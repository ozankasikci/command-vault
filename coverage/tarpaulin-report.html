<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","Users","ozan","Projects","command-vault","src","cli","args.rs"],"content":"use clap::{Parser, Subcommand};\n\n#[derive(Parser, Debug)]\n#[command(author, version, about, long_about = None)]\npub struct Cli {\n    #[command(subcommand)]\n    pub command: Commands,\n\n    /// Enable debug mode to see detailed command execution information\n    #[arg(short, long)]\n    pub debug: bool,\n}\n\n#[derive(Subcommand, Debug)]\npub enum Commands {\n    /// Add a command to history\n    ///\n    /// Parameters can be specified using @name:description=default syntax\n    /// Examples:\n    ///   - Basic parameter: @filename\n    ///   - With description: @filename:Name of file to create\n    ///   - With default: @filename:Name of file to create=test.txt\n    Add {\n        /// Tags to add to the command\n        #[arg(short, long)]\n        tags: Vec\u003cString\u003e,\n        \n        /// Command to add\n        #[arg(trailing_var_arg = true, required = true)]\n        command: Vec\u003cString\u003e,\n    },\n    \n    /// Execute a command by id (in the current shell)\n    Exec {\n        /// Command ID to execute\n        command_id: i64,\n        \n        /// Enable debug mode\n        #[arg(long)]\n        debug: bool,\n    },\n    /// Search through command history\n    Search {\n        /// Search query\n        #[arg(required = true)]\n        query: String,\n        \n        /// Maximum number of results to show\n        #[arg(short, long, default_value = \"10\")]\n        limit: usize,\n    },\n    /// List all commands in chronological order\n    Ls {\n        /// Maximum number of results to show. Use 0 to show all commands.\n        #[arg(short, long, default_value = \"50\")]\n        limit: usize,\n        \n        /// Sort in ascending order (oldest first)\n        #[arg(short = 'a', long)]\n        asc: bool,\n    },\n    /// Tag related operations\n    Tag {\n        #[command(subcommand)]\n        action: TagCommands,\n    },\n    /// Initialize shell integration\n    ShellInit {\n        /// Shell to initialize (defaults to current shell)\n        #[arg(short, long)]\n        shell: Option\u003cString\u003e,\n    },\n    /// Delete a command from history\n    Delete {\n        /// Command ID to delete\n        #[arg(required = true)]\n        command_id: i64,\n    },\n}\n\n#[derive(Subcommand, Debug)]\npub enum TagCommands {\n    /// Add tags to a command\n    Add {\n        /// Command ID to tag\n        #[arg(required = true)]\n        command_id: i64,\n        \n        /// Tags to add\n        #[arg(required = true)]\n        tags: Vec\u003cString\u003e,\n    },\n    /// Remove a tag from a command\n    Remove {\n        /// Command ID to remove tag from\n        #[arg(required = true)]\n        command_id: i64,\n        \n        /// Tag to remove\n        #[arg(required = true)]\n        tag: String,\n    },\n    /// List all tags and their usage count\n    List,\n    /// Search commands by tag\n    Search {\n        /// Tag to search for\n        #[arg(required = true)]\n        tag: String,\n        \n        /// Maximum number of results to show\n        #[arg(short, long, default_value = \"10\")]\n        limit: usize,\n    },\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","cli","commands.rs"],"content":"use anyhow::{Result, anyhow};\nuse chrono::{Local, Utc};\nuse std::io::{self, Stdout};\nuse crossterm::{\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    layout::{Constraint, Direction, Layout},\n    style::{Color, Style},\n    text::{Line, Span},\n    widgets::{Block, Borders, Paragraph},\n    Terminal,\n};\nuse colored::*;\n\nuse crate::db::{Command, Database};\nuse crate::ui::App;\nuse crate::utils::params::parse_parameters;\nuse crate::utils::params::substitute_parameters;\nuse crate::exec::{ExecutionContext, execute_shell_command};\n\nuse super::args::{Commands, TagCommands};\n\n// Terminal interface trait for testability\n#[cfg(test)]\npub trait TerminalInterface {\n    fn setup(\u0026self) -\u003e Result\u003c()\u003e;\n    fn display_commands(\u0026self, commands: \u0026[Command]) -\u003e Result\u003c()\u003e;\n    fn cleanup(\u0026self) -\u003e Result\u003c()\u003e;\n}\n\nfn print_commands(commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n    let terminal_result = setup_terminal();\n    \n    match terminal_result {\n        Ok(mut terminal) =\u003e {\n            let res = print_commands_ui(\u0026mut terminal, commands);\n            restore_terminal(\u0026mut terminal)?;\n            res\n        }\n        Err(_) =\u003e {\n            // Fallback to simple text output\n            println!(\"Command History:\");\n            println!(\"─────────────────────────────────────────────\");\n            for cmd in commands {\n                let local_time = cmd.timestamp.with_timezone(\u0026Local);\n                println!(\"{} │ {}\", local_time.format(\"%Y-%m-%d %H:%M:%S\"), cmd.command);\n                if !cmd.tags.is_empty() {\n                    println!(\"    Tags: {}\", cmd.tags.join(\", \"));\n                }\n                if !cmd.parameters.is_empty() {\n                    println!(\"    Parameters:\");\n                    for param in \u0026cmd.parameters {\n                        let desc = param.description.as_deref().unwrap_or(\"None\");\n                        println!(\"      - {}: {} (default: {})\", param.name, desc, \"None\");\n                    }\n                }\n                println!(\"    Directory: {}\", cmd.directory);\n                println!();\n            }\n            Ok(())\n        }\n    }\n}\n\nfn print_commands_ui(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e, commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n    terminal.draw(|f| {\n        let chunks = Layout::default()\n            .direction(Direction::Vertical)\n            .margin(1)\n            .constraints([Constraint::Min(0)])\n            .split(f.size());\n\n        let mut lines = vec![];\n        lines.push(Line::from(Span::styled(\n            \"Command History:\",\n            Style::default().fg(Color::Cyan),\n        )));\n        lines.push(Line::from(Span::raw(\"─────────────────────────────────────────────\")));\n\n        for cmd in commands {\n            let local_time = cmd.timestamp.with_timezone(\u0026Local);\n            lines.push(Line::from(vec![\n                Span::styled(local_time.format(\"%Y-%m-%d %H:%M:%S\").to_string(), Style::default().fg(Color::Yellow)),\n                Span::raw(\" │ \"),\n                Span::raw(\u0026cmd.command),\n            ]));\n            lines.push(Line::from(vec![\n                Span::raw(\"    Directory: \"),\n                Span::raw(\u0026cmd.directory),\n            ]));\n            if !cmd.tags.is_empty() {\n                lines.push(Line::from(vec![\n                    Span::raw(\"    Tags: \"),\n                    Span::raw(cmd.tags.join(\", \")),\n                ]));\n            }\n            lines.push(Line::from(Span::raw(\"─────────────────────────────────────────────\")));\n        }\n\n        let paragraph = Paragraph::new(lines).block(Block::default().borders(Borders::ALL));\n        f.render_widget(paragraph, chunks[0]);\n    })?;\n    Ok(())\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    Terminal::new(backend).map_err(|e| e.into())\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    disable_raw_mode()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    terminal.show_cursor()?;\n    Ok(())\n}\n\npub fn handle_command(command: Commands, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    match command {\n        Commands::Add { command, tags } =\u003e {\n            handle_add_command(command, tags, db)?\n        }\n        Commands::Search { query, limit } =\u003e {\n            handle_search_command(\u0026query, limit, db, debug)?\n        }\n        Commands::Ls { limit, asc } =\u003e {\n            handle_list_command(limit, asc, db, debug)?\n        }\n        Commands::Tag { action } =\u003e {\n            handle_tag_command(action, db)?\n        },\n        Commands::Exec { command_id, debug } =\u003e {\n            handle_exec_command(command_id, db, debug)?\n        }\n        Commands::ShellInit { shell } =\u003e {\n            let script_path = crate::shell::hooks::init_shell(shell)?;\n            if !script_path.exists() {\n                return Err(anyhow!(\"Shell integration script not found at: {}\", script_path.display()));\n            }\n            print!(\"{}\", script_path.display());\n        },\n        Commands::Delete { command_id } =\u003e {\n            handle_delete_command(command_id, db)?\n        }\n    }\n    Ok(())\n}\n\n// Extract individual command handlers for better testability\nfn handle_add_command(command: Vec\u003cString\u003e, tags: Vec\u003cString\u003e, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    // Process command parts with special handling for git format strings\n    let command_str = command.iter().enumerate().fold(String::new(), |mut acc, (i, arg)| {\n        if i \u003e 0 {\n            acc.push(' ');\n        }\n        // Special case for git format strings\n        if arg.starts_with(\"--pretty=format:\") {\n            acc.push_str(\u0026format!(\"\\\"{}\\\"\", arg));\n        } else {\n            acc.push_str(arg);\n        }\n        acc\n    });\n    \n    // Don't allow empty commands\n    if command_str.trim().is_empty() {\n        return Err(anyhow!(\"Cannot add empty command\"));\n    }\n    \n    // Get the current directory\n    let directory = std::env::current_dir()?\n        .to_string_lossy()\n        .to_string();\n    \n    let timestamp = Local::now().with_timezone(\u0026Utc);\n    \n    // Parse parameters from command string\n    let parameters = parse_parameters(\u0026command_str);\n    \n    let cmd = Command {\n        id: None,\n        command: command_str.clone(),\n        timestamp,\n        directory,\n        tags,\n        parameters,\n    };\n    let id = db.add_command(\u0026cmd)?;\n    println!(\"Command added to history with ID: {}\", id);\n    \n    // If command has parameters, show them\n    if !cmd.parameters.is_empty() {\n        println!(\"\\nDetected parameters:\");\n        for param in \u0026cmd.parameters {\n            let desc = param.description.as_deref().unwrap_or(\"None\");\n            println!(\"  {} - Description: {}\", param.name.yellow(), desc);\n        }\n    }\n    \n    Ok(())\n}\n\nfn handle_search_command(query: \u0026str, limit: usize, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let commands = db.search_commands(query, limit)?;\n    \n    // Check if TUI should be disabled (useful for testing or non-interactive environments)\n    if std::env::var(\"COMMAND_VAULT_NO_TUI\").is_ok() {\n        if commands.is_empty() {\n            print!(\"No commands found matching query: {}\", query);\n            return Ok(());\n        }\n        \n        for cmd in commands {\n            print!(\"{}: {} ({})\", cmd.id.unwrap_or(0), cmd.command, cmd.directory);\n        }\n        return Ok(());\n    }\n    \n    let mut app = App::new(commands.clone(), db, debug);\n    match app.run() {\n        Ok(_) =\u003e (),\n        Err(e) =\u003e {\n            if e.to_string() == \"Operation cancelled by user\" {\n                print!(\"\\n{}\", \"Operation cancelled.\".yellow());\n                return Ok(());\n            }\n            eprintln!(\"Failed to start TUI mode: {}\", e);\n            print_commands(\u0026commands)?;\n        }\n    }\n    Ok(())\n}\n\nfn handle_list_command(limit: usize, asc: bool, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let commands = db.list_commands(limit, asc)?;\n    if commands.is_empty() {\n        print!(\"No commands found.\");\n        return Ok(());\n    }\n\n    // Check if TUI should be disabled (useful for testing or non-interactive environments)\n    if std::env::var(\"COMMAND_VAULT_NO_TUI\").is_ok() {\n        for cmd in commands {\n            print!(\"{}: {} ({})\", cmd.id.unwrap_or(0), cmd.command, cmd.directory);\n        }\n        return Ok(());\n    }\n\n    let mut app = App::new(commands.clone(), db, debug);\n    match app.run() {\n        Ok(_) =\u003e (),\n        Err(e) =\u003e {\n            if e.to_string() == \"Operation cancelled by user\" {\n                print!(\"\\n{}\", \"Operation cancelled.\".yellow());\n                return Ok(());\n            }\n            eprintln!(\"Failed to start TUI mode: {}\", e);\n            print_commands(\u0026commands)?;\n        }\n    }\n    Ok(())\n}\n\nfn handle_tag_command(action: TagCommands, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    match action {\n        TagCommands::Add { command_id, tags } =\u003e {\n            match db.add_tags_to_command(command_id, \u0026tags) {\n                Ok(_) =\u003e print!(\"Tags added successfully\"),\n                Err(e) =\u003e eprintln!(\"Failed to add tags: {}\", e),\n            }\n        }\n        TagCommands::Remove { command_id, tag } =\u003e {\n            match db.remove_tag_from_command(command_id, \u0026tag) {\n                Ok(_) =\u003e print!(\"Tag removed successfully\"),\n                Err(e) =\u003e eprintln!(\"Failed to remove tag: {}\", e),\n            }\n        }\n        TagCommands::List =\u003e {\n            match db.list_tags() {\n                Ok(tags) =\u003e {\n                    if tags.is_empty() {\n                        print!(\"No tags found\");\n                        return Ok(());\n                    }\n                    \n                    print!(\"\\nTags and their usage:\");\n                    print!(\"─────────────────────────────────────────────\");\n                    for (tag, count) in tags {\n                        print!(\"{}: {} command{}\", tag, count, if count == 1 { \"\" } else { \"s\" });\n                    }\n                }\n                Err(e) =\u003e eprintln!(\"Failed to list tags: {}\", e),\n            }\n        }\n        TagCommands::Search { tag, limit } =\u003e {\n            match db.search_by_tag(\u0026tag, limit) {\n                Ok(commands) =\u003e print_commands(\u0026commands)?,\n                Err(e) =\u003e eprintln!(\"Failed to search by tag: {}\", e),\n            }\n        }\n    }\n    Ok(())\n}\n\nfn handle_exec_command(command_id: i64, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let command = db.get_command(command_id)?\n        .ok_or_else(|| anyhow!(\"Command not found with ID: {}\", command_id))?;\n    \n    // Create the directory if it doesn't exist\n    if !std::path::Path::new(\u0026command.directory).exists() {\n        std::fs::create_dir_all(\u0026command.directory)?;\n    }\n    \n    let current_params = parse_parameters(\u0026command.command);\n    let final_command = substitute_parameters(\u0026command.command, \u0026current_params, None)?;\n\n    let ctx = ExecutionContext {\n        command: final_command.clone(),\n        directory: command.directory.clone(),\n        test_mode: std::env::var(\"COMMAND_VAULT_TEST\").is_ok(),\n        debug_mode: debug,\n    };\n\n    println!(\"\\n─────────────────────────────────────────────\");\n    println!(\"Command to execute: {}\", final_command);\n    println!(\"Working directory: {}\", command.directory);\n    println!();  // Add extra newline before command output\n\n    execute_shell_command(\u0026ctx)?;\n    \n    Ok(())\n}\n\nfn handle_delete_command(command_id: i64, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    // First check if the command exists\n    if let Some(command) = db.get_command(command_id)? {\n        // Show the command that will be deleted\n        println!(\"Deleting command:\");\n        print_commands(\u0026[command])?;\n        \n        // Delete the command\n        db.delete_command(command_id)?;\n        println!(\"Command deleted successfully\");\n    } else {\n        return Err(anyhow!(\"Command with ID {} not found\", command_id));\n    }\n    \n    Ok(())\n}\n\n// Unit tests for the command handlers\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::db::models::Parameter;\n    \n    // Mock terminal for testing\n    pub struct MockTerminal {\n        pub commands_displayed: Vec\u003cCommand\u003e,\n    }\n    \n    impl MockTerminal {\n        pub fn new() -\u003e Self {\n            MockTerminal {\n                commands_displayed: Vec::new(),\n            }\n        }\n    }\n    \n    impl TerminalInterface for MockTerminal {\n        fn setup(\u0026self) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n        \n        fn display_commands(\u0026self, commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n        \n        fn cleanup(\u0026self) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n    }\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":6}},{"line":35,"address":[],"length":0,"stats":{"Line":6}},{"line":37,"address":[],"length":0,"stats":{"Line":6}},{"line":38,"address":[],"length":0,"stats":{"Line":6}},{"line":39,"address":[],"length":0,"stats":{"Line":6}},{"line":40,"address":[],"length":0,"stats":{"Line":6}},{"line":41,"address":[],"length":0,"stats":{"Line":6}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":6}},{"line":69,"address":[],"length":0,"stats":{"Line":12}},{"line":70,"address":[],"length":0,"stats":{"Line":6}},{"line":71,"address":[],"length":0,"stats":{"Line":6}},{"line":72,"address":[],"length":0,"stats":{"Line":6}},{"line":73,"address":[],"length":0,"stats":{"Line":6}},{"line":74,"address":[],"length":0,"stats":{"Line":6}},{"line":76,"address":[],"length":0,"stats":{"Line":6}},{"line":77,"address":[],"length":0,"stats":{"Line":6}},{"line":78,"address":[],"length":0,"stats":{"Line":6}},{"line":79,"address":[],"length":0,"stats":{"Line":6}},{"line":81,"address":[],"length":0,"stats":{"Line":6}},{"line":83,"address":[],"length":0,"stats":{"Line":26}},{"line":94,"address":[],"length":0,"stats":{"Line":8}},{"line":95,"address":[],"length":0,"stats":{"Line":8}},{"line":96,"address":[],"length":0,"stats":{"Line":8}},{"line":97,"address":[],"length":0,"stats":{"Line":8}},{"line":100,"address":[],"length":0,"stats":{"Line":10}},{"line":103,"address":[],"length":0,"stats":{"Line":6}},{"line":104,"address":[],"length":0,"stats":{"Line":6}},{"line":106,"address":[],"length":0,"stats":{"Line":6}},{"line":109,"address":[],"length":0,"stats":{"Line":6}},{"line":110,"address":[],"length":0,"stats":{"Line":6}},{"line":111,"address":[],"length":0,"stats":{"Line":6}},{"line":112,"address":[],"length":0,"stats":{"Line":6}},{"line":113,"address":[],"length":0,"stats":{"Line":6}},{"line":114,"address":[],"length":0,"stats":{"Line":12}},{"line":117,"address":[],"length":0,"stats":{"Line":6}},{"line":118,"address":[],"length":0,"stats":{"Line":6}},{"line":119,"address":[],"length":0,"stats":{"Line":6}},{"line":120,"address":[],"length":0,"stats":{"Line":6}},{"line":121,"address":[],"length":0,"stats":{"Line":6}},{"line":124,"address":[],"length":0,"stats":{"Line":42}},{"line":125,"address":[],"length":0,"stats":{"Line":42}},{"line":126,"address":[],"length":0,"stats":{"Line":12}},{"line":127,"address":[],"length":0,"stats":{"Line":14}},{"line":129,"address":[],"length":0,"stats":{"Line":2}},{"line":130,"address":[],"length":0,"stats":{"Line":2}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":10}},{"line":136,"address":[],"length":0,"stats":{"Line":10}},{"line":138,"address":[],"length":0,"stats":{"Line":6}},{"line":139,"address":[],"length":0,"stats":{"Line":10}},{"line":141,"address":[],"length":0,"stats":{"Line":6}},{"line":142,"address":[],"length":0,"stats":{"Line":12}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":4}},{"line":148,"address":[],"length":0,"stats":{"Line":6}},{"line":149,"address":[],"length":0,"stats":{"Line":8}},{"line":152,"address":[],"length":0,"stats":{"Line":32}},{"line":156,"address":[],"length":0,"stats":{"Line":12}},{"line":158,"address":[],"length":0,"stats":{"Line":40}},{"line":159,"address":[],"length":0,"stats":{"Line":44}},{"line":160,"address":[],"length":0,"stats":{"Line":16}},{"line":163,"address":[],"length":0,"stats":{"Line":30}},{"line":164,"address":[],"length":0,"stats":{"Line":2}},{"line":166,"address":[],"length":0,"stats":{"Line":26}},{"line":168,"address":[],"length":0,"stats":{"Line":28}},{"line":172,"address":[],"length":0,"stats":{"Line":12}},{"line":173,"address":[],"length":0,"stats":{"Line":2}},{"line":177,"address":[],"length":0,"stats":{"Line":10}},{"line":194,"address":[],"length":0,"stats":{"Line":10}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":10}},{"line":209,"address":[],"length":0,"stats":{"Line":2}},{"line":210,"address":[],"length":0,"stats":{"Line":4}},{"line":214,"address":[],"length":0,"stats":{"Line":2}},{"line":215,"address":[],"length":0,"stats":{"Line":2}},{"line":216,"address":[],"length":0,"stats":{"Line":2}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":10}},{"line":271,"address":[],"length":0,"stats":{"Line":10}},{"line":272,"address":[],"length":0,"stats":{"Line":4}},{"line":273,"address":[],"length":0,"stats":{"Line":4}},{"line":274,"address":[],"length":0,"stats":{"Line":2}},{"line":275,"address":[],"length":0,"stats":{"Line":2}},{"line":278,"address":[],"length":0,"stats":{"Line":2}},{"line":279,"address":[],"length":0,"stats":{"Line":2}},{"line":280,"address":[],"length":0,"stats":{"Line":2}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":2}},{"line":286,"address":[],"length":0,"stats":{"Line":2}},{"line":287,"address":[],"length":0,"stats":{"Line":2}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":2}},{"line":293,"address":[],"length":0,"stats":{"Line":2}},{"line":294,"address":[],"length":0,"stats":{"Line":18}},{"line":295,"address":[],"length":0,"stats":{"Line":8}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":2}},{"line":302,"address":[],"length":0,"stats":{"Line":2}},{"line":303,"address":[],"length":0,"stats":{"Line":2}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":10}},{"line":311,"address":[],"length":0,"stats":{"Line":6}},{"line":312,"address":[],"length":0,"stats":{"Line":10}},{"line":313,"address":[],"length":0,"stats":{"Line":10}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":4}},{"line":321,"address":[],"length":0,"stats":{"Line":4}},{"line":335,"address":[],"length":0,"stats":{"Line":2}},{"line":337,"address":[],"length":0,"stats":{"Line":2}},{"line":340,"address":[],"length":0,"stats":{"Line":6}},{"line":342,"address":[],"length":0,"stats":{"Line":10}},{"line":344,"address":[],"length":0,"stats":{"Line":4}},{"line":345,"address":[],"length":0,"stats":{"Line":4}},{"line":348,"address":[],"length":0,"stats":{"Line":4}},{"line":349,"address":[],"length":0,"stats":{"Line":4}},{"line":351,"address":[],"length":0,"stats":{"Line":2}},{"line":354,"address":[],"length":0,"stats":{"Line":4}}],"covered":108,"coverable":164},{"path":["/","Users","ozan","Projects","command-vault","src","cli","mod.rs"],"content":"pub mod args;\npub mod commands;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","db","mod.rs"],"content":"pub mod models;\npub mod store;\n\npub use models::Command;\npub use store::Database;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","db","models.rs"],"content":"//! Database models for command-vault\n//! \n//! This module defines the core data structures used throughout the application.\n\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\n\n/// Represents a command with its metadata.\n/// \n/// A command includes the actual command string, execution directory,\n/// timestamp, tags, and parameters.\n/// \n/// # Example\n/// ```rust\n/// use command_vault::db::models::Command;\n/// use chrono::Utc;\n/// \n/// let cmd = Command {\n///     id: None,\n///     command: \"git push origin main\".to_string(),\n///     timestamp: Utc::now(),\n///     directory: \"/project\".to_string(),\n///     tags: vec![\"git\".to_string()],\n///     parameters: vec![],\n/// };\n/// ```\n#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]\npub struct Command {\n    /// Unique identifier for the command\n    pub id: Option\u003ci64\u003e,\n    \n    /// The actual command string\n    pub command: String,\n    \n    /// When the command was created or last modified\n    pub timestamp: DateTime\u003cUtc\u003e,\n    \n    /// Directory where the command should be executed\n    pub directory: String,\n    \n    /// Tags associated with the command\n    #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n    pub tags: Vec\u003cString\u003e,\n    \n    /// Parameters that can be substituted in the command\n    #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n    pub parameters: Vec\u003cParameter\u003e,\n}\n\n/// Represents a parameter that can be substituted in a command.\n/// \n/// Parameters allow commands to be more flexible by providing\n/// placeholders that can be filled in at runtime.\n/// \n/// # Example\n/// ```rust\n/// use command_vault::db::models::Parameter;\n/// \n/// let param = Parameter {\n///     name: \"branch\".to_string(),\n///     description: Some(\"Git branch name\".to_string()),\n/// };\n/// ```\n#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]\npub struct Parameter {\n    /// Name of the parameter (used in substitution)\n    pub name: String,\n    \n    /// Optional description of what the parameter does\n    pub description: Option\u003cString\u003e,\n}\n\nimpl Parameter {\n    pub fn new(name: String) -\u003e Self {\n        Self {\n            name,\n            description: None,\n        }\n    }\n\n    pub fn with_description(name: String, description: Option\u003cString\u003e) -\u003e Self {\n        Self {\n            name,\n            description,\n        }\n    }\n}\n","traces":[{"line":74,"address":[],"length":0,"stats":{"Line":8}},{"line":81,"address":[],"length":0,"stats":{"Line":62}}],"covered":2,"coverable":2},{"path":["/","Users","ozan","Projects","command-vault","src","db","store.rs"],"content":"//! Database module for command-vault\n//! \n//! This module provides SQLite-based storage for commands, tags, and parameters.\n//! It handles all database operations including CRUD operations for commands,\n//! tag management, and search functionality.\n\nuse anyhow::{Result, anyhow};\nuse rusqlite::Connection;\nuse chrono::Utc;\nuse serde_json;\n\nuse super::models::Command;\n\n/// The main database interface for command-vault.\n/// \n/// Handles all database operations including:\n/// - Command storage and retrieval\n/// - Tag management\n/// - Search functionality\n/// \n/// # Example\n/// ```no_run\n/// use anyhow::Result;\n/// use command_vault::db::Database;\n/// \n/// fn main() -\u003e Result\u003c()\u003e {\n///     let db = Database::new(\"commands.db\")?;\n///     db.init()?;\n///     Ok(())\n/// }\n/// ```\npub struct Database {\n    conn: Connection,\n}\n\nimpl Database {\n    /// Creates a new database connection.\n    /// \n    /// # Arguments\n    /// * `path` - Path to the SQLite database file\n    /// \n    /// # Returns\n    /// * `Result\u003cDatabase\u003e` - A new database instance\n    pub fn new(path: \u0026str) -\u003e Result\u003cSelf\u003e {\n        let conn = Connection::open(path)?;\n        let db = Database { conn };\n        db.init()?;\n        Ok(db)\n    }\n\n    /// Initializes the database schema.\n    /// \n    /// Creates the following tables if they don't exist:\n    /// - commands: Stores command information\n    /// - tags: Stores tag information\n    /// - command_tags: Links commands to tags\n    pub fn init(\u0026self) -\u003e Result\u003c()\u003e {\n        // Create commands table\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS commands (\n                id INTEGER PRIMARY KEY,\n                command TEXT NOT NULL,\n                timestamp TEXT NOT NULL,\n                directory TEXT NOT NULL,\n                tags TEXT NOT NULL DEFAULT '',\n                parameters TEXT NOT NULL DEFAULT '[]'\n            )\",\n            [],\n        )?;\n        \n        // Create tags table\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS tags (\n                id INTEGER PRIMARY KEY,\n                name TEXT NOT NULL UNIQUE\n            )\",\n            [],\n        )?;\n\n        // Create command_tags table for many-to-many relationship\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS command_tags (\n                command_id INTEGER NOT NULL,\n                tag_id INTEGER NOT NULL,\n                PRIMARY KEY (command_id, tag_id),\n                FOREIGN KEY (command_id) REFERENCES commands(id) ON DELETE CASCADE,\n                FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE\n            )\",\n            [],\n        )?;\n        \n        // Create indexes\n        self.conn.execute(\n            \"CREATE INDEX IF NOT EXISTS idx_commands_command ON commands(command)\",\n            [],\n        )?;\n        self.conn.execute(\n            \"CREATE INDEX IF NOT EXISTS idx_tags_name ON tags(name)\",\n            [],\n        )?;\n        \n        Ok(())\n    }\n\n    /// Adds a new command to the database.\n    /// \n    /// # Arguments\n    /// * `command` - The command to add\n    /// \n    /// # Returns\n    /// * `Result\u003ci64\u003e` - The ID of the newly added command\n    pub fn add_command(\u0026mut self, command: \u0026Command) -\u003e Result\u003ci64\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // Insert the command\n        tx.execute(\n            \"INSERT INTO commands (command, timestamp, directory, tags, parameters)\n             VALUES (?1, ?2, ?3, ?4, ?5)\",\n            (\n                \u0026command.command,\n                \u0026command.timestamp.to_rfc3339(),\n                \u0026command.directory,\n                \u0026command.tags.join(\",\"),\n                \u0026serde_json::to_string(\u0026command.parameters)?,\n            ),\n        )?;\n        \n        let command_id = tx.last_insert_rowid();\n        \n        // Add tags if present\n        for tag in \u0026command.tags {\n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command_id, tag_id],\n            )?;\n        }\n        \n        tx.commit()?;\n        Ok(command_id)\n    }\n\n    /// Adds tags to an existing command.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to add tags to\n    /// * `tags` - The tags to add\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn add_tags_to_command(\u0026mut self, command_id: i64, tags: \u0026[String]) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // Verify command exists\n        let exists: bool = tx.query_row(\n            \"SELECT 1 FROM commands WHERE id = ?1\",\n            [command_id],\n            |_| Ok(true),\n        ).unwrap_or(false);\n        \n        if !exists {\n            return Err(anyhow!(\"Command not found\"));\n        }\n        \n        // Get current tags\n        let mut current_tags = Vec::new();\n        {\n            let mut stmt = tx.prepare(\n                \"SELECT t.name \n                 FROM tags t \n                 JOIN command_tags ct ON ct.tag_id = t.id \n                 WHERE ct.command_id = ?1\"\n            )?;\n            let mut rows = stmt.query([command_id])?;\n            while let Some(row) = rows.next()? {\n                current_tags.push(row.get::\u003c_, String\u003e(0)?);\n            }\n        }\n        \n        for tag in tags {\n            // Skip if tag already exists\n            if current_tags.contains(tag) {\n                continue;\n            }\n            \n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command_id, tag_id],\n            )?;\n            \n            // Update tags string in commands table\n            current_tags.push(tag.clone());\n        }\n        \n        // Update the tags string in the commands table\n        tx.execute(\n            \"UPDATE commands SET tags = ?1 WHERE id = ?2\",\n            rusqlite::params![current_tags.join(\",\"), command_id],\n        )?;\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Removes a tag from a command.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to remove the tag from\n    /// * `tag_name` - The name of the tag to remove\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn remove_tag_from_command(\u0026mut self, command_id: i64, tag_name: \u0026str) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        tx.execute(\n            \"DELETE FROM command_tags \n             WHERE command_id = ?1 \n             AND tag_id = (SELECT id FROM tags WHERE name = ?2)\",\n            rusqlite::params![command_id, tag_name],\n        )?;\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Searches for commands containing a given query string.\n    /// \n    /// # Arguments\n    /// * `query` - The query string to search for\n    /// * `limit` - The maximum number of results to return\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of matching commands\n    pub fn search_commands(\u0026self, query: \u0026str, limit: usize) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n             FROM commands c\n             WHERE c.command LIKE '%' || ?1 || '%'\n             ORDER BY c.timestamp DESC\n             LIMIT ?2\"\n        )?;\n\n        let mut rows = stmt.query([query, \u0026limit.to_string()])?;\n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Searches for commands with a given tag.\n    /// \n    /// # Arguments\n    /// * `tag` - The tag to search for\n    /// * `limit` - The maximum number of results to return\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of matching commands\n    pub fn search_by_tag(\u0026self, tag: \u0026str, limit: usize) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT DISTINCT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n             FROM commands c\n             JOIN command_tags ct ON ct.command_id = c.id\n             JOIN tags t ON t.id = ct.tag_id\n             WHERE t.name = ?1\n             ORDER BY c.timestamp DESC\n             LIMIT ?2\"\n        )?;\n\n        let mut rows = stmt.query([tag, \u0026limit.to_string()])?;\n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Lists all tags in the database.\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003c(String, i64)\u003e\u003e` - A list of tags with their respective counts\n    pub fn list_tags(\u0026self) -\u003e Result\u003cVec\u003c(String, i64)\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT t.name, COUNT(ct.command_id) as count\n             FROM tags t\n             LEFT JOIN command_tags ct ON ct.tag_id = t.id\n             GROUP BY t.id, t.name\n             ORDER BY count DESC, t.name\"\n        )?;\n        \n        let tags = stmt.query_map([], |row| {\n            Ok((row.get::\u003c_, String\u003e(0)?, row.get(1)?))\n        })?\n        .collect::\u003cstd::result::Result\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n        \n        Ok(tags)\n    }\n\n    /// Lists all commands in the database.\n    /// \n    /// # Arguments\n    /// * `limit` - The maximum number of results to return\n    /// * `ascending` - Whether to return results in ascending order\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of commands\n    pub fn list_commands(\u0026self, limit: usize, ascending: bool) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let query = if ascending {\n            if limit == 0 {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp ASC\"\n            } else {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp ASC\n                 LIMIT ?1\"\n            }\n        } else {\n            if limit == 0 {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp DESC\"\n            } else {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp DESC\n                 LIMIT ?1\"\n            }\n        };\n\n        let mut stmt = self.conn.prepare(query)?;\n        let mut rows = if limit == 0 {\n            stmt.query([])?\n        } else {\n            stmt.query([limit])?\n        };\n        \n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Gets a command by its ID.\n    /// \n    /// # Arguments\n    /// * `id` - The ID of the command to retrieve\n    /// \n    /// # Returns\n    /// * `Result\u003cOption\u003cCommand\u003e\u003e` - The command if found\n    pub fn get_command(\u0026self, id: i64) -\u003e Result\u003cOption\u003cCommand\u003e\u003e {\n        // First get the command details\n        let mut stmt = self.conn.prepare(\n            \"SELECT command, timestamp, directory, parameters \n             FROM commands \n             WHERE id = ?1\"\n        )?;\n\n        let command = stmt.query_row([id], |row| {\n            Ok((\n                row.get::\u003c_, String\u003e(0)?,\n                row.get::\u003c_, String\u003e(1)?,\n                row.get::\u003c_, String\u003e(2)?,\n                row.get::\u003c_, String\u003e(3)?,\n            ))\n        });\n\n        if let Ok((command, timestamp, directory, parameters)) = command {\n            // Then get the tags\n            let mut stmt = self.conn.prepare(\n                \"SELECT t.name \n                 FROM tags t \n                 JOIN command_tags ct ON ct.tag_id = t.id \n                 WHERE ct.command_id = ?1\"\n            )?;\n\n            let mut tags = Vec::new();\n            let mut rows = stmt.query([id])?;\n            while let Some(row) = rows.next()? {\n                tags.push(row.get::\u003c_, String\u003e(0)?);\n            }\n\n            Ok(Some(Command {\n                id: Some(id),\n                command,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026timestamp)?\n                    .with_timezone(\u0026Utc),\n                directory,\n                tags,\n                parameters: serde_json::from_str(\u0026parameters)?,\n            }))\n        } else {\n            Ok(None)\n        }\n    }\n\n    /// Updates an existing command.\n    /// \n    /// # Arguments\n    /// * `command` - The updated command\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn update_command(\u0026mut self, command: \u0026Command) -\u003e Result\u003c()\u003e {\n        if command.id.is_none() {\n            return Err(anyhow!(\"Cannot update command without id\"));\n        }\n\n        let tx = self.conn.transaction()?;\n        \n        // Update command\n        tx.execute(\n            \"UPDATE commands \n             SET command = ?1, \n                 timestamp = ?2,\n                 directory = ?3,\n                 tags = ?4,\n                 parameters = ?5\n             WHERE id = ?6\",\n            rusqlite::params![\n                command.command,\n                command.timestamp.to_rfc3339(),\n                command.directory,\n                command.tags.join(\",\"),\n                serde_json::to_string(\u0026command.parameters)?,\n                command.id.unwrap()\n            ],\n        )?;\n\n        // Delete existing tags\n        tx.execute(\n            \"DELETE FROM command_tags WHERE command_id = ?1\",\n            [command.id.unwrap()],\n        )?;\n\n        // Add new tags using the same transaction\n        for tag in \u0026command.tags {\n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command.id.unwrap(), tag_id],\n            )?;\n        }\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Deletes a command by its ID.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to delete\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn delete_command(\u0026mut self, command_id: i64) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // First delete from command_tags\n        tx.execute(\n            \"DELETE FROM command_tags WHERE command_id = ?\",\n            [command_id],\n        )?;\n\n        // Then delete from commands\n        let rows_affected = tx.execute(\n            \"DELETE FROM commands WHERE id = ?\",\n            [command_id],\n        )?;\n\n        if rows_affected == 0 {\n            return Err(anyhow!(\"Command not found\"));\n        }\n\n        // Clean up unused tags\n        tx.execute(\n            \"DELETE FROM tags WHERE id NOT IN (SELECT DISTINCT tag_id FROM command_tags)\",\n            [],\n        )?;\n\n        tx.commit()?;\n        Ok(())\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":144}},{"line":45,"address":[],"length":0,"stats":{"Line":288}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":144}},{"line":57,"address":[],"length":0,"stats":{"Line":170}},{"line":59,"address":[],"length":0,"stats":{"Line":170}},{"line":72,"address":[],"length":0,"stats":{"Line":170}},{"line":81,"address":[],"length":0,"stats":{"Line":170}},{"line":93,"address":[],"length":0,"stats":{"Line":170}},{"line":97,"address":[],"length":0,"stats":{"Line":170}},{"line":102,"address":[],"length":0,"stats":{"Line":170}},{"line":112,"address":[],"length":0,"stats":{"Line":328}},{"line":113,"address":[],"length":0,"stats":{"Line":656}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":328}},{"line":131,"address":[],"length":0,"stats":{"Line":544}},{"line":138,"address":[],"length":0,"stats":{"Line":216}},{"line":140,"address":[],"length":0,"stats":{"Line":108}},{"line":141,"address":[],"length":0,"stats":{"Line":216}},{"line":151,"address":[],"length":0,"stats":{"Line":328}},{"line":152,"address":[],"length":0,"stats":{"Line":328}},{"line":163,"address":[],"length":0,"stats":{"Line":20}},{"line":164,"address":[],"length":0,"stats":{"Line":40}},{"line":170,"address":[],"length":0,"stats":{"Line":14}},{"line":174,"address":[],"length":0,"stats":{"Line":6}},{"line":178,"address":[],"length":0,"stats":{"Line":14}},{"line":180,"address":[],"length":0,"stats":{"Line":14}},{"line":186,"address":[],"length":0,"stats":{"Line":14}},{"line":187,"address":[],"length":0,"stats":{"Line":18}},{"line":188,"address":[],"length":0,"stats":{"Line":2}},{"line":192,"address":[],"length":0,"stats":{"Line":50}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":18}},{"line":201,"address":[],"length":0,"stats":{"Line":18}},{"line":204,"address":[],"length":0,"stats":{"Line":36}},{"line":206,"address":[],"length":0,"stats":{"Line":18}},{"line":207,"address":[],"length":0,"stats":{"Line":36}},{"line":217,"address":[],"length":0,"stats":{"Line":18}},{"line":221,"address":[],"length":0,"stats":{"Line":14}},{"line":223,"address":[],"length":0,"stats":{"Line":14}},{"line":226,"address":[],"length":0,"stats":{"Line":14}},{"line":227,"address":[],"length":0,"stats":{"Line":14}},{"line":238,"address":[],"length":0,"stats":{"Line":6}},{"line":239,"address":[],"length":0,"stats":{"Line":12}},{"line":248,"address":[],"length":0,"stats":{"Line":6}},{"line":249,"address":[],"length":0,"stats":{"Line":6}},{"line":260,"address":[],"length":0,"stats":{"Line":12}},{"line":261,"address":[],"length":0,"stats":{"Line":24}},{"line":269,"address":[],"length":0,"stats":{"Line":12}},{"line":272,"address":[],"length":0,"stats":{"Line":40}},{"line":273,"address":[],"length":0,"stats":{"Line":28}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":14}},{"line":278,"address":[],"length":0,"stats":{"Line":14}},{"line":279,"address":[],"length":0,"stats":{"Line":14}},{"line":280,"address":[],"length":0,"stats":{"Line":14}},{"line":281,"address":[],"length":0,"stats":{"Line":14}},{"line":282,"address":[],"length":0,"stats":{"Line":28}},{"line":283,"address":[],"length":0,"stats":{"Line":12}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":12}},{"line":300,"address":[],"length":0,"stats":{"Line":8}},{"line":301,"address":[],"length":0,"stats":{"Line":16}},{"line":311,"address":[],"length":0,"stats":{"Line":8}},{"line":314,"address":[],"length":0,"stats":{"Line":44}},{"line":315,"address":[],"length":0,"stats":{"Line":36}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":18}},{"line":320,"address":[],"length":0,"stats":{"Line":18}},{"line":321,"address":[],"length":0,"stats":{"Line":18}},{"line":322,"address":[],"length":0,"stats":{"Line":18}},{"line":323,"address":[],"length":0,"stats":{"Line":18}},{"line":324,"address":[],"length":0,"stats":{"Line":40}},{"line":325,"address":[],"length":0,"stats":{"Line":22}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":8}},{"line":338,"address":[],"length":0,"stats":{"Line":16}},{"line":339,"address":[],"length":0,"stats":{"Line":32}},{"line":347,"address":[],"length":0,"stats":{"Line":58}},{"line":348,"address":[],"length":0,"stats":{"Line":84}},{"line":352,"address":[],"length":0,"stats":{"Line":16}},{"line":363,"address":[],"length":0,"stats":{"Line":40}},{"line":364,"address":[],"length":0,"stats":{"Line":80}},{"line":365,"address":[],"length":0,"stats":{"Line":2}},{"line":366,"address":[],"length":0,"stats":{"Line":2}},{"line":367,"address":[],"length":0,"stats":{"Line":2}},{"line":368,"address":[],"length":0,"stats":{"Line":2}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":38}},{"line":377,"address":[],"length":0,"stats":{"Line":4}},{"line":378,"address":[],"length":0,"stats":{"Line":4}},{"line":379,"address":[],"length":0,"stats":{"Line":4}},{"line":381,"address":[],"length":0,"stats":{"Line":34}},{"line":382,"address":[],"length":0,"stats":{"Line":34}},{"line":383,"address":[],"length":0,"stats":{"Line":34}},{"line":384,"address":[],"length":0,"stats":{"Line":34}},{"line":388,"address":[],"length":0,"stats":{"Line":80}},{"line":389,"address":[],"length":0,"stats":{"Line":40}},{"line":390,"address":[],"length":0,"stats":{"Line":6}},{"line":392,"address":[],"length":0,"stats":{"Line":34}},{"line":397,"address":[],"length":0,"stats":{"Line":1308}},{"line":398,"address":[],"length":0,"stats":{"Line":1268}},{"line":401,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":634}},{"line":403,"address":[],"length":0,"stats":{"Line":634}},{"line":404,"address":[],"length":0,"stats":{"Line":634}},{"line":405,"address":[],"length":0,"stats":{"Line":634}},{"line":406,"address":[],"length":0,"stats":{"Line":634}},{"line":407,"address":[],"length":0,"stats":{"Line":1276}},{"line":408,"address":[],"length":0,"stats":{"Line":18}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":40}},{"line":424,"address":[],"length":0,"stats":{"Line":60}},{"line":426,"address":[],"length":0,"stats":{"Line":120}},{"line":432,"address":[],"length":0,"stats":{"Line":52}},{"line":433,"address":[],"length":0,"stats":{"Line":52}},{"line":434,"address":[],"length":0,"stats":{"Line":52}},{"line":435,"address":[],"length":0,"stats":{"Line":52}},{"line":436,"address":[],"length":0,"stats":{"Line":52}},{"line":437,"address":[],"length":0,"stats":{"Line":52}},{"line":441,"address":[],"length":0,"stats":{"Line":52}},{"line":443,"address":[],"length":0,"stats":{"Line":52}},{"line":451,"address":[],"length":0,"stats":{"Line":52}},{"line":452,"address":[],"length":0,"stats":{"Line":144}},{"line":453,"address":[],"length":0,"stats":{"Line":46}},{"line":457,"address":[],"length":0,"stats":{"Line":52}},{"line":458,"address":[],"length":0,"stats":{"Line":52}},{"line":459,"address":[],"length":0,"stats":{"Line":52}},{"line":460,"address":[],"length":0,"stats":{"Line":52}},{"line":461,"address":[],"length":0,"stats":{"Line":52}},{"line":462,"address":[],"length":0,"stats":{"Line":52}},{"line":463,"address":[],"length":0,"stats":{"Line":52}},{"line":466,"address":[],"length":0,"stats":{"Line":8}},{"line":477,"address":[],"length":0,"stats":{"Line":18}},{"line":478,"address":[],"length":0,"stats":{"Line":18}},{"line":479,"address":[],"length":0,"stats":{"Line":2}},{"line":482,"address":[],"length":0,"stats":{"Line":16}},{"line":498,"address":[],"length":0,"stats":{"Line":0}},{"line":499,"address":[],"length":0,"stats":{"Line":16}},{"line":504,"address":[],"length":0,"stats":{"Line":16}},{"line":506,"address":[],"length":0,"stats":{"Line":16}},{"line":510,"address":[],"length":0,"stats":{"Line":28}},{"line":517,"address":[],"length":0,"stats":{"Line":12}},{"line":519,"address":[],"length":0,"stats":{"Line":6}},{"line":520,"address":[],"length":0,"stats":{"Line":12}},{"line":530,"address":[],"length":0,"stats":{"Line":16}},{"line":531,"address":[],"length":0,"stats":{"Line":16}},{"line":541,"address":[],"length":0,"stats":{"Line":18}},{"line":542,"address":[],"length":0,"stats":{"Line":36}},{"line":551,"address":[],"length":0,"stats":{"Line":36}},{"line":553,"address":[],"length":0,"stats":{"Line":18}},{"line":557,"address":[],"length":0,"stats":{"Line":4}},{"line":561,"address":[],"length":0,"stats":{"Line":14}},{"line":566,"address":[],"length":0,"stats":{"Line":14}},{"line":567,"address":[],"length":0,"stats":{"Line":14}}],"covered":144,"coverable":158},{"path":["/","Users","ozan","Projects","command-vault","src","exec","mod.rs"],"content":"use std::io::{self, Write};\nuse std::process::Command as ProcessCommand;\nuse std::env;\nuse std::path::{Path, PathBuf};\nuse anyhow::Result;\nuse crossterm::terminal;\nuse dialoguer::{theme::ColorfulTheme, Input};\nuse crate::db::models::Command;\nuse crate::shell::hooks::detect_current_shell;\n\npub struct ExecutionContext {\n    pub command: String,\n    pub directory: String,\n    pub test_mode: bool,\n    pub debug_mode: bool,\n}\n\npub fn wrap_command(command: \u0026str, test_mode: bool) -\u003e String {\n    if test_mode {\n        command.to_string()\n    } else {\n        // For interactive mode, handle shell initialization\n        let shell_type = detect_current_shell();\n        let clean_command = command.trim_matches('\"').to_string();\n            \n        match shell_type.as_str() {\n            \"zsh\" =\u003e format!(\n                r#\"setopt no_global_rcs; if [ -f ~/.zshrc ]; then ZDOTDIR=~ source ~/.zshrc; fi; {}\"#,\n                clean_command\n            ),\n            \"fish\" =\u003e format!(\n                r#\"if test -f ~/.config/fish/config.fish; source ~/.config/fish/config.fish 2\u003e/dev/null; end; {}\"#,\n                clean_command\n            ),\n            \"bash\" | _ =\u003e format!(\n                r#\"if [ -f ~/.bashrc ]; then . ~/.bashrc \u003e/dev/null 2\u003e\u00261; fi; if [ -f ~/.bash_profile ]; then . ~/.bash_profile \u003e/dev/null 2\u003e\u00261; fi; {}\"#,\n                clean_command\n            ),\n        }\n    }\n}\n\nfn is_path_traversal_attempt(command: \u0026str, working_dir: \u0026Path) -\u003e bool {\n    // Check if the command contains path traversal attempts\n    if command.contains(\"..\") {\n        // Get the absolute path of the working directory\n        if let Ok(working_dir) = working_dir.canonicalize() {\n            // Try to resolve any path in the command relative to working_dir\n            let potential_path = working_dir.join(command);\n            if let Ok(resolved_path) = potential_path.canonicalize() {\n                // Check if the resolved path is outside the working directory\n                return !resolved_path.starts_with(working_dir);\n            }\n        }\n        // If we can't resolve the paths, assume it's a traversal attempt\n        return true;\n    }\n    false\n}\n\npub fn execute_shell_command(ctx: \u0026ExecutionContext) -\u003e Result\u003c()\u003e {\n    // Get the current shell\n    let shell = if cfg!(windows) {\n        String::from(\"cmd.exe\")\n    } else {\n        env::var(\"SHELL\").unwrap_or_else(|_| String::from(\"/bin/sh\"))\n    };\n\n    // Wrap the command for shell execution\n    let wrapped_command = wrap_command(\u0026ctx.command, ctx.test_mode);\n\n    // Check for directory traversal attempts\n    if is_path_traversal_attempt(\u0026wrapped_command, Path::new(\u0026ctx.directory)) {\n        return Err(anyhow::anyhow!(\"Directory traversal attempt detected\"));\n    }\n\n    // Create command with the appropriate shell\n    let mut command = ProcessCommand::new(\u0026shell);\n    \n    // In test mode, use simple shell execution\n    if ctx.test_mode {\n        command.args(\u0026[\"-c\", \u0026wrapped_command]);\n    } else {\n        // Use -i for all shells in interactive mode to ensure proper initialization\n        command.args(\u0026[\"-i\", \"-c\", \u0026wrapped_command]);\n    }\n    \n    // Set working directory\n    command.current_dir(\u0026ctx.directory);\n\n    if ctx.debug_mode {\n        println!(\"Full command: {:?}\", command);\n    }\n\n    // Disable raw mode only in interactive mode\n    if !ctx.test_mode {\n        let _ = terminal::disable_raw_mode();\n        // Reset cursor position\n        let mut stdout = io::stdout();\n        let _ = crossterm::execute!(\n            stdout,\n            crossterm::cursor::MoveTo(0, crossterm::cursor::position()?.1)\n        );\n        println!(); // Add a newline before command output\n    }\n\n    // Execute the command and capture output\n    let output = command.output()?;\n\n    // Handle command output\n    if !output.status.success() {\n        let stderr = String::from_utf8_lossy(\u0026output.stderr);\n        return Err(anyhow::anyhow!(\n            \"Command failed with status: {}. stderr: {}\",\n            output.status,\n            stderr\n        ));\n    }\n\n    // Print stdout\n    if !output.stdout.is_empty() {\n        let stdout_str = String::from_utf8_lossy(\u0026output.stdout);\n        print!(\"{}\", stdout_str);\n    }\n\n    // Print stderr\n    if !output.stderr.is_empty() {\n        let stderr_str = String::from_utf8_lossy(\u0026output.stderr);\n        eprint!(\"{}\", stderr_str);\n    }\n\n    Ok(())\n}\n\npub fn execute_command(command: \u0026Command) -\u003e Result\u003c()\u003e {\n    let test_mode = std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    let debug_mode = std::env::var(\"COMMAND_VAULT_DEBUG\").is_ok();\n    let mut final_command = command.command.clone();\n\n    // If command has parameters, prompt for values first\n    if !command.parameters.is_empty() {\n        for param in \u0026command.parameters {\n            println!(\"Parameter: {}\", param.name);\n            println!();\n\n            let value = if test_mode {\n                let value = std::env::var(\"COMMAND_VAULT_TEST_INPUT\")\n                    .unwrap_or_else(|_| \"test_value\".to_string());\n                println!(\"Enter value: {}\", value);\n                println!();\n                value\n            } else {\n                let input: String = Input::with_theme(\u0026ColorfulTheme::default())\n                    .with_prompt(\"Enter value\")\n                    .allow_empty(true)\n                    .interact_text()?;\n                println!();\n                \n                if input.contains(' ') {\n                    format!(\"'{}'\", input.replace(\"'\", \"'\\\\''\"))\n                } else {\n                    input\n                }\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", param.name), \u0026value);\n        }\n    }\n\n    let ctx = ExecutionContext {\n        command: final_command,\n        directory: command.directory.clone(),\n        test_mode,\n        debug_mode,\n    };\n\n    // Print command details only once\n    println!(\"─────────────────────────────────────────────\");\n    println!();\n    println!(\"Command to execute: {}\", ctx.command);\n    println!(\"Working directory: {}\", ctx.directory);\n    println!();\n\n    execute_shell_command(\u0026ctx)\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":22}},{"line":19,"address":[],"length":0,"stats":{"Line":22}},{"line":20,"address":[],"length":0,"stats":{"Line":22}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":22}},{"line":45,"address":[],"length":0,"stats":{"Line":22}},{"line":47,"address":[],"length":0,"stats":{"Line":4}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":58,"address":[],"length":0,"stats":{"Line":20}},{"line":61,"address":[],"length":0,"stats":{"Line":22}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":22}},{"line":70,"address":[],"length":0,"stats":{"Line":22}},{"line":73,"address":[],"length":0,"stats":{"Line":22}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":78,"address":[],"length":0,"stats":{"Line":20}},{"line":81,"address":[],"length":0,"stats":{"Line":40}},{"line":82,"address":[],"length":0,"stats":{"Line":20}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":4}},{"line":92,"address":[],"length":0,"stats":{"Line":4}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":20}},{"line":112,"address":[],"length":0,"stats":{"Line":2}},{"line":113,"address":[],"length":0,"stats":{"Line":2}},{"line":114,"address":[],"length":0,"stats":{"Line":2}},{"line":115,"address":[],"length":0,"stats":{"Line":2}},{"line":116,"address":[],"length":0,"stats":{"Line":2}},{"line":121,"address":[],"length":0,"stats":{"Line":34}},{"line":122,"address":[],"length":0,"stats":{"Line":16}},{"line":123,"address":[],"length":0,"stats":{"Line":16}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":18}},{"line":135,"address":[],"length":0,"stats":{"Line":18}},{"line":136,"address":[],"length":0,"stats":{"Line":18}},{"line":137,"address":[],"length":0,"stats":{"Line":18}},{"line":138,"address":[],"length":0,"stats":{"Line":18}},{"line":141,"address":[],"length":0,"stats":{"Line":18}},{"line":142,"address":[],"length":0,"stats":{"Line":24}},{"line":146,"address":[],"length":0,"stats":{"Line":8}},{"line":147,"address":[],"length":0,"stats":{"Line":8}},{"line":148,"address":[],"length":0,"stats":{"Line":16}},{"line":149,"address":[],"length":0,"stats":{"Line":8}},{"line":150,"address":[],"length":0,"stats":{"Line":8}},{"line":151,"address":[],"length":0,"stats":{"Line":8}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":18}},{"line":178,"address":[],"length":0,"stats":{"Line":18}},{"line":179,"address":[],"length":0,"stats":{"Line":18}},{"line":180,"address":[],"length":0,"stats":{"Line":18}},{"line":181,"address":[],"length":0,"stats":{"Line":18}},{"line":182,"address":[],"length":0,"stats":{"Line":18}},{"line":184,"address":[],"length":0,"stats":{"Line":18}}],"covered":47,"coverable":73},{"path":["/","Users","ozan","Projects","command-vault","src","lib.rs"],"content":"pub mod cli;\npub mod db;\npub mod shell;\npub mod ui;\npub mod utils;\npub mod exec;\npub mod version;\n\npub use db::Database;\npub use version::VERSION;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","main.rs"],"content":"use anyhow::Result;\nuse clap::Parser;\nuse command_vault::{\n    cli::{args::Cli, commands::handle_command},\n    db::store::Database,\n};\nuse std::path::PathBuf;\n\nmod cli;\nmod db;\nmod shell;\nmod ui;\nmod utils;\nmod exec;\n\nfn main() -\u003e Result\u003c()\u003e {\n    // Enable colors globally\n    colored::control::set_override(true);\n    \n    let args = Cli::parse();\n    \n    let data_dir = dirs::data_dir()\n        .ok_or_else(|| anyhow::anyhow!(\"Could not find data directory\"))?\n        .join(\"command-vault\");\n    std::fs::create_dir_all(\u0026data_dir)?;\n    \n    let db_path = data_dir.join(\"commands.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n    \n    let result = handle_command(args.command, \u0026mut db, args.debug);\n    \n    // Re-enable colors before exiting\n    colored::control::set_override(true);\n    \n    result\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":11},{"path":["/","Users","ozan","Projects","command-vault","src","shell","hooks.rs"],"content":"use anyhow::{anyhow, Result};\nuse std::env;\nuse std::path::PathBuf;\n\n/// Get the directory containing shell integration scripts\npub fn get_shell_integration_dir() -\u003e PathBuf {\n    let mut path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n    path.push(\"shell\");\n    path\n}\n\n/// Get the path to the ZSH integration script\npub fn get_zsh_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"zsh-integration.zsh\");\n    path\n}\n\n/// Get the path to the Bash integration script\npub fn get_bash_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"bash-integration.sh\");\n    path\n}\n\n/// Get the path to the Fish integration script\npub fn get_fish_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"fish-integration.fish\");\n    path\n}\n\n/// Detect the current shell from environment variables\npub fn detect_current_shell() -\u003e String {\n    // First check for FISH_VERSION environment variable (highest priority)\n    if env::var(\"FISH_VERSION\").is_ok() {\n        return \"fish\".to_string();\n    }\n\n    // Then check SHELL environment variable\n    if let Ok(shell_path) = env::var(\"SHELL\") {\n        let shell_path = shell_path.to_lowercase();\n        \n        // Check for fish first (to match FISH_VERSION priority)\n        if shell_path.contains(\"fish\") {\n            return \"fish\".to_string();\n        }\n        \n        // Then check for other shells\n        if shell_path.contains(\"zsh\") {\n            return \"zsh\".to_string();\n        }\n        if shell_path.contains(\"bash\") {\n            return \"bash\".to_string();\n        }\n    }\n\n    // Default to bash if no shell is detected or unknown shell\n    \"bash\".to_string()\n}\n\n/// Get the shell integration script path for a specific shell\npub fn get_shell_integration_script(shell: \u0026str) -\u003e Result\u003cPathBuf\u003e {\n    let shell_lower = shell.to_lowercase();\n    match shell_lower.as_str() {\n        \"zsh\" =\u003e Ok(get_zsh_integration_path()),\n        \"bash\" =\u003e Ok(get_bash_integration_path()),\n        \"fish\" =\u003e Ok(get_fish_integration_path()),\n        _ =\u003e Err(anyhow!(\"Unsupported shell: {}\", shell)),\n    }\n}\n\n/// Initialize shell integration\npub fn init_shell(shell_override: Option\u003cString\u003e) -\u003e Result\u003cPathBuf\u003e {\n    let shell = if let Some(shell) = shell_override {\n        shell\n    } else {\n        detect_current_shell()\n    };\n\n    get_shell_integration_script(\u0026shell)\n}\n","traces":[{"line":6,"address":[],"length":0,"stats":{"Line":34}},{"line":7,"address":[],"length":0,"stats":{"Line":34}},{"line":8,"address":[],"length":0,"stats":{"Line":34}},{"line":9,"address":[],"length":0,"stats":{"Line":34}},{"line":13,"address":[],"length":0,"stats":{"Line":10}},{"line":14,"address":[],"length":0,"stats":{"Line":10}},{"line":15,"address":[],"length":0,"stats":{"Line":10}},{"line":16,"address":[],"length":0,"stats":{"Line":10}},{"line":20,"address":[],"length":0,"stats":{"Line":10}},{"line":21,"address":[],"length":0,"stats":{"Line":10}},{"line":22,"address":[],"length":0,"stats":{"Line":10}},{"line":23,"address":[],"length":0,"stats":{"Line":10}},{"line":27,"address":[],"length":0,"stats":{"Line":10}},{"line":28,"address":[],"length":0,"stats":{"Line":10}},{"line":29,"address":[],"length":0,"stats":{"Line":10}},{"line":30,"address":[],"length":0,"stats":{"Line":10}},{"line":34,"address":[],"length":0,"stats":{"Line":28}},{"line":36,"address":[],"length":0,"stats":{"Line":28}},{"line":37,"address":[],"length":0,"stats":{"Line":8}},{"line":41,"address":[],"length":0,"stats":{"Line":18}},{"line":46,"address":[],"length":0,"stats":{"Line":10}},{"line":50,"address":[],"length":0,"stats":{"Line":8}},{"line":51,"address":[],"length":0,"stats":{"Line":4}},{"line":53,"address":[],"length":0,"stats":{"Line":4}},{"line":54,"address":[],"length":0,"stats":{"Line":4}},{"line":59,"address":[],"length":0,"stats":{"Line":2}},{"line":63,"address":[],"length":0,"stats":{"Line":24}},{"line":64,"address":[],"length":0,"stats":{"Line":24}},{"line":65,"address":[],"length":0,"stats":{"Line":24}},{"line":66,"address":[],"length":0,"stats":{"Line":30}},{"line":67,"address":[],"length":0,"stats":{"Line":24}},{"line":68,"address":[],"length":0,"stats":{"Line":18}},{"line":69,"address":[],"length":0,"stats":{"Line":6}},{"line":74,"address":[],"length":0,"stats":{"Line":14}},{"line":75,"address":[],"length":0,"stats":{"Line":38}},{"line":78,"address":[],"length":0,"stats":{"Line":4}},{"line":81,"address":[],"length":0,"stats":{"Line":14}}],"covered":37,"coverable":37},{"path":["/","Users","ozan","Projects","command-vault","src","shell","mod.rs"],"content":"pub mod hooks;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","ui","add.rs"],"content":"use std::io::Stdout;\nuse anyhow::Result;\nuse crossterm::{\n    event::{self, Event, KeyCode, KeyModifiers, KeyEvent},\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    layout::{Constraint, Direction, Layout, Rect},\n    style::{Color, Style},\n    widgets::{Block, Borders, Paragraph, Clear},\n    Terminal,\n};\n\n/// Type alias for the command result tuple\npub type CommandResult = Option\u003c(String, Vec\u003cString\u003e, Option\u003ci32\u003e)\u003e;\n\n#[derive(Default)]\npub struct AddCommandApp {\n    /// The command being entered\n    pub command: String,\n    /// Tags for the command\n    pub tags: Vec\u003cString\u003e,\n    /// Current tag being entered\n    pub current_tag: String,\n    /// Current cursor position in the command\n    pub command_cursor: usize,\n    /// Current line in multi-line command\n    pub command_line: usize,\n    /// Current input mode\n    pub input_mode: InputMode,\n    /// Suggested tags\n    pub suggested_tags: Vec\u003cString\u003e,\n    /// Previous input mode (for returning from help)\n    pub previous_mode: InputMode,\n}\n\n#[derive(Debug, Clone, PartialEq, Default)]\npub enum InputMode {\n    #[default]\n    Command,\n    Tag,\n    Confirm,\n    Help,\n}\n\nimpl AddCommandApp {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    pub fn run(\u0026mut self) -\u003e Result\u003cCommandResult\u003e {\n        let mut terminal = setup_terminal()?;\n        let result = self.run_app(\u0026mut terminal);\n        restore_terminal(\u0026mut terminal)?;\n        result\n    }\n\n    fn run_app(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cCommandResult\u003e {\n        loop {\n            terminal.draw(|f| self.ui(f))?;\n\n            if let Event::Key(key) = event::read()? {\n                match self.input_mode {\n                    InputMode::Help =\u003e match key.code {\n                        KeyCode::Char('?') | KeyCode::Esc =\u003e {\n                            self.input_mode = self.previous_mode.clone();\n                        }\n                        _ =\u003e {}\n                    },\n                    _ =\u003e match key.code {\n                        KeyCode::Char('?') =\u003e {\n                            eprintln!(\"Debug: ? key pressed, switching to help mode\");\n                            self.previous_mode = self.input_mode.clone();\n                            self.input_mode = InputMode::Help;\n                            eprintln!(\"Debug: Input mode is now Help\");\n                        }\n                        _ =\u003e match self.input_mode {\n                            InputMode::Command =\u003e match key.code {\n                                KeyCode::Enter =\u003e {\n                                    if key.modifiers.contains(KeyModifiers::SHIFT) {\n                                        // Add newline to command\n                                        self.command.insert(self.command_cursor, '\\n');\n                                        self.command_cursor += 1;\n                                        self.command_line += 1;\n                                    } else {\n                                        if !self.command.is_empty() {\n                                            self.suggest_tags();\n                                            self.input_mode = InputMode::Tag;\n                                        }\n                                    }\n                                }\n                                KeyCode::Char(c) =\u003e {\n                                    self.command.insert(self.command_cursor, c);\n                                    self.command_cursor += 1;\n                                }\n                                KeyCode::Backspace =\u003e {\n                                    if self.command_cursor \u003e 0 {\n                                        self.command.remove(self.command_cursor - 1);\n                                        self.command_cursor -= 1;\n                                        if self.command_cursor \u003e 0 \u0026\u0026 self.command.chars().nth(self.command_cursor - 1) == Some('\\n') {\n                                            self.command_line -= 1;\n                                        }\n                                    }\n                                }\n                                KeyCode::Left =\u003e {\n                                    if self.command_cursor \u003e 0 {\n                                        self.command_cursor -= 1;\n                                        if self.command_cursor \u003e 0 \u0026\u0026 self.command.chars().nth(self.command_cursor - 1) == Some('\\n') {\n                                            self.command_line -= 1;\n                                        }\n                                    }\n                                }\n                                KeyCode::Right =\u003e {\n                                    if self.command_cursor \u003c self.command.len() {\n                                        if self.command.chars().nth(self.command_cursor) == Some('\\n') {\n                                            self.command_line += 1;\n                                        }\n                                        self.command_cursor += 1;\n                                    }\n                                }\n                                KeyCode::Up =\u003e {\n                                    // Move cursor to previous line\n                                    let current_line_start = self.command[..self.command_cursor]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1)\n                                        .unwrap_or(0);\n                                    if let Some(prev_line_start) = self.command[..current_line_start.saturating_sub(1)]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1) {\n                                        let column = self.command_cursor - current_line_start;\n                                        self.command_cursor = prev_line_start + column.min(\n                                            self.command[prev_line_start..current_line_start.saturating_sub(1)]\n                                                .chars()\n                                                .count(),\n                                        );\n                                        self.command_line -= 1;\n                                    }\n                                }\n                                KeyCode::Down =\u003e {\n                                    // Move cursor to next line\n                                    let current_line_start = self.command[..self.command_cursor]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1)\n                                        .unwrap_or(0);\n                                    if let Some(next_line_start) = self.command[self.command_cursor..]\n                                        .find('\\n')\n                                        .map(|pos| self.command_cursor + pos + 1) {\n                                        let column = self.command_cursor - current_line_start;\n                                        let next_line_end = self.command[next_line_start..]\n                                            .find('\\n')\n                                            .map(|pos| next_line_start + pos)\n                                            .unwrap_or_else(|| self.command.len());\n                                        self.command_cursor = next_line_start + column.min(next_line_end - next_line_start);\n                                        self.command_line += 1;\n                                    }\n                                }\n                                KeyCode::Esc =\u003e {\n                                    return Ok(None);\n                                }\n                                _ =\u003e {}\n                            },\n                            InputMode::Tag =\u003e {\n                                match key.code {\n                                    KeyCode::Enter =\u003e {\n                                        if !self.current_tag.is_empty() {\n                                            self.tags.push(self.current_tag.clone());\n                                            self.current_tag.clear();\n                                        } else {\n                                            self.input_mode = InputMode::Confirm;\n                                        }\n                                    }\n                                    KeyCode::Char(c) =\u003e {\n                                        self.current_tag.push(c);\n                                    }\n                                    KeyCode::Backspace =\u003e {\n                                        self.current_tag.pop();\n                                    }\n                                    KeyCode::Tab =\u003e {\n                                        if !self.suggested_tags.is_empty() {\n                                            self.tags.push(self.suggested_tags[0].clone());\n                                            self.suggested_tags.remove(0);\n                                        }\n                                    }\n                                    KeyCode::Esc =\u003e {\n                                        self.input_mode = InputMode::Command;\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            InputMode::Confirm =\u003e {\n                                match key.code {\n                                    KeyCode::Char('y') =\u003e {\n                                        return Ok(Some((\n                                            self.command.clone(),\n                                            self.tags.clone(),\n                                            None,\n                                        )));\n                                    }\n                                    KeyCode::Char('n') | KeyCode::Esc =\u003e {\n                                        return Ok(None);\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    pub fn set_command(\u0026mut self, command: String) {\n        self.command = command;\n        self.command_cursor = self.command.len();\n    }\n\n    pub fn set_tags(\u0026mut self, tags: Vec\u003cString\u003e) {\n        self.tags = tags;\n    }\n\n    fn ui(\u0026self, f: \u0026mut ratatui::Frame) {\n        match self.input_mode {\n            InputMode::Help =\u003e {\n                let help_text = vec![\n                    \"Command Vault Help\",\n                    \"\",\n                    \"Global Commands:\",\n                    \"  ?      - Toggle this help screen\",\n                    \"  Esc    - Go back / Cancel\",\n                    \"\",\n                    \"Command Input Mode:\",\n                    \"  Enter        - Continue to tag input\",\n                    \"  Shift+Enter  - Add new line\",\n                    \"  ←/→         - Move cursor\",\n                    \"  ↑/↓         - Navigate between lines\",\n                    \"\",\n                    \"Tag Input Mode:\",\n                    \"  Enter  - Add tag\",\n                    \"  Tab    - Show tag suggestions\",\n                    \"\",\n                    \"Confirmation Mode:\",\n                    \"  y/Y    - Save command\",\n                    \"  n/N    - Cancel\",\n                ];\n\n                let help_paragraph = Paragraph::new(help_text.join(\"\\n\"))\n                    .style(Style::default().fg(Color::White))\n                    .block(Block::default().borders(Borders::ALL).title(\"Help (press ? or Esc to close)\"));\n\n                // Center the help window\n                let area = centered_rect(60, 80, f.size());\n                f.render_widget(Clear, area); // Clear the background\n                f.render_widget(help_paragraph, area);\n            }\n            _ =\u003e {\n                let chunks = Layout::default()\n                    .direction(Direction::Vertical)\n                    .margin(1)\n                    .constraints([\n                        Constraint::Length(3),  // Title\n                        Constraint::Min(5),     // Command input\n                        Constraint::Length(3),  // Tags input\n                        Constraint::Min(0),     // Message/Help\n                    ])\n                    .split(f.size());\n\n                // Title\n                let title = Paragraph::new(\"Add Command\")\n                    .style(Style::default().fg(Color::Cyan))\n                    .block(Block::default().borders(Borders::ALL));\n                f.render_widget(title, chunks[0]);\n\n                // Command input\n                let mut command_text = self.command.clone();\n                if self.input_mode == InputMode::Command {\n                    command_text.insert(self.command_cursor, '│'); // Add cursor\n                }\n                let command_input = Paragraph::new(command_text)\n                    .style(Style::default().fg(if self.input_mode == InputMode::Command {\n                        Color::Yellow\n                    } else {\n                        Color::Gray\n                    }))\n                    .block(Block::default().borders(Borders::ALL).title(\"Command (Shift+Enter for new line)\"))\n                    .wrap(ratatui::widgets::Wrap { trim: false });\n                f.render_widget(command_input, chunks[1]);\n\n                // Tags input\n                let mut tags_text = self.tags.join(\", \");\n                if !tags_text.is_empty() {\n                    tags_text.push_str(\", \");\n                }\n                tags_text.push_str(\u0026self.current_tag);\n                if self.input_mode == InputMode::Tag {\n                    tags_text.push('│');\n                }\n                let tags_input = Paragraph::new(tags_text)\n                    .style(Style::default().fg(if self.input_mode == InputMode::Tag {\n                        Color::Yellow\n                    } else {\n                        Color::Gray\n                    }))\n                    .block(Block::default().borders(Borders::ALL).title(\"Tags\"));\n                f.render_widget(tags_input, chunks[2]);\n\n                // Help text or confirmation prompt\n                let help_text = match self.input_mode {\n                    InputMode::Command =\u003e \"Press ? for help\",\n                    InputMode::Tag =\u003e \"Press ? for help\",\n                    InputMode::Confirm =\u003e \"Save command? (y/n)\",\n                    InputMode::Help =\u003e unreachable!(),\n                };\n                let help = Paragraph::new(help_text)\n                    .style(Style::default().fg(Color::White))\n                    .block(Block::default().borders(Borders::ALL));\n                f.render_widget(help, chunks[3]);\n            }\n        }\n    }\n\n    fn suggest_tags(\u0026mut self) {\n        self.suggested_tags.clear();\n        \n        // Simple tag suggestions based on command content\n        let command = self.command.to_lowercase();\n        \n        if command.contains(\"git\") {\n            self.suggested_tags.push(\"git\".to_string());\n            if command.contains(\"push\") {\n                self.suggested_tags.push(\"push\".to_string());\n            }\n            if command.contains(\"pull\") {\n                self.suggested_tags.push(\"pull\".to_string());\n            }\n        }\n        \n        if command.contains(\"docker\") {\n            self.suggested_tags.push(\"docker\".to_string());\n        }\n        \n        if command.contains(\"cargo\") {\n            self.suggested_tags.push(\"rust\".to_string());\n            self.suggested_tags.push(\"cargo\".to_string());\n        }\n        \n        if command.contains(\"npm\") || command.contains(\"yarn\") {\n            self.suggested_tags.push(\"javascript\".to_string());\n            self.suggested_tags.push(\"node\".to_string());\n        }\n    }\n\n    pub fn handle_key_event(\u0026mut self, key: KeyEvent) {\n        match self.input_mode {\n            InputMode::Help =\u003e match key.code {\n                KeyCode::Char('?') | KeyCode::Esc =\u003e {\n                    self.input_mode = self.previous_mode.clone();\n                }\n                _ =\u003e {}\n            },\n            _ =\u003e match key.code {\n                KeyCode::Char('?') =\u003e {\n                    self.previous_mode = self.input_mode.clone();\n                    self.input_mode = InputMode::Help;\n                }\n                _ =\u003e match self.input_mode {\n                    InputMode::Command =\u003e match key.code {\n                        KeyCode::Char(c) =\u003e {\n                            self.command.insert(self.command_cursor, c);\n                            self.command_cursor += 1;\n                        }\n                        KeyCode::Backspace =\u003e {\n                            if self.command_cursor \u003e 0 {\n                                self.command.remove(self.command_cursor - 1);\n                                self.command_cursor -= 1;\n                            }\n                        }\n                        KeyCode::Left =\u003e {\n                            if self.command_cursor \u003e 0 {\n                                self.command_cursor -= 1;\n                            }\n                        }\n                        KeyCode::Right =\u003e {\n                            if self.command_cursor \u003c self.command.len() {\n                                self.command_cursor += 1;\n                            }\n                        }\n                        KeyCode::Enter =\u003e {\n                            if key.modifiers.contains(KeyModifiers::SHIFT) {\n                                self.command.insert(self.command_cursor, '\\n');\n                                self.command_cursor += 1;\n                                self.command_line += 1;\n                            } else if !self.command.is_empty() {\n                                self.input_mode = InputMode::Tag;\n                            }\n                        }\n                        _ =\u003e {}\n                    },\n                    InputMode::Tag =\u003e match key.code {\n                        KeyCode::Char(c) =\u003e {\n                            self.current_tag.push(c);\n                        }\n                        KeyCode::Enter =\u003e {\n                            if !self.current_tag.is_empty() {\n                                self.tags.push(self.current_tag.clone());\n                                self.current_tag.clear();\n                            }\n                        }\n                        _ =\u003e {}\n                    },\n                    _ =\u003e {}\n                }\n            }\n        }\n    }\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = std::io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    let mut terminal = Terminal::new(backend)?;\n    terminal.hide_cursor()?;\n    Ok(terminal)\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    terminal.show_cursor()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    disable_raw_mode()?;\n    Ok(())\n}\n\nfn centered_rect(percent_x: u16, percent_y: u16, r: Rect) -\u003e Rect {\n    let popup_layout = Layout::default()\n        .direction(Direction::Vertical)\n        .constraints([\n            Constraint::Percentage((100 - percent_y) / 2),\n            Constraint::Percentage(percent_y),\n            Constraint::Percentage((100 - percent_y) / 2),\n        ])\n        .split(r);\n\n    Layout::default()\n        .direction(Direction::Horizontal)\n        .constraints([\n            Constraint::Percentage((100 - percent_x) / 2),\n            Constraint::Percentage(percent_x),\n            Constraint::Percentage((100 - percent_x) / 2),\n        ])\n        .split(popup_layout[1])[1]\n}\n","traces":[{"line":49,"address":[],"length":0,"stats":{"Line":22}},{"line":50,"address":[],"length":0,"stats":{"Line":22}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":6}},{"line":216,"address":[],"length":0,"stats":{"Line":6}},{"line":217,"address":[],"length":0,"stats":{"Line":6}},{"line":220,"address":[],"length":0,"stats":{"Line":4}},{"line":221,"address":[],"length":0,"stats":{"Line":4}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":48}},{"line":356,"address":[],"length":0,"stats":{"Line":48}},{"line":357,"address":[],"length":0,"stats":{"Line":6}},{"line":358,"address":[],"length":0,"stats":{"Line":6}},{"line":359,"address":[],"length":0,"stats":{"Line":6}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":42}},{"line":364,"address":[],"length":0,"stats":{"Line":6}},{"line":365,"address":[],"length":0,"stats":{"Line":6}},{"line":366,"address":[],"length":0,"stats":{"Line":6}},{"line":368,"address":[],"length":0,"stats":{"Line":36}},{"line":369,"address":[],"length":0,"stats":{"Line":28}},{"line":370,"address":[],"length":0,"stats":{"Line":16}},{"line":371,"address":[],"length":0,"stats":{"Line":16}},{"line":372,"address":[],"length":0,"stats":{"Line":16}},{"line":375,"address":[],"length":0,"stats":{"Line":4}},{"line":376,"address":[],"length":0,"stats":{"Line":2}},{"line":377,"address":[],"length":0,"stats":{"Line":2}},{"line":381,"address":[],"length":0,"stats":{"Line":4}},{"line":382,"address":[],"length":0,"stats":{"Line":2}},{"line":386,"address":[],"length":0,"stats":{"Line":4}},{"line":387,"address":[],"length":0,"stats":{"Line":2}},{"line":391,"address":[],"length":0,"stats":{"Line":10}},{"line":392,"address":[],"length":0,"stats":{"Line":4}},{"line":393,"address":[],"length":0,"stats":{"Line":4}},{"line":394,"address":[],"length":0,"stats":{"Line":4}},{"line":395,"address":[],"length":0,"stats":{"Line":8}},{"line":396,"address":[],"length":0,"stats":{"Line":2}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":401,"address":[],"length":0,"stats":{"Line":8}},{"line":402,"address":[],"length":0,"stats":{"Line":6}},{"line":403,"address":[],"length":0,"stats":{"Line":6}},{"line":406,"address":[],"length":0,"stats":{"Line":4}},{"line":407,"address":[],"length":0,"stats":{"Line":2}},{"line":408,"address":[],"length":0,"stats":{"Line":2}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":422,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":439,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":442,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[],"length":0,"stats":{"Line":0}},{"line":449,"address":[],"length":0,"stats":{"Line":0}},{"line":450,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":454,"address":[],"length":0,"stats":{"Line":0}}],"covered":40,"coverable":225},{"path":["/","Users","ozan","Projects","command-vault","src","ui","app.rs"],"content":"use std::io::{self, Stdout};\nuse anyhow::Result;\nuse crossterm::{\n    event::{self, Event, KeyCode, KeyModifiers},\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    Terminal,\n    layout::{Constraint, Direction, Layout, Rect},\n    style::{Color, Modifier, Style},\n    text::{Line, Span},\n    widgets::{Block, Borders, Clear, List, ListItem, Paragraph},\n};\nuse crate::db::{Command, Database};\nuse crate::utils::params::{substitute_parameters, parse_parameters};\nuse crate::exec::{ExecutionContext, execute_shell_command};\nuse crate::ui::AddCommandApp;\n\npub struct App\u003c'a\u003e {\n    pub commands: Vec\u003cCommand\u003e,\n    pub selected: Option\u003cusize\u003e,\n    pub show_help: bool,\n    pub message: Option\u003c(String, Color)\u003e,\n    pub filter_text: String,\n    pub filtered_commands: Vec\u003cusize\u003e,\n    pub db: \u0026'a mut Database,\n    pub confirm_delete: Option\u003cusize\u003e, // Index of command pending deletion\n    pub debug_mode: bool,\n}\n\nimpl\u003c'a\u003e App\u003c'a\u003e {\n    pub fn new(commands: Vec\u003cCommand\u003e, db: \u0026'a mut Database, debug_mode: bool) -\u003e App\u003c'a\u003e {\n        let filtered_commands: Vec\u003cusize\u003e = (0..commands.len()).collect();\n        App {\n            commands,\n            selected: None,\n            show_help: false,\n            message: None,\n            filter_text: String::new(),\n            filtered_commands,\n            db,\n            confirm_delete: None,\n            debug_mode,\n        }\n    }\n\n    pub fn run(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let mut terminal = setup_terminal()?;\n        let res = self.run_app(\u0026mut terminal);\n        restore_terminal(\u0026mut terminal)?;\n        res\n    }\n\n    fn run_app(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        loop {\n            terminal.draw(|f| self.ui(f))?;\n\n            if let Event::Key(key) = event::read()? {\n                if let Some(()) = self.handle_key_event(terminal, key)? {\n                    return Ok(());\n                }\n            }\n        }\n    }\n\n    fn handle_key_event(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e, key: event::KeyEvent) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        match key.code {\n            KeyCode::Char('q') =\u003e self.handle_quit(),\n            KeyCode::Char('c') if key.modifiers.contains(KeyModifiers::CONTROL) =\u003e Ok(Some(())),\n            KeyCode::Char('?') =\u003e self.handle_help_toggle(),\n            _ if self.show_help =\u003e Ok(None),\n            KeyCode::Char('c') | KeyCode::Char('y') =\u003e self.handle_copy(),\n            KeyCode::Enter =\u003e self.handle_enter(terminal),\n            KeyCode::Char('e') =\u003e self.handle_edit(terminal),\n            KeyCode::Down | KeyCode::Char('j') =\u003e self.handle_down(),\n            KeyCode::Up | KeyCode::Char('k') =\u003e self.handle_up(),\n            KeyCode::Char('/') =\u003e self.handle_filter_start(),\n            KeyCode::Char('d') =\u003e self.handle_delete(),\n            KeyCode::Char(c) =\u003e self.handle_char_input(c),\n            KeyCode::Backspace =\u003e self.handle_backspace(),\n            KeyCode::Esc =\u003e self.handle_escape(),\n            _ =\u003e Ok(None)\n        }\n    }\n\n    pub fn handle_quit(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if !self.filter_text.is_empty() {\n            self.filter_text.clear();\n            self.update_filtered_commands();\n            Ok(None)\n        } else if self.confirm_delete.is_some() {\n            self.confirm_delete = None;\n            Ok(None)\n        } else if self.show_help {\n            self.show_help = false;\n            Ok(None)\n        } else {\n            Ok(Some(()))\n        }\n    }\n\n    fn handle_help_toggle(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.show_help = !self.show_help;\n        Ok(None)\n    }\n\n    fn handle_copy(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(cmd) = self.get_selected_command() {\n            copy_to_clipboard(\u0026cmd.command)?;\n            self.set_success_message(\"Command copied to clipboard!\".to_string());\n        }\n        Ok(None)\n    }\n\n    fn handle_enter(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(selected) = self.get_selection() {\n            if self.confirm_delete.is_some() {\n                self.delete_selected_command()?;\n                Ok(None)\n            } else {\n                self.execute_selected_command(terminal).map(Some)\n            }\n        } else {\n            Ok(None)\n        }\n    }\n\n    fn handle_edit(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.edit_selected_command(terminal)?;\n        Ok(None)\n    }\n\n    fn handle_down(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.select_next();\n        Ok(None)\n    }\n\n    fn handle_up(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.select_previous();\n        Ok(None)\n    }\n\n    fn handle_filter_start(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.clear_filter();\n        self.set_message(\"Type to filter commands...\".to_string(), Color::Blue);\n        Ok(None)\n    }\n\n    fn handle_delete(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(\u0026filtered_idx) = self.filtered_commands.get(selected) {\n                if let Some(_) = self.commands[filtered_idx].id {\n                    self.confirm_delete = Some(selected);\n                }\n            }\n        }\n        Ok(None)\n    }\n\n    fn handle_char_input(\u0026mut self, c: char) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if c == '/' {\n            self.clear_filter();\n            self.set_message(\"Type to filter commands...\".to_string(), Color::Blue);\n        } else if c != '/' {\n            self.append_to_filter(c);\n        }\n        Ok(None)\n    }\n\n    fn handle_backspace(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.backspace_filter();\n        Ok(None)\n    }\n\n    pub fn handle_escape(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if !self.filter_text.is_empty() {\n            self.clear_filter();\n        } else if self.confirm_delete.is_some() {\n            self.confirm_delete = None;\n            self.set_message(\"Delete operation cancelled\".to_string(), Color::Yellow);\n        }\n        Ok(None)\n    }\n\n    pub fn clear_filter(\u0026mut self) {\n        self.filter_text.clear();\n        self.update_filtered_commands();\n    }\n\n    pub fn set_filter(\u0026mut self, text: String) {\n        self.filter_text = text;\n        self.update_filtered_commands();\n    }\n\n    pub fn append_to_filter(\u0026mut self, c: char) {\n        self.filter_text.push(c);\n        self.update_filtered_commands();\n    }\n\n    pub fn backspace_filter(\u0026mut self) {\n        if !self.filter_text.is_empty() {\n            self.filter_text.pop();\n            self.update_filtered_commands();\n        }\n    }\n\n    fn matches_filter(\u0026self, command: \u0026Command, search_term: \u0026str) -\u003e bool {\n        let search_term = search_term.to_lowercase();\n        command.command.to_lowercase().contains(\u0026search_term) ||\n        command.tags.iter().any(|tag| tag.to_lowercase().contains(\u0026search_term)) ||\n        command.directory.to_lowercase().contains(\u0026search_term)\n    }\n\n    pub fn update_filtered_commands(\u0026mut self) {\n        self.filtered_commands = (0..self.commands.len())\n            .filter(|\u0026i| self.matches_filter(\u0026self.commands[i], \u0026self.filter_text))\n            .collect::\u003cVec\u003cusize\u003e\u003e();\n        \n        self.update_selection_after_filter();\n    }\n\n    fn ui(\u0026mut self, f: \u0026mut ratatui::Frame) {\n        if self.show_help {\n            self.render_help_screen(f);\n            return;\n        }\n\n        let chunks = self.create_layout(f);\n        self.render_title(f, chunks[0]);\n        self.render_commands_list(f, chunks[1]);\n        self.render_filter(f, chunks[2]);\n        self.render_status_bar(f, chunks[3]);\n\n        if self.confirm_delete.is_some() {\n            self.render_delete_confirmation(f);\n        }\n    }\n\n    fn render_help_screen(\u0026self, f: \u0026mut ratatui::Frame) {\n        let help_text = vec![\n            \"Command Vault Help\",\n            \"\",\n            \"Navigation:\",\n            \"  ↑/k      - Move cursor up\",\n            \"  ↓/j      - Move cursor down\",\n            \"  q        - Quit (or clear filter/cancel delete/close help)\",\n            \"  Ctrl+c   - Force quit\",\n            \"\",\n            \"Command Actions:\",\n            \"  Enter    - Execute selected command\",\n            \"  c/y      - Copy command to clipboard\",\n            \"  e        - Edit selected command (text, tags, directory)\",\n            \"  d        - Delete selected command (requires confirmation)\",\n            \"\",\n            \"Search and Filter:\",\n            \"  /        - Start filtering commands\",\n            \"  [type]   - Filter by command text, tags, or directory\",\n            \"  Esc      - Clear filter or cancel current operation\",\n            \"  Backspace- Remove last character from filter\",\n            \"\",\n            \"Display:\",\n            \"  ?        - Toggle this help screen\",\n            \"\",\n            \"Command Format:\",\n            \"  - (@param) Parameters are shown with @ prefix\",\n            \"  - (#tag)  Tags are shown in green with # prefix\",\n            \"  - (dir)   Working directory is shown if set\",\n            \"  - (id)    Command IDs are shown in parentheses\",\n            \"\",\n            \"Tips:\",\n            \"  - Use descriptive tags to organize commands\",\n            \"  - Parameters (@param) allow dynamic input\",\n            \"  - Filter works on commands, tags, and directories\",\n            \"  - Working directory affects command execution\",\n            \"\",\n            \"Note:\",\n            \"  - Debug mode can be enabled for troubleshooting\",\n            \"  - All commands are executed in the current shell\",\n            \"  - Command history is preserved in the database\"\n        ];\n\n        let help_paragraph = Paragraph::new(help_text.join(\"\\n\"))\n            .style(Style::default().fg(Color::White))\n            .block(Block::default().borders(Borders::ALL).title(\"Help (press ? to close)\"));\n\n        let area = centered_rect(80, 80, f.size());\n        f.render_widget(Clear, area);\n        f.render_widget(help_paragraph, area);\n    }\n\n    fn create_layout(\u0026self, f: \u0026mut ratatui::Frame) -\u003e Vec\u003cRect\u003e {\n        Layout::default()\n            .direction(Direction::Vertical)\n            .margin(1)\n            .constraints([\n                Constraint::Length(3),  // Title\n                Constraint::Min(0),     // Commands list\n                Constraint::Length(1),  // Filter\n                Constraint::Length(3),  // Status bar\n            ])\n            .split(f.size())\n            .to_vec()\n    }\n\n    fn render_title(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let title = Paragraph::new(\"Command Vault\")\n            .style(Style::default().fg(Color::Cyan))\n            .block(Block::default().borders(Borders::ALL));\n        f.render_widget(title, area);\n    }\n\n    fn render_commands_list(\u0026mut self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let commands: Vec\u003cListItem\u003e = self.filtered_commands.iter()\n            .map(|\u0026i| {\n                let cmd = \u0026self.commands[i];\n                let local_time = cmd.timestamp.with_timezone(\u0026chrono::Local);\n                let time_str = local_time.format(\"%Y-%m-%d %H:%M:%S\").to_string();\n                \n                let mut spans = vec![\n                    Span::styled(\n                        format!(\"({}) \", cmd.id.unwrap_or(0)),\n                        Style::default().fg(Color::DarkGray)\n                    ),\n                    Span::styled(\n                        format!(\"[{}] \", time_str),\n                        Style::default().fg(Color::Yellow)\n                    ),\n                    Span::raw(\u0026cmd.command),\n                ];\n\n                if !cmd.tags.is_empty() {\n                    spans.push(Span::raw(\" \"));\n                    for tag in \u0026cmd.tags {\n                        spans.push(Span::styled(\n                            format!(\"#{} \", tag),\n                            Style::default().fg(Color::Green)\n                        ));\n                    }\n                }\n\n                ListItem::new(Line::from(spans))\n            })\n            .collect();\n\n        let commands = List::new(commands)\n            .block(Block::default().borders(Borders::ALL).title(\"Commands\"))\n            .highlight_style(Style::default().add_modifier(Modifier::REVERSED));\n        \n        let commands_state = self.selected.map(|i| {\n            let mut state = ratatui::widgets::ListState::default();\n            state.select(Some(i));\n            state\n        });\n\n        if let Some(state) = commands_state {\n            f.render_stateful_widget(commands, area, \u0026mut state.clone());\n        } else {\n            f.render_widget(commands, area);\n        }\n    }\n\n    fn render_filter(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        if !self.filter_text.is_empty() {\n            let filter = Paragraph::new(format!(\"Filter: {}\", self.filter_text))\n                .style(Style::default().fg(Color::Yellow));\n            f.render_widget(filter, area);\n        }\n    }\n\n    fn render_status_bar(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let status = if let Some((msg, color)) = \u0026self.message {\n            vec![Span::styled(msg, Style::default().fg(*color))]\n        } else if self.show_help {\n            vec![\n                Span::raw(\"Press \"),\n                Span::styled(\"q\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to quit, \"),\n                Span::styled(\"↑↓/jk\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to navigate, \"),\n                Span::styled(\"c\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" or \"),\n                Span::styled(\"y\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to copy, \"),\n                Span::styled(\"?\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" for help\"),\n            ]\n        } else {\n            vec![\n                Span::raw(\"Press \"),\n                Span::styled(\"?\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" for help\"),\n            ]\n        };\n\n        let status = Paragraph::new(Line::from(status))\n            .block(Block::default().borders(Borders::ALL));\n        f.render_widget(status, area);\n    }\n\n    fn render_delete_confirmation(\u0026self, f: \u0026mut ratatui::Frame) {\n        if let Some(idx) = self.confirm_delete {\n            if let Some(\u0026cmd_idx) = self.filtered_commands.get(idx) {\n                if let Some(cmd) = self.commands.get(cmd_idx) {\n                    let command_str = format!(\"Command: {}\", cmd.command);\n                    let id_str = format!(\"ID: {}\", cmd.id.unwrap_or(0));\n                    \n                    let dialog_text = vec![\n                        \"Are you sure you want to delete this command?\",\n                        \"\",\n                        \u0026command_str,\n                        \u0026id_str,\n                        \"\",\n                        \"Press Enter to confirm or Esc to cancel\",\n                    ];\n\n                    let dialog = Paragraph::new(dialog_text.join(\"\\n\"))\n                        .style(Style::default().fg(Color::White))\n                        .block(Block::default()\n                            .borders(Borders::ALL)\n                            .border_style(Style::default().fg(Color::Red))\n                            .title(\"Confirm Delete\"));\n\n                    let area = centered_rect(60, 40, f.size());\n                    f.render_widget(Clear, area);\n                    f.render_widget(dialog, area);\n                }\n            }\n        }\n    }\n\n    pub fn set_message(\u0026mut self, text: String, color: Color) {\n        self.message = Some((text, color));\n    }\n\n    pub fn clear_message(\u0026mut self) {\n        self.message = None;\n    }\n\n    pub fn set_success_message(\u0026mut self, text: String) {\n        self.set_message(text, Color::Green);\n    }\n\n    pub fn set_error_message(\u0026mut self, text: String) {\n        self.set_message(text, Color::Red);\n    }\n\n    pub fn get_selection(\u0026self) -\u003e Option\u003cusize\u003e {\n        self.selected\n    }\n\n    pub fn set_selection(\u0026mut self, index: Option\u003cusize\u003e) {\n        if let Some(idx) = index {\n            if idx \u003c self.filtered_commands.len() {\n                self.selected = Some(idx);\n            }\n        } else {\n            self.selected = None;\n        }\n    }\n\n    pub fn update_selection_after_filter(\u0026mut self) {\n        if self.filtered_commands.is_empty() {\n            self.selected = None;\n        } else if let Some(selected) = self.selected {\n            if selected \u003e= self.filtered_commands.len() {\n                self.selected = Some(self.filtered_commands.len() - 1);\n            }\n        }\n    }\n\n    pub fn update_selection_after_delete(\u0026mut self, deleted_index: usize) {\n        if self.filtered_commands.is_empty() {\n            self.selected = None;\n        } else if let Some(selected) = self.selected {\n            self.selected = Some(selected.min(self.filtered_commands.len() - 1));\n        }\n    }\n\n    pub fn select_next(\u0026mut self) {\n        if let Some(selected) = self.selected {\n            if selected \u003c self.filtered_commands.len() - 1 {\n                self.selected = Some(selected + 1);\n            }\n        } else if !self.filtered_commands.is_empty() {\n            self.selected = Some(0);\n        }\n    }\n\n    pub fn select_previous(\u0026mut self) {\n        if let Some(selected) = self.selected {\n            if selected \u003e 0 {\n                self.selected = Some(selected - 1);\n            }\n        } else if !self.filtered_commands.is_empty() {\n            self.selected = Some(self.filtered_commands.len() - 1);\n        }\n    }\n\n    pub fn get_selected_command(\u0026self) -\u003e Option\u003c\u0026Command\u003e {\n        self.selected\n            .and_then(|selected| self.filtered_commands.get(selected))\n            .and_then(|\u0026idx| self.commands.get(idx))\n    }\n\n    pub fn get_selected_index(\u0026self) -\u003e Option\u003cusize\u003e {\n        self.selected\n            .and_then(|selected| self.filtered_commands.get(selected))\n            .copied()\n    }\n\n    fn execute_selected_command(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        if let Some(cmd) = self.get_selected_command() {\n            // Exit TUI temporarily\n            restore_terminal(terminal)?;\n            \n            // Re-enable colors after restoring terminal\n            colored::control::set_override(true);\n\n            // If command has parameters, substitute them with user input\n            let current_params = parse_parameters(\u0026cmd.command);\n            let final_command = substitute_parameters(\u0026cmd.command, \u0026current_params, None)?;\n            let ctx = ExecutionContext {\n                command: final_command,\n                directory: cmd.directory.clone(),\n                test_mode: false,\n                debug_mode: self.debug_mode,\n            };\n            execute_shell_command(\u0026ctx)?;\n            \n            return Ok(());\n        }\n        Ok(())\n    }\n\n    fn delete_selected_command(\u0026mut self) -\u003e Result\u003c()\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(confirm_idx) = self.confirm_delete {\n                if confirm_idx == selected {\n                    if let Some(idx) = self.get_selected_index() {\n                        if let Some(command_id) = self.commands[idx].id {\n                            match self.db.delete_command(command_id) {\n                                Ok(_) =\u003e {\n                                    self.commands.remove(idx);\n                                    self.set_success_message(\"Command deleted successfully\".to_string());\n                                    self.update_filtered_commands();\n                                    self.update_selection_after_delete(idx);\n                                }\n                                Err(e) =\u003e {\n                                    self.set_error_message(format!(\"Failed to delete command: {}\", e));\n                                }\n                            }\n                            self.confirm_delete = None;\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n\n    fn edit_selected_command(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(\u0026idx) = self.filtered_commands.get(selected) {\n                if let Some(cmd) = self.commands.get(idx).cloned() {\n                    // Exit TUI temporarily\n                    restore_terminal(terminal)?;\n                    \n                    // Create AddCommandApp with existing command data\n                    let mut add_app = AddCommandApp::new();\n                    add_app.set_command(cmd.command.clone());\n                    add_app.set_tags(cmd.tags.clone());\n                    \n                    let result = add_app.run();\n                    \n                    // Re-initialize terminal and force redraw\n                    let mut new_terminal = setup_terminal()?;\n                    new_terminal.clear()?;\n                    *terminal = new_terminal;\n                    terminal.draw(|f| self.ui(f))?;\n                    \n                    match result {\n                        Ok(Some((new_command, new_tags, _))) =\u003e {\n                            // Update command\n                            let updated_cmd = Command {\n                                id: cmd.id,\n                                command: new_command.clone(),\n                                timestamp: cmd.timestamp,\n                                directory: cmd.directory.clone(),\n                                tags: new_tags,\n                                parameters: crate::utils::params::parse_parameters(\u0026new_command),\n                            };\n                            \n                            if let Err(e) = self.db.update_command(\u0026updated_cmd) {\n                                self.set_error_message(format!(\"Failed to update command: {}\", e));\n                            } else {\n                                // Update local command list\n                                if let Some(cmd) = self.commands.get_mut(idx) {\n                                    *cmd = updated_cmd;\n                                }\n                                self.set_success_message(\"Command updated successfully!\".to_string());\n                            }\n                        }\n                        Ok(None) =\u003e {\n                            self.set_message(\"Edit cancelled\".to_string(), Color::Yellow);\n                        }\n                        Err(e) =\u003e {\n                            self.set_error_message(format!(\"Error during edit: {}\", e));\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n}\n\nfn centered_rect(percent_x: u16, percent_y: u16, r: Rect) -\u003e Rect {\n    // Calculate popup size based on percentage of screen size\n    let popup_width = (r.width as f32 * (percent_x as f32 / 100.0)) as u16;\n    let popup_height = (r.height as f32 * (percent_y as f32 / 100.0)) as u16;\n\n    // Calculate popup position to center it\n    let popup_x = ((r.width - popup_width) / 2) + r.x;\n    let popup_y = ((r.height - popup_height) / 2) + r.y;\n\n    Rect::new(popup_x, popup_y, popup_width, popup_height)\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    let mut terminal = Terminal::new(backend)?;\n    terminal.hide_cursor()?;\n    Ok(terminal)\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    terminal.show_cursor()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    disable_raw_mode()?;\n    colored::control::set_override(true);\n    Ok(())\n}\n\npub fn copy_to_clipboard(text: \u0026str) -\u003e Result\u003c()\u003e {\n    #[cfg(target_os = \"macos\")]\n    {\n        use std::process::Command;\n        let mut child = Command::new(\"pbcopy\")\n            .stdin(std::process::Stdio::piped())\n            .spawn()?;\n        \n        if let Some(mut stdin) = child.stdin.take() {\n            use std::io::Write;\n            stdin.write_all(text.as_bytes())?;\n        }\n        \n        child.wait()?;\n    }\n    \n    #[cfg(target_os = \"linux\")]\n    {\n        use std::process::Command;\n        let mut child = Command::new(\"xclip\")\n            .arg(\"-selection\")\n            .arg(\"clipboard\")\n            .stdin(std::process::Stdio::piped())\n            .spawn()?;\n        \n        if let Some(mut stdin) = child.stdin.take() {\n            use std::io::Write;\n            stdin.write_all(text.as_bytes())?;\n        }\n        \n        child.wait()?;\n    }\n    \n    Ok(())\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":54}},{"line":35,"address":[],"length":0,"stats":{"Line":54}},{"line":41,"address":[],"length":0,"stats":{"Line":54}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":8}},{"line":89,"address":[],"length":0,"stats":{"Line":8}},{"line":90,"address":[],"length":0,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":2}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":93,"address":[],"length":0,"stats":{"Line":6}},{"line":94,"address":[],"length":0,"stats":{"Line":2}},{"line":95,"address":[],"length":0,"stats":{"Line":2}},{"line":96,"address":[],"length":0,"stats":{"Line":4}},{"line":97,"address":[],"length":0,"stats":{"Line":2}},{"line":98,"address":[],"length":0,"stats":{"Line":2}},{"line":100,"address":[],"length":0,"stats":{"Line":2}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":6}},{"line":178,"address":[],"length":0,"stats":{"Line":8}},{"line":179,"address":[],"length":0,"stats":{"Line":2}},{"line":180,"address":[],"length":0,"stats":{"Line":8}},{"line":181,"address":[],"length":0,"stats":{"Line":2}},{"line":182,"address":[],"length":0,"stats":{"Line":2}},{"line":184,"address":[],"length":0,"stats":{"Line":6}},{"line":187,"address":[],"length":0,"stats":{"Line":6}},{"line":188,"address":[],"length":0,"stats":{"Line":6}},{"line":189,"address":[],"length":0,"stats":{"Line":6}},{"line":192,"address":[],"length":0,"stats":{"Line":10}},{"line":193,"address":[],"length":0,"stats":{"Line":10}},{"line":194,"address":[],"length":0,"stats":{"Line":10}},{"line":197,"address":[],"length":0,"stats":{"Line":12}},{"line":198,"address":[],"length":0,"stats":{"Line":12}},{"line":199,"address":[],"length":0,"stats":{"Line":12}},{"line":202,"address":[],"length":0,"stats":{"Line":8}},{"line":203,"address":[],"length":0,"stats":{"Line":16}},{"line":204,"address":[],"length":0,"stats":{"Line":8}},{"line":205,"address":[],"length":0,"stats":{"Line":8}},{"line":209,"address":[],"length":0,"stats":{"Line":224}},{"line":210,"address":[],"length":0,"stats":{"Line":224}},{"line":211,"address":[],"length":0,"stats":{"Line":224}},{"line":212,"address":[],"length":0,"stats":{"Line":320}},{"line":213,"address":[],"length":0,"stats":{"Line":130}},{"line":216,"address":[],"length":0,"stats":{"Line":76}},{"line":217,"address":[],"length":0,"stats":{"Line":76}},{"line":218,"address":[],"length":0,"stats":{"Line":376}},{"line":219,"address":[],"length":0,"stats":{"Line":76}},{"line":221,"address":[],"length":0,"stats":{"Line":76}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":334,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":379,"address":[],"length":0,"stats":{"Line":0}},{"line":380,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":382,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":391,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":403,"address":[],"length":0,"stats":{"Line":0}},{"line":404,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":406,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":418,"address":[],"length":0,"stats":{"Line":0}},{"line":419,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":422,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":14}},{"line":434,"address":[],"length":0,"stats":{"Line":14}},{"line":437,"address":[],"length":0,"stats":{"Line":6}},{"line":438,"address":[],"length":0,"stats":{"Line":6}},{"line":441,"address":[],"length":0,"stats":{"Line":8}},{"line":442,"address":[],"length":0,"stats":{"Line":8}},{"line":445,"address":[],"length":0,"stats":{"Line":2}},{"line":446,"address":[],"length":0,"stats":{"Line":2}},{"line":449,"address":[],"length":0,"stats":{"Line":10}},{"line":450,"address":[],"length":0,"stats":{"Line":10}},{"line":453,"address":[],"length":0,"stats":{"Line":8}},{"line":454,"address":[],"length":0,"stats":{"Line":14}},{"line":455,"address":[],"length":0,"stats":{"Line":6}},{"line":456,"address":[],"length":0,"stats":{"Line":6}},{"line":459,"address":[],"length":0,"stats":{"Line":2}},{"line":463,"address":[],"length":0,"stats":{"Line":82}},{"line":464,"address":[],"length":0,"stats":{"Line":92}},{"line":465,"address":[],"length":0,"stats":{"Line":10}},{"line":466,"address":[],"length":0,"stats":{"Line":96}},{"line":467,"address":[],"length":0,"stats":{"Line":8}},{"line":468,"address":[],"length":0,"stats":{"Line":8}},{"line":473,"address":[],"length":0,"stats":{"Line":8}},{"line":474,"address":[],"length":0,"stats":{"Line":10}},{"line":475,"address":[],"length":0,"stats":{"Line":2}},{"line":476,"address":[],"length":0,"stats":{"Line":16}},{"line":477,"address":[],"length":0,"stats":{"Line":4}},{"line":481,"address":[],"length":0,"stats":{"Line":14}},{"line":482,"address":[],"length":0,"stats":{"Line":22}},{"line":483,"address":[],"length":0,"stats":{"Line":4}},{"line":484,"address":[],"length":0,"stats":{"Line":4}},{"line":486,"address":[],"length":0,"stats":{"Line":12}},{"line":487,"address":[],"length":0,"stats":{"Line":6}},{"line":491,"address":[],"length":0,"stats":{"Line":8}},{"line":492,"address":[],"length":0,"stats":{"Line":14}},{"line":493,"address":[],"length":0,"stats":{"Line":4}},{"line":494,"address":[],"length":0,"stats":{"Line":4}},{"line":496,"address":[],"length":0,"stats":{"Line":4}},{"line":497,"address":[],"length":0,"stats":{"Line":2}},{"line":501,"address":[],"length":0,"stats":{"Line":12}},{"line":502,"address":[],"length":0,"stats":{"Line":12}},{"line":503,"address":[],"length":0,"stats":{"Line":34}},{"line":504,"address":[],"length":0,"stats":{"Line":30}},{"line":507,"address":[],"length":0,"stats":{"Line":10}},{"line":508,"address":[],"length":0,"stats":{"Line":10}},{"line":509,"address":[],"length":0,"stats":{"Line":28}},{"line":513,"address":[],"length":0,"stats":{"Line":0}},{"line":514,"address":[],"length":0,"stats":{"Line":0}},{"line":516,"address":[],"length":0,"stats":{"Line":0}},{"line":519,"address":[],"length":0,"stats":{"Line":0}},{"line":522,"address":[],"length":0,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":526,"address":[],"length":0,"stats":{"Line":0}},{"line":528,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":532,"address":[],"length":0,"stats":{"Line":0}},{"line":534,"address":[],"length":0,"stats":{"Line":0}},{"line":537,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":540,"address":[],"length":0,"stats":{"Line":0}},{"line":541,"address":[],"length":0,"stats":{"Line":0}},{"line":542,"address":[],"length":0,"stats":{"Line":0}},{"line":543,"address":[],"length":0,"stats":{"Line":0}},{"line":544,"address":[],"length":0,"stats":{"Line":0}},{"line":545,"address":[],"length":0,"stats":{"Line":0}},{"line":546,"address":[],"length":0,"stats":{"Line":0}},{"line":547,"address":[],"length":0,"stats":{"Line":0}},{"line":548,"address":[],"length":0,"stats":{"Line":0}},{"line":550,"address":[],"length":0,"stats":{"Line":0}},{"line":551,"address":[],"length":0,"stats":{"Line":0}},{"line":554,"address":[],"length":0,"stats":{"Line":0}},{"line":560,"address":[],"length":0,"stats":{"Line":0}},{"line":563,"address":[],"length":0,"stats":{"Line":0}},{"line":564,"address":[],"length":0,"stats":{"Line":0}},{"line":565,"address":[],"length":0,"stats":{"Line":0}},{"line":566,"address":[],"length":0,"stats":{"Line":0}},{"line":568,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":572,"address":[],"length":0,"stats":{"Line":0}},{"line":573,"address":[],"length":0,"stats":{"Line":0}},{"line":575,"address":[],"length":0,"stats":{"Line":0}},{"line":578,"address":[],"length":0,"stats":{"Line":0}},{"line":579,"address":[],"length":0,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":583,"address":[],"length":0,"stats":{"Line":0}},{"line":584,"address":[],"length":0,"stats":{"Line":0}},{"line":587,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":589,"address":[],"length":0,"stats":{"Line":0}},{"line":590,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":595,"address":[],"length":0,"stats":{"Line":0}},{"line":596,"address":[],"length":0,"stats":{"Line":0}},{"line":599,"address":[],"length":0,"stats":{"Line":0}},{"line":600,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":605,"address":[],"length":0,"stats":{"Line":0}},{"line":606,"address":[],"length":0,"stats":{"Line":0}},{"line":608,"address":[],"length":0,"stats":{"Line":0}},{"line":609,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":619,"address":[],"length":0,"stats":{"Line":0}},{"line":621,"address":[],"length":0,"stats":{"Line":0}},{"line":622,"address":[],"length":0,"stats":{"Line":0}},{"line":625,"address":[],"length":0,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":628,"address":[],"length":0,"stats":{"Line":0}},{"line":631,"address":[],"length":0,"stats":{"Line":0}},{"line":632,"address":[],"length":0,"stats":{"Line":0}},{"line":633,"address":[],"length":0,"stats":{"Line":0}},{"line":634,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":636,"address":[],"length":0,"stats":{"Line":0}},{"line":637,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":643,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":645,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":2}},{"line":653,"address":[],"length":0,"stats":{"Line":4}},{"line":654,"address":[],"length":0,"stats":{"Line":2}},{"line":657,"address":[],"length":0,"stats":{"Line":4}},{"line":659,"address":[],"length":0,"stats":{"Line":0}},{"line":662,"address":[],"length":0,"stats":{"Line":2}},{"line":682,"address":[],"length":0,"stats":{"Line":2}}],"covered":96,"coverable":356},{"path":["/","Users","ozan","Projects","command-vault","src","ui","mod.rs"],"content":"pub mod app;\npub mod add;\n\npub use app::App;\npub use add::AddCommandApp;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","utils","mod.rs"],"content":"pub mod time;\npub mod params;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","utils","params.rs"],"content":"use anyhow::Result;\nuse colored::*;\nuse crossterm::{\n    cursor::MoveTo,\n    event::{self, Event, KeyCode},\n    QueueableCommand,\n    style::Print,\n    terminal::{disable_raw_mode, enable_raw_mode, Clear, ClearType},\n};\nuse regex::Regex;\nuse std::{\n    collections::HashMap,\n    io::{stdout, Stdout, Write},\n};\n\nuse crate::db::models::Parameter;\n\npub fn parse_parameters(command: \u0026str) -\u003e Vec\u003cParameter\u003e {\n    let re = Regex::new(r\"@([a-zA-Z_][a-zA-Z0-9_]*)(?::([^@\\s][^@]*))?\").unwrap();\n    let mut parameters = Vec::new();\n    \n    for cap in re.captures_iter(command) {\n        let name = cap[1].to_string();\n        let description = cap.get(2).map(|m| {\n            let desc = m.as_str().trim_end();\n            if let Some(space_pos) = desc.find(char::is_whitespace) {\n                \u0026desc[..space_pos]\n            } else {\n                desc\n            }.to_string()\n        });\n        parameters.push(Parameter::with_description(name, description));\n    }\n    \n    parameters\n}\n\npub fn substitute_parameters(command: \u0026str, parameters: \u0026[Parameter], test_input: Option\u003c\u0026str\u003e) -\u003e Result\u003cString\u003e {\n    let is_test = test_input.is_some() || std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    if is_test {\n        let mut final_command = command.to_string();\n        let test_values: Vec\u003c\u0026str\u003e = if let Some(input) = test_input {\n            if input.is_empty() {\n                parameters.iter()\n                    .map(|p| p.description.as_deref().unwrap_or(\"\"))\n                    .collect()\n            } else {\n                input.split('\\n').collect()\n            }\n        } else {\n            // When no test input is provided, use descriptions\n            parameters.iter()\n                .map(|p| p.description.as_deref().unwrap_or(\"\"))\n                .collect()\n        };\n\n        for (i, param) in parameters.iter().enumerate() {\n            let value = if i \u003c test_values.len() {\n                test_values[i]\n            } else {\n                param.description.as_deref().unwrap_or(\"\")\n            };\n\n            let needs_quotes = value.is_empty() || \n                             value.contains(' ') || \n                             value.contains('*') || \n                             value.contains(';') ||\n                             value.contains('|') ||\n                             value.contains('\u003e') ||\n                             value.contains('\u003c') ||\n                             command.contains('\u003e') ||\n                             command.contains('\u003c') ||\n                             command.contains('|') ||\n                             final_command.starts_with(\"grep\");\n\n            let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n            } else {\n                value.to_string()\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", param.name), \u0026quoted_value);\n            \n            // Remove the description part from the command\n            if let Some(desc) = \u0026param.description {\n                final_command = final_command.replace(\u0026format!(\":{}\", desc), \"\");\n            }\n        }\n        Ok(final_command)\n    } else {\n        prompt_parameters(command, parameters, test_input)\n    }\n}\n\npub fn prompt_parameters(command: \u0026str, parameters: \u0026[Parameter], test_input: Option\u003c\u0026str\u003e) -\u003e Result\u003cString\u003e {\n    let is_test = test_input.is_some() || std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    let result = (|| -\u003e Result\u003cString\u003e {\n        let mut param_values: HashMap\u003cString, String\u003e = HashMap::new();\n        let mut final_command = String::new();\n\n        for param in parameters {\n            let value = if is_test {\n                if let Some(input) = test_input {\n                    input.to_string()\n                } else {\n                    param.description.clone().unwrap_or_default()\n                }\n            } else {\n                enable_raw_mode()?;\n                let mut stdout = stdout();\n                stdout.queue(Clear(ClearType::All))?;\n                \n                // Function to update the preview\n                let update_preview = |stdout: \u0026mut Stdout, current_value: \u0026str| -\u003e Result\u003c()\u003e {\n                    let mut preview_command = command.to_string();\n                    \n                    // Add all previous parameter values\n                    for (name, value) in \u0026param_values {\n                        let needs_quotes = value.is_empty() || \n                            value.contains(' ') || \n                            value.contains('*') || \n                            value.contains(';') ||\n                            value.contains('|') ||\n                            value.contains('\u003e') ||\n                            value.contains('\u003c') ||\n                            preview_command.starts_with(\"grep\");\n\n                        let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                            format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n                        } else {\n                            value.clone()\n                        };\n\n                        preview_command = preview_command.replace(\u0026format!(\"@{}\", name), \u0026quoted_value);\n                    }\n\n                    // Add current parameter value\n                    let needs_quotes = current_value.is_empty() || \n                        current_value.contains(' ') || \n                        current_value.contains('*') || \n                        current_value.contains(';') ||\n                        current_value.contains('|') ||\n                        current_value.contains('\u003e') ||\n                        current_value.contains('\u003c') ||\n                        preview_command.starts_with(\"grep\");\n\n                    let quoted_value = if needs_quotes \u0026\u0026 !current_value.starts_with('\\'') \u0026\u0026 !current_value.starts_with('\"') {\n                        format!(\"'{}'\", current_value.replace('\\'', \"'\\\\''\"))\n                    } else {\n                        current_value.to_string()\n                    };\n\n                    preview_command = preview_command.replace(\u0026format!(\"@{}\", param.name), \u0026quoted_value);\n\n                    stdout.queue(MoveTo(0, 0))?\n                          .queue(Print(\"─\".repeat(45).dimmed()))?;\n                    stdout.queue(MoveTo(0, 1))?\n                          .queue(Clear(ClearType::CurrentLine))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Command to execute\".blue().bold(), \n                              preview_command.green()\n                          )))?;\n                    stdout.queue(MoveTo(0, 2))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Working directory\".cyan().bold(), \n                              std::env::current_dir()?.to_string_lossy().white()\n                          )))?;\n                    Ok(())\n                };\n\n                // Initial display\n                update_preview(\u0026mut stdout, \"\")?;\n\n                stdout.queue(MoveTo(0, 4))?\n                      .queue(Print(\"─\".repeat(45).dimmed()))?;\n                stdout.queue(MoveTo(0, 5))?\n                      .queue(Print(format!(\"{}: {}\", \n                          \"Parameter\".blue().bold(), \n                          param.name.green()\n                      )))?;\n                if let Some(desc) = \u0026param.description {\n                    stdout.queue(MoveTo(0, 6))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Description\".cyan().bold(), \n                              desc.white()\n                          )))?;\n                }\n                stdout.queue(MoveTo(0, 7))?\n                      .queue(Print(format!(\"{}: \", \"Enter value\".yellow().bold())))?;\n                stdout.flush()?;\n\n                let mut value = String::new();\n                let mut cursor_pos = 0;\n\n                loop {\n                    if let Event::Key(key) = event::read()? {\n                        match key.code {\n                            KeyCode::Enter =\u003e break,\n                            KeyCode::Char('c') if key.modifiers.contains(event::KeyModifiers::CONTROL) =\u003e {\n                                // Handle Ctrl+C\n                                disable_raw_mode()?;\n                                stdout.queue(Clear(ClearType::All))?;\n                                stdout.queue(MoveTo(0, 0))?;\n                                stdout.flush()?;\n                                return Err(anyhow::anyhow!(\"Operation cancelled by user\"));\n                            }\n                            KeyCode::Char(c) =\u003e {\n                                value.insert(cursor_pos, c);\n                                cursor_pos += 1;\n                            }\n                            KeyCode::Backspace if cursor_pos \u003e 0 =\u003e {\n                                value.remove(cursor_pos - 1);\n                                cursor_pos -= 1;\n                            }\n                            KeyCode::Left if cursor_pos \u003e 0 =\u003e {\n                                cursor_pos -= 1;\n                            }\n                            KeyCode::Right if cursor_pos \u003c value.len() =\u003e {\n                                cursor_pos += 1;\n                            }\n                            _ =\u003e {}\n                        }\n\n                        // Update command preview\n                        update_preview(\u0026mut stdout, \u0026value)?;\n\n                        // Redraw the value line\n                        stdout.queue(MoveTo(0, 7))?\n                              .queue(Clear(ClearType::CurrentLine))?\n                              .queue(Print(format!(\"{}: {}\", \n                                  \"Enter value\".yellow().bold(), \n                                  value\n                              )))?;\n                        stdout.queue(MoveTo((cursor_pos + 13) as u16, 7))?;\n                        stdout.flush()?;\n                    }\n                }\n\n                disable_raw_mode()?;\n                value\n            };\n\n            param_values.insert(param.name.clone(), value);\n        }\n\n        // Build final command\n        final_command = command.to_string();\n        for (name, value) in \u0026param_values {\n            let needs_quotes = value.is_empty() || \n                             value.contains(' ') || \n                             value.contains('*') || \n                             value.contains(';') ||\n                             value.contains('|') ||\n                             value.contains('\u003e') ||\n                             value.contains('\u003c') ||\n                             command.contains('\u003e') ||\n                             command.contains('\u003c') ||\n                             command.contains('|') ||\n                             final_command.starts_with(\"grep\");\n\n            let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n            } else {\n                value.clone()\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", name), \u0026quoted_value);\n            \n            // Remove the description part from the command\n            if let Some(desc) = \u0026parameters.iter().find(|p| p.name == *name).unwrap().description {\n                final_command = final_command.replace(\u0026format!(\":{}\", desc), \"\");\n            }\n        }\n\n        if !is_test {\n            let mut stdout = stdout();\n            stdout.queue(Clear(ClearType::All))?;\n            stdout.queue(MoveTo(0, 0))?;\n            stdout.flush()?;\n        }\n\n        Ok(final_command)\n    })();\n\n    if !is_test {\n        disable_raw_mode()?;\n    }\n\n    result\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":40}},{"line":19,"address":[],"length":0,"stats":{"Line":40}},{"line":20,"address":[],"length":0,"stats":{"Line":40}},{"line":22,"address":[],"length":0,"stats":{"Line":116}},{"line":23,"address":[],"length":0,"stats":{"Line":38}},{"line":24,"address":[],"length":0,"stats":{"Line":62}},{"line":25,"address":[],"length":0,"stats":{"Line":24}},{"line":26,"address":[],"length":0,"stats":{"Line":28}},{"line":29,"address":[],"length":0,"stats":{"Line":20}},{"line":30,"address":[],"length":0,"stats":{"Line":24}},{"line":32,"address":[],"length":0,"stats":{"Line":38}},{"line":35,"address":[],"length":0,"stats":{"Line":40}},{"line":38,"address":[],"length":0,"stats":{"Line":42}},{"line":39,"address":[],"length":0,"stats":{"Line":92}},{"line":40,"address":[],"length":0,"stats":{"Line":42}},{"line":41,"address":[],"length":0,"stats":{"Line":42}},{"line":42,"address":[],"length":0,"stats":{"Line":118}},{"line":44,"address":[],"length":0,"stats":{"Line":6}},{"line":45,"address":[],"length":0,"stats":{"Line":18}},{"line":48,"address":[],"length":0,"stats":{"Line":28}},{"line":52,"address":[],"length":0,"stats":{"Line":8}},{"line":53,"address":[],"length":0,"stats":{"Line":18}},{"line":57,"address":[],"length":0,"stats":{"Line":38}},{"line":58,"address":[],"length":0,"stats":{"Line":76}},{"line":59,"address":[],"length":0,"stats":{"Line":38}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":76}},{"line":65,"address":[],"length":0,"stats":{"Line":34}},{"line":66,"address":[],"length":0,"stats":{"Line":10}},{"line":67,"address":[],"length":0,"stats":{"Line":10}},{"line":68,"address":[],"length":0,"stats":{"Line":10}},{"line":69,"address":[],"length":0,"stats":{"Line":10}},{"line":70,"address":[],"length":0,"stats":{"Line":10}},{"line":71,"address":[],"length":0,"stats":{"Line":10}},{"line":72,"address":[],"length":0,"stats":{"Line":10}},{"line":73,"address":[],"length":0,"stats":{"Line":10}},{"line":74,"address":[],"length":0,"stats":{"Line":10}},{"line":76,"address":[],"length":0,"stats":{"Line":96}},{"line":77,"address":[],"length":0,"stats":{"Line":28}},{"line":79,"address":[],"length":0,"stats":{"Line":10}},{"line":85,"address":[],"length":0,"stats":{"Line":8}},{"line":89,"address":[],"length":0,"stats":{"Line":42}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}}],"covered":41,"coverable":167},{"path":["/","Users","ozan","Projects","command-vault","src","utils","time.rs"],"content":"use chrono::{DateTime, TimeZone, Utc, NaiveDate};\n\npub fn parse_datetime(s: \u0026str) -\u003e Option\u003cDateTime\u003cUtc\u003e\u003e {\n    // Try RFC3339 format first\n    if let Ok(dt) = DateTime::parse_from_rfc3339(s) {\n        return Some(dt.with_timezone(\u0026Utc));\n    }\n\n    // Try common date formats\n    let date_formats = [\n        \"%Y-%m-%d\",\n        \"%Y/%m/%d\",\n        \"%d-%m-%Y\",\n        \"%d/%m/%Y\",\n    ];\n\n    let datetime_formats = [\n        \"%Y-%m-%d %H:%M\",\n        \"%Y-%m-%d %H:%M:%S\",\n        \"%Y-%m-%d %H:%M:%S UTC\",\n        \"%d/%m/%Y %H:%M\",\n        \"%d/%m/%Y %H:%M:%S\",\n    ];\n\n    // Try date-only formats first\n    for format in date_formats {\n        if let Ok(naive_date) = NaiveDate::parse_from_str(s, format) {\n            let naive_datetime = naive_date.and_hms_opt(0, 0, 0).unwrap();\n            return Some(Utc.from_utc_datetime(\u0026naive_datetime));\n        }\n    }\n\n    // Then try datetime formats\n    for format in datetime_formats {\n        if let Ok(naive) = chrono::NaiveDateTime::parse_from_str(s, format) {\n            return Some(Utc.from_utc_datetime(\u0026naive));\n        }\n    }\n\n    None\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":51}},{"line":5,"address":[],"length":0,"stats":{"Line":57}},{"line":10,"address":[],"length":0,"stats":{"Line":45}},{"line":11,"address":[],"length":0,"stats":{"Line":45}},{"line":12,"address":[],"length":0,"stats":{"Line":45}},{"line":13,"address":[],"length":0,"stats":{"Line":45}},{"line":14,"address":[],"length":0,"stats":{"Line":45}},{"line":17,"address":[],"length":0,"stats":{"Line":45}},{"line":18,"address":[],"length":0,"stats":{"Line":45}},{"line":19,"address":[],"length":0,"stats":{"Line":45}},{"line":20,"address":[],"length":0,"stats":{"Line":45}},{"line":21,"address":[],"length":0,"stats":{"Line":45}},{"line":22,"address":[],"length":0,"stats":{"Line":45}},{"line":26,"address":[],"length":0,"stats":{"Line":357}},{"line":27,"address":[],"length":0,"stats":{"Line":12}},{"line":28,"address":[],"length":0,"stats":{"Line":12}},{"line":29,"address":[],"length":0,"stats":{"Line":12}},{"line":34,"address":[],"length":0,"stats":{"Line":298}},{"line":35,"address":[],"length":0,"stats":{"Line":13}},{"line":36,"address":[],"length":0,"stats":{"Line":13}},{"line":40,"address":[],"length":0,"stats":{"Line":20}}],"covered":21,"coverable":21},{"path":["/","Users","ozan","Projects","command-vault","src","version.rs"],"content":"/// The current version of the application.\n/// This should match the version in Cargo.toml\npub const VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\n/// The name of the application\npub const APP_NAME: \u0026str = env!(\"CARGO_PKG_NAME\");\n\n/// The authors of the application\npub const APP_AUTHORS: \u0026str = env!(\"CARGO_PKG_AUTHORS\");\n\n/// The description of the application\npub const APP_DESCRIPTION: \u0026str = env!(\"CARGO_PKG_DESCRIPTION\");\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","args_test.rs"],"content":"use command_vault::cli::args::{Cli, Commands, TagCommands};\nuse clap::Parser;\n\n#[test]\nfn test_parse_args_add() {\n    let args = vec![\"cv\", \"add\", \"--\", \"ls\", \"-l\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command, vec![\"ls\", \"-l\"]);\n            assert!(tags.is_empty());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_add_with_tags() {\n    let args = vec![\"cv\", \"add\", \"-t\", \"file\", \"-t\", \"list\", \"--\", \"ls\", \"-l\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command, vec![\"ls\", \"-l\"]);\n            assert_eq!(tags, vec![\"file\", \"list\"]);\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_ls() {\n    let args = vec![\"cv\", \"ls\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 50);\n            assert!(!asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_ls_with_limit() {\n    let args = vec![\"cv\", \"ls\", \"--limit\", \"5\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 5);\n            assert!(!asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_exec() {\n    let args = vec![\"cv\", \"exec\", \"1\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(debug, false); // Default value should be false\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n\n    // Test with debug flag\n    let args = vec![\"cv\", \"exec\", \"1\", \"--debug\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(debug, true);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_search() {\n    let args = vec![\"cv\", \"search\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git\");\n            assert_eq!(limit, 10);\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_add() {\n    let args = vec![\"cv\", \"tag\", \"add\", \"1\", \"--\", \"git\", \"vcs\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Add { command_id, tags } =\u003e {\n                    assert_eq!(command_id, 1);\n                    assert_eq!(tags, vec![\"git\", \"vcs\"]);\n                }\n                _ =\u003e panic!(\"Expected Tag Add command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_remove() {\n    let args = vec![\"cv\", \"tag\", \"remove\", \"1\", \"--\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Remove { command_id, tag } =\u003e {\n                    assert_eq!(command_id, 1);\n                    assert_eq!(tag, \"git\");\n                }\n                _ =\u003e panic!(\"Expected Tag Remove command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_list() {\n    let args = vec![\"cv\", \"tag\", \"list\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::List =\u003e (),\n                _ =\u003e panic!(\"Expected Tag List command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_search() {\n    let args = vec![\"cv\", \"tag\", \"search\", \"--\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Search { tag, limit } =\u003e {\n                    assert_eq!(tag, \"git\");\n                    assert_eq!(limit, 10);\n                }\n                _ =\u003e panic!(\"Expected Tag Search command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","cli_test.rs"],"content":"use anyhow::Result;\nuse command_vault::cli::args::{Cli, Commands, TagCommands};\nuse clap::Parser;\n\n#[test]\nfn test_add_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test basic command without tags\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"git\",\n        \"commit\",\n        \"-m\",\n        \"test\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"git commit -m test\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test with tags\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--tags\",\n        \"git\",\n        \"--tags\",\n        \"vcs\",\n        \"--\",\n        \"git\",\n        \"commit\",\n        \"-m\",\n        \"test\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"git commit -m test\");\n            assert_eq!(tags, vec![\"git\", \"vcs\"]);\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test with multiple words in command (no dashes)\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"echo\",\n        \"hello world\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"echo hello world\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command without any command (missing --)\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n    ]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"the following required arguments were not provided\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_search_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n        \"git commit\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git commit\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_ls_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"ls\",\n        \"--limit\",\n        \"20\",\n        \"--asc\",\n    ])?;\n\n    match args.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 20);\n            assert!(asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_ls_command_default_behavior() -\u003e Result\u003c()\u003e {\n    // Test ls with default values\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"ls\",\n    ])?;\n\n    match args.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 50); // Default limit is 50\n            assert!(!asc); // Default is descending order\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_tag_commands_parsing() -\u003e Result\u003c()\u003e {\n    // Test tag add\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"add\",\n        \"1\",\n        \"important\",\n        \"urgent\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Add { command_id, tags } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tags, vec![\"important\", \"urgent\"]);\n        }\n        _ =\u003e panic!(\"Expected Tag Add command\"),\n    }\n\n    // Test tag remove\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"remove\",\n        \"1\",\n        \"urgent\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Remove { command_id, tag } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tag, \"urgent\");\n        }\n        _ =\u003e panic!(\"Expected Tag Remove command\"),\n    }\n\n    // Test tag list\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"list\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::List } =\u003e (),\n        _ =\u003e panic!(\"Expected Tag List command\"),\n    }\n\n    // Test tag search\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_exec_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"exec\",\n        \"42\",\n    ])?;\n\n    match args.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 42);\n            assert_eq!(debug, false);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_parse_exec_command() {\n    let args = vec![\"command-vault\", \"exec\", \"123\"];\n    let cli = Cli::try_parse_from(args).unwrap();\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 123);\n            assert_eq!(debug, false);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n\n    // Test with debug flag\n    let args = vec![\"command-vault\", \"exec\", \"123\", \"--debug\"];\n    let cli = Cli::try_parse_from(args).unwrap();\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 123);\n            assert_eq!(debug, true);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n}\n\n#[test]\nfn test_invalid_command_id() {\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"exec\",\n        \"not_a_number\",\n    ]);\n    assert!(result.is_err());\n    let err = result.unwrap_err().to_string();\n    assert!(err.contains(\"invalid value 'not_a_number'\"));\n}\n\n#[test]\nfn test_missing_required_args() {\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n    ]);\n    assert!(result.is_err());\n    let err = result.unwrap_err().to_string();\n    assert!(err.contains(\"\u003cQUERY\u003e\"));\n}\n\n#[test]\nfn test_search_command_default_limit() -\u003e Result\u003c()\u003e {\n    // Test search with default limit\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n        \"git commit\",\n    ])?;\n\n    match args.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git commit\");\n            assert_eq!(limit, 10); // Default limit is 10\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_delete_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test basic delete\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"delete\",\n        \"42\",\n    ])?;\n\n    match args.command {\n        Commands::Delete { command_id } =\u003e {\n            assert_eq!(command_id, 42);\n        }\n        _ =\u003e panic!(\"Expected Delete command\"),\n    }\n\n    // Test missing command ID\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"delete\",\n    ]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"required\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_shell_init_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test default shell initialization\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"shell-init\",\n    ])?;\n\n    match args.command {\n        Commands::ShellInit { shell } =\u003e {\n            assert!(shell.is_none());\n        }\n        _ =\u003e panic!(\"Expected ShellInit command\"),\n    }\n\n    // Test explicit shell override\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"shell-init\",\n        \"--shell\",\n        \"fish\",\n    ])?;\n\n    match args.command {\n        Commands::ShellInit { shell } =\u003e {\n            assert_eq!(shell, Some(\"fish\".to_string()));\n        }\n        _ =\u003e panic!(\"Expected ShellInit command\"),\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_commands_all() -\u003e Result\u003c()\u003e {\n    // Test tag remove\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"remove\",\n        \"1\",\n        \"git\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Remove { command_id, tag } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tag, \"git\");\n        }\n        _ =\u003e panic!(\"Expected Tag Remove command\"),\n    }\n\n    // Test tag list\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"list\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::List } =\u003e (),\n        _ =\u003e panic!(\"Expected Tag List command\"),\n    }\n\n    // Test tag search\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n\n    // Test tag search with default limit\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 10); // Default limit is 10\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_with_parameters() -\u003e Result\u003c()\u003e {\n    // Test add command with basic parameter\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command with parameter description\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename:Name of file to create\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename:Name of file to create\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command with parameter default value\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename:Name of file to create=test.txt\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename:Name of file to create=test.txt\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","commands_test.rs"],"content":"use anyhow::Result;\nuse chrono::{TimeZone, Utc};\nuse command_vault::{\n    cli::{args::{Commands, TagCommands}, commands::handle_command},\n    db::{Command, models::Parameter},\n};\nuse tempfile::tempdir;\nuse std::env;\n\nmod test_utils;\nuse test_utils::create_test_db;\n\n// Set up test environment\n#[ctor::ctor]\nfn setup() {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n}\n\n#[test]\nfn test_ls_empty() -\u003e Result\u003c()\u003e {\n    let (db, _db_dir) = create_test_db()?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_list() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    Ok(())\n}\n\n#[test]\nfn test_ls_with_limit() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    for i in 0..5 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    let commands = db.list_commands(3, false)?;\n    assert_eq!(commands.len(), 3);\n    Ok(())\n}\n\n#[test]\nfn test_ls_ordering() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let timestamps = vec![\n        Utc.with_ymd_and_hms(2022, 1, 1, 0, 0, 0).unwrap(),\n        Utc.with_ymd_and_hms(2022, 1, 2, 0, 0, 0).unwrap(),\n        Utc.with_ymd_and_hms(2022, 1, 3, 0, 0, 0).unwrap(),\n    ];\n    \n    for (i, timestamp) in timestamps.iter().enumerate() {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: *timestamp,\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 3);\n    assert_eq!(commands[0].command, \"command 2\");\n    assert_eq!(commands[1].command, \"command 1\");\n    assert_eq!(commands[2].command, \"command 0\");\n    Ok(())\n}\n\n#[test]\nfn test_delete_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    db.delete_command(id)?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_search_commands() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    db.add_command(\u0026command)?;\n    let commands = db.search_commands(\"test\", 10)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    Ok(())\n}\n\n#[test]\nfn test_add_command_with_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    std::fs::create_dir_all(temp_dir.path())?;\n\n    // Change to the test directory\n    let original_dir = env::current_dir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    env::set_current_dir(\u0026test_dir)?;\n    \n    let command = vec![\"test\".to_string(), \"command\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    assert_eq!(commands[0].tags, vec![\"tag1\", \"tag2\"]);\n    \n    // Restore the original directory\n    env::set_current_dir(original_dir)?;\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_output() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test command that would produce output\n    let command = vec![\"echo\".to_string(), \"\\\"Hello, World!\\\"\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"echo \\\"Hello, World!\\\"\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_stderr() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test command that would produce stderr\n    let command = vec![\"ls\".to_string(), \"nonexistent_directory\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"ls nonexistent_directory\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_git_log_format_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    std::fs::create_dir_all(temp_dir.path())?;\n\n    // Change to the test directory\n    let original_dir = env::current_dir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    env::set_current_dir(\u0026test_dir)?;\n    \n    // Add the git log command with format string\n    let format_str = \"%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)\u003c%an\u003e%Creset\";\n    let command = vec![\n        \"git\".to_string(),\n        \"log\".to_string(),\n        \"--graph\".to_string(),\n        format!(\"--pretty=format:{}\", format_str),\n        \"--abbrev-commit\".to_string(),\n    ];\n    \n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(\n        commands[0].command, \n        format!(\"git log --graph \\\"--pretty=format:{}\\\" --abbrev-commit\", format_str)\n    );\n    \n    // Restore the original directory\n    env::set_current_dir(original_dir)?;\n    \n    Ok(())\n}\n\n#[test]\nfn test_parameter_parsing() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test basic parameter\n    let command = Command {\n        id: None,\n        command: \"echo @message\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"User_name\".to_string())\n        )],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 1);\n    assert_eq!(saved.parameters[0].name, \"message\");\n    assert_eq!(saved.parameters[0].description, Some(\"User_name\".to_string()));\n    \n    // Test parameter with description\n    let command = Command {\n        id: None,\n        command: \"echo @message:User_name\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"User_name\".to_string())\n        )],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 1);\n    assert_eq!(saved.parameters[0].name, \"message\");\n    assert_eq!(saved.parameters[0].description, Some(\"User_name\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_exec_command_with_parameters() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a command with parameters\n    let command = Command {\n        id: None,\n        command: \"echo Hello @name:Person's Name\".to_string(),\n        timestamp: Utc::now(),\n        directory: std::env::current_dir()?.to_string_lossy().to_string(),\n        tags: vec![],\n        parameters: vec![\n            Parameter::with_description(\"name\".to_string(), Some(\"Person's Name\".to_string()))\n        ],\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Execute the command without providing parameter values\n    // It should use the default value\n    let exec_command = Commands::Exec { \n        command_id,\n        debug: true  // Enable debug mode for better testing\n    };\n    \n    // Don't assert the result - the command execution may fail in test environments\n    // but we're primarily testing that our code can handle parameter substitution\n    handle_command(exec_command, \u0026mut db, false);\n    \n    // Instead, verify that the command was retrieved correctly\n    let retrieved_cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(retrieved_cmd.parameters.len(), 1);\n    assert_eq!(retrieved_cmd.parameters[0].name, \"name\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_exec_command_not_found() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to execute a nonexistent command\n    let exec_command = Commands::Exec { \n        command_id: 999, // Nonexistent ID\n        debug: false\n    };\n    \n    let result = handle_command(exec_command, \u0026mut db, false);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n    \n    Ok(())\n}\n\n#[test]\nfn test_parameter_validation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test invalid parameter name (starts with number)\n    let command = Command {\n        id: None,\n        command: \"echo @1name\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 0); // Invalid parameter should be ignored\n    \n    // Test invalid parameter name (special characters)\n    let command = Command {\n        id: None,\n        command: \"echo @name!\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 0); // Invalid parameter should be ignored\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_spaces_in_parameters() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"echo @message\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"test\".to_string()],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"A test message\".to_string())\n        )],\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"echo @message\");\n    assert_eq!(commands[0].parameters[0].name, \"message\");\n    assert_eq!(commands[0].parameters[0].description, Some(\"A test message\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_command_with_multiple_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].tags.len(), 3);\n    assert!(commands[0].tags.contains(\u0026\"tag1\".to_string()));\n    assert!(commands[0].tags.contains(\u0026\"tag2\".to_string()));\n    assert!(commands[0].tags.contains(\u0026\"tag3\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_command_with_special_chars() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"grep -r \\\"@pattern\\\" @directory\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"search\".to_string()],\n        parameters: vec![\n            Parameter::with_description(\n                \"pattern\".to_string(),\n                Some(\"Search pattern\".to_string())\n            ),\n            Parameter::with_description(\n                \"directory\".to_string(),\n                Some(\"Directory to search in\".to_string())\n            ),\n        ],\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].parameters.len(), 2);\n    assert_eq!(commands[0].parameters[0].name, \"pattern\");\n    assert_eq!(commands[0].parameters[0].description, Some(\"Search pattern\".to_string()));\n    assert_eq!(commands[0].parameters[1].name, \"directory\");\n    assert_eq!(commands[0].parameters[1].description, Some(\"Directory to search in\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_debug() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    std::env::set_current_dir(\u0026test_dir)?;\n    \n    // First add a simple command that works in any shell\n    let add_command = Commands::Add {\n        command: vec![\"echo\".to_string(), \"test\".to_string()],\n        tags: vec![],\n    };\n    handle_command(add_command, \u0026mut db, true)?;\n\n    // Then get the id of the added command\n    let commands = db.list_commands(1, false)?;\n    let id = commands[0].id.unwrap();\n\n    // Execute the command in debug mode\n    let exec_command = Commands::Exec { command_id: id, debug: true };\n    handle_command(exec_command, \u0026mut db, true)?;\n\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a test command\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    \n    // Verify command exists\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    \n    // Delete the command\n    handle_command(Commands::Delete { command_id: id }, \u0026mut db, false)?;\n    \n    // Verify command was deleted\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete_nonexistent() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to delete a command that doesn't exist\n    let result = handle_command(Commands::Delete { command_id: 999 }, \u0026mut db, false);\n    \n    // Verify we get an error\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"Command with ID 999 not found\"));\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete_with_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a test command with tags\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"test\".to_string(), \"example\".to_string()],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    \n    // Verify command exists with tags\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].tags.len(), 2);\n    \n    // Delete the command\n    handle_command(Commands::Delete { command_id: id }, \u0026mut db, false)?;\n    \n    // Verify command and its tags were deleted\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    \n    // Verify tags were removed\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 0);\n    Ok(())\n}\n\n// Add new tests for tag command functionality\n#[test]\nfn test_tag_add_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // First add a command\n    let command = Command {\n        id: None,\n        command: \"test command for tags\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Add tags to the command\n    let add_tags = vec![\"test-tag\".to_string(), \"important\".to_string()];\n    let tag_command = Commands::Tag { \n        action: TagCommands::Add { \n            command_id, \n            tags: add_tags.clone()\n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tags were added\n    let cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(cmd.tags.len(), 2);\n    assert!(cmd.tags.contains(\u0026\"test-tag\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"important\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_remove_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // First add a command with tags\n    let command = Command {\n        id: None,\n        command: \"test command for tag removal\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Remove a tag\n    let tag_command = Commands::Tag { \n        action: TagCommands::Remove { \n            command_id, \n            tag: \"tag2\".to_string() \n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tag was removed\n    let cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(cmd.tags.len(), 2);\n    assert!(cmd.tags.contains(\u0026\"tag1\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"tag3\".to_string()));\n    assert!(!cmd.tags.contains(\u0026\"tag2\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_list_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add commands with tags\n    for i in 0..3 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![\"common-tag\".to_string(), format!(\"tag-{}\", i)],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    // List tags\n    let tag_command = Commands::Tag { \n        action: TagCommands::List \n    };\n    \n    // This should not error\n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tags directly\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 4); // common-tag + 3 individual tags\n    \n    // Check if common-tag is used 3 times\n    let common_tag = tags.iter().find(|(t, _)| t == \"common-tag\").unwrap();\n    assert_eq!(common_tag.1, 3);\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_search_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add commands with different tags\n    for i in 0..5 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: if i % 2 == 0 { \n                vec![\"even\".to_string()]\n            } else {\n                vec![\"odd\".to_string()]\n            },\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    // Set up environment for testing\n    std::env::set_var(\"COMMAND_VAULT_NO_TUI\", \"1\");\n    \n    // Search by tag\n    let tag_command = Commands::Tag { \n        action: TagCommands::Search { \n            tag: \"even\".to_string(),\n            limit: 10\n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify directly with the DB\n    let results = db.search_by_tag(\"even\", 10)?;\n    assert_eq!(results.len(), 3); // commands 0, 2, 4\n    \n    // Clean up environment\n    std::env::remove_var(\"COMMAND_VAULT_NO_TUI\");\n    \n    Ok(())\n}\n\n// Add tests for edge cases and error conditions\n#[test]\nfn test_tag_add_nonexistent_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to add tags to a command that doesn't exist\n    let tag_command = Commands::Tag { \n        action: TagCommands::Add { \n            command_id: 999, // Nonexistent ID\n            tags: vec![\"test-tag\".to_string()]\n        } \n    };\n    \n    // This should not panic, but might produce an error\n    let result = handle_command(tag_command, \u0026mut db, false);\n    assert!(result.is_ok()); // The function handles the error internally\n    \n    Ok(())\n}\n\n#[test]\nfn test_empty_command_validation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to add an empty command\n    let add_command = Commands::Add {\n        command: vec![\"\".to_string()], \n        tags: vec![]\n    };\n    \n    let result = handle_command(add_command, \u0026mut db, false);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"empty command\"));\n    \n    Ok(())\n}\n\n// Test for shell initialization command\n#[test]\nfn test_shell_init_command_generation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    let shell_command = Commands::ShellInit { \n        shell: Some(\"bash\".to_string()) \n    };\n    \n    // This should return the path to the shell script\n    let result = handle_command(shell_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    // Test with missing shell parameter\n    let shell_command = Commands::ShellInit { \n        shell: None \n    };\n    \n    // This should try to auto-detect the shell\n    let result = handle_command(shell_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    Ok(())\n}\n\n// Test error handling for invalid shell\n#[test]\nfn test_shell_init_invalid_shell() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    let shell_command = Commands::ShellInit { \n        shell: Some(\"invalid_shell_name\".to_string()) \n    };\n    \n    // This should return an error for an invalid shell name\n    let result = handle_command(shell_command, \u0026mut db, false);\n    \n    // The result could be Ok or Err depending on how the function handles invalid shells\n    // Check the behavior based on the implementation\n    if result.is_err() {\n        assert!(result.unwrap_err().to_string().contains(\"invalid\"));\n    }\n    \n    Ok(())\n}\n\n// Test for search with empty results\n#[test]\nfn test_search_no_results() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Search for something that shouldn't exist\n    let search_command = Commands::Search { \n        query: \"nonexistent_command_XYZABC\".to_string(),\n        limit: 10\n    };\n    \n    // Set up environment for testing\n    std::env::set_var(\"COMMAND_VAULT_NO_TUI\", \"1\");\n    \n    // This should handle the case of no results\n    let result = handle_command(search_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    // Clean up environment\n    std::env::remove_var(\"COMMAND_VAULT_NO_TUI\");\n    \n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","db_test.rs"],"content":"use anyhow::Result;\nuse chrono::Utc;\nuse command_vault::db::{\n    models::{Command, Parameter},\n    Database,\n};\nuse std::fs;\nuse tempfile::tempdir;\n\nfn create_test_command(command: \u0026str, tags: Vec\u003cString\u003e, parameters: Vec\u003cParameter\u003e) -\u003e Command {\n    Command {\n        id: None,\n        command: command.to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test/dir\".to_string(),\n        tags,\n        parameters,\n    }\n}\n\n#[test]\nfn test_command_crud() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test adding a command\n    let cmd = create_test_command(\n        \"echo test\",\n        vec![\"test\".to_string()],\n        vec![],\n    );\n    let id = db.add_command(\u0026cmd)?;\n    assert!(id \u003e 0);\n\n    // Test retrieving the command\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, \"echo test\");\n    assert_eq!(retrieved.tags, vec![\"test\"]);\n    assert!(retrieved.parameters.is_empty());\n\n    // Test updating the command\n    let mut updated_cmd = retrieved.clone();\n    updated_cmd.command = \"echo updated\".to_string();\n    db.update_command(\u0026updated_cmd)?;\n\n    let retrieved_updated = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved_updated.command, \"echo updated\");\n\n    // Test deleting the command\n    db.delete_command(id)?;\n    assert!(db.get_command(id)?.is_none());\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add command with initial tags\n    let cmd = create_test_command(\n        \"git status\",\n        vec![\"git\".to_string()],\n        vec![],\n    );\n    let id = db.add_command(\u0026cmd)?;\n\n    // Add more tags\n    db.add_tags_to_command(id, \u0026vec![\"vcs\".to_string(), \"status\".to_string()])?;\n    let cmd = db.get_command(id)?.unwrap();\n    assert!(cmd.tags.contains(\u0026\"git\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"vcs\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"status\".to_string()));\n\n    // Remove a tag\n    db.remove_tag_from_command(id, \"status\")?;\n    let cmd = db.get_command(id)?.unwrap();\n    assert!(!cmd.tags.contains(\u0026\"status\".to_string()));\n\n    // Test tag search\n    let results = db.search_by_tag(\"git\", 10)?;\n    assert_eq!(results.len(), 1);\n    assert_eq!(results[0].command, \"git status\");\n\n    // Test listing tags\n    let tags = db.list_tags()?;\n    assert!(tags.iter().any(|(name, _)| name == \"git\"));\n    assert!(tags.iter().any(|(name, _)| name == \"vcs\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_command_with_parameters() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Create command with parameters\n    let params = vec![\n        Parameter::new(\"branch\".to_string()),\n        Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"Commit message\".to_string()),\n        ),\n    ];\n    let cmd = create_test_command(\n        \"git commit -m @message \u0026\u0026 git push origin @branch\",\n        vec![\"git\".to_string()],\n        params.clone(),\n    );\n\n    // Add and retrieve\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n\n    assert_eq!(retrieved.parameters.len(), 2);\n    assert_eq!(retrieved.parameters[0].name, \"branch\");\n    assert_eq!(retrieved.parameters[1].name, \"message\");\n    assert_eq!(retrieved.parameters[1].description, Some(\"Commit message\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_command_search() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add multiple commands\n    let commands = vec![\n        (\"git status\", vec![\"git\".to_string()]),\n        (\"git push\", vec![\"git\".to_string()]),\n        (\"ls -la\", vec![\"system\".to_string()]),\n        (\"echo test\", vec![\"test\".to_string()]),\n    ];\n\n    for (cmd, tags) in commands {\n        let command = create_test_command(cmd, tags, vec![]);\n        db.add_command(\u0026command)?;\n    }\n\n    // Test exact match\n    let results = db.search_commands(\"git status\", 10)?;\n    assert_eq!(results.len(), 1);\n    assert_eq!(results[0].command, \"git status\");\n\n    // Test partial match\n    let results = db.search_commands(\"git\", 10)?;\n    assert_eq!(results.len(), 2);\n\n    // Test with limit\n    let results = db.search_commands(\"git\", 1)?;\n    assert_eq!(results.len(), 1);\n\n    // Test case sensitivity\n    let results = db.search_commands(\"GIT\", 10)?;\n    assert!(!results.is_empty());\n\n    // Test tag search\n    let results = db.search_by_tag(\"git\", 10)?;\n    assert_eq!(results.len(), 2);\n\n    Ok(())\n}\n\n#[test]\nfn test_edge_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test empty command\n    let cmd = create_test_command(\"\", vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, \"\");\n\n    // Test very long command\n    let long_cmd = \"x\".repeat(1000);\n    let cmd = create_test_command(\u0026long_cmd, vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, long_cmd);\n\n    // Test special characters in command\n    let special_cmd = \"echo 'test' \u0026\u0026 ls -la | grep \\\"something\\\" \u003e output.txt\";\n    let cmd = create_test_command(special_cmd, vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, special_cmd);\n\n    // Test non-existent command\n    assert!(db.get_command(9999)?.is_none());\n\n    // Test deleting non-existent command\n    assert!(db.delete_command(9999).is_err());\n\n    // Test adding tags to non-existent command\n    assert!(db.add_tags_to_command(9999, \u0026vec![\"test\".to_string()]).is_err());\n\n    // Test removing non-existent tag\n    let cmd = create_test_command(\"test\", vec![\"tag1\".to_string()], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    assert!(db.remove_tag_from_command(id, \"nonexistent\").is_ok());\n\n    Ok(())\n}\n\n#[test]\nfn test_database_init() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let db = Database::new(db_path.to_str().unwrap())?;\n\n    // Verify tables exist by attempting to use them\n    let conn = rusqlite::Connection::open(db_path)?;\n    \n    // Check commands table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM commands\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Check tags table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM tags\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Check command_tags table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM command_tags\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Verify indexes exist\n    let indexes: Vec\u003cString\u003e = conn\n        .prepare(\"SELECT name FROM sqlite_master WHERE type='index'\")?\n        .query_map([], |row| row.get(0))?\n        .collect::\u003cstd::result::Result\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n    assert!(indexes.contains(\u0026\"idx_commands_command\".to_string()));\n    assert!(indexes.contains(\u0026\"idx_tags_name\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_list_commands_no_limit() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add more than the default limit of commands\n    for i in 0..100 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n\n    // Test listing with no limit (0)\n    let commands = db.list_commands(0, false)?;\n    assert_eq!(commands.len(), 100);\n\n    // Test listing with no limit and ascending order\n    let commands = db.list_commands(0, true)?;\n    assert_eq!(commands.len(), 100);\n    \n    // Verify order in ascending mode\n    for i in 1..commands.len() {\n        assert!(commands[i].timestamp \u003e= commands[i-1].timestamp);\n    }\n\n    // Verify order in descending mode (default)\n    let commands = db.list_commands(0, false)?;\n    for i in 1..commands.len() {\n        assert!(commands[i].timestamp \u003c= commands[i-1].timestamp);\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_cleanup_after_deletion() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add two commands with overlapping tags\n    let cmd1 = Command {\n        id: None,\n        command: \"command 1\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()],\n        parameters: Vec::new(),\n    };\n    let cmd2 = Command {\n        id: None,\n        command: \"command 2\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n\n    let id1 = db.add_command(\u0026cmd1)?;\n    let id2 = db.add_command(\u0026cmd2)?;\n\n    // Verify initial tag state\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 3);\n    assert!(tags.iter().any(|(name, count)| name == \"tag1\" \u0026\u0026 *count == 1));\n    assert!(tags.iter().any(|(name, count)| name == \"tag2\" \u0026\u0026 *count == 2));\n    assert!(tags.iter().any(|(name, count)| name == \"tag3\" \u0026\u0026 *count == 1));\n\n    // Delete first command\n    db.delete_command(id1)?;\n\n    // Verify tag1 is removed, tag2 count decreased, tag3 unchanged\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 2);\n    assert!(!tags.iter().any(|(name, _)| name == \"tag1\")); // tag1 should be removed\n    assert!(tags.iter().any(|(name, count)| name == \"tag2\" \u0026\u0026 *count == 1));\n    assert!(tags.iter().any(|(name, count)| name == \"tag3\" \u0026\u0026 *count == 1));\n\n    // Delete second command\n    db.delete_command(id2)?;\n\n    // Verify all tags are removed\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_rollback() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add a command with tags\n    let cmd = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026cmd)?;\n\n    // Verify initial state\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to update with invalid command (id = None)\n    let mut invalid_cmd = command.clone();\n    invalid_cmd.id = None;\n    let result = db.update_command(\u0026invalid_cmd);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"without id\"));\n\n    // Verify state wasn't changed\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to delete non-existent command\n    let result = db.delete_command(9999);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n\n    // Verify original command still exists\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to add tags to non-existent command\n    let result = db.add_tags_to_command(9999, \u0026vec![\"tag3\".to_string()]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n\n    // Verify original command's tags weren't changed\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.tags.len(), 2);\n    assert!(command.tags.contains(\u0026\"tag1\".to_string()));\n    assert!(command.tags.contains(\u0026\"tag2\".to_string()));\n    assert!(!command.tags.contains(\u0026\"tag3\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_parameter_handling() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test command with valid parameters\n    let mut cmd = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![\n            Parameter::new(\"param1\".to_string()),\n            Parameter::with_description(\"param2\".to_string(), Some(\"description\".to_string())),\n        ],\n    };\n    let id = db.add_command(\u0026cmd)?;\n\n    // Verify parameters were stored correctly\n    let stored = db.get_command(id)?.unwrap();\n    assert_eq!(stored.parameters.len(), 2);\n    assert_eq!(stored.parameters[0].name, \"param1\");\n    assert_eq!(stored.parameters[1].name, \"param2\");\n    assert_eq!(stored.parameters[1].description, Some(\"description\".to_string()));\n\n    // Test updating parameters\n    cmd.id = Some(id);\n    cmd.parameters = vec![Parameter::new(\"new_param\".to_string())];\n    db.update_command(\u0026cmd)?;\n\n    // Verify parameters were updated\n    let updated = db.get_command(id)?.unwrap();\n    assert_eq!(updated.parameters.len(), 1);\n    assert_eq!(updated.parameters[0].name, \"new_param\");\n\n    Ok(())\n}\n\n#[test]\nfn test_concurrent_access() -\u003e Result\u003c()\u003e {\n    use std::thread;\n    use std::sync::Arc;\n    use std::sync::Mutex;\n\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    \n    // Create initial database and enable WAL mode\n    let conn = rusqlite::Connection::open(db_path.to_str().unwrap())?;\n    conn.pragma_update(None, \"journal_mode\", \"WAL\")?;\n    conn.pragma_update(None, \"busy_timeout\", 5000)?;\n    drop(conn);\n\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add initial command\n    let cmd = Command {\n        id: None,\n        command: \"initial command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string()],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026cmd)?;\n    let db_path = Arc::new(db_path.to_str().unwrap().to_string());\n\n    // Create multiple threads that try to modify the same command\n    let mut handles = vec![];\n    let counter = Arc::new(Mutex::new(0));\n\n    for i in 0..5 {\n        let db_path = Arc::clone(\u0026db_path);\n        let counter = Arc::clone(\u0026counter);\n        \n        let handle = thread::spawn(move || -\u003e Result\u003c()\u003e {\n            let mut db = Database::new(\u0026db_path)?;\n            \n            // Try to update the command with retries\n            let mut retries = 3;\n            while retries \u003e 0 {\n                if let Ok(_) = db.update_command(\u0026Command {\n                    id: Some(id),\n                    command: format!(\"updated by thread {}\", i),\n                    timestamp: Utc::now(),\n                    directory: \"/test\".to_string(),\n                    tags: vec![],\n                    parameters: vec![],\n                }) {\n                    break;\n                }\n                retries -= 1;\n                thread::sleep(std::time::Duration::from_millis(100));\n            }\n\n            // Try to add a new tag with retries\n            let mut retries = 3;\n            while retries \u003e 0 {\n                if let Ok(_) = db.add_tags_to_command(id, \u0026vec![format!(\"tag{}\", i)]) {\n                    break;\n                }\n                retries -= 1;\n                thread::sleep(std::time::Duration::from_millis(100));\n            }\n\n            *counter.lock().unwrap() += 1;\n            Ok(())\n        });\n\n        handles.push(handle);\n    }\n\n    // Wait for all threads to complete\n    for handle in handles {\n        handle.join().unwrap()?;\n    }\n\n    // Verify final state\n    let final_cmd = db.get_command(id)?.unwrap();\n    assert!(final_cmd.command.starts_with(\"updated by thread\"));\n    assert_eq!(*counter.lock().unwrap(), 5);\n    \n    // Verify all tags were added (initial tag + 5 new tags)\n    let tags = db.list_tags()?;\n    assert!(tags.len() \u003e= 5, \"Expected at least 5 tags, got {}\", tags.len());\n    \n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","exec_test.rs"],"content":"use command_vault::exec::execute_command;\nuse command_vault::db::models::{Command, Parameter};\nuse std::env;\nuse std::fs;\nuse std::path::PathBuf;\nuse tempfile::TempDir;\nuse chrono::Utc;\nuse std::thread;\nuse std::time::Duration;\nuse std::io::Cursor;\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_test_command(command: \u0026str) -\u003e Command {\n        Command {\n            id: None,\n            command: command.to_string(),\n            directory: String::new(),\n            timestamp: Utc::now(),\n            tags: vec![],\n            parameters: vec![],\n        }\n    }\n\n    fn setup_test_env() {\n        env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"test_value\");\n        env::set_var(\"SHELL\", \"/bin/sh\");\n    }\n\n    fn cleanup_test_env() {\n        env::remove_var(\"COMMAND_VAULT_TEST\");\n        env::remove_var(\"COMMAND_VAULT_TEST_INPUT\");\n        env::remove_var(\"SHELL\");\n    }\n\n    fn ensure_directory_exists(path: \u0026PathBuf) -\u003e std::io::Result\u003c()\u003e {\n        if !path.exists() {\n            fs::create_dir_all(path)?;\n        }\n        // Small delay to ensure filesystem operations complete\n        thread::sleep(Duration::from_millis(100));\n        Ok(())\n    }\n\n    fn get_safe_temp_dir() -\u003e std::io::Result\u003c(TempDir, PathBuf)\u003e {\n        let temp_dir = TempDir::new()?;\n        let temp_path = temp_dir.path().to_path_buf();\n        ensure_directory_exists(\u0026temp_path)?;\n        \n        // Verify the directory exists and is accessible\n        if !temp_path.exists() || !temp_path.is_dir() {\n            return Err(std::io::Error::new(\n                std::io::ErrorKind::Other,\n                \"Failed to create temporary directory\"\n            ));\n        }\n        \n        Ok((temp_dir, temp_path))\n    }\n\n    fn setup_test_dir(temp_path: \u0026PathBuf) -\u003e std::io::Result\u003c()\u003e {\n        ensure_directory_exists(temp_path)?;\n        \n        // Create a test file\n        let test_file = temp_path.join(\"test.txt\");\n        fs::write(\u0026test_file, \"test content\")?;\n        \n        // Small delay to ensure file is written\n        thread::sleep(Duration::from_millis(100));\n        \n        // Verify the file was created\n        if !test_file.exists() {\n            return Err(std::io::Error::new(\n                std::io::ErrorKind::Other,\n                \"Failed to create test file\"\n            ));\n        }\n        \n        Ok(())\n    }\n\n    #[test]\n    fn test_basic_command_execution() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo 'hello world'\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_working_directory() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        setup_test_dir(\u0026temp_path)?;\n        \n        let mut command = create_test_command(\"cat test.txt\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_parameters() -\u003e std::io::Result\u003c()\u003e {\n        // Create and verify temp directory\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Ensure the directory exists and is accessible\n        ensure_directory_exists(\u0026temp_path)?;\n        \n        // Set up test environment with a known test value\n        setup_test_env();\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"test_message\");\n        \n        // Create a simple command that just echoes the parameter\n        let mut command = create_test_command(\"echo @message\");\n        command.directory = dir_path;\n        command.parameters = vec![\n            Parameter {\n                name: \"message\".to_string(),\n                description: Some(\"Test message\".to_string()),\n            },\n        ];\n        \n        // Execute the command and verify it succeeds\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        \n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_quoted_parameters() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo '@message'\");\n        command.directory = dir_path;\n        command.parameters = vec![\n            Parameter::with_description(\n                \"message\".to_string(),\n                Some(\"Test 'quoted' message\".to_string())\n            ),\n        ];\n\n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_multiple_env_vars() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo \\\"$TEST_VAR1 $TEST_VAR2\\\"\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        env::set_var(\"TEST_VAR1\", \"value1\");\n        env::set_var(\"TEST_VAR2\", \"value2\");\n        \n        let result = execute_command(\u0026command);\n        \n        env::remove_var(\"TEST_VAR1\");\n        env::remove_var(\"TEST_VAR2\");\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_directory_traversal() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Create a test directory structure\n        let test_dir = temp_path.join(\"test_dir\");\n        ensure_directory_exists(\u0026test_dir)?;\n        \n        // Create a test file in the test directory\n        let test_file = test_dir.join(\"test.txt\");\n        fs::write(\u0026test_file, \"test content\")?;\n        \n        // Small delay to ensure file is written\n        thread::sleep(Duration::from_millis(100));\n        \n        // Attempt to traverse outside the test directory\n        let mut command = create_test_command(\"cat ../test.txt\");\n        command.directory = test_dir.canonicalize()?.to_string_lossy().to_string();\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_err(), \"Directory traversal should be prevented\");\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_special_shell_chars() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Create a test file first\n        setup_test_dir(\u0026temp_path)?;\n        \n        let mut command = create_test_command(\"echo test \u003e output.txt \u0026\u0026 cat output.txt\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_parameter_handling() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo @p\");\n        command.directory = dir_path.clone();\n        command.parameters = vec![\n            Parameter {\n                name: \"p\".to_string(),\n                description: Some(\"Test parameter\".to_string()),\n            },\n        ];\n        \n        // Set up test environment\n        setup_test_env();\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"some-value\");\n        \n        // Execute command\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_output_format() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo @p \u003e output.txt\");\n        command.directory = dir_path.clone();\n        command.parameters = vec![\n            Parameter {\n                name: \"p\".to_string(),\n                description: Some(\"Test parameter\".to_string()),\n            },\n        ];\n        \n        // Set up test environment\n        setup_test_env();\n        let test_value = \"test_value\";\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", test_value);\n        \n        // Execute command\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Verify the command executed correctly by checking the output file\n        let output_path = PathBuf::from(\u0026dir_path).join(\"output.txt\");\n        let output_content = fs::read_to_string(output_path)?;\n        assert_eq!(output_content.trim(), test_value);\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        Ok(())\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","params_test.rs"],"content":"use command_vault::{\n    db::models::Parameter,\n    utils::params::{parse_parameters, substitute_parameters},\n};\n\n#[test]\nfn test_parse_parameters_basic() {\n    let command = \"echo @name\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, None);\n}\n\n#[test]\nfn test_parse_parameters_with_description() {\n    let command = \"echo @name:new-name\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"new-name\".to_string()));\n}\n\n#[test]\nfn test_parse_multiple_parameters() {\n    let command = \"echo @name:new-name @age:30 @city\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 3);\n    \n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"new-name\".to_string()));\n    \n    assert_eq!(params[1].name, \"age\");\n    assert_eq!(params[1].description, Some(\"30\".to_string()));\n    \n    assert_eq!(params[2].name, \"city\");\n    assert_eq!(params[2].description, None);\n}\n\n#[test]\nfn test_parse_parameters_with_underscores() {\n    let command = \"echo @user_name:new-user\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"user_name\");\n    assert_eq!(params[0].description, Some(\"new-user\".to_string()));\n}\n\n\n\n#[test]\nfn test_parse_parameters_empty_command() {\n    let command = \"echo\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 0);\n}\n\n#[test]\nfn test_parse_parameters_invalid_names() {\n    let command = \"echo @123 @!invalid @valid_name\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"valid_name\");\n}\n\n#[test]\nfn test_substitute_parameters_with_special_chars() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"grep @pattern /path/to/dir\";\n    let parameters = vec![Parameter {\n        name: \"pattern\".to_string(),\n        description: None,\n    }];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"test-pattern\"))?;\n    assert_eq!(result, \"grep 'test-pattern' /path/to/dir\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_value() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo ''\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_spaces() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![\n        Parameter::with_description(\"message\".to_string(), Some(\"A test message\".to_string())),\n    ];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello world\"))?;\n    assert_eq!(result, \"echo 'hello world'\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parse_parameters_from_params_rs() {\n    let command = \"docker run -p @port:8080 -v @volume @image\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 3);\n    \n    assert_eq!(params[0].name, \"port\");\n    assert_eq!(params[0].description, Some(\"8080\".to_string()));\n    \n    assert_eq!(params[1].name, \"volume\");\n    assert_eq!(params[1].description, None);\n    \n    assert_eq!(params[2].name, \"image\");\n    assert_eq!(params[2].description, None);\n}\n\n#[test]\nfn test_substitute_parameters_basic() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter::with_description(\"message\".to_string(), None)];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello\"))?;\n    assert_eq!(result, \"echo hello\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_defaults() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message:default value\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: Some(\"default value\".to_string()),\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo 'default value'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_multiple() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"git commit -m @message --author @author\";\n    let parameters = vec![\n        Parameter {\n            name: \"message\".to_string(),\n            description: None,\n        },\n        Parameter {\n            name: \"author\".to_string(),\n            description: None,\n        },\n    ];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"test commit\\nJohn Doe\"))?;\n    assert_eq!(result, \"git commit -m 'test commit' --author 'John Doe'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello * world\"))?;\n    assert_eq!(result, \"echo 'hello * world'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_command() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"\";\n    let parameters = vec![];\n    \n    let result = substitute_parameters(command, \u0026parameters, None)?;\n    assert_eq!(result, \"\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_no_parameters() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo hello\";\n    let parameters = vec![];\n    \n    let result = substitute_parameters(command, \u0026parameters, None)?;\n    assert_eq!(result, \"echo hello\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_git_commands() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"git commit -m @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test commit\"))?;\n    assert_eq!(result, \"git commit -m 'test commit'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_grep() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"grep @pattern\";\n    let parameters = vec![Parameter {\n        name: \"pattern\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello * world\"))?;\n    assert_eq!(result, \"grep 'hello * world'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_multiple_occurrences() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    let command = \"echo @message \u0026\u0026 echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test\")).unwrap();\n    assert_eq!(result, \"echo test \u0026\u0026 echo test\");\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_descriptions() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    let command = \"echo @message:A test message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: Some(\"A test message\".to_string()),\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test\")).unwrap();\n    assert_eq!(result, \"echo test\");\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_value_removed_duplicate() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo ''\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parse_parameters_with_adjacent_parameters() {\n    let command = \"echo @first@second\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 2);\n    assert_eq!(params[0].name, \"first\");\n    assert_eq!(params[1].name, \"second\");\n}\n\n#[test]\nfn test_parse_parameters_with_special_chars_in_description() {\n    let command = \"echo @name:special!\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"special!\".to_string()));\n}\n\n#[test]\nfn test_substitute_parameters_with_semicolon() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"echo hello; ls\"))?;\n    assert_eq!(result, \"echo 'echo hello; ls'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_pipe() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"ls | grep test\"))?;\n    assert_eq!(result, \"echo 'ls | grep test'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_redirection() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"echo test \u003e file.txt\"))?;\n    assert_eq!(result, \"echo 'echo test \u003e file.txt'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_existing_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"'already quoted'\"))?;\n    assert_eq!(result, \"echo 'already quoted'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_escaped_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"It's a test\"))?;\n    assert_eq!(result, \"echo 'It'\\\\''s a test'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parameter_new() {\n    let param = Parameter::new(\"test\".to_string());\n    assert_eq!(param.name, \"test\");\n    assert_eq!(param.description, None);\n}\n\n#[test]\nfn test_parameter_with_description() {\n    let param = Parameter::with_description(\"test\".to_string(), Some(\"A test parameter\".to_string()));\n    assert_eq!(param.name, \"test\");\n    assert_eq!(param.description, Some(\"A test parameter\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_trailing_whitespace() {\n    let command = \"echo @name:test\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"test\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_multiple_colons() {\n    let command = \"echo @name:test:value\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"test:value\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_numbers_in_description() {\n    let command = \"echo @port:8080 @host:localhost:8080\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 2);\n    assert_eq!(params[0].name, \"port\");\n    assert_eq!(params[0].description, Some(\"8080\".to_string()));\n    assert_eq!(params[1].name, \"host\");\n    assert_eq!(params[1].description, Some(\"localhost:8080\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_dash_in_description() {\n    let command = \"git checkout @branch:feature-123\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"branch\");\n    assert_eq!(params[0].description, Some(\"feature-123\".to_string()));\n}","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","shell_test.rs"],"content":"use std::env;\nuse std::path::PathBuf;\nuse anyhow::Result;\nuse serial_test::serial;\nuse command_vault::shell::hooks::{\n    detect_current_shell, get_shell_integration_dir, get_shell_integration_script,\n    get_zsh_integration_path, get_bash_integration_path, get_fish_integration_path, init_shell\n};\n\n#[test]\n#[serial]\nfn test_detect_current_shell() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test default case (no environment variables)\n    assert_eq!(\n        detect_current_shell(),\n        \"bash\",\n        \"Should default to bash when no shell is set\"\n    );\n    \n    // Test with FISH_VERSION (highest priority)\n    env::remove_var(\"SHELL\"); // Ensure SHELL is not set\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"Should detect Fish via FISH_VERSION\"\n    );\n    \n    // Test with SHELL environment variable\n    env::remove_var(\"FISH_VERSION\");\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    assert_eq!(\n        detect_current_shell(),\n        \"zsh\",\n        \"Should detect Zsh via SHELL\"\n    );\n    \n    // Test with SHELL environment variable (bash)\n    env::set_var(\"SHELL\", \"/bin/bash\");\n    assert_eq!(\n        detect_current_shell(),\n        \"bash\",\n        \"Should detect Bash via SHELL\"\n    );\n    \n    // Test that FISH_VERSION takes precedence over SHELL\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"FISH_VERSION should take precedence over SHELL\"\n    );\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    } else {\n        env::remove_var(\"SHELL\");\n    }\n    if let Some(fish_version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", fish_version);\n    } else {\n        env::remove_var(\"FISH_VERSION\");\n    }\n}\n\n#[test]\nfn test_get_shell_integration_dir() {\n    let dir = get_shell_integration_dir();\n    assert!(dir.is_dir(), \"Shell integration directory should exist\");\n    assert!(dir.ends_with(\"shell\"), \"Directory should end with 'shell'\");\n    \n    // Check if shell scripts exist\n    let zsh_script = dir.join(\"zsh-integration.zsh\");\n    let bash_script = dir.join(\"bash-integration.sh\");\n    let fish_script = dir.join(\"fish-integration.fish\");\n    \n    assert!(zsh_script.exists(), \"ZSH integration script should exist\");\n    assert!(bash_script.exists(), \"Bash integration script should exist\");\n    assert!(fish_script.exists(), \"Fish integration script should exist\");\n}\n\n#[test]\nfn test_get_shell_specific_paths() {\n    let zsh_path = get_zsh_integration_path();\n    let bash_path = get_bash_integration_path();\n    let fish_path = get_fish_integration_path();\n    \n    assert!(zsh_path.ends_with(\"zsh-integration.zsh\"), \"ZSH path should end with correct filename\");\n    assert!(bash_path.ends_with(\"bash-integration.sh\"), \"Bash path should end with correct filename\");\n    assert!(fish_path.ends_with(\"fish-integration.fish\"), \"Fish path should end with correct filename\");\n    assert!(zsh_path.exists(), \"ZSH integration script should exist\");\n    assert!(bash_path.exists(), \"Bash integration script should exist\");\n    assert!(fish_path.exists(), \"Fish integration script should exist\");\n}\n\n#[test]\nfn test_get_shell_integration_script() -\u003e Result\u003c()\u003e {\n    // Test valid shells\n    let zsh_script = get_shell_integration_script(\"zsh\")?;\n    let bash_script = get_shell_integration_script(\"bash\")?;\n    let fish_script = get_shell_integration_script(\"fish\")?;\n    \n    assert!(zsh_script.ends_with(\"zsh-integration.zsh\"));\n    assert!(bash_script.ends_with(\"bash-integration.sh\"));\n    assert!(fish_script.ends_with(\"fish-integration.fish\"));\n    \n    // Test case insensitivity\n    let upper_zsh = get_shell_integration_script(\"ZSH\")?;\n    assert_eq!(upper_zsh, zsh_script);\n    \n    // Test error cases\n    let unknown_result = get_shell_integration_script(\"unknown\");\n    assert!(unknown_result.is_err());\n    assert!(unknown_result.unwrap_err().to_string().contains(\"Unsupported shell\"));\n    \n    Ok(())\n}\n\n#[test]\n#[serial]\nfn test_init_shell() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test default shell (bash)\n    env::set_var(\"SHELL\", \"/bin/bash\");\n    let path = init_shell(None).unwrap();\n    assert!(path.ends_with(\"bash-integration.sh\"), \"Path should end with bash-integration.sh\");\n    \n    // Test with shell override\n    let path = init_shell(Some(\"fish\".to_string())).unwrap();\n    assert!(path.ends_with(\"fish-integration.fish\"), \"Path should end with fish-integration.fish\");\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\n#[serial]\nfn test_detect_current_shell_fish_env() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test FISH_VERSION detection\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"Should detect Fish via FISH_VERSION\"\n    );\n    \n    // Test FISH_VERSION takes precedence over SHELL\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"FISH_VERSION should take precedence over SHELL\"\n    );\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\n#[serial]\nfn test_init_shell_explicit_fish() -\u003e Result\u003c()\u003e {\n    // Test with explicit fish shell override\n    let path = init_shell(Some(\"fish\".to_string()))?;\n    assert!(path.ends_with(\"fish-integration.fish\"));\n    Ok(())\n}\n\n#[test]\n#[serial]\nfn test_detect_current_shell_fish_variants() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test various fish shell paths\n    let fish_paths = vec![\n        \"/usr/local/bin/fish\",\n        \"/opt/homebrew/bin/fish\",\n        \"fish\",\n        \"/usr/bin/fish\",\n        \"/bin/fish\",\n    ];\n    \n    for path in fish_paths {\n        env::remove_var(\"FISH_VERSION\"); // Ensure FISH_VERSION doesn't interfere\n        env::remove_var(\"SHELL\"); // Clean SHELL before setting\n        env::set_var(\"SHELL\", path);\n        assert_eq!(\n            detect_current_shell(),\n            \"fish\",\n            \"Failed to detect fish shell at path: {}\",\n            path\n        );\n    }\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\nfn test_shell_integration_paths() -\u003e Result\u003c()\u003e {\n    // Test shell integration directory\n    let integration_dir = get_shell_integration_dir();\n    assert!(integration_dir.ends_with(\"shell\"));\n\n    // Test zsh integration path\n    let zsh_path = get_zsh_integration_path();\n    assert!(zsh_path.ends_with(\"zsh-integration.zsh\"));\n\n    // Test bash integration path\n    let bash_path = get_bash_integration_path();\n    assert!(bash_path.ends_with(\"bash-integration.sh\"));\n\n    // Test fish integration path\n    let fish_path = get_fish_integration_path();\n    assert!(fish_path.ends_with(\"fish-integration.fish\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_init_shell_invalid_shell() -\u003e Result\u003c()\u003e {\n    // Test with an invalid shell\n    let result = init_shell(Some(\"invalid_shell\".to_string()));\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"Unsupported shell\"));\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","test_utils.rs"],"content":"use anyhow::Result;\nuse chrono::{Datelike, Timelike};\nuse command_vault::db::Database;\nuse command_vault::utils::time::parse_datetime;\nuse tempfile::TempDir;\n\npub fn create_test_db() -\u003e Result\u003c(Database, TempDir)\u003e {\n    let dir = tempfile::tempdir()?;\n    let db = Database::new(dir.path().join(\"test.db\").to_str().unwrap())?;\n    Ok((db, dir))\n}\n\n// Time parsing tests\n#[test]\nfn test_parse_datetime_rfc3339() {\n    let input = \"2024-03-14T15:30:00Z\";\n    let result = parse_datetime(input).unwrap();\n    assert_eq!(result.year(), 2024);\n    assert_eq!(result.month(), 3);\n    assert_eq!(result.day(), 14);\n    assert_eq!(result.hour(), 15);\n    assert_eq!(result.minute(), 30);\n    assert_eq!(result.second(), 0);\n}\n\n#[test]\nfn test_parse_datetime_common_formats() {\n    let test_cases = vec![\n        // Date-only formats\n        (\"2024-03-14\", 2024, 3, 14, 0, 0, 0),\n        (\"2024/03/14\", 2024, 3, 14, 0, 0, 0),\n        (\"14-03-2024\", 2024, 3, 14, 0, 0, 0),\n        (\"14/03/2024\", 2024, 3, 14, 0, 0, 0),\n        \n        // Date-time formats\n        (\"2024-03-14 15:30\", 2024, 3, 14, 15, 30, 0),\n        (\"2024-03-14 15:30:45\", 2024, 3, 14, 15, 30, 45),\n        (\"14/03/2024 15:30\", 2024, 3, 14, 15, 30, 0),\n        (\"14/03/2024 15:30:45\", 2024, 3, 14, 15, 30, 45),\n    ];\n\n    for (input, year, month, day, hour, minute, second) in test_cases {\n        let result = parse_datetime(input).unwrap_or_else(|| panic!(\"Failed to parse date: {}\", input));\n        assert_eq!(result.year(), year, \"Year mismatch for {}\", input);\n        assert_eq!(result.month(), month, \"Month mismatch for {}\", input);\n        assert_eq!(result.day(), day, \"Day mismatch for {}\", input);\n        assert_eq!(result.hour(), hour, \"Hour mismatch for {}\", input);\n        assert_eq!(result.minute(), minute, \"Minute mismatch for {}\", input);\n        assert_eq!(result.second(), second, \"Second mismatch for {}\", input);\n    }\n}\n\n#[test]\nfn test_parse_datetime_invalid() {\n    let test_cases = vec![\n        \"invalid\",\n        \"2024\",\n        \"2024-13-01\",  // Invalid month\n        \"2024-01-32\",  // Invalid day\n        \"03/14/24\",    // Two-digit year not supported\n        \"\",\n    ];\n\n    for input in test_cases {\n        assert!(parse_datetime(input).is_none(), \"Expected None for input: {}\", input);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","time_test.rs"],"content":"use command_vault::utils::time::parse_datetime;\nuse chrono::{DateTime, Utc};\n\n#[test]\nfn test_parse_datetime_valid() {\n    let input = \"2024-01-01T12:00:00Z\";\n    let result = parse_datetime(input);\n    assert!(result.is_some());\n    let dt: DateTime\u003cUtc\u003e = result.unwrap();\n    assert_eq!(dt.to_rfc3339(), \"2024-01-01T12:00:00+00:00\");\n}\n\n#[test]\nfn test_parse_datetime_invalid() {\n    let input = \"invalid date\";\n    let result = parse_datetime(input);\n    assert!(result.is_none());\n}\n\n#[test]\nfn test_parse_datetime_empty() {\n    let input = \"\";\n    let result = parse_datetime(input);\n    assert!(result.is_none());\n}\n\n#[test]\nfn test_parse_datetime_different_formats() {\n    let inputs = vec![\n        \"2024-01-01T12:00:00+00:00\",\n        \"2024-01-01T12:00:00-05:00\",\n        \"2024-01-01 12:00:00 UTC\",\n    ];\n\n    for input in inputs {\n        let result = parse_datetime(input);\n        assert!(result.is_some(), \"Failed to parse: {}\", input);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","ui_test.rs"],"content":"use anyhow::Result;\nuse chrono::{TimeZone, Utc};\nuse command_vault::{\n    db::{Command, Database},\n    ui::{app::App, AddCommandApp},\n};\nuse crate::test_utils::create_test_db;\nuse command_vault::ui::add::InputMode;\nuse ratatui::style::Color;\nuse crossterm::terminal::{disable_raw_mode, enable_raw_mode, is_raw_mode_enabled};\nuse ratatui::{Terminal, backend::CrosstermBackend};\nuse std::io::stdout;\n\nmod test_utils;\n\nfn create_test_commands() -\u003e Vec\u003cCommand\u003e {\n    vec![\n        Command {\n            id: Some(1),\n            command: \"ls -la\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 0).unwrap(),\n            directory: \"/home/user\".to_string(),\n            tags: vec![\"file\".to_string(), \"list\".to_string()],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(2),\n            command: \"git status\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 1).unwrap(),\n            directory: \"/home/user/project\".to_string(),\n            tags: vec![\"git\".to_string()],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(3),\n            command: \"docker ps\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 2).unwrap(),\n            directory: \"/home/user\".to_string(),\n            tags: vec![\"docker\".to_string()],\n            parameters: vec![],\n        },\n    ]\n}\n\n#[test]\nfn test_app_new() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = vec![\n        Command {\n            id: Some(1),\n            command: \"test command\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![\"test\".to_string(), \"example\".to_string()],\n            parameters: vec![],\n        }\n    ];\n    \n    let app = App::new(commands.clone(), \u0026mut db, false);\n    \n    assert_eq!(app.commands, commands);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.show_help, false);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands, vec![0]);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.debug_mode, false);\n    \n    Ok(())\n}\n\n#[test]\nfn test_app_filter() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = vec![\n        Command {\n            id: Some(1),\n            command: \"ls -l\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/\".to_string(),\n            tags: vec![],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(2),\n            command: \"pwd\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/\".to_string(),\n            tags: vec![],\n            parameters: vec![],\n        },\n    ];\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n    app.filter_text = \"ls\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.filtered_commands[0], 0);\n    Ok(())\n}\n\n#[test]\nfn test_app_filtering() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test filtering by command\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test filtering by tag\n    app.filter_text = \"file\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Test filtering by directory\n    app.filter_text = \"project\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test no matches\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_new() {\n    let app = AddCommandApp::new();\n    assert!(app.command.is_empty());\n    assert!(app.tags.is_empty());\n    assert!(app.current_tag.is_empty());\n    assert_eq!(app.command_cursor, 0);\n}\n\n#[test]\nfn test_add_command_app_command_input() {\n    let mut app = AddCommandApp::new();\n    app.set_command(\"ls -la\".to_string());\n    assert_eq!(app.command, \"ls -la\");\n}\n\n#[test]\nfn test_add_command_app_tag_input() {\n    let mut app = AddCommandApp::new();\n    \n    // Test single tag\n    app.set_tags(vec![\"git\".to_string()]);\n    assert_eq!(app.tags, vec![\"git\"]);\n    \n    // Test multiple tags\n    app.set_tags(vec![\"git\".to_string(), \"docker\".to_string()]);\n    assert_eq!(app.tags, vec![\"git\", \"docker\"]);\n}\n\n#[test]\nfn test_app_message() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.message, None);\n\n    // Set a success message\n    app.message = Some((\"Command copied to clipboard!\".to_string(), Color::Green));\n    assert_eq!(app.message, Some((\"Command copied to clipboard!\".to_string(), Color::Green)));\n\n    // Set an error message\n    app.message = Some((\"Failed to delete command\".to_string(), Color::Red));\n    assert_eq!(app.message, Some((\"Failed to delete command\".to_string(), Color::Red)));\n\n    // Clear message\n    app.message = None;\n    assert_eq!(app.message, None);\n\n    // Set an info message\n    app.message = Some((\"Type to filter commands...\".to_string(), Color::Blue));\n    assert_eq!(app.message, Some((\"Type to filter commands...\".to_string(), Color::Blue)));\n\n    // Set a warning message\n    app.message = Some((\"Delete operation cancelled\".to_string(), Color::Yellow));\n    assert_eq!(app.message, Some((\"Delete operation cancelled\".to_string(), Color::Yellow)));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selection() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n\n    // Test selecting a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test selecting another command\n    app.selected = Some(1);\n    assert_eq!(app.selected, Some(1));\n\n    // Test selecting last command\n    app.selected = Some(app.commands.len() - 1);\n    assert_eq!(app.selected, Some(2));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_confirm_delete() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test setting confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Test canceling delete\n    app.confirm_delete = None;\n    assert_eq!(app.confirm_delete, None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_debug_mode() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    \n    // Test debug mode enabled\n    let mut app = App::new(commands.clone(), \u0026mut db, true);\n    assert_eq!(app.debug_mode, true);\n    \n    // Test debug mode disabled\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n    assert_eq!(app.debug_mode, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_help_toggle() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.show_help, false);\n\n    // Test toggling help on\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Test toggling help off\n    app.show_help = false;\n    assert_eq!(app.show_help, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_cursor_movement() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial cursor position\n    assert_eq!(app.command_cursor, 0);\n    \n    // Test setting cursor position\n    app.set_command(\"ls -la\".to_string());\n    app.command_cursor = 3;\n    assert_eq!(app.command_cursor, 3);\n}\n\n#[test]\nfn test_app_filter_clear() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Apply filter\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Clear filter\n    app.filter_text.clear();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_tag_operations() {\n    let mut app = AddCommandApp::new();\n    \n    // Test adding a tag\n    app.current_tag = \"git\".to_string();\n    app.tags.push(app.current_tag.clone());\n    assert_eq!(app.tags, vec![\"git\"]);\n    \n    // Test clearing current tag\n    app.current_tag.clear();\n    assert!(app.current_tag.is_empty());\n    \n    // Test adding multiple tags\n    app.tags.push(\"docker\".to_string());\n    app.tags.push(\"test\".to_string());\n    assert_eq!(app.tags, vec![\"git\", \"docker\", \"test\"]);\n}\n\n#[test]\nfn test_add_command_app_input_modes() {\n    use command_vault::ui::add::InputMode;\n    let mut app = AddCommandApp::new();\n    \n    // Test initial mode\n    assert!(matches!(app.input_mode, InputMode::Command));\n    \n    // Test switching to Tag mode\n    app.input_mode = InputMode::Tag;\n    assert!(matches!(app.input_mode, InputMode::Tag));\n    \n    // Test switching to Confirm mode\n    app.input_mode = InputMode::Confirm;\n    assert!(matches!(app.input_mode, InputMode::Confirm));\n    \n    // Test switching to Help mode\n    app.input_mode = InputMode::Help;\n    assert!(matches!(app.input_mode, InputMode::Help));\n    \n    // Test storing previous mode\n    app.previous_mode = InputMode::Command;\n    assert!(matches!(app.previous_mode, InputMode::Command));\n}\n\n#[test]\nfn test_add_command_app_tag_suggestions() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial state\n    assert!(app.suggested_tags.is_empty());\n    \n    // Test adding suggested tags\n    app.suggested_tags = vec![\"git\".to_string(), \"docker\".to_string()];\n    assert_eq!(app.suggested_tags, vec![\"git\", \"docker\"]);\n    \n    // Test clearing suggestions\n    app.suggested_tags.clear();\n    assert!(app.suggested_tags.is_empty());\n}\n\n#[test]\nfn test_add_command_app_multiline() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial state\n    assert_eq!(app.command_line, 0);\n    \n    // Test setting command with multiple lines\n    app.set_command(\"line1\\nline2\\nline3\".to_string());\n    assert_eq!(app.command, \"line1\\nline2\\nline3\");\n    \n    // Test cursor movement across lines\n    app.command_cursor = 6;  // After \"line1\\n\"\n    assert_eq!(app.command_cursor, 6);\n}\n\n#[test]\nfn test_add_command_app_key_events() {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n\n    let mut app = AddCommandApp::new();\n\n    // Test command input\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('l'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('s'), KeyModifiers::empty()));\n    assert_eq!(app.command, \"ls\");\n    assert_eq!(app.command_cursor, 2);\n\n    // Test backspace\n    app.handle_key_event(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty()));\n    assert_eq!(app.command, \"l\");\n    assert_eq!(app.command_cursor, 1);\n\n    // Test cursor movement\n    app.handle_key_event(KeyEvent::new(KeyCode::Left, KeyModifiers::empty()));\n    assert_eq!(app.command_cursor, 0);\n    app.handle_key_event(KeyEvent::new(KeyCode::Right, KeyModifiers::empty()));\n    assert_eq!(app.command_cursor, 1);\n\n    // Test multiline command\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::SHIFT));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('a'), KeyModifiers::empty()));\n    assert_eq!(app.command, \"l\\na\");\n    assert_eq!(app.command_line, 1);\n\n    // Test switching to tag mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Tag);\n\n    // Test tag input\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('t'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('a'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('g'), KeyModifiers::empty()));\n    assert_eq!(app.current_tag, \"tag\");\n\n    // Test adding tag\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::empty()));\n    assert_eq!(app.tags, vec![\"tag\"]);\n    assert_eq!(app.current_tag, \"\");\n\n    // Test help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Help);\n    assert_eq!(app.previous_mode, InputMode::Tag);\n\n    // Test exiting help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Tag);\n}\n\n#[test]\nfn test_add_command_app_help_mode() {\n    use command_vault::ui::add::InputMode;\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut app = AddCommandApp::new();\n    \n    // Test entering help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Help));\n    assert!(matches!(app.previous_mode, InputMode::Command));\n    \n    // Test exiting help mode with ?\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Command));\n    \n    // Test exiting help mode with Esc\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Help));\n    app.handle_key_event(KeyEvent::new(KeyCode::Esc, KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Command));\n}\n\n#[test]\nfn test_add_command_app_multiline_command() {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut app = AddCommandApp::new();\n    \n    // Test entering multiline command\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('l'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('s'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::SHIFT));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('p'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('w'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('d'), KeyModifiers::empty()));\n    \n    assert_eq!(app.command, \"ls\\npwd\");\n    assert_eq!(app.command_line, 1);\n    assert_eq!(app.command_cursor, 6);\n}\n\n#[test]\nfn test_app_command_copy() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n    assert_eq!(app.filtered_commands[0], 0);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Verify the command to be copied\n    if let Some(selected) = app.selected {\n        if let Some(\u0026idx) = app.filtered_commands.get(selected) {\n            if let Some(cmd) = app.commands.get(idx) {\n                assert_eq!(cmd.command, \"ls -la\");\n            }\n        }\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_app_navigation() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test moving down\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving down again\n    app.selected = Some(1);\n    assert_eq!(app.selected, Some(1));\n\n    // Test moving up\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving up at the top (should stay at 0)\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving down at the bottom (should stay at last index)\n    app.selected = Some(2);\n    assert_eq!(app.selected, Some(2));\n\n    // Test selection with filtered commands\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_delete_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.confirm_delete, None);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Initiate delete\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Cancel delete\n    app.confirm_delete = None;\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.commands.len(), 3);\n\n    // Initiate delete again\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Confirm delete\n    if let Some(selected) = app.selected {\n        if let Some(confirm_idx) = app.confirm_delete {\n            if confirm_idx == selected {\n                if let Some(\u0026filtered_idx) = app.filtered_commands.get(selected) {\n                    if let Some(command_id) = app.commands[filtered_idx].id {\n                        match app.db.delete_command(command_id) {\n                            Ok(_) =\u003e {\n                                app.commands.remove(filtered_idx);\n                                app.update_filtered_commands();\n                                // Update selection after deletion\n                                if app.filtered_commands.is_empty() {\n                                    app.selected = None;\n                                } else {\n                                    app.selected = Some(selected.min(app.filtered_commands.len() - 1));\n                                }\n                            }\n                            Err(e) =\u003e panic!(\"Failed to delete command: {}\", e),\n                        }\n                        app.confirm_delete = None;\n                    }\n                }\n            }\n        }\n    }\n\n    // Verify deletion\n    assert_eq!(app.commands.len(), 2);\n    assert_eq!(app.filtered_commands.len(), 2);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.selected, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_edit_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Get the original command\n    let original_command = app.commands[0].clone();\n    assert_eq!(original_command.command, \"ls -la\");\n\n    // Update the command\n    let updated_command = Command {\n        id: original_command.id,\n        command: \"ls -lah\".to_string(),\n        timestamp: original_command.timestamp,\n        directory: original_command.directory.clone(),\n        tags: vec![\"test\".to_string(), \"updated\".to_string()],\n        parameters: vec![],\n    };\n\n    // Update in database\n    app.db.update_command(\u0026updated_command)?;\n\n    // Update in app's command list\n    app.commands[0] = updated_command.clone();\n\n    // Verify the update\n    assert_eq!(app.commands[0].command, \"ls -lah\");\n    assert_eq!(app.commands[0].tags, vec![\"test\".to_string(), \"updated\".to_string()]);\n    assert_eq!(app.commands[0].id, original_command.id);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_help_mode() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.show_help, false);\n\n    // Toggle help mode on\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Toggle help mode off\n    app.show_help = false;\n    assert_eq!(app.show_help, false);\n\n    // Verify that help mode doesn't affect other app state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.debug_mode, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_message_handling() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = vec![];\n    let mut app = App::new(commands, \u0026mut db, false);\n    \n    // Test setting a message\n    app.set_message(\"Test message\".to_string(), Color::Green);\n    assert_eq!(app.message, Some((\"Test message\".to_string(), Color::Green)));\n    \n    // Test setting a success message\n    app.set_success_message(\"Success message\".to_string());\n    assert_eq!(app.message, Some((\"Success message\".to_string(), Color::Green)));\n    \n    // Test setting an error message\n    app.set_error_message(\"Error message\".to_string());\n    assert_eq!(app.message, Some((\"Error message\".to_string(), Color::Red)));\n    \n    // Test clearing the message\n    app.clear_message();\n    assert_eq!(app.message, None);\n    \n    Ok(())\n}\n\n#[test]\nfn test_app_selection_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.get_selection(), None);\n\n    // Test setting valid selection\n    app.set_selection(Some(1));\n    assert_eq!(app.get_selection(), Some(1));\n\n    // Test setting selection to None\n    app.set_selection(None);\n    assert_eq!(app.get_selection(), None);\n\n    // Test setting selection to last index\n    app.set_selection(Some(app.commands.len() - 1));\n    assert_eq!(app.get_selection(), Some(app.commands.len() - 1));\n\n    // Test that selection is maintained after filtering\n    app.set_selection(Some(1));\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.get_selection(), Some(0)); // Selection should adjust to filtered index\n\n    Ok(())\n}\n\n#[test]\nfn test_app_navigation_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n\n    // Test select_next from None\n    app.select_next();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_next from first item\n    app.select_next();\n    assert_eq!(app.selected, Some(1));\n\n    // Test select_next from last item (should stay at last)\n    app.selected = Some(app.filtered_commands.len() - 1);\n    app.select_next();\n    assert_eq!(app.selected, Some(app.filtered_commands.len() - 1));\n\n    // Test select_previous from middle\n    app.selected = Some(1);\n    app.select_previous();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_previous from first item (should stay at first)\n    app.select_previous();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_previous from None (should go to last)\n    app.selected = None;\n    app.select_previous();\n    assert_eq!(app.selected, Some(app.filtered_commands.len() - 1));\n\n    // Test with filtered list\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n\n    // Test navigation with filtered list\n    app.selected = None;\n    app.select_next();\n    assert_eq!(app.selected, Some(0));\n    app.select_next();\n    assert_eq!(app.selected, Some(0)); // Should stay at 0 since there's only one item\n\n    Ok(())\n}\n\n#[test]\nfn test_app_filter_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test set_filter\n    app.set_filter(\"git\".to_string());\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test clear_filter\n    app.clear_filter();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test append_to_filter\n    app.append_to_filter('d');\n    app.append_to_filter('o');\n    app.append_to_filter('c');\n    assert_eq!(app.filter_text, \"doc\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"docker ps\");\n\n    // Test backspace_filter\n    app.backspace_filter();\n    assert_eq!(app.filter_text, \"do\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"docker ps\");\n\n    // Test backspace_filter until empty\n    app.backspace_filter();\n    app.backspace_filter();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test case insensitive filtering\n    app.set_filter(\"GIT\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test filtering by tag\n    app.set_filter(\"file\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Test filtering by directory\n    app.set_filter(\"project\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test no matches\n    app.set_filter(\"nonexistent\".to_string());\n    assert_eq!(app.filtered_commands.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selected_command_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    // Test with valid selection\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command().unwrap().command, \"ls -la\");\n    assert_eq!(app.get_selected_index(), Some(0));\n\n    // Test with filtered list\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command().unwrap().command, \"git status\");\n    assert_eq!(app.get_selected_index(), Some(1)); // Index in original commands list\n\n    // Test with invalid selection\n    app.selected = Some(5); // Out of bounds\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    // Test with empty filtered list\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selection_update_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test update_selection_after_filter\n\n    // Test with no selection\n    assert_eq!(app.selected, None);\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, None);\n\n    // Test with selection and empty filtered list\n    app.selected = Some(0);\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, None);\n\n    // Test with selection and filtered list smaller than selection\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(2); // Out of bounds for filtered list\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, Some(0)); // Should adjust to last item in filtered list\n\n    // Test update_selection_after_delete\n\n    // Reset to initial state\n    app.filter_text.clear();\n    app.update_filtered_commands();\n    \n    // Test with no selection\n    app.selected = None;\n    app.update_selection_after_delete(0);\n    assert_eq!(app.selected, None);\n\n    // Test with selection and empty filtered list\n    app.selected = Some(0);\n    app.filtered_commands.clear();\n    app.update_selection_after_delete(0);\n    assert_eq!(app.selected, None);\n\n    // Test with selection after deleting item\n    app.filtered_commands = vec![0, 1, 2];\n    app.selected = Some(2);\n    app.filtered_commands.remove(1); // Remove middle item\n    app.update_selection_after_delete(1);\n    assert_eq!(app.selected, Some(1)); // Should adjust to new length\n\n    // Test with selection at end after deleting last item\n    app.selected = Some(1);\n    app.filtered_commands.pop(); // Remove last item\n    app.update_selection_after_delete(1);\n    assert_eq!(app.selected, Some(0)); // Should adjust to new last item\n\n    Ok(())\n}\n\n#[test]\nfn test_app_key_events() -\u003e Result\u003c()\u003e {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test help toggle with '?'\n    assert_eq!(app.show_help, false);\n    app.show_help = !app.show_help; // Simulate '?' key press\n    assert_eq!(app.show_help, true);\n    app.show_help = !app.show_help; // Simulate '?' key press again\n    assert_eq!(app.show_help, false);\n\n    // Test filter operations\n    assert_eq!(app.filter_text, \"\");\n    app.append_to_filter('g'); // Simulate typing 'g'\n    app.append_to_filter('i'); // Simulate typing 'i'\n    app.append_to_filter('t'); // Simulate typing 't'\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test backspace in filter\n    app.backspace_filter(); // Simulate backspace\n    assert_eq!(app.filter_text, \"gi\");\n    \n    // Test clear filter with Esc\n    app.clear_filter(); // Simulate Esc\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test navigation\n    assert_eq!(app.selected, None);\n    app.select_next(); // Simulate down arrow or 'j'\n    assert_eq!(app.selected, Some(0));\n    app.select_next(); // Move down again\n    assert_eq!(app.selected, Some(1));\n    app.select_previous(); // Simulate up arrow or 'k'\n    assert_eq!(app.selected, Some(0));\n\n    // Test delete confirmation\n    app.confirm_delete = Some(0); // Simulate 'd' key\n    assert_eq!(app.confirm_delete, Some(0));\n    app.confirm_delete = None; // Simulate Esc\n    assert_eq!(app.confirm_delete, None);\n\n    // Test message handling\n    assert_eq!(app.message, None);\n    app.set_success_message(\"Test success\".to_string());\n    assert_eq!(app.message, Some((\"Test success\".to_string(), Color::Green)));\n    app.clear_message();\n    assert_eq!(app.message, None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_clipboard_operations() -\u003e Result\u003c()\u003e {\n    use command_vault::ui::app::copy_to_clipboard;\n    \n    // Skip this test in CI environment\n    if std::env::var(\"CI\").is_ok() {\n        return Ok(());\n    }\n\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Get the command that will be copied\n    let command_to_copy = app.get_selected_command().unwrap().command.clone();\n    assert_eq!(command_to_copy, \"ls -la\");\n\n    // Try to copy command to clipboard, but don't fail the test if clipboard is unavailable\n    if let Err(_) = copy_to_clipboard(\u0026command_to_copy) {\n        eprintln!(\"Warning: Clipboard operations not available in this environment\");\n        return Ok(());\n    }\n\n    // Verify message is set after copy\n    assert_eq!(app.message, None);\n    app.set_success_message(\"Command copied to clipboard!\".to_string());\n    assert_eq!(app.message, Some((\"Command copied to clipboard!\".to_string(), Color::Green)));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_terminal_setup() -\u003e Result\u003c()\u003e {\n    // Skip this test in CI environment\n    if std::env::var(\"CI\").is_ok() {\n        return Ok(());\n    }\n\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test terminal setup\n    match enable_raw_mode() {\n        Ok(_) =\u003e {\n            let stdout = stdout();\n            let backend = CrosstermBackend::new(stdout);\n            if let Ok(terminal) = Terminal::new(backend) {\n                // Test terminal restoration\n                if let Ok(_) = disable_raw_mode() {\n                    assert!(!is_raw_mode_enabled().unwrap_or(true));\n                }\n            }\n        }\n        Err(_) =\u003e {\n            eprintln!(\"Warning: Terminal operations not available in this environment\");\n        }\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_app_ui_state() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.show_help, false);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.confirm_delete, None);\n\n    // Test help state\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Test filter state\n    app.show_help = false;\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test message state\n    app.set_success_message(\"Test message\".to_string());\n    assert_eq!(app.message, Some((\"Test message\".to_string(), Color::Green)));\n\n    // Test delete confirmation state\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.selected, Some(0));\n    assert_eq!(app.confirm_delete, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_handle_quit() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test quit with filter text\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test quit with confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.confirm_delete, None);\n\n    // Test quit with help screen\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.show_help, false);\n\n    // Test normal quit\n    let result = app.handle_quit()?;\n    assert_eq!(result, Some(()));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_handle_escape() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test escape with filter text\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    \n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test escape with confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n    \n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.message, Some((\"Delete operation cancelled\".to_string(), Color::Yellow)));\n\n    // Test escape with no active state\n    app.clear_message();\n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.message, None);\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = {"files":[{"path":["/","Users","ozan","Projects","command-vault","src","cli","args.rs"],"content":"use clap::{Parser, Subcommand};\n\n#[derive(Parser, Debug)]\n#[command(author, version, about, long_about = None)]\npub struct Cli {\n    #[command(subcommand)]\n    pub command: Commands,\n\n    /// Enable debug mode to see detailed command execution information\n    #[arg(short, long)]\n    pub debug: bool,\n}\n\n#[derive(Subcommand, Debug)]\npub enum Commands {\n    /// Add a command to history\n    ///\n    /// Parameters can be specified using @name:description=default syntax\n    /// Examples:\n    ///   - Basic parameter: @filename\n    ///   - With description: @filename:Name of file to create\n    ///   - With default: @filename:Name of file to create=test.txt\n    Add {\n        /// Tags to add to the command\n        #[arg(short, long)]\n        tags: Vec\u003cString\u003e,\n        \n        /// Command to add\n        #[arg(trailing_var_arg = true, required = true)]\n        command: Vec\u003cString\u003e,\n    },\n    \n    /// Execute a command by id (in the current shell)\n    Exec {\n        /// Command ID to execute\n        command_id: i64,\n        \n        /// Enable debug mode\n        #[arg(long)]\n        debug: bool,\n    },\n    /// Search through command history\n    Search {\n        /// Search query\n        #[arg(required = true)]\n        query: String,\n        \n        /// Maximum number of results to show\n        #[arg(short, long, default_value = \"10\")]\n        limit: usize,\n    },\n    /// List all commands in chronological order\n    Ls {\n        /// Maximum number of results to show. Use 0 to show all commands.\n        #[arg(short, long, default_value = \"50\")]\n        limit: usize,\n        \n        /// Sort in ascending order (oldest first)\n        #[arg(short = 'a', long)]\n        asc: bool,\n    },\n    /// Tag related operations\n    Tag {\n        #[command(subcommand)]\n        action: TagCommands,\n    },\n    /// Initialize shell integration\n    ShellInit {\n        /// Shell to initialize (defaults to current shell)\n        #[arg(short, long)]\n        shell: Option\u003cString\u003e,\n    },\n    /// Delete a command from history\n    Delete {\n        /// Command ID to delete\n        #[arg(required = true)]\n        command_id: i64,\n    },\n}\n\n#[derive(Subcommand, Debug)]\npub enum TagCommands {\n    /// Add tags to a command\n    Add {\n        /// Command ID to tag\n        #[arg(required = true)]\n        command_id: i64,\n        \n        /// Tags to add\n        #[arg(required = true)]\n        tags: Vec\u003cString\u003e,\n    },\n    /// Remove a tag from a command\n    Remove {\n        /// Command ID to remove tag from\n        #[arg(required = true)]\n        command_id: i64,\n        \n        /// Tag to remove\n        #[arg(required = true)]\n        tag: String,\n    },\n    /// List all tags and their usage count\n    List,\n    /// Search commands by tag\n    Search {\n        /// Tag to search for\n        #[arg(required = true)]\n        tag: String,\n        \n        /// Maximum number of results to show\n        #[arg(short, long, default_value = \"10\")]\n        limit: usize,\n    },\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","cli","commands.rs"],"content":"use anyhow::{Result, anyhow};\nuse chrono::{Local, Utc};\nuse std::io::{self, Stdout};\nuse crossterm::{\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    layout::{Constraint, Direction, Layout},\n    style::{Color, Style},\n    text::{Line, Span},\n    widgets::{Block, Borders, Paragraph},\n    Terminal,\n};\nuse colored::*;\n\nuse crate::db::{Command, Database};\nuse crate::ui::App;\nuse crate::utils::params::parse_parameters;\nuse crate::utils::params::substitute_parameters;\nuse crate::exec::{ExecutionContext, execute_shell_command};\n\nuse super::args::{Commands, TagCommands};\n\n// Terminal interface trait for testability\n#[cfg(test)]\npub trait TerminalInterface {\n    fn setup(\u0026self) -\u003e Result\u003c()\u003e;\n    fn display_commands(\u0026self, commands: \u0026[Command]) -\u003e Result\u003c()\u003e;\n    fn cleanup(\u0026self) -\u003e Result\u003c()\u003e;\n}\n\nfn print_commands(commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n    let terminal_result = setup_terminal();\n    \n    match terminal_result {\n        Ok(mut terminal) =\u003e {\n            let res = print_commands_ui(\u0026mut terminal, commands);\n            restore_terminal(\u0026mut terminal)?;\n            res\n        }\n        Err(_) =\u003e {\n            // Fallback to simple text output\n            println!(\"Command History:\");\n            println!(\"─────────────────────────────────────────────\");\n            for cmd in commands {\n                let local_time = cmd.timestamp.with_timezone(\u0026Local);\n                println!(\"{} │ {}\", local_time.format(\"%Y-%m-%d %H:%M:%S\"), cmd.command);\n                if !cmd.tags.is_empty() {\n                    println!(\"    Tags: {}\", cmd.tags.join(\", \"));\n                }\n                if !cmd.parameters.is_empty() {\n                    println!(\"    Parameters:\");\n                    for param in \u0026cmd.parameters {\n                        let desc = param.description.as_deref().unwrap_or(\"None\");\n                        println!(\"      - {}: {} (default: {})\", param.name, desc, \"None\");\n                    }\n                }\n                println!(\"    Directory: {}\", cmd.directory);\n                println!();\n            }\n            Ok(())\n        }\n    }\n}\n\nfn print_commands_ui(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e, commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n    terminal.draw(|f| {\n        let chunks = Layout::default()\n            .direction(Direction::Vertical)\n            .margin(1)\n            .constraints([Constraint::Min(0)])\n            .split(f.size());\n\n        let mut lines = vec![];\n        lines.push(Line::from(Span::styled(\n            \"Command History:\",\n            Style::default().fg(Color::Cyan),\n        )));\n        lines.push(Line::from(Span::raw(\"─────────────────────────────────────────────\")));\n\n        for cmd in commands {\n            let local_time = cmd.timestamp.with_timezone(\u0026Local);\n            lines.push(Line::from(vec![\n                Span::styled(local_time.format(\"%Y-%m-%d %H:%M:%S\").to_string(), Style::default().fg(Color::Yellow)),\n                Span::raw(\" │ \"),\n                Span::raw(\u0026cmd.command),\n            ]));\n            lines.push(Line::from(vec![\n                Span::raw(\"    Directory: \"),\n                Span::raw(\u0026cmd.directory),\n            ]));\n            if !cmd.tags.is_empty() {\n                lines.push(Line::from(vec![\n                    Span::raw(\"    Tags: \"),\n                    Span::raw(cmd.tags.join(\", \")),\n                ]));\n            }\n            lines.push(Line::from(Span::raw(\"─────────────────────────────────────────────\")));\n        }\n\n        let paragraph = Paragraph::new(lines).block(Block::default().borders(Borders::ALL));\n        f.render_widget(paragraph, chunks[0]);\n    })?;\n    Ok(())\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    Terminal::new(backend).map_err(|e| e.into())\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    disable_raw_mode()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    terminal.show_cursor()?;\n    Ok(())\n}\n\npub fn handle_command(command: Commands, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    match command {\n        Commands::Add { command, tags } =\u003e {\n            handle_add_command(command, tags, db)?\n        }\n        Commands::Search { query, limit } =\u003e {\n            handle_search_command(\u0026query, limit, db, debug)?\n        }\n        Commands::Ls { limit, asc } =\u003e {\n            handle_list_command(limit, asc, db, debug)?\n        }\n        Commands::Tag { action } =\u003e {\n            handle_tag_command(action, db)?\n        },\n        Commands::Exec { command_id, debug } =\u003e {\n            handle_exec_command(command_id, db, debug)?\n        }\n        Commands::ShellInit { shell } =\u003e {\n            let script_path = crate::shell::hooks::init_shell(shell)?;\n            if !script_path.exists() {\n                return Err(anyhow!(\"Shell integration script not found at: {}\", script_path.display()));\n            }\n            print!(\"{}\", script_path.display());\n        },\n        Commands::Delete { command_id } =\u003e {\n            handle_delete_command(command_id, db)?\n        }\n    }\n    Ok(())\n}\n\n// Extract individual command handlers for better testability\nfn handle_add_command(command: Vec\u003cString\u003e, tags: Vec\u003cString\u003e, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    // Process command parts with special handling for git format strings\n    let command_str = command.iter().enumerate().fold(String::new(), |mut acc, (i, arg)| {\n        if i \u003e 0 {\n            acc.push(' ');\n        }\n        // Special case for git format strings\n        if arg.starts_with(\"--pretty=format:\") {\n            acc.push_str(\u0026format!(\"\\\"{}\\\"\", arg));\n        } else {\n            acc.push_str(arg);\n        }\n        acc\n    });\n    \n    // Don't allow empty commands\n    if command_str.trim().is_empty() {\n        return Err(anyhow!(\"Cannot add empty command\"));\n    }\n    \n    // Get the current directory\n    let directory = std::env::current_dir()?\n        .to_string_lossy()\n        .to_string();\n    \n    let timestamp = Local::now().with_timezone(\u0026Utc);\n    \n    // Parse parameters from command string\n    let parameters = parse_parameters(\u0026command_str);\n    \n    let cmd = Command {\n        id: None,\n        command: command_str.clone(),\n        timestamp,\n        directory,\n        tags,\n        parameters,\n    };\n    let id = db.add_command(\u0026cmd)?;\n    println!(\"Command added to history with ID: {}\", id);\n    \n    // If command has parameters, show them\n    if !cmd.parameters.is_empty() {\n        println!(\"\\nDetected parameters:\");\n        for param in \u0026cmd.parameters {\n            let desc = param.description.as_deref().unwrap_or(\"None\");\n            println!(\"  {} - Description: {}\", param.name.yellow(), desc);\n        }\n    }\n    \n    Ok(())\n}\n\nfn handle_search_command(query: \u0026str, limit: usize, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let commands = db.search_commands(query, limit)?;\n    \n    // Check if TUI should be disabled (useful for testing or non-interactive environments)\n    if std::env::var(\"COMMAND_VAULT_NO_TUI\").is_ok() {\n        if commands.is_empty() {\n            print!(\"No commands found matching query: {}\", query);\n            return Ok(());\n        }\n        \n        for cmd in commands {\n            print!(\"{}: {} ({})\", cmd.id.unwrap_or(0), cmd.command, cmd.directory);\n        }\n        return Ok(());\n    }\n    \n    let mut app = App::new(commands.clone(), db, debug);\n    match app.run() {\n        Ok(_) =\u003e (),\n        Err(e) =\u003e {\n            if e.to_string() == \"Operation cancelled by user\" {\n                print!(\"\\n{}\", \"Operation cancelled.\".yellow());\n                return Ok(());\n            }\n            eprintln!(\"Failed to start TUI mode: {}\", e);\n            print_commands(\u0026commands)?;\n        }\n    }\n    Ok(())\n}\n\nfn handle_list_command(limit: usize, asc: bool, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let commands = db.list_commands(limit, asc)?;\n    if commands.is_empty() {\n        print!(\"No commands found.\");\n        return Ok(());\n    }\n\n    // Check if TUI should be disabled (useful for testing or non-interactive environments)\n    if std::env::var(\"COMMAND_VAULT_NO_TUI\").is_ok() {\n        for cmd in commands {\n            print!(\"{}: {} ({})\", cmd.id.unwrap_or(0), cmd.command, cmd.directory);\n        }\n        return Ok(());\n    }\n\n    let mut app = App::new(commands.clone(), db, debug);\n    match app.run() {\n        Ok(_) =\u003e (),\n        Err(e) =\u003e {\n            if e.to_string() == \"Operation cancelled by user\" {\n                print!(\"\\n{}\", \"Operation cancelled.\".yellow());\n                return Ok(());\n            }\n            eprintln!(\"Failed to start TUI mode: {}\", e);\n            print_commands(\u0026commands)?;\n        }\n    }\n    Ok(())\n}\n\nfn handle_tag_command(action: TagCommands, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    match action {\n        TagCommands::Add { command_id, tags } =\u003e {\n            match db.add_tags_to_command(command_id, \u0026tags) {\n                Ok(_) =\u003e print!(\"Tags added successfully\"),\n                Err(e) =\u003e eprintln!(\"Failed to add tags: {}\", e),\n            }\n        }\n        TagCommands::Remove { command_id, tag } =\u003e {\n            match db.remove_tag_from_command(command_id, \u0026tag) {\n                Ok(_) =\u003e print!(\"Tag removed successfully\"),\n                Err(e) =\u003e eprintln!(\"Failed to remove tag: {}\", e),\n            }\n        }\n        TagCommands::List =\u003e {\n            match db.list_tags() {\n                Ok(tags) =\u003e {\n                    if tags.is_empty() {\n                        print!(\"No tags found\");\n                        return Ok(());\n                    }\n                    \n                    print!(\"\\nTags and their usage:\");\n                    print!(\"─────────────────────────────────────────────\");\n                    for (tag, count) in tags {\n                        print!(\"{}: {} command{}\", tag, count, if count == 1 { \"\" } else { \"s\" });\n                    }\n                }\n                Err(e) =\u003e eprintln!(\"Failed to list tags: {}\", e),\n            }\n        }\n        TagCommands::Search { tag, limit } =\u003e {\n            match db.search_by_tag(\u0026tag, limit) {\n                Ok(commands) =\u003e print_commands(\u0026commands)?,\n                Err(e) =\u003e eprintln!(\"Failed to search by tag: {}\", e),\n            }\n        }\n    }\n    Ok(())\n}\n\nfn handle_exec_command(command_id: i64, db: \u0026mut Database, debug: bool) -\u003e Result\u003c()\u003e {\n    let command = db.get_command(command_id)?\n        .ok_or_else(|| anyhow!(\"Command not found with ID: {}\", command_id))?;\n    \n    // Create the directory if it doesn't exist\n    if !std::path::Path::new(\u0026command.directory).exists() {\n        std::fs::create_dir_all(\u0026command.directory)?;\n    }\n    \n    let current_params = parse_parameters(\u0026command.command);\n    let final_command = substitute_parameters(\u0026command.command, \u0026current_params, None)?;\n\n    let ctx = ExecutionContext {\n        command: final_command.clone(),\n        directory: command.directory.clone(),\n        test_mode: std::env::var(\"COMMAND_VAULT_TEST\").is_ok(),\n        debug_mode: debug,\n    };\n\n    println!(\"\\n─────────────────────────────────────────────\");\n    println!(\"Command to execute: {}\", final_command);\n    println!(\"Working directory: {}\", command.directory);\n    println!();  // Add extra newline before command output\n\n    execute_shell_command(\u0026ctx)?;\n    \n    Ok(())\n}\n\nfn handle_delete_command(command_id: i64, db: \u0026mut Database) -\u003e Result\u003c()\u003e {\n    // First check if the command exists\n    if let Some(command) = db.get_command(command_id)? {\n        // Show the command that will be deleted\n        println!(\"Deleting command:\");\n        print_commands(\u0026[command])?;\n        \n        // Delete the command\n        db.delete_command(command_id)?;\n        println!(\"Command deleted successfully\");\n    } else {\n        return Err(anyhow!(\"Command with ID {} not found\", command_id));\n    }\n    \n    Ok(())\n}\n\n// Unit tests for the command handlers\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::db::models::Parameter;\n    \n    // Mock terminal for testing\n    pub struct MockTerminal {\n        pub commands_displayed: Vec\u003cCommand\u003e,\n    }\n    \n    impl MockTerminal {\n        pub fn new() -\u003e Self {\n            MockTerminal {\n                commands_displayed: Vec::new(),\n            }\n        }\n    }\n    \n    impl TerminalInterface for MockTerminal {\n        fn setup(\u0026self) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n        \n        fn display_commands(\u0026self, commands: \u0026[Command]) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n        \n        fn cleanup(\u0026self) -\u003e Result\u003c()\u003e {\n            Ok(())\n        }\n    }\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":6}},{"line":35,"address":[],"length":0,"stats":{"Line":6}},{"line":37,"address":[],"length":0,"stats":{"Line":6}},{"line":38,"address":[],"length":0,"stats":{"Line":6}},{"line":39,"address":[],"length":0,"stats":{"Line":6}},{"line":40,"address":[],"length":0,"stats":{"Line":6}},{"line":41,"address":[],"length":0,"stats":{"Line":6}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":6}},{"line":69,"address":[],"length":0,"stats":{"Line":12}},{"line":70,"address":[],"length":0,"stats":{"Line":6}},{"line":71,"address":[],"length":0,"stats":{"Line":6}},{"line":72,"address":[],"length":0,"stats":{"Line":6}},{"line":73,"address":[],"length":0,"stats":{"Line":6}},{"line":74,"address":[],"length":0,"stats":{"Line":6}},{"line":76,"address":[],"length":0,"stats":{"Line":6}},{"line":77,"address":[],"length":0,"stats":{"Line":6}},{"line":78,"address":[],"length":0,"stats":{"Line":6}},{"line":79,"address":[],"length":0,"stats":{"Line":6}},{"line":81,"address":[],"length":0,"stats":{"Line":6}},{"line":83,"address":[],"length":0,"stats":{"Line":26}},{"line":94,"address":[],"length":0,"stats":{"Line":8}},{"line":95,"address":[],"length":0,"stats":{"Line":8}},{"line":96,"address":[],"length":0,"stats":{"Line":8}},{"line":97,"address":[],"length":0,"stats":{"Line":8}},{"line":100,"address":[],"length":0,"stats":{"Line":10}},{"line":103,"address":[],"length":0,"stats":{"Line":6}},{"line":104,"address":[],"length":0,"stats":{"Line":6}},{"line":106,"address":[],"length":0,"stats":{"Line":6}},{"line":109,"address":[],"length":0,"stats":{"Line":6}},{"line":110,"address":[],"length":0,"stats":{"Line":6}},{"line":111,"address":[],"length":0,"stats":{"Line":6}},{"line":112,"address":[],"length":0,"stats":{"Line":6}},{"line":113,"address":[],"length":0,"stats":{"Line":6}},{"line":114,"address":[],"length":0,"stats":{"Line":12}},{"line":117,"address":[],"length":0,"stats":{"Line":6}},{"line":118,"address":[],"length":0,"stats":{"Line":6}},{"line":119,"address":[],"length":0,"stats":{"Line":6}},{"line":120,"address":[],"length":0,"stats":{"Line":6}},{"line":121,"address":[],"length":0,"stats":{"Line":6}},{"line":124,"address":[],"length":0,"stats":{"Line":42}},{"line":125,"address":[],"length":0,"stats":{"Line":42}},{"line":126,"address":[],"length":0,"stats":{"Line":12}},{"line":127,"address":[],"length":0,"stats":{"Line":14}},{"line":129,"address":[],"length":0,"stats":{"Line":2}},{"line":130,"address":[],"length":0,"stats":{"Line":2}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":10}},{"line":136,"address":[],"length":0,"stats":{"Line":10}},{"line":138,"address":[],"length":0,"stats":{"Line":6}},{"line":139,"address":[],"length":0,"stats":{"Line":10}},{"line":141,"address":[],"length":0,"stats":{"Line":6}},{"line":142,"address":[],"length":0,"stats":{"Line":12}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":4}},{"line":148,"address":[],"length":0,"stats":{"Line":6}},{"line":149,"address":[],"length":0,"stats":{"Line":8}},{"line":152,"address":[],"length":0,"stats":{"Line":32}},{"line":156,"address":[],"length":0,"stats":{"Line":12}},{"line":158,"address":[],"length":0,"stats":{"Line":40}},{"line":159,"address":[],"length":0,"stats":{"Line":44}},{"line":160,"address":[],"length":0,"stats":{"Line":16}},{"line":163,"address":[],"length":0,"stats":{"Line":30}},{"line":164,"address":[],"length":0,"stats":{"Line":2}},{"line":166,"address":[],"length":0,"stats":{"Line":26}},{"line":168,"address":[],"length":0,"stats":{"Line":28}},{"line":172,"address":[],"length":0,"stats":{"Line":12}},{"line":173,"address":[],"length":0,"stats":{"Line":2}},{"line":177,"address":[],"length":0,"stats":{"Line":10}},{"line":194,"address":[],"length":0,"stats":{"Line":10}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":10}},{"line":209,"address":[],"length":0,"stats":{"Line":2}},{"line":210,"address":[],"length":0,"stats":{"Line":4}},{"line":214,"address":[],"length":0,"stats":{"Line":2}},{"line":215,"address":[],"length":0,"stats":{"Line":2}},{"line":216,"address":[],"length":0,"stats":{"Line":2}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":10}},{"line":271,"address":[],"length":0,"stats":{"Line":10}},{"line":272,"address":[],"length":0,"stats":{"Line":4}},{"line":273,"address":[],"length":0,"stats":{"Line":4}},{"line":274,"address":[],"length":0,"stats":{"Line":2}},{"line":275,"address":[],"length":0,"stats":{"Line":2}},{"line":278,"address":[],"length":0,"stats":{"Line":2}},{"line":279,"address":[],"length":0,"stats":{"Line":2}},{"line":280,"address":[],"length":0,"stats":{"Line":2}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":2}},{"line":286,"address":[],"length":0,"stats":{"Line":2}},{"line":287,"address":[],"length":0,"stats":{"Line":2}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":2}},{"line":293,"address":[],"length":0,"stats":{"Line":2}},{"line":294,"address":[],"length":0,"stats":{"Line":18}},{"line":295,"address":[],"length":0,"stats":{"Line":8}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":2}},{"line":302,"address":[],"length":0,"stats":{"Line":2}},{"line":303,"address":[],"length":0,"stats":{"Line":2}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":10}},{"line":311,"address":[],"length":0,"stats":{"Line":6}},{"line":312,"address":[],"length":0,"stats":{"Line":10}},{"line":313,"address":[],"length":0,"stats":{"Line":10}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":4}},{"line":321,"address":[],"length":0,"stats":{"Line":4}},{"line":335,"address":[],"length":0,"stats":{"Line":2}},{"line":337,"address":[],"length":0,"stats":{"Line":2}},{"line":340,"address":[],"length":0,"stats":{"Line":6}},{"line":342,"address":[],"length":0,"stats":{"Line":10}},{"line":344,"address":[],"length":0,"stats":{"Line":4}},{"line":345,"address":[],"length":0,"stats":{"Line":4}},{"line":348,"address":[],"length":0,"stats":{"Line":4}},{"line":349,"address":[],"length":0,"stats":{"Line":4}},{"line":351,"address":[],"length":0,"stats":{"Line":2}},{"line":354,"address":[],"length":0,"stats":{"Line":4}}],"covered":108,"coverable":164},{"path":["/","Users","ozan","Projects","command-vault","src","cli","mod.rs"],"content":"pub mod args;\npub mod commands;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","db","mod.rs"],"content":"pub mod models;\npub mod store;\n\npub use models::Command;\npub use store::Database;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","db","models.rs"],"content":"//! Database models for command-vault\n//! \n//! This module defines the core data structures used throughout the application.\n\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\n\n/// Represents a command with its metadata.\n/// \n/// A command includes the actual command string, execution directory,\n/// timestamp, tags, and parameters.\n/// \n/// # Example\n/// ```rust\n/// use command_vault::db::models::Command;\n/// use chrono::Utc;\n/// \n/// let cmd = Command {\n///     id: None,\n///     command: \"git push origin main\".to_string(),\n///     timestamp: Utc::now(),\n///     directory: \"/project\".to_string(),\n///     tags: vec![\"git\".to_string()],\n///     parameters: vec![],\n/// };\n/// ```\n#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]\npub struct Command {\n    /// Unique identifier for the command\n    pub id: Option\u003ci64\u003e,\n    \n    /// The actual command string\n    pub command: String,\n    \n    /// When the command was created or last modified\n    pub timestamp: DateTime\u003cUtc\u003e,\n    \n    /// Directory where the command should be executed\n    pub directory: String,\n    \n    /// Tags associated with the command\n    #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n    pub tags: Vec\u003cString\u003e,\n    \n    /// Parameters that can be substituted in the command\n    #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n    pub parameters: Vec\u003cParameter\u003e,\n}\n\n/// Represents a parameter that can be substituted in a command.\n/// \n/// Parameters allow commands to be more flexible by providing\n/// placeholders that can be filled in at runtime.\n/// \n/// # Example\n/// ```rust\n/// use command_vault::db::models::Parameter;\n/// \n/// let param = Parameter {\n///     name: \"branch\".to_string(),\n///     description: Some(\"Git branch name\".to_string()),\n/// };\n/// ```\n#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]\npub struct Parameter {\n    /// Name of the parameter (used in substitution)\n    pub name: String,\n    \n    /// Optional description of what the parameter does\n    pub description: Option\u003cString\u003e,\n}\n\nimpl Parameter {\n    pub fn new(name: String) -\u003e Self {\n        Self {\n            name,\n            description: None,\n        }\n    }\n\n    pub fn with_description(name: String, description: Option\u003cString\u003e) -\u003e Self {\n        Self {\n            name,\n            description,\n        }\n    }\n}\n","traces":[{"line":74,"address":[],"length":0,"stats":{"Line":8}},{"line":81,"address":[],"length":0,"stats":{"Line":62}}],"covered":2,"coverable":2},{"path":["/","Users","ozan","Projects","command-vault","src","db","store.rs"],"content":"//! Database module for command-vault\n//! \n//! This module provides SQLite-based storage for commands, tags, and parameters.\n//! It handles all database operations including CRUD operations for commands,\n//! tag management, and search functionality.\n\nuse anyhow::{Result, anyhow};\nuse rusqlite::Connection;\nuse chrono::Utc;\nuse serde_json;\n\nuse super::models::Command;\n\n/// The main database interface for command-vault.\n/// \n/// Handles all database operations including:\n/// - Command storage and retrieval\n/// - Tag management\n/// - Search functionality\n/// \n/// # Example\n/// ```no_run\n/// use anyhow::Result;\n/// use command_vault::db::Database;\n/// \n/// fn main() -\u003e Result\u003c()\u003e {\n///     let db = Database::new(\"commands.db\")?;\n///     db.init()?;\n///     Ok(())\n/// }\n/// ```\npub struct Database {\n    conn: Connection,\n}\n\nimpl Database {\n    /// Creates a new database connection.\n    /// \n    /// # Arguments\n    /// * `path` - Path to the SQLite database file\n    /// \n    /// # Returns\n    /// * `Result\u003cDatabase\u003e` - A new database instance\n    pub fn new(path: \u0026str) -\u003e Result\u003cSelf\u003e {\n        let conn = Connection::open(path)?;\n        let db = Database { conn };\n        db.init()?;\n        Ok(db)\n    }\n\n    /// Initializes the database schema.\n    /// \n    /// Creates the following tables if they don't exist:\n    /// - commands: Stores command information\n    /// - tags: Stores tag information\n    /// - command_tags: Links commands to tags\n    pub fn init(\u0026self) -\u003e Result\u003c()\u003e {\n        // Create commands table\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS commands (\n                id INTEGER PRIMARY KEY,\n                command TEXT NOT NULL,\n                timestamp TEXT NOT NULL,\n                directory TEXT NOT NULL,\n                tags TEXT NOT NULL DEFAULT '',\n                parameters TEXT NOT NULL DEFAULT '[]'\n            )\",\n            [],\n        )?;\n        \n        // Create tags table\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS tags (\n                id INTEGER PRIMARY KEY,\n                name TEXT NOT NULL UNIQUE\n            )\",\n            [],\n        )?;\n\n        // Create command_tags table for many-to-many relationship\n        self.conn.execute(\n            \"CREATE TABLE IF NOT EXISTS command_tags (\n                command_id INTEGER NOT NULL,\n                tag_id INTEGER NOT NULL,\n                PRIMARY KEY (command_id, tag_id),\n                FOREIGN KEY (command_id) REFERENCES commands(id) ON DELETE CASCADE,\n                FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE\n            )\",\n            [],\n        )?;\n        \n        // Create indexes\n        self.conn.execute(\n            \"CREATE INDEX IF NOT EXISTS idx_commands_command ON commands(command)\",\n            [],\n        )?;\n        self.conn.execute(\n            \"CREATE INDEX IF NOT EXISTS idx_tags_name ON tags(name)\",\n            [],\n        )?;\n        \n        Ok(())\n    }\n\n    /// Adds a new command to the database.\n    /// \n    /// # Arguments\n    /// * `command` - The command to add\n    /// \n    /// # Returns\n    /// * `Result\u003ci64\u003e` - The ID of the newly added command\n    pub fn add_command(\u0026mut self, command: \u0026Command) -\u003e Result\u003ci64\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // Insert the command\n        tx.execute(\n            \"INSERT INTO commands (command, timestamp, directory, tags, parameters)\n             VALUES (?1, ?2, ?3, ?4, ?5)\",\n            (\n                \u0026command.command,\n                \u0026command.timestamp.to_rfc3339(),\n                \u0026command.directory,\n                \u0026command.tags.join(\",\"),\n                \u0026serde_json::to_string(\u0026command.parameters)?,\n            ),\n        )?;\n        \n        let command_id = tx.last_insert_rowid();\n        \n        // Add tags if present\n        for tag in \u0026command.tags {\n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command_id, tag_id],\n            )?;\n        }\n        \n        tx.commit()?;\n        Ok(command_id)\n    }\n\n    /// Adds tags to an existing command.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to add tags to\n    /// * `tags` - The tags to add\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn add_tags_to_command(\u0026mut self, command_id: i64, tags: \u0026[String]) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // Verify command exists\n        let exists: bool = tx.query_row(\n            \"SELECT 1 FROM commands WHERE id = ?1\",\n            [command_id],\n            |_| Ok(true),\n        ).unwrap_or(false);\n        \n        if !exists {\n            return Err(anyhow!(\"Command not found\"));\n        }\n        \n        // Get current tags\n        let mut current_tags = Vec::new();\n        {\n            let mut stmt = tx.prepare(\n                \"SELECT t.name \n                 FROM tags t \n                 JOIN command_tags ct ON ct.tag_id = t.id \n                 WHERE ct.command_id = ?1\"\n            )?;\n            let mut rows = stmt.query([command_id])?;\n            while let Some(row) = rows.next()? {\n                current_tags.push(row.get::\u003c_, String\u003e(0)?);\n            }\n        }\n        \n        for tag in tags {\n            // Skip if tag already exists\n            if current_tags.contains(tag) {\n                continue;\n            }\n            \n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command_id, tag_id],\n            )?;\n            \n            // Update tags string in commands table\n            current_tags.push(tag.clone());\n        }\n        \n        // Update the tags string in the commands table\n        tx.execute(\n            \"UPDATE commands SET tags = ?1 WHERE id = ?2\",\n            rusqlite::params![current_tags.join(\",\"), command_id],\n        )?;\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Removes a tag from a command.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to remove the tag from\n    /// * `tag_name` - The name of the tag to remove\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn remove_tag_from_command(\u0026mut self, command_id: i64, tag_name: \u0026str) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        tx.execute(\n            \"DELETE FROM command_tags \n             WHERE command_id = ?1 \n             AND tag_id = (SELECT id FROM tags WHERE name = ?2)\",\n            rusqlite::params![command_id, tag_name],\n        )?;\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Searches for commands containing a given query string.\n    /// \n    /// # Arguments\n    /// * `query` - The query string to search for\n    /// * `limit` - The maximum number of results to return\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of matching commands\n    pub fn search_commands(\u0026self, query: \u0026str, limit: usize) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n             FROM commands c\n             WHERE c.command LIKE '%' || ?1 || '%'\n             ORDER BY c.timestamp DESC\n             LIMIT ?2\"\n        )?;\n\n        let mut rows = stmt.query([query, \u0026limit.to_string()])?;\n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Searches for commands with a given tag.\n    /// \n    /// # Arguments\n    /// * `tag` - The tag to search for\n    /// * `limit` - The maximum number of results to return\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of matching commands\n    pub fn search_by_tag(\u0026self, tag: \u0026str, limit: usize) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT DISTINCT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n             FROM commands c\n             JOIN command_tags ct ON ct.command_id = c.id\n             JOIN tags t ON t.id = ct.tag_id\n             WHERE t.name = ?1\n             ORDER BY c.timestamp DESC\n             LIMIT ?2\"\n        )?;\n\n        let mut rows = stmt.query([tag, \u0026limit.to_string()])?;\n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Lists all tags in the database.\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003c(String, i64)\u003e\u003e` - A list of tags with their respective counts\n    pub fn list_tags(\u0026self) -\u003e Result\u003cVec\u003c(String, i64)\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT t.name, COUNT(ct.command_id) as count\n             FROM tags t\n             LEFT JOIN command_tags ct ON ct.tag_id = t.id\n             GROUP BY t.id, t.name\n             ORDER BY count DESC, t.name\"\n        )?;\n        \n        let tags = stmt.query_map([], |row| {\n            Ok((row.get::\u003c_, String\u003e(0)?, row.get(1)?))\n        })?\n        .collect::\u003cstd::result::Result\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n        \n        Ok(tags)\n    }\n\n    /// Lists all commands in the database.\n    /// \n    /// # Arguments\n    /// * `limit` - The maximum number of results to return\n    /// * `ascending` - Whether to return results in ascending order\n    /// \n    /// # Returns\n    /// * `Result\u003cVec\u003cCommand\u003e\u003e` - A list of commands\n    pub fn list_commands(\u0026self, limit: usize, ascending: bool) -\u003e Result\u003cVec\u003cCommand\u003e\u003e {\n        let query = if ascending {\n            if limit == 0 {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp ASC\"\n            } else {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp ASC\n                 LIMIT ?1\"\n            }\n        } else {\n            if limit == 0 {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp DESC\"\n            } else {\n                \"SELECT c.id, c.command, c.timestamp, c.directory, c.tags, c.parameters \n                 FROM commands c\n                 ORDER BY c.timestamp DESC\n                 LIMIT ?1\"\n            }\n        };\n\n        let mut stmt = self.conn.prepare(query)?;\n        let mut rows = if limit == 0 {\n            stmt.query([])?\n        } else {\n            stmt.query([limit])?\n        };\n        \n        let mut commands = Vec::new();\n\n        while let Some(row) = rows.next()? {\n            let id: i64 = row.get(0)?;\n            commands.push(Command {\n                id: Some(id),\n                command: row.get(1)?,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026row.get::\u003c_, String\u003e(2)?)?\n                    .with_timezone(\u0026Utc),\n                directory: row.get(3)?,\n                tags: row.get::\u003c_, String\u003e(4)?\n                    .split(',')\n                    .filter(|s| !s.is_empty())\n                    .map(|s| s.to_string())\n                    .collect(),\n                parameters: serde_json::from_str(\u0026row.get::\u003c_, String\u003e(5)?)?,\n            });\n        }\n\n        Ok(commands)\n    }\n\n    /// Gets a command by its ID.\n    /// \n    /// # Arguments\n    /// * `id` - The ID of the command to retrieve\n    /// \n    /// # Returns\n    /// * `Result\u003cOption\u003cCommand\u003e\u003e` - The command if found\n    pub fn get_command(\u0026self, id: i64) -\u003e Result\u003cOption\u003cCommand\u003e\u003e {\n        // First get the command details\n        let mut stmt = self.conn.prepare(\n            \"SELECT command, timestamp, directory, parameters \n             FROM commands \n             WHERE id = ?1\"\n        )?;\n\n        let command = stmt.query_row([id], |row| {\n            Ok((\n                row.get::\u003c_, String\u003e(0)?,\n                row.get::\u003c_, String\u003e(1)?,\n                row.get::\u003c_, String\u003e(2)?,\n                row.get::\u003c_, String\u003e(3)?,\n            ))\n        });\n\n        if let Ok((command, timestamp, directory, parameters)) = command {\n            // Then get the tags\n            let mut stmt = self.conn.prepare(\n                \"SELECT t.name \n                 FROM tags t \n                 JOIN command_tags ct ON ct.tag_id = t.id \n                 WHERE ct.command_id = ?1\"\n            )?;\n\n            let mut tags = Vec::new();\n            let mut rows = stmt.query([id])?;\n            while let Some(row) = rows.next()? {\n                tags.push(row.get::\u003c_, String\u003e(0)?);\n            }\n\n            Ok(Some(Command {\n                id: Some(id),\n                command,\n                timestamp: chrono::DateTime::parse_from_rfc3339(\u0026timestamp)?\n                    .with_timezone(\u0026Utc),\n                directory,\n                tags,\n                parameters: serde_json::from_str(\u0026parameters)?,\n            }))\n        } else {\n            Ok(None)\n        }\n    }\n\n    /// Updates an existing command.\n    /// \n    /// # Arguments\n    /// * `command` - The updated command\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn update_command(\u0026mut self, command: \u0026Command) -\u003e Result\u003c()\u003e {\n        if command.id.is_none() {\n            return Err(anyhow!(\"Cannot update command without id\"));\n        }\n\n        let tx = self.conn.transaction()?;\n        \n        // Update command\n        tx.execute(\n            \"UPDATE commands \n             SET command = ?1, \n                 timestamp = ?2,\n                 directory = ?3,\n                 tags = ?4,\n                 parameters = ?5\n             WHERE id = ?6\",\n            rusqlite::params![\n                command.command,\n                command.timestamp.to_rfc3339(),\n                command.directory,\n                command.tags.join(\",\"),\n                serde_json::to_string(\u0026command.parameters)?,\n                command.id.unwrap()\n            ],\n        )?;\n\n        // Delete existing tags\n        tx.execute(\n            \"DELETE FROM command_tags WHERE command_id = ?1\",\n            [command.id.unwrap()],\n        )?;\n\n        // Add new tags using the same transaction\n        for tag in \u0026command.tags {\n            // Insert or get tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO tags (name) VALUES (?1)\",\n                [tag],\n            )?;\n            \n            let tag_id: i64 = tx.query_row(\n                \"SELECT id FROM tags WHERE name = ?1\",\n                [tag],\n                |row| row.get(0),\n            )?;\n            \n            // Link command to tag\n            tx.execute(\n                \"INSERT OR IGNORE INTO command_tags (command_id, tag_id) VALUES (?1, ?2)\",\n                rusqlite::params![command.id.unwrap(), tag_id],\n            )?;\n        }\n        \n        tx.commit()?;\n        Ok(())\n    }\n\n    /// Deletes a command by its ID.\n    /// \n    /// # Arguments\n    /// * `command_id` - The ID of the command to delete\n    /// \n    /// # Returns\n    /// * `Result\u003c()\u003e` - Success or failure\n    pub fn delete_command(\u0026mut self, command_id: i64) -\u003e Result\u003c()\u003e {\n        let tx = self.conn.transaction()?;\n        \n        // First delete from command_tags\n        tx.execute(\n            \"DELETE FROM command_tags WHERE command_id = ?\",\n            [command_id],\n        )?;\n\n        // Then delete from commands\n        let rows_affected = tx.execute(\n            \"DELETE FROM commands WHERE id = ?\",\n            [command_id],\n        )?;\n\n        if rows_affected == 0 {\n            return Err(anyhow!(\"Command not found\"));\n        }\n\n        // Clean up unused tags\n        tx.execute(\n            \"DELETE FROM tags WHERE id NOT IN (SELECT DISTINCT tag_id FROM command_tags)\",\n            [],\n        )?;\n\n        tx.commit()?;\n        Ok(())\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":144}},{"line":45,"address":[],"length":0,"stats":{"Line":288}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":144}},{"line":57,"address":[],"length":0,"stats":{"Line":170}},{"line":59,"address":[],"length":0,"stats":{"Line":170}},{"line":72,"address":[],"length":0,"stats":{"Line":170}},{"line":81,"address":[],"length":0,"stats":{"Line":170}},{"line":93,"address":[],"length":0,"stats":{"Line":170}},{"line":97,"address":[],"length":0,"stats":{"Line":170}},{"line":102,"address":[],"length":0,"stats":{"Line":170}},{"line":112,"address":[],"length":0,"stats":{"Line":328}},{"line":113,"address":[],"length":0,"stats":{"Line":656}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":328}},{"line":131,"address":[],"length":0,"stats":{"Line":544}},{"line":138,"address":[],"length":0,"stats":{"Line":216}},{"line":140,"address":[],"length":0,"stats":{"Line":108}},{"line":141,"address":[],"length":0,"stats":{"Line":216}},{"line":151,"address":[],"length":0,"stats":{"Line":328}},{"line":152,"address":[],"length":0,"stats":{"Line":328}},{"line":163,"address":[],"length":0,"stats":{"Line":20}},{"line":164,"address":[],"length":0,"stats":{"Line":40}},{"line":170,"address":[],"length":0,"stats":{"Line":14}},{"line":174,"address":[],"length":0,"stats":{"Line":6}},{"line":178,"address":[],"length":0,"stats":{"Line":14}},{"line":180,"address":[],"length":0,"stats":{"Line":14}},{"line":186,"address":[],"length":0,"stats":{"Line":14}},{"line":187,"address":[],"length":0,"stats":{"Line":18}},{"line":188,"address":[],"length":0,"stats":{"Line":2}},{"line":192,"address":[],"length":0,"stats":{"Line":50}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":18}},{"line":201,"address":[],"length":0,"stats":{"Line":18}},{"line":204,"address":[],"length":0,"stats":{"Line":36}},{"line":206,"address":[],"length":0,"stats":{"Line":18}},{"line":207,"address":[],"length":0,"stats":{"Line":36}},{"line":217,"address":[],"length":0,"stats":{"Line":18}},{"line":221,"address":[],"length":0,"stats":{"Line":14}},{"line":223,"address":[],"length":0,"stats":{"Line":14}},{"line":226,"address":[],"length":0,"stats":{"Line":14}},{"line":227,"address":[],"length":0,"stats":{"Line":14}},{"line":238,"address":[],"length":0,"stats":{"Line":6}},{"line":239,"address":[],"length":0,"stats":{"Line":12}},{"line":248,"address":[],"length":0,"stats":{"Line":6}},{"line":249,"address":[],"length":0,"stats":{"Line":6}},{"line":260,"address":[],"length":0,"stats":{"Line":12}},{"line":261,"address":[],"length":0,"stats":{"Line":24}},{"line":269,"address":[],"length":0,"stats":{"Line":12}},{"line":272,"address":[],"length":0,"stats":{"Line":40}},{"line":273,"address":[],"length":0,"stats":{"Line":28}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":14}},{"line":278,"address":[],"length":0,"stats":{"Line":14}},{"line":279,"address":[],"length":0,"stats":{"Line":14}},{"line":280,"address":[],"length":0,"stats":{"Line":14}},{"line":281,"address":[],"length":0,"stats":{"Line":14}},{"line":282,"address":[],"length":0,"stats":{"Line":28}},{"line":283,"address":[],"length":0,"stats":{"Line":12}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":12}},{"line":300,"address":[],"length":0,"stats":{"Line":8}},{"line":301,"address":[],"length":0,"stats":{"Line":16}},{"line":311,"address":[],"length":0,"stats":{"Line":8}},{"line":314,"address":[],"length":0,"stats":{"Line":44}},{"line":315,"address":[],"length":0,"stats":{"Line":36}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":18}},{"line":320,"address":[],"length":0,"stats":{"Line":18}},{"line":321,"address":[],"length":0,"stats":{"Line":18}},{"line":322,"address":[],"length":0,"stats":{"Line":18}},{"line":323,"address":[],"length":0,"stats":{"Line":18}},{"line":324,"address":[],"length":0,"stats":{"Line":40}},{"line":325,"address":[],"length":0,"stats":{"Line":22}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":8}},{"line":338,"address":[],"length":0,"stats":{"Line":16}},{"line":339,"address":[],"length":0,"stats":{"Line":32}},{"line":347,"address":[],"length":0,"stats":{"Line":58}},{"line":348,"address":[],"length":0,"stats":{"Line":84}},{"line":352,"address":[],"length":0,"stats":{"Line":16}},{"line":363,"address":[],"length":0,"stats":{"Line":40}},{"line":364,"address":[],"length":0,"stats":{"Line":80}},{"line":365,"address":[],"length":0,"stats":{"Line":2}},{"line":366,"address":[],"length":0,"stats":{"Line":2}},{"line":367,"address":[],"length":0,"stats":{"Line":2}},{"line":368,"address":[],"length":0,"stats":{"Line":2}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":38}},{"line":377,"address":[],"length":0,"stats":{"Line":4}},{"line":378,"address":[],"length":0,"stats":{"Line":4}},{"line":379,"address":[],"length":0,"stats":{"Line":4}},{"line":381,"address":[],"length":0,"stats":{"Line":34}},{"line":382,"address":[],"length":0,"stats":{"Line":34}},{"line":383,"address":[],"length":0,"stats":{"Line":34}},{"line":384,"address":[],"length":0,"stats":{"Line":34}},{"line":388,"address":[],"length":0,"stats":{"Line":80}},{"line":389,"address":[],"length":0,"stats":{"Line":40}},{"line":390,"address":[],"length":0,"stats":{"Line":6}},{"line":392,"address":[],"length":0,"stats":{"Line":34}},{"line":397,"address":[],"length":0,"stats":{"Line":1308}},{"line":398,"address":[],"length":0,"stats":{"Line":1268}},{"line":401,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":634}},{"line":403,"address":[],"length":0,"stats":{"Line":634}},{"line":404,"address":[],"length":0,"stats":{"Line":634}},{"line":405,"address":[],"length":0,"stats":{"Line":634}},{"line":406,"address":[],"length":0,"stats":{"Line":634}},{"line":407,"address":[],"length":0,"stats":{"Line":1276}},{"line":408,"address":[],"length":0,"stats":{"Line":18}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":40}},{"line":424,"address":[],"length":0,"stats":{"Line":60}},{"line":426,"address":[],"length":0,"stats":{"Line":120}},{"line":432,"address":[],"length":0,"stats":{"Line":52}},{"line":433,"address":[],"length":0,"stats":{"Line":52}},{"line":434,"address":[],"length":0,"stats":{"Line":52}},{"line":435,"address":[],"length":0,"stats":{"Line":52}},{"line":436,"address":[],"length":0,"stats":{"Line":52}},{"line":437,"address":[],"length":0,"stats":{"Line":52}},{"line":441,"address":[],"length":0,"stats":{"Line":52}},{"line":443,"address":[],"length":0,"stats":{"Line":52}},{"line":451,"address":[],"length":0,"stats":{"Line":52}},{"line":452,"address":[],"length":0,"stats":{"Line":144}},{"line":453,"address":[],"length":0,"stats":{"Line":46}},{"line":457,"address":[],"length":0,"stats":{"Line":52}},{"line":458,"address":[],"length":0,"stats":{"Line":52}},{"line":459,"address":[],"length":0,"stats":{"Line":52}},{"line":460,"address":[],"length":0,"stats":{"Line":52}},{"line":461,"address":[],"length":0,"stats":{"Line":52}},{"line":462,"address":[],"length":0,"stats":{"Line":52}},{"line":463,"address":[],"length":0,"stats":{"Line":52}},{"line":466,"address":[],"length":0,"stats":{"Line":8}},{"line":477,"address":[],"length":0,"stats":{"Line":18}},{"line":478,"address":[],"length":0,"stats":{"Line":18}},{"line":479,"address":[],"length":0,"stats":{"Line":2}},{"line":482,"address":[],"length":0,"stats":{"Line":16}},{"line":498,"address":[],"length":0,"stats":{"Line":0}},{"line":499,"address":[],"length":0,"stats":{"Line":16}},{"line":504,"address":[],"length":0,"stats":{"Line":16}},{"line":506,"address":[],"length":0,"stats":{"Line":16}},{"line":510,"address":[],"length":0,"stats":{"Line":28}},{"line":517,"address":[],"length":0,"stats":{"Line":12}},{"line":519,"address":[],"length":0,"stats":{"Line":6}},{"line":520,"address":[],"length":0,"stats":{"Line":12}},{"line":530,"address":[],"length":0,"stats":{"Line":16}},{"line":531,"address":[],"length":0,"stats":{"Line":16}},{"line":541,"address":[],"length":0,"stats":{"Line":18}},{"line":542,"address":[],"length":0,"stats":{"Line":36}},{"line":551,"address":[],"length":0,"stats":{"Line":36}},{"line":553,"address":[],"length":0,"stats":{"Line":18}},{"line":557,"address":[],"length":0,"stats":{"Line":4}},{"line":561,"address":[],"length":0,"stats":{"Line":14}},{"line":566,"address":[],"length":0,"stats":{"Line":14}},{"line":567,"address":[],"length":0,"stats":{"Line":14}}],"covered":144,"coverable":158},{"path":["/","Users","ozan","Projects","command-vault","src","exec","mod.rs"],"content":"use std::io::{self, Write};\nuse std::process::Command as ProcessCommand;\nuse std::env;\nuse std::path::{Path, PathBuf};\nuse anyhow::Result;\nuse crossterm::terminal;\nuse dialoguer::{theme::ColorfulTheme, Input};\nuse crate::db::models::Command;\nuse crate::shell::hooks::detect_current_shell;\n\npub struct ExecutionContext {\n    pub command: String,\n    pub directory: String,\n    pub test_mode: bool,\n    pub debug_mode: bool,\n}\n\npub fn wrap_command(command: \u0026str, test_mode: bool) -\u003e String {\n    if test_mode {\n        command.to_string()\n    } else {\n        // For interactive mode, handle shell initialization\n        let shell_type = detect_current_shell();\n        let clean_command = command.trim_matches('\"').to_string();\n            \n        match shell_type.as_str() {\n            \"zsh\" =\u003e format!(\n                r#\"setopt no_global_rcs; if [ -f ~/.zshrc ]; then ZDOTDIR=~ source ~/.zshrc; fi; {}\"#,\n                clean_command\n            ),\n            \"fish\" =\u003e format!(\n                r#\"if test -f ~/.config/fish/config.fish; source ~/.config/fish/config.fish 2\u003e/dev/null; end; {}\"#,\n                clean_command\n            ),\n            \"bash\" | _ =\u003e format!(\n                r#\"if [ -f ~/.bashrc ]; then . ~/.bashrc \u003e/dev/null 2\u003e\u00261; fi; if [ -f ~/.bash_profile ]; then . ~/.bash_profile \u003e/dev/null 2\u003e\u00261; fi; {}\"#,\n                clean_command\n            ),\n        }\n    }\n}\n\nfn is_path_traversal_attempt(command: \u0026str, working_dir: \u0026Path) -\u003e bool {\n    // Check if the command contains path traversal attempts\n    if command.contains(\"..\") {\n        // Get the absolute path of the working directory\n        if let Ok(working_dir) = working_dir.canonicalize() {\n            // Try to resolve any path in the command relative to working_dir\n            let potential_path = working_dir.join(command);\n            if let Ok(resolved_path) = potential_path.canonicalize() {\n                // Check if the resolved path is outside the working directory\n                return !resolved_path.starts_with(working_dir);\n            }\n        }\n        // If we can't resolve the paths, assume it's a traversal attempt\n        return true;\n    }\n    false\n}\n\npub fn execute_shell_command(ctx: \u0026ExecutionContext) -\u003e Result\u003c()\u003e {\n    // Get the current shell\n    let shell = if cfg!(windows) {\n        String::from(\"cmd.exe\")\n    } else {\n        env::var(\"SHELL\").unwrap_or_else(|_| String::from(\"/bin/sh\"))\n    };\n\n    // Wrap the command for shell execution\n    let wrapped_command = wrap_command(\u0026ctx.command, ctx.test_mode);\n\n    // Check for directory traversal attempts\n    if is_path_traversal_attempt(\u0026wrapped_command, Path::new(\u0026ctx.directory)) {\n        return Err(anyhow::anyhow!(\"Directory traversal attempt detected\"));\n    }\n\n    // Create command with the appropriate shell\n    let mut command = ProcessCommand::new(\u0026shell);\n    \n    // In test mode, use simple shell execution\n    if ctx.test_mode {\n        command.args(\u0026[\"-c\", \u0026wrapped_command]);\n    } else {\n        // Use -i for all shells in interactive mode to ensure proper initialization\n        command.args(\u0026[\"-i\", \"-c\", \u0026wrapped_command]);\n    }\n    \n    // Set working directory\n    command.current_dir(\u0026ctx.directory);\n\n    if ctx.debug_mode {\n        println!(\"Full command: {:?}\", command);\n    }\n\n    // Disable raw mode only in interactive mode\n    if !ctx.test_mode {\n        let _ = terminal::disable_raw_mode();\n        // Reset cursor position\n        let mut stdout = io::stdout();\n        let _ = crossterm::execute!(\n            stdout,\n            crossterm::cursor::MoveTo(0, crossterm::cursor::position()?.1)\n        );\n        println!(); // Add a newline before command output\n    }\n\n    // Execute the command and capture output\n    let output = command.output()?;\n\n    // Handle command output\n    if !output.status.success() {\n        let stderr = String::from_utf8_lossy(\u0026output.stderr);\n        return Err(anyhow::anyhow!(\n            \"Command failed with status: {}. stderr: {}\",\n            output.status,\n            stderr\n        ));\n    }\n\n    // Print stdout\n    if !output.stdout.is_empty() {\n        let stdout_str = String::from_utf8_lossy(\u0026output.stdout);\n        print!(\"{}\", stdout_str);\n    }\n\n    // Print stderr\n    if !output.stderr.is_empty() {\n        let stderr_str = String::from_utf8_lossy(\u0026output.stderr);\n        eprint!(\"{}\", stderr_str);\n    }\n\n    Ok(())\n}\n\npub fn execute_command(command: \u0026Command) -\u003e Result\u003c()\u003e {\n    let test_mode = std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    let debug_mode = std::env::var(\"COMMAND_VAULT_DEBUG\").is_ok();\n    let mut final_command = command.command.clone();\n\n    // If command has parameters, prompt for values first\n    if !command.parameters.is_empty() {\n        for param in \u0026command.parameters {\n            println!(\"Parameter: {}\", param.name);\n            println!();\n\n            let value = if test_mode {\n                let value = std::env::var(\"COMMAND_VAULT_TEST_INPUT\")\n                    .unwrap_or_else(|_| \"test_value\".to_string());\n                println!(\"Enter value: {}\", value);\n                println!();\n                value\n            } else {\n                let input: String = Input::with_theme(\u0026ColorfulTheme::default())\n                    .with_prompt(\"Enter value\")\n                    .allow_empty(true)\n                    .interact_text()?;\n                println!();\n                \n                if input.contains(' ') {\n                    format!(\"'{}'\", input.replace(\"'\", \"'\\\\''\"))\n                } else {\n                    input\n                }\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", param.name), \u0026value);\n        }\n    }\n\n    let ctx = ExecutionContext {\n        command: final_command,\n        directory: command.directory.clone(),\n        test_mode,\n        debug_mode,\n    };\n\n    // Print command details only once\n    println!(\"─────────────────────────────────────────────\");\n    println!();\n    println!(\"Command to execute: {}\", ctx.command);\n    println!(\"Working directory: {}\", ctx.directory);\n    println!();\n\n    execute_shell_command(\u0026ctx)\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":22}},{"line":19,"address":[],"length":0,"stats":{"Line":22}},{"line":20,"address":[],"length":0,"stats":{"Line":22}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":22}},{"line":45,"address":[],"length":0,"stats":{"Line":22}},{"line":47,"address":[],"length":0,"stats":{"Line":4}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":58,"address":[],"length":0,"stats":{"Line":20}},{"line":61,"address":[],"length":0,"stats":{"Line":22}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":22}},{"line":70,"address":[],"length":0,"stats":{"Line":22}},{"line":73,"address":[],"length":0,"stats":{"Line":22}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":78,"address":[],"length":0,"stats":{"Line":20}},{"line":81,"address":[],"length":0,"stats":{"Line":40}},{"line":82,"address":[],"length":0,"stats":{"Line":20}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":4}},{"line":92,"address":[],"length":0,"stats":{"Line":4}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":20}},{"line":112,"address":[],"length":0,"stats":{"Line":2}},{"line":113,"address":[],"length":0,"stats":{"Line":2}},{"line":114,"address":[],"length":0,"stats":{"Line":2}},{"line":115,"address":[],"length":0,"stats":{"Line":2}},{"line":116,"address":[],"length":0,"stats":{"Line":2}},{"line":121,"address":[],"length":0,"stats":{"Line":34}},{"line":122,"address":[],"length":0,"stats":{"Line":16}},{"line":123,"address":[],"length":0,"stats":{"Line":16}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":18}},{"line":135,"address":[],"length":0,"stats":{"Line":18}},{"line":136,"address":[],"length":0,"stats":{"Line":18}},{"line":137,"address":[],"length":0,"stats":{"Line":18}},{"line":138,"address":[],"length":0,"stats":{"Line":18}},{"line":141,"address":[],"length":0,"stats":{"Line":18}},{"line":142,"address":[],"length":0,"stats":{"Line":24}},{"line":146,"address":[],"length":0,"stats":{"Line":8}},{"line":147,"address":[],"length":0,"stats":{"Line":8}},{"line":148,"address":[],"length":0,"stats":{"Line":16}},{"line":149,"address":[],"length":0,"stats":{"Line":8}},{"line":150,"address":[],"length":0,"stats":{"Line":8}},{"line":151,"address":[],"length":0,"stats":{"Line":8}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":18}},{"line":178,"address":[],"length":0,"stats":{"Line":18}},{"line":179,"address":[],"length":0,"stats":{"Line":18}},{"line":180,"address":[],"length":0,"stats":{"Line":18}},{"line":181,"address":[],"length":0,"stats":{"Line":18}},{"line":182,"address":[],"length":0,"stats":{"Line":18}},{"line":184,"address":[],"length":0,"stats":{"Line":18}}],"covered":47,"coverable":73},{"path":["/","Users","ozan","Projects","command-vault","src","lib.rs"],"content":"pub mod cli;\npub mod db;\npub mod shell;\npub mod ui;\npub mod utils;\npub mod exec;\npub mod version;\n\npub use db::Database;\npub use version::VERSION;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","main.rs"],"content":"use anyhow::Result;\nuse clap::Parser;\nuse command_vault::{\n    cli::{args::Cli, commands::handle_command},\n    db::store::Database,\n};\nuse std::path::PathBuf;\n\nmod cli;\nmod db;\nmod shell;\nmod ui;\nmod utils;\nmod exec;\n\nfn main() -\u003e Result\u003c()\u003e {\n    // Enable colors globally\n    colored::control::set_override(true);\n    \n    let args = Cli::parse();\n    \n    let data_dir = dirs::data_dir()\n        .ok_or_else(|| anyhow::anyhow!(\"Could not find data directory\"))?\n        .join(\"command-vault\");\n    std::fs::create_dir_all(\u0026data_dir)?;\n    \n    let db_path = data_dir.join(\"commands.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n    \n    let result = handle_command(args.command, \u0026mut db, args.debug);\n    \n    // Re-enable colors before exiting\n    colored::control::set_override(true);\n    \n    result\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":11},{"path":["/","Users","ozan","Projects","command-vault","src","shell","hooks.rs"],"content":"use anyhow::{anyhow, Result};\nuse std::env;\nuse std::path::PathBuf;\n\n/// Get the directory containing shell integration scripts\npub fn get_shell_integration_dir() -\u003e PathBuf {\n    let mut path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n    path.push(\"shell\");\n    path\n}\n\n/// Get the path to the ZSH integration script\npub fn get_zsh_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"zsh-integration.zsh\");\n    path\n}\n\n/// Get the path to the Bash integration script\npub fn get_bash_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"bash-integration.sh\");\n    path\n}\n\n/// Get the path to the Fish integration script\npub fn get_fish_integration_path() -\u003e PathBuf {\n    let mut path = get_shell_integration_dir();\n    path.push(\"fish-integration.fish\");\n    path\n}\n\n/// Detect the current shell from environment variables\npub fn detect_current_shell() -\u003e String {\n    // First check for FISH_VERSION environment variable (highest priority)\n    if env::var(\"FISH_VERSION\").is_ok() {\n        return \"fish\".to_string();\n    }\n\n    // Then check SHELL environment variable\n    if let Ok(shell_path) = env::var(\"SHELL\") {\n        let shell_path = shell_path.to_lowercase();\n        \n        // Check for fish first (to match FISH_VERSION priority)\n        if shell_path.contains(\"fish\") {\n            return \"fish\".to_string();\n        }\n        \n        // Then check for other shells\n        if shell_path.contains(\"zsh\") {\n            return \"zsh\".to_string();\n        }\n        if shell_path.contains(\"bash\") {\n            return \"bash\".to_string();\n        }\n    }\n\n    // Default to bash if no shell is detected or unknown shell\n    \"bash\".to_string()\n}\n\n/// Get the shell integration script path for a specific shell\npub fn get_shell_integration_script(shell: \u0026str) -\u003e Result\u003cPathBuf\u003e {\n    let shell_lower = shell.to_lowercase();\n    match shell_lower.as_str() {\n        \"zsh\" =\u003e Ok(get_zsh_integration_path()),\n        \"bash\" =\u003e Ok(get_bash_integration_path()),\n        \"fish\" =\u003e Ok(get_fish_integration_path()),\n        _ =\u003e Err(anyhow!(\"Unsupported shell: {}\", shell)),\n    }\n}\n\n/// Initialize shell integration\npub fn init_shell(shell_override: Option\u003cString\u003e) -\u003e Result\u003cPathBuf\u003e {\n    let shell = if let Some(shell) = shell_override {\n        shell\n    } else {\n        detect_current_shell()\n    };\n\n    get_shell_integration_script(\u0026shell)\n}\n","traces":[{"line":6,"address":[],"length":0,"stats":{"Line":34}},{"line":7,"address":[],"length":0,"stats":{"Line":34}},{"line":8,"address":[],"length":0,"stats":{"Line":34}},{"line":9,"address":[],"length":0,"stats":{"Line":34}},{"line":13,"address":[],"length":0,"stats":{"Line":10}},{"line":14,"address":[],"length":0,"stats":{"Line":10}},{"line":15,"address":[],"length":0,"stats":{"Line":10}},{"line":16,"address":[],"length":0,"stats":{"Line":10}},{"line":20,"address":[],"length":0,"stats":{"Line":10}},{"line":21,"address":[],"length":0,"stats":{"Line":10}},{"line":22,"address":[],"length":0,"stats":{"Line":10}},{"line":23,"address":[],"length":0,"stats":{"Line":10}},{"line":27,"address":[],"length":0,"stats":{"Line":10}},{"line":28,"address":[],"length":0,"stats":{"Line":10}},{"line":29,"address":[],"length":0,"stats":{"Line":10}},{"line":30,"address":[],"length":0,"stats":{"Line":10}},{"line":34,"address":[],"length":0,"stats":{"Line":28}},{"line":36,"address":[],"length":0,"stats":{"Line":28}},{"line":37,"address":[],"length":0,"stats":{"Line":8}},{"line":41,"address":[],"length":0,"stats":{"Line":18}},{"line":46,"address":[],"length":0,"stats":{"Line":10}},{"line":50,"address":[],"length":0,"stats":{"Line":8}},{"line":51,"address":[],"length":0,"stats":{"Line":4}},{"line":53,"address":[],"length":0,"stats":{"Line":4}},{"line":54,"address":[],"length":0,"stats":{"Line":4}},{"line":59,"address":[],"length":0,"stats":{"Line":2}},{"line":63,"address":[],"length":0,"stats":{"Line":24}},{"line":64,"address":[],"length":0,"stats":{"Line":24}},{"line":65,"address":[],"length":0,"stats":{"Line":24}},{"line":66,"address":[],"length":0,"stats":{"Line":30}},{"line":67,"address":[],"length":0,"stats":{"Line":24}},{"line":68,"address":[],"length":0,"stats":{"Line":18}},{"line":69,"address":[],"length":0,"stats":{"Line":6}},{"line":74,"address":[],"length":0,"stats":{"Line":14}},{"line":75,"address":[],"length":0,"stats":{"Line":38}},{"line":78,"address":[],"length":0,"stats":{"Line":4}},{"line":81,"address":[],"length":0,"stats":{"Line":14}}],"covered":37,"coverable":37},{"path":["/","Users","ozan","Projects","command-vault","src","shell","mod.rs"],"content":"pub mod hooks;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","ui","add.rs"],"content":"use std::io::Stdout;\nuse anyhow::Result;\nuse crossterm::{\n    event::{self, Event, KeyCode, KeyModifiers, KeyEvent},\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    layout::{Constraint, Direction, Layout, Rect},\n    style::{Color, Style},\n    widgets::{Block, Borders, Paragraph, Clear},\n    Terminal,\n};\n\n/// Type alias for the command result tuple\npub type CommandResult = Option\u003c(String, Vec\u003cString\u003e, Option\u003ci32\u003e)\u003e;\n\n#[derive(Default)]\npub struct AddCommandApp {\n    /// The command being entered\n    pub command: String,\n    /// Tags for the command\n    pub tags: Vec\u003cString\u003e,\n    /// Current tag being entered\n    pub current_tag: String,\n    /// Current cursor position in the command\n    pub command_cursor: usize,\n    /// Current line in multi-line command\n    pub command_line: usize,\n    /// Current input mode\n    pub input_mode: InputMode,\n    /// Suggested tags\n    pub suggested_tags: Vec\u003cString\u003e,\n    /// Previous input mode (for returning from help)\n    pub previous_mode: InputMode,\n}\n\n#[derive(Debug, Clone, PartialEq, Default)]\npub enum InputMode {\n    #[default]\n    Command,\n    Tag,\n    Confirm,\n    Help,\n}\n\nimpl AddCommandApp {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    pub fn run(\u0026mut self) -\u003e Result\u003cCommandResult\u003e {\n        let mut terminal = setup_terminal()?;\n        let result = self.run_app(\u0026mut terminal);\n        restore_terminal(\u0026mut terminal)?;\n        result\n    }\n\n    fn run_app(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cCommandResult\u003e {\n        loop {\n            terminal.draw(|f| self.ui(f))?;\n\n            if let Event::Key(key) = event::read()? {\n                match self.input_mode {\n                    InputMode::Help =\u003e match key.code {\n                        KeyCode::Char('?') | KeyCode::Esc =\u003e {\n                            self.input_mode = self.previous_mode.clone();\n                        }\n                        _ =\u003e {}\n                    },\n                    _ =\u003e match key.code {\n                        KeyCode::Char('?') =\u003e {\n                            eprintln!(\"Debug: ? key pressed, switching to help mode\");\n                            self.previous_mode = self.input_mode.clone();\n                            self.input_mode = InputMode::Help;\n                            eprintln!(\"Debug: Input mode is now Help\");\n                        }\n                        _ =\u003e match self.input_mode {\n                            InputMode::Command =\u003e match key.code {\n                                KeyCode::Enter =\u003e {\n                                    if key.modifiers.contains(KeyModifiers::SHIFT) {\n                                        // Add newline to command\n                                        self.command.insert(self.command_cursor, '\\n');\n                                        self.command_cursor += 1;\n                                        self.command_line += 1;\n                                    } else {\n                                        if !self.command.is_empty() {\n                                            self.suggest_tags();\n                                            self.input_mode = InputMode::Tag;\n                                        }\n                                    }\n                                }\n                                KeyCode::Char(c) =\u003e {\n                                    self.command.insert(self.command_cursor, c);\n                                    self.command_cursor += 1;\n                                }\n                                KeyCode::Backspace =\u003e {\n                                    if self.command_cursor \u003e 0 {\n                                        self.command.remove(self.command_cursor - 1);\n                                        self.command_cursor -= 1;\n                                        if self.command_cursor \u003e 0 \u0026\u0026 self.command.chars().nth(self.command_cursor - 1) == Some('\\n') {\n                                            self.command_line -= 1;\n                                        }\n                                    }\n                                }\n                                KeyCode::Left =\u003e {\n                                    if self.command_cursor \u003e 0 {\n                                        self.command_cursor -= 1;\n                                        if self.command_cursor \u003e 0 \u0026\u0026 self.command.chars().nth(self.command_cursor - 1) == Some('\\n') {\n                                            self.command_line -= 1;\n                                        }\n                                    }\n                                }\n                                KeyCode::Right =\u003e {\n                                    if self.command_cursor \u003c self.command.len() {\n                                        if self.command.chars().nth(self.command_cursor) == Some('\\n') {\n                                            self.command_line += 1;\n                                        }\n                                        self.command_cursor += 1;\n                                    }\n                                }\n                                KeyCode::Up =\u003e {\n                                    // Move cursor to previous line\n                                    let current_line_start = self.command[..self.command_cursor]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1)\n                                        .unwrap_or(0);\n                                    if let Some(prev_line_start) = self.command[..current_line_start.saturating_sub(1)]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1) {\n                                        let column = self.command_cursor - current_line_start;\n                                        self.command_cursor = prev_line_start + column.min(\n                                            self.command[prev_line_start..current_line_start.saturating_sub(1)]\n                                                .chars()\n                                                .count(),\n                                        );\n                                        self.command_line -= 1;\n                                    }\n                                }\n                                KeyCode::Down =\u003e {\n                                    // Move cursor to next line\n                                    let current_line_start = self.command[..self.command_cursor]\n                                        .rfind('\\n')\n                                        .map(|pos| pos + 1)\n                                        .unwrap_or(0);\n                                    if let Some(next_line_start) = self.command[self.command_cursor..]\n                                        .find('\\n')\n                                        .map(|pos| self.command_cursor + pos + 1) {\n                                        let column = self.command_cursor - current_line_start;\n                                        let next_line_end = self.command[next_line_start..]\n                                            .find('\\n')\n                                            .map(|pos| next_line_start + pos)\n                                            .unwrap_or_else(|| self.command.len());\n                                        self.command_cursor = next_line_start + column.min(next_line_end - next_line_start);\n                                        self.command_line += 1;\n                                    }\n                                }\n                                KeyCode::Esc =\u003e {\n                                    return Ok(None);\n                                }\n                                _ =\u003e {}\n                            },\n                            InputMode::Tag =\u003e {\n                                match key.code {\n                                    KeyCode::Enter =\u003e {\n                                        if !self.current_tag.is_empty() {\n                                            self.tags.push(self.current_tag.clone());\n                                            self.current_tag.clear();\n                                        } else {\n                                            self.input_mode = InputMode::Confirm;\n                                        }\n                                    }\n                                    KeyCode::Char(c) =\u003e {\n                                        self.current_tag.push(c);\n                                    }\n                                    KeyCode::Backspace =\u003e {\n                                        self.current_tag.pop();\n                                    }\n                                    KeyCode::Tab =\u003e {\n                                        if !self.suggested_tags.is_empty() {\n                                            self.tags.push(self.suggested_tags[0].clone());\n                                            self.suggested_tags.remove(0);\n                                        }\n                                    }\n                                    KeyCode::Esc =\u003e {\n                                        self.input_mode = InputMode::Command;\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            InputMode::Confirm =\u003e {\n                                match key.code {\n                                    KeyCode::Char('y') =\u003e {\n                                        return Ok(Some((\n                                            self.command.clone(),\n                                            self.tags.clone(),\n                                            None,\n                                        )));\n                                    }\n                                    KeyCode::Char('n') | KeyCode::Esc =\u003e {\n                                        return Ok(None);\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    pub fn set_command(\u0026mut self, command: String) {\n        self.command = command;\n        self.command_cursor = self.command.len();\n    }\n\n    pub fn set_tags(\u0026mut self, tags: Vec\u003cString\u003e) {\n        self.tags = tags;\n    }\n\n    fn ui(\u0026self, f: \u0026mut ratatui::Frame) {\n        match self.input_mode {\n            InputMode::Help =\u003e {\n                let help_text = vec![\n                    \"Command Vault Help\",\n                    \"\",\n                    \"Global Commands:\",\n                    \"  ?      - Toggle this help screen\",\n                    \"  Esc    - Go back / Cancel\",\n                    \"\",\n                    \"Command Input Mode:\",\n                    \"  Enter        - Continue to tag input\",\n                    \"  Shift+Enter  - Add new line\",\n                    \"  ←/→         - Move cursor\",\n                    \"  ↑/↓         - Navigate between lines\",\n                    \"\",\n                    \"Tag Input Mode:\",\n                    \"  Enter  - Add tag\",\n                    \"  Tab    - Show tag suggestions\",\n                    \"\",\n                    \"Confirmation Mode:\",\n                    \"  y/Y    - Save command\",\n                    \"  n/N    - Cancel\",\n                ];\n\n                let help_paragraph = Paragraph::new(help_text.join(\"\\n\"))\n                    .style(Style::default().fg(Color::White))\n                    .block(Block::default().borders(Borders::ALL).title(\"Help (press ? or Esc to close)\"));\n\n                // Center the help window\n                let area = centered_rect(60, 80, f.size());\n                f.render_widget(Clear, area); // Clear the background\n                f.render_widget(help_paragraph, area);\n            }\n            _ =\u003e {\n                let chunks = Layout::default()\n                    .direction(Direction::Vertical)\n                    .margin(1)\n                    .constraints([\n                        Constraint::Length(3),  // Title\n                        Constraint::Min(5),     // Command input\n                        Constraint::Length(3),  // Tags input\n                        Constraint::Min(0),     // Message/Help\n                    ])\n                    .split(f.size());\n\n                // Title\n                let title = Paragraph::new(\"Add Command\")\n                    .style(Style::default().fg(Color::Cyan))\n                    .block(Block::default().borders(Borders::ALL));\n                f.render_widget(title, chunks[0]);\n\n                // Command input\n                let mut command_text = self.command.clone();\n                if self.input_mode == InputMode::Command {\n                    command_text.insert(self.command_cursor, '│'); // Add cursor\n                }\n                let command_input = Paragraph::new(command_text)\n                    .style(Style::default().fg(if self.input_mode == InputMode::Command {\n                        Color::Yellow\n                    } else {\n                        Color::Gray\n                    }))\n                    .block(Block::default().borders(Borders::ALL).title(\"Command (Shift+Enter for new line)\"))\n                    .wrap(ratatui::widgets::Wrap { trim: false });\n                f.render_widget(command_input, chunks[1]);\n\n                // Tags input\n                let mut tags_text = self.tags.join(\", \");\n                if !tags_text.is_empty() {\n                    tags_text.push_str(\", \");\n                }\n                tags_text.push_str(\u0026self.current_tag);\n                if self.input_mode == InputMode::Tag {\n                    tags_text.push('│');\n                }\n                let tags_input = Paragraph::new(tags_text)\n                    .style(Style::default().fg(if self.input_mode == InputMode::Tag {\n                        Color::Yellow\n                    } else {\n                        Color::Gray\n                    }))\n                    .block(Block::default().borders(Borders::ALL).title(\"Tags\"));\n                f.render_widget(tags_input, chunks[2]);\n\n                // Help text or confirmation prompt\n                let help_text = match self.input_mode {\n                    InputMode::Command =\u003e \"Press ? for help\",\n                    InputMode::Tag =\u003e \"Press ? for help\",\n                    InputMode::Confirm =\u003e \"Save command? (y/n)\",\n                    InputMode::Help =\u003e unreachable!(),\n                };\n                let help = Paragraph::new(help_text)\n                    .style(Style::default().fg(Color::White))\n                    .block(Block::default().borders(Borders::ALL));\n                f.render_widget(help, chunks[3]);\n            }\n        }\n    }\n\n    fn suggest_tags(\u0026mut self) {\n        self.suggested_tags.clear();\n        \n        // Simple tag suggestions based on command content\n        let command = self.command.to_lowercase();\n        \n        if command.contains(\"git\") {\n            self.suggested_tags.push(\"git\".to_string());\n            if command.contains(\"push\") {\n                self.suggested_tags.push(\"push\".to_string());\n            }\n            if command.contains(\"pull\") {\n                self.suggested_tags.push(\"pull\".to_string());\n            }\n        }\n        \n        if command.contains(\"docker\") {\n            self.suggested_tags.push(\"docker\".to_string());\n        }\n        \n        if command.contains(\"cargo\") {\n            self.suggested_tags.push(\"rust\".to_string());\n            self.suggested_tags.push(\"cargo\".to_string());\n        }\n        \n        if command.contains(\"npm\") || command.contains(\"yarn\") {\n            self.suggested_tags.push(\"javascript\".to_string());\n            self.suggested_tags.push(\"node\".to_string());\n        }\n    }\n\n    pub fn handle_key_event(\u0026mut self, key: KeyEvent) {\n        match self.input_mode {\n            InputMode::Help =\u003e match key.code {\n                KeyCode::Char('?') | KeyCode::Esc =\u003e {\n                    self.input_mode = self.previous_mode.clone();\n                }\n                _ =\u003e {}\n            },\n            _ =\u003e match key.code {\n                KeyCode::Char('?') =\u003e {\n                    self.previous_mode = self.input_mode.clone();\n                    self.input_mode = InputMode::Help;\n                }\n                _ =\u003e match self.input_mode {\n                    InputMode::Command =\u003e match key.code {\n                        KeyCode::Char(c) =\u003e {\n                            self.command.insert(self.command_cursor, c);\n                            self.command_cursor += 1;\n                        }\n                        KeyCode::Backspace =\u003e {\n                            if self.command_cursor \u003e 0 {\n                                self.command.remove(self.command_cursor - 1);\n                                self.command_cursor -= 1;\n                            }\n                        }\n                        KeyCode::Left =\u003e {\n                            if self.command_cursor \u003e 0 {\n                                self.command_cursor -= 1;\n                            }\n                        }\n                        KeyCode::Right =\u003e {\n                            if self.command_cursor \u003c self.command.len() {\n                                self.command_cursor += 1;\n                            }\n                        }\n                        KeyCode::Enter =\u003e {\n                            if key.modifiers.contains(KeyModifiers::SHIFT) {\n                                self.command.insert(self.command_cursor, '\\n');\n                                self.command_cursor += 1;\n                                self.command_line += 1;\n                            } else if !self.command.is_empty() {\n                                self.input_mode = InputMode::Tag;\n                            }\n                        }\n                        _ =\u003e {}\n                    },\n                    InputMode::Tag =\u003e match key.code {\n                        KeyCode::Char(c) =\u003e {\n                            self.current_tag.push(c);\n                        }\n                        KeyCode::Enter =\u003e {\n                            if !self.current_tag.is_empty() {\n                                self.tags.push(self.current_tag.clone());\n                                self.current_tag.clear();\n                            }\n                        }\n                        _ =\u003e {}\n                    },\n                    _ =\u003e {}\n                }\n            }\n        }\n    }\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = std::io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    let mut terminal = Terminal::new(backend)?;\n    terminal.hide_cursor()?;\n    Ok(terminal)\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    terminal.show_cursor()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    disable_raw_mode()?;\n    Ok(())\n}\n\nfn centered_rect(percent_x: u16, percent_y: u16, r: Rect) -\u003e Rect {\n    let popup_layout = Layout::default()\n        .direction(Direction::Vertical)\n        .constraints([\n            Constraint::Percentage((100 - percent_y) / 2),\n            Constraint::Percentage(percent_y),\n            Constraint::Percentage((100 - percent_y) / 2),\n        ])\n        .split(r);\n\n    Layout::default()\n        .direction(Direction::Horizontal)\n        .constraints([\n            Constraint::Percentage((100 - percent_x) / 2),\n            Constraint::Percentage(percent_x),\n            Constraint::Percentage((100 - percent_x) / 2),\n        ])\n        .split(popup_layout[1])[1]\n}\n","traces":[{"line":49,"address":[],"length":0,"stats":{"Line":22}},{"line":50,"address":[],"length":0,"stats":{"Line":22}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":6}},{"line":216,"address":[],"length":0,"stats":{"Line":6}},{"line":217,"address":[],"length":0,"stats":{"Line":6}},{"line":220,"address":[],"length":0,"stats":{"Line":4}},{"line":221,"address":[],"length":0,"stats":{"Line":4}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":48}},{"line":356,"address":[],"length":0,"stats":{"Line":48}},{"line":357,"address":[],"length":0,"stats":{"Line":6}},{"line":358,"address":[],"length":0,"stats":{"Line":6}},{"line":359,"address":[],"length":0,"stats":{"Line":6}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":42}},{"line":364,"address":[],"length":0,"stats":{"Line":6}},{"line":365,"address":[],"length":0,"stats":{"Line":6}},{"line":366,"address":[],"length":0,"stats":{"Line":6}},{"line":368,"address":[],"length":0,"stats":{"Line":36}},{"line":369,"address":[],"length":0,"stats":{"Line":28}},{"line":370,"address":[],"length":0,"stats":{"Line":16}},{"line":371,"address":[],"length":0,"stats":{"Line":16}},{"line":372,"address":[],"length":0,"stats":{"Line":16}},{"line":375,"address":[],"length":0,"stats":{"Line":4}},{"line":376,"address":[],"length":0,"stats":{"Line":2}},{"line":377,"address":[],"length":0,"stats":{"Line":2}},{"line":381,"address":[],"length":0,"stats":{"Line":4}},{"line":382,"address":[],"length":0,"stats":{"Line":2}},{"line":386,"address":[],"length":0,"stats":{"Line":4}},{"line":387,"address":[],"length":0,"stats":{"Line":2}},{"line":391,"address":[],"length":0,"stats":{"Line":10}},{"line":392,"address":[],"length":0,"stats":{"Line":4}},{"line":393,"address":[],"length":0,"stats":{"Line":4}},{"line":394,"address":[],"length":0,"stats":{"Line":4}},{"line":395,"address":[],"length":0,"stats":{"Line":8}},{"line":396,"address":[],"length":0,"stats":{"Line":2}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":401,"address":[],"length":0,"stats":{"Line":8}},{"line":402,"address":[],"length":0,"stats":{"Line":6}},{"line":403,"address":[],"length":0,"stats":{"Line":6}},{"line":406,"address":[],"length":0,"stats":{"Line":4}},{"line":407,"address":[],"length":0,"stats":{"Line":2}},{"line":408,"address":[],"length":0,"stats":{"Line":2}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":422,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":439,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":442,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[],"length":0,"stats":{"Line":0}},{"line":449,"address":[],"length":0,"stats":{"Line":0}},{"line":450,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":454,"address":[],"length":0,"stats":{"Line":0}}],"covered":40,"coverable":225},{"path":["/","Users","ozan","Projects","command-vault","src","ui","app.rs"],"content":"use std::io::{self, Stdout};\nuse anyhow::Result;\nuse crossterm::{\n    event::{self, Event, KeyCode, KeyModifiers},\n    execute,\n    terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},\n};\nuse ratatui::{\n    backend::CrosstermBackend,\n    Terminal,\n    layout::{Constraint, Direction, Layout, Rect},\n    style::{Color, Modifier, Style},\n    text::{Line, Span},\n    widgets::{Block, Borders, Clear, List, ListItem, Paragraph},\n};\nuse crate::db::{Command, Database};\nuse crate::utils::params::{substitute_parameters, parse_parameters};\nuse crate::exec::{ExecutionContext, execute_shell_command};\nuse crate::ui::AddCommandApp;\n\npub struct App\u003c'a\u003e {\n    pub commands: Vec\u003cCommand\u003e,\n    pub selected: Option\u003cusize\u003e,\n    pub show_help: bool,\n    pub message: Option\u003c(String, Color)\u003e,\n    pub filter_text: String,\n    pub filtered_commands: Vec\u003cusize\u003e,\n    pub db: \u0026'a mut Database,\n    pub confirm_delete: Option\u003cusize\u003e, // Index of command pending deletion\n    pub debug_mode: bool,\n}\n\nimpl\u003c'a\u003e App\u003c'a\u003e {\n    pub fn new(commands: Vec\u003cCommand\u003e, db: \u0026'a mut Database, debug_mode: bool) -\u003e App\u003c'a\u003e {\n        let filtered_commands: Vec\u003cusize\u003e = (0..commands.len()).collect();\n        App {\n            commands,\n            selected: None,\n            show_help: false,\n            message: None,\n            filter_text: String::new(),\n            filtered_commands,\n            db,\n            confirm_delete: None,\n            debug_mode,\n        }\n    }\n\n    pub fn run(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let mut terminal = setup_terminal()?;\n        let res = self.run_app(\u0026mut terminal);\n        restore_terminal(\u0026mut terminal)?;\n        res\n    }\n\n    fn run_app(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        loop {\n            terminal.draw(|f| self.ui(f))?;\n\n            if let Event::Key(key) = event::read()? {\n                if let Some(()) = self.handle_key_event(terminal, key)? {\n                    return Ok(());\n                }\n            }\n        }\n    }\n\n    fn handle_key_event(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e, key: event::KeyEvent) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        match key.code {\n            KeyCode::Char('q') =\u003e self.handle_quit(),\n            KeyCode::Char('c') if key.modifiers.contains(KeyModifiers::CONTROL) =\u003e Ok(Some(())),\n            KeyCode::Char('?') =\u003e self.handle_help_toggle(),\n            _ if self.show_help =\u003e Ok(None),\n            KeyCode::Char('c') | KeyCode::Char('y') =\u003e self.handle_copy(),\n            KeyCode::Enter =\u003e self.handle_enter(terminal),\n            KeyCode::Char('e') =\u003e self.handle_edit(terminal),\n            KeyCode::Down | KeyCode::Char('j') =\u003e self.handle_down(),\n            KeyCode::Up | KeyCode::Char('k') =\u003e self.handle_up(),\n            KeyCode::Char('/') =\u003e self.handle_filter_start(),\n            KeyCode::Char('d') =\u003e self.handle_delete(),\n            KeyCode::Char(c) =\u003e self.handle_char_input(c),\n            KeyCode::Backspace =\u003e self.handle_backspace(),\n            KeyCode::Esc =\u003e self.handle_escape(),\n            _ =\u003e Ok(None)\n        }\n    }\n\n    pub fn handle_quit(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if !self.filter_text.is_empty() {\n            self.filter_text.clear();\n            self.update_filtered_commands();\n            Ok(None)\n        } else if self.confirm_delete.is_some() {\n            self.confirm_delete = None;\n            Ok(None)\n        } else if self.show_help {\n            self.show_help = false;\n            Ok(None)\n        } else {\n            Ok(Some(()))\n        }\n    }\n\n    fn handle_help_toggle(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.show_help = !self.show_help;\n        Ok(None)\n    }\n\n    fn handle_copy(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(cmd) = self.get_selected_command() {\n            copy_to_clipboard(\u0026cmd.command)?;\n            self.set_success_message(\"Command copied to clipboard!\".to_string());\n        }\n        Ok(None)\n    }\n\n    fn handle_enter(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(selected) = self.get_selection() {\n            if self.confirm_delete.is_some() {\n                self.delete_selected_command()?;\n                Ok(None)\n            } else {\n                self.execute_selected_command(terminal).map(Some)\n            }\n        } else {\n            Ok(None)\n        }\n    }\n\n    fn handle_edit(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.edit_selected_command(terminal)?;\n        Ok(None)\n    }\n\n    fn handle_down(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.select_next();\n        Ok(None)\n    }\n\n    fn handle_up(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.select_previous();\n        Ok(None)\n    }\n\n    fn handle_filter_start(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.clear_filter();\n        self.set_message(\"Type to filter commands...\".to_string(), Color::Blue);\n        Ok(None)\n    }\n\n    fn handle_delete(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(\u0026filtered_idx) = self.filtered_commands.get(selected) {\n                if let Some(_) = self.commands[filtered_idx].id {\n                    self.confirm_delete = Some(selected);\n                }\n            }\n        }\n        Ok(None)\n    }\n\n    fn handle_char_input(\u0026mut self, c: char) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if c == '/' {\n            self.clear_filter();\n            self.set_message(\"Type to filter commands...\".to_string(), Color::Blue);\n        } else if c != '/' {\n            self.append_to_filter(c);\n        }\n        Ok(None)\n    }\n\n    fn handle_backspace(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        self.backspace_filter();\n        Ok(None)\n    }\n\n    pub fn handle_escape(\u0026mut self) -\u003e Result\u003cOption\u003c()\u003e\u003e {\n        if !self.filter_text.is_empty() {\n            self.clear_filter();\n        } else if self.confirm_delete.is_some() {\n            self.confirm_delete = None;\n            self.set_message(\"Delete operation cancelled\".to_string(), Color::Yellow);\n        }\n        Ok(None)\n    }\n\n    pub fn clear_filter(\u0026mut self) {\n        self.filter_text.clear();\n        self.update_filtered_commands();\n    }\n\n    pub fn set_filter(\u0026mut self, text: String) {\n        self.filter_text = text;\n        self.update_filtered_commands();\n    }\n\n    pub fn append_to_filter(\u0026mut self, c: char) {\n        self.filter_text.push(c);\n        self.update_filtered_commands();\n    }\n\n    pub fn backspace_filter(\u0026mut self) {\n        if !self.filter_text.is_empty() {\n            self.filter_text.pop();\n            self.update_filtered_commands();\n        }\n    }\n\n    fn matches_filter(\u0026self, command: \u0026Command, search_term: \u0026str) -\u003e bool {\n        let search_term = search_term.to_lowercase();\n        command.command.to_lowercase().contains(\u0026search_term) ||\n        command.tags.iter().any(|tag| tag.to_lowercase().contains(\u0026search_term)) ||\n        command.directory.to_lowercase().contains(\u0026search_term)\n    }\n\n    pub fn update_filtered_commands(\u0026mut self) {\n        self.filtered_commands = (0..self.commands.len())\n            .filter(|\u0026i| self.matches_filter(\u0026self.commands[i], \u0026self.filter_text))\n            .collect::\u003cVec\u003cusize\u003e\u003e();\n        \n        self.update_selection_after_filter();\n    }\n\n    fn ui(\u0026mut self, f: \u0026mut ratatui::Frame) {\n        if self.show_help {\n            self.render_help_screen(f);\n            return;\n        }\n\n        let chunks = self.create_layout(f);\n        self.render_title(f, chunks[0]);\n        self.render_commands_list(f, chunks[1]);\n        self.render_filter(f, chunks[2]);\n        self.render_status_bar(f, chunks[3]);\n\n        if self.confirm_delete.is_some() {\n            self.render_delete_confirmation(f);\n        }\n    }\n\n    fn render_help_screen(\u0026self, f: \u0026mut ratatui::Frame) {\n        let help_text = vec![\n            \"Command Vault Help\",\n            \"\",\n            \"Navigation:\",\n            \"  ↑/k      - Move cursor up\",\n            \"  ↓/j      - Move cursor down\",\n            \"  q        - Quit (or clear filter/cancel delete/close help)\",\n            \"  Ctrl+c   - Force quit\",\n            \"\",\n            \"Command Actions:\",\n            \"  Enter    - Execute selected command\",\n            \"  c/y      - Copy command to clipboard\",\n            \"  e        - Edit selected command (text, tags, directory)\",\n            \"  d        - Delete selected command (requires confirmation)\",\n            \"\",\n            \"Search and Filter:\",\n            \"  /        - Start filtering commands\",\n            \"  [type]   - Filter by command text, tags, or directory\",\n            \"  Esc      - Clear filter or cancel current operation\",\n            \"  Backspace- Remove last character from filter\",\n            \"\",\n            \"Display:\",\n            \"  ?        - Toggle this help screen\",\n            \"\",\n            \"Command Format:\",\n            \"  - (@param) Parameters are shown with @ prefix\",\n            \"  - (#tag)  Tags are shown in green with # prefix\",\n            \"  - (dir)   Working directory is shown if set\",\n            \"  - (id)    Command IDs are shown in parentheses\",\n            \"\",\n            \"Tips:\",\n            \"  - Use descriptive tags to organize commands\",\n            \"  - Parameters (@param) allow dynamic input\",\n            \"  - Filter works on commands, tags, and directories\",\n            \"  - Working directory affects command execution\",\n            \"\",\n            \"Note:\",\n            \"  - Debug mode can be enabled for troubleshooting\",\n            \"  - All commands are executed in the current shell\",\n            \"  - Command history is preserved in the database\"\n        ];\n\n        let help_paragraph = Paragraph::new(help_text.join(\"\\n\"))\n            .style(Style::default().fg(Color::White))\n            .block(Block::default().borders(Borders::ALL).title(\"Help (press ? to close)\"));\n\n        let area = centered_rect(80, 80, f.size());\n        f.render_widget(Clear, area);\n        f.render_widget(help_paragraph, area);\n    }\n\n    fn create_layout(\u0026self, f: \u0026mut ratatui::Frame) -\u003e Vec\u003cRect\u003e {\n        Layout::default()\n            .direction(Direction::Vertical)\n            .margin(1)\n            .constraints([\n                Constraint::Length(3),  // Title\n                Constraint::Min(0),     // Commands list\n                Constraint::Length(1),  // Filter\n                Constraint::Length(3),  // Status bar\n            ])\n            .split(f.size())\n            .to_vec()\n    }\n\n    fn render_title(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let title = Paragraph::new(\"Command Vault\")\n            .style(Style::default().fg(Color::Cyan))\n            .block(Block::default().borders(Borders::ALL));\n        f.render_widget(title, area);\n    }\n\n    fn render_commands_list(\u0026mut self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let commands: Vec\u003cListItem\u003e = self.filtered_commands.iter()\n            .map(|\u0026i| {\n                let cmd = \u0026self.commands[i];\n                let local_time = cmd.timestamp.with_timezone(\u0026chrono::Local);\n                let time_str = local_time.format(\"%Y-%m-%d %H:%M:%S\").to_string();\n                \n                let mut spans = vec![\n                    Span::styled(\n                        format!(\"({}) \", cmd.id.unwrap_or(0)),\n                        Style::default().fg(Color::DarkGray)\n                    ),\n                    Span::styled(\n                        format!(\"[{}] \", time_str),\n                        Style::default().fg(Color::Yellow)\n                    ),\n                    Span::raw(\u0026cmd.command),\n                ];\n\n                if !cmd.tags.is_empty() {\n                    spans.push(Span::raw(\" \"));\n                    for tag in \u0026cmd.tags {\n                        spans.push(Span::styled(\n                            format!(\"#{} \", tag),\n                            Style::default().fg(Color::Green)\n                        ));\n                    }\n                }\n\n                ListItem::new(Line::from(spans))\n            })\n            .collect();\n\n        let commands = List::new(commands)\n            .block(Block::default().borders(Borders::ALL).title(\"Commands\"))\n            .highlight_style(Style::default().add_modifier(Modifier::REVERSED));\n        \n        let commands_state = self.selected.map(|i| {\n            let mut state = ratatui::widgets::ListState::default();\n            state.select(Some(i));\n            state\n        });\n\n        if let Some(state) = commands_state {\n            f.render_stateful_widget(commands, area, \u0026mut state.clone());\n        } else {\n            f.render_widget(commands, area);\n        }\n    }\n\n    fn render_filter(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        if !self.filter_text.is_empty() {\n            let filter = Paragraph::new(format!(\"Filter: {}\", self.filter_text))\n                .style(Style::default().fg(Color::Yellow));\n            f.render_widget(filter, area);\n        }\n    }\n\n    fn render_status_bar(\u0026self, f: \u0026mut ratatui::Frame, area: Rect) {\n        let status = if let Some((msg, color)) = \u0026self.message {\n            vec![Span::styled(msg, Style::default().fg(*color))]\n        } else if self.show_help {\n            vec![\n                Span::raw(\"Press \"),\n                Span::styled(\"q\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to quit, \"),\n                Span::styled(\"↑↓/jk\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to navigate, \"),\n                Span::styled(\"c\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" or \"),\n                Span::styled(\"y\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" to copy, \"),\n                Span::styled(\"?\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" for help\"),\n            ]\n        } else {\n            vec![\n                Span::raw(\"Press \"),\n                Span::styled(\"?\", Style::default().fg(Color::Yellow)),\n                Span::raw(\" for help\"),\n            ]\n        };\n\n        let status = Paragraph::new(Line::from(status))\n            .block(Block::default().borders(Borders::ALL));\n        f.render_widget(status, area);\n    }\n\n    fn render_delete_confirmation(\u0026self, f: \u0026mut ratatui::Frame) {\n        if let Some(idx) = self.confirm_delete {\n            if let Some(\u0026cmd_idx) = self.filtered_commands.get(idx) {\n                if let Some(cmd) = self.commands.get(cmd_idx) {\n                    let command_str = format!(\"Command: {}\", cmd.command);\n                    let id_str = format!(\"ID: {}\", cmd.id.unwrap_or(0));\n                    \n                    let dialog_text = vec![\n                        \"Are you sure you want to delete this command?\",\n                        \"\",\n                        \u0026command_str,\n                        \u0026id_str,\n                        \"\",\n                        \"Press Enter to confirm or Esc to cancel\",\n                    ];\n\n                    let dialog = Paragraph::new(dialog_text.join(\"\\n\"))\n                        .style(Style::default().fg(Color::White))\n                        .block(Block::default()\n                            .borders(Borders::ALL)\n                            .border_style(Style::default().fg(Color::Red))\n                            .title(\"Confirm Delete\"));\n\n                    let area = centered_rect(60, 40, f.size());\n                    f.render_widget(Clear, area);\n                    f.render_widget(dialog, area);\n                }\n            }\n        }\n    }\n\n    pub fn set_message(\u0026mut self, text: String, color: Color) {\n        self.message = Some((text, color));\n    }\n\n    pub fn clear_message(\u0026mut self) {\n        self.message = None;\n    }\n\n    pub fn set_success_message(\u0026mut self, text: String) {\n        self.set_message(text, Color::Green);\n    }\n\n    pub fn set_error_message(\u0026mut self, text: String) {\n        self.set_message(text, Color::Red);\n    }\n\n    pub fn get_selection(\u0026self) -\u003e Option\u003cusize\u003e {\n        self.selected\n    }\n\n    pub fn set_selection(\u0026mut self, index: Option\u003cusize\u003e) {\n        if let Some(idx) = index {\n            if idx \u003c self.filtered_commands.len() {\n                self.selected = Some(idx);\n            }\n        } else {\n            self.selected = None;\n        }\n    }\n\n    pub fn update_selection_after_filter(\u0026mut self) {\n        if self.filtered_commands.is_empty() {\n            self.selected = None;\n        } else if let Some(selected) = self.selected {\n            if selected \u003e= self.filtered_commands.len() {\n                self.selected = Some(self.filtered_commands.len() - 1);\n            }\n        }\n    }\n\n    pub fn update_selection_after_delete(\u0026mut self, deleted_index: usize) {\n        if self.filtered_commands.is_empty() {\n            self.selected = None;\n        } else if let Some(selected) = self.selected {\n            self.selected = Some(selected.min(self.filtered_commands.len() - 1));\n        }\n    }\n\n    pub fn select_next(\u0026mut self) {\n        if let Some(selected) = self.selected {\n            if selected \u003c self.filtered_commands.len() - 1 {\n                self.selected = Some(selected + 1);\n            }\n        } else if !self.filtered_commands.is_empty() {\n            self.selected = Some(0);\n        }\n    }\n\n    pub fn select_previous(\u0026mut self) {\n        if let Some(selected) = self.selected {\n            if selected \u003e 0 {\n                self.selected = Some(selected - 1);\n            }\n        } else if !self.filtered_commands.is_empty() {\n            self.selected = Some(self.filtered_commands.len() - 1);\n        }\n    }\n\n    pub fn get_selected_command(\u0026self) -\u003e Option\u003c\u0026Command\u003e {\n        self.selected\n            .and_then(|selected| self.filtered_commands.get(selected))\n            .and_then(|\u0026idx| self.commands.get(idx))\n    }\n\n    pub fn get_selected_index(\u0026self) -\u003e Option\u003cusize\u003e {\n        self.selected\n            .and_then(|selected| self.filtered_commands.get(selected))\n            .copied()\n    }\n\n    fn execute_selected_command(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        if let Some(cmd) = self.get_selected_command() {\n            // Exit TUI temporarily\n            restore_terminal(terminal)?;\n            \n            // Re-enable colors after restoring terminal\n            colored::control::set_override(true);\n\n            // If command has parameters, substitute them with user input\n            let current_params = parse_parameters(\u0026cmd.command);\n            let final_command = substitute_parameters(\u0026cmd.command, \u0026current_params, None)?;\n            let ctx = ExecutionContext {\n                command: final_command,\n                directory: cmd.directory.clone(),\n                test_mode: false,\n                debug_mode: self.debug_mode,\n            };\n            execute_shell_command(\u0026ctx)?;\n            \n            return Ok(());\n        }\n        Ok(())\n    }\n\n    fn delete_selected_command(\u0026mut self) -\u003e Result\u003c()\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(confirm_idx) = self.confirm_delete {\n                if confirm_idx == selected {\n                    if let Some(idx) = self.get_selected_index() {\n                        if let Some(command_id) = self.commands[idx].id {\n                            match self.db.delete_command(command_id) {\n                                Ok(_) =\u003e {\n                                    self.commands.remove(idx);\n                                    self.set_success_message(\"Command deleted successfully\".to_string());\n                                    self.update_filtered_commands();\n                                    self.update_selection_after_delete(idx);\n                                }\n                                Err(e) =\u003e {\n                                    self.set_error_message(format!(\"Failed to delete command: {}\", e));\n                                }\n                            }\n                            self.confirm_delete = None;\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n\n    fn edit_selected_command(\u0026mut self, terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n        if let Some(selected) = self.get_selection() {\n            if let Some(\u0026idx) = self.filtered_commands.get(selected) {\n                if let Some(cmd) = self.commands.get(idx).cloned() {\n                    // Exit TUI temporarily\n                    restore_terminal(terminal)?;\n                    \n                    // Create AddCommandApp with existing command data\n                    let mut add_app = AddCommandApp::new();\n                    add_app.set_command(cmd.command.clone());\n                    add_app.set_tags(cmd.tags.clone());\n                    \n                    let result = add_app.run();\n                    \n                    // Re-initialize terminal and force redraw\n                    let mut new_terminal = setup_terminal()?;\n                    new_terminal.clear()?;\n                    *terminal = new_terminal;\n                    terminal.draw(|f| self.ui(f))?;\n                    \n                    match result {\n                        Ok(Some((new_command, new_tags, _))) =\u003e {\n                            // Update command\n                            let updated_cmd = Command {\n                                id: cmd.id,\n                                command: new_command.clone(),\n                                timestamp: cmd.timestamp,\n                                directory: cmd.directory.clone(),\n                                tags: new_tags,\n                                parameters: crate::utils::params::parse_parameters(\u0026new_command),\n                            };\n                            \n                            if let Err(e) = self.db.update_command(\u0026updated_cmd) {\n                                self.set_error_message(format!(\"Failed to update command: {}\", e));\n                            } else {\n                                // Update local command list\n                                if let Some(cmd) = self.commands.get_mut(idx) {\n                                    *cmd = updated_cmd;\n                                }\n                                self.set_success_message(\"Command updated successfully!\".to_string());\n                            }\n                        }\n                        Ok(None) =\u003e {\n                            self.set_message(\"Edit cancelled\".to_string(), Color::Yellow);\n                        }\n                        Err(e) =\u003e {\n                            self.set_error_message(format!(\"Error during edit: {}\", e));\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n}\n\nfn centered_rect(percent_x: u16, percent_y: u16, r: Rect) -\u003e Rect {\n    // Calculate popup size based on percentage of screen size\n    let popup_width = (r.width as f32 * (percent_x as f32 / 100.0)) as u16;\n    let popup_height = (r.height as f32 * (percent_y as f32 / 100.0)) as u16;\n\n    // Calculate popup position to center it\n    let popup_x = ((r.width - popup_width) / 2) + r.x;\n    let popup_y = ((r.height - popup_height) / 2) + r.y;\n\n    Rect::new(popup_x, popup_y, popup_width, popup_height)\n}\n\nfn setup_terminal() -\u003e Result\u003cTerminal\u003cCrosstermBackend\u003cStdout\u003e\u003e\u003e {\n    enable_raw_mode()?;\n    let mut stdout = io::stdout();\n    execute!(stdout, EnterAlternateScreen)?;\n    let backend = CrosstermBackend::new(stdout);\n    let mut terminal = Terminal::new(backend)?;\n    terminal.hide_cursor()?;\n    Ok(terminal)\n}\n\nfn restore_terminal(terminal: \u0026mut Terminal\u003cCrosstermBackend\u003cStdout\u003e\u003e) -\u003e Result\u003c()\u003e {\n    terminal.show_cursor()?;\n    execute!(terminal.backend_mut(), LeaveAlternateScreen)?;\n    disable_raw_mode()?;\n    colored::control::set_override(true);\n    Ok(())\n}\n\npub fn copy_to_clipboard(text: \u0026str) -\u003e Result\u003c()\u003e {\n    #[cfg(target_os = \"macos\")]\n    {\n        use std::process::Command;\n        let mut child = Command::new(\"pbcopy\")\n            .stdin(std::process::Stdio::piped())\n            .spawn()?;\n        \n        if let Some(mut stdin) = child.stdin.take() {\n            use std::io::Write;\n            stdin.write_all(text.as_bytes())?;\n        }\n        \n        child.wait()?;\n    }\n    \n    #[cfg(target_os = \"linux\")]\n    {\n        use std::process::Command;\n        let mut child = Command::new(\"xclip\")\n            .arg(\"-selection\")\n            .arg(\"clipboard\")\n            .stdin(std::process::Stdio::piped())\n            .spawn()?;\n        \n        if let Some(mut stdin) = child.stdin.take() {\n            use std::io::Write;\n            stdin.write_all(text.as_bytes())?;\n        }\n        \n        child.wait()?;\n    }\n    \n    Ok(())\n}\n","traces":[{"line":34,"address":[],"length":0,"stats":{"Line":54}},{"line":35,"address":[],"length":0,"stats":{"Line":54}},{"line":41,"address":[],"length":0,"stats":{"Line":54}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":8}},{"line":89,"address":[],"length":0,"stats":{"Line":8}},{"line":90,"address":[],"length":0,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":2}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":93,"address":[],"length":0,"stats":{"Line":6}},{"line":94,"address":[],"length":0,"stats":{"Line":2}},{"line":95,"address":[],"length":0,"stats":{"Line":2}},{"line":96,"address":[],"length":0,"stats":{"Line":4}},{"line":97,"address":[],"length":0,"stats":{"Line":2}},{"line":98,"address":[],"length":0,"stats":{"Line":2}},{"line":100,"address":[],"length":0,"stats":{"Line":2}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":6}},{"line":178,"address":[],"length":0,"stats":{"Line":8}},{"line":179,"address":[],"length":0,"stats":{"Line":2}},{"line":180,"address":[],"length":0,"stats":{"Line":8}},{"line":181,"address":[],"length":0,"stats":{"Line":2}},{"line":182,"address":[],"length":0,"stats":{"Line":2}},{"line":184,"address":[],"length":0,"stats":{"Line":6}},{"line":187,"address":[],"length":0,"stats":{"Line":6}},{"line":188,"address":[],"length":0,"stats":{"Line":6}},{"line":189,"address":[],"length":0,"stats":{"Line":6}},{"line":192,"address":[],"length":0,"stats":{"Line":10}},{"line":193,"address":[],"length":0,"stats":{"Line":10}},{"line":194,"address":[],"length":0,"stats":{"Line":10}},{"line":197,"address":[],"length":0,"stats":{"Line":12}},{"line":198,"address":[],"length":0,"stats":{"Line":12}},{"line":199,"address":[],"length":0,"stats":{"Line":12}},{"line":202,"address":[],"length":0,"stats":{"Line":8}},{"line":203,"address":[],"length":0,"stats":{"Line":16}},{"line":204,"address":[],"length":0,"stats":{"Line":8}},{"line":205,"address":[],"length":0,"stats":{"Line":8}},{"line":209,"address":[],"length":0,"stats":{"Line":224}},{"line":210,"address":[],"length":0,"stats":{"Line":224}},{"line":211,"address":[],"length":0,"stats":{"Line":224}},{"line":212,"address":[],"length":0,"stats":{"Line":320}},{"line":213,"address":[],"length":0,"stats":{"Line":130}},{"line":216,"address":[],"length":0,"stats":{"Line":76}},{"line":217,"address":[],"length":0,"stats":{"Line":76}},{"line":218,"address":[],"length":0,"stats":{"Line":376}},{"line":219,"address":[],"length":0,"stats":{"Line":76}},{"line":221,"address":[],"length":0,"stats":{"Line":76}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":334,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":379,"address":[],"length":0,"stats":{"Line":0}},{"line":380,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":382,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":391,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":403,"address":[],"length":0,"stats":{"Line":0}},{"line":404,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":406,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":418,"address":[],"length":0,"stats":{"Line":0}},{"line":419,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":422,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":14}},{"line":434,"address":[],"length":0,"stats":{"Line":14}},{"line":437,"address":[],"length":0,"stats":{"Line":6}},{"line":438,"address":[],"length":0,"stats":{"Line":6}},{"line":441,"address":[],"length":0,"stats":{"Line":8}},{"line":442,"address":[],"length":0,"stats":{"Line":8}},{"line":445,"address":[],"length":0,"stats":{"Line":2}},{"line":446,"address":[],"length":0,"stats":{"Line":2}},{"line":449,"address":[],"length":0,"stats":{"Line":10}},{"line":450,"address":[],"length":0,"stats":{"Line":10}},{"line":453,"address":[],"length":0,"stats":{"Line":8}},{"line":454,"address":[],"length":0,"stats":{"Line":14}},{"line":455,"address":[],"length":0,"stats":{"Line":6}},{"line":456,"address":[],"length":0,"stats":{"Line":6}},{"line":459,"address":[],"length":0,"stats":{"Line":2}},{"line":463,"address":[],"length":0,"stats":{"Line":82}},{"line":464,"address":[],"length":0,"stats":{"Line":92}},{"line":465,"address":[],"length":0,"stats":{"Line":10}},{"line":466,"address":[],"length":0,"stats":{"Line":96}},{"line":467,"address":[],"length":0,"stats":{"Line":8}},{"line":468,"address":[],"length":0,"stats":{"Line":8}},{"line":473,"address":[],"length":0,"stats":{"Line":8}},{"line":474,"address":[],"length":0,"stats":{"Line":10}},{"line":475,"address":[],"length":0,"stats":{"Line":2}},{"line":476,"address":[],"length":0,"stats":{"Line":16}},{"line":477,"address":[],"length":0,"stats":{"Line":4}},{"line":481,"address":[],"length":0,"stats":{"Line":14}},{"line":482,"address":[],"length":0,"stats":{"Line":22}},{"line":483,"address":[],"length":0,"stats":{"Line":4}},{"line":484,"address":[],"length":0,"stats":{"Line":4}},{"line":486,"address":[],"length":0,"stats":{"Line":12}},{"line":487,"address":[],"length":0,"stats":{"Line":6}},{"line":491,"address":[],"length":0,"stats":{"Line":8}},{"line":492,"address":[],"length":0,"stats":{"Line":14}},{"line":493,"address":[],"length":0,"stats":{"Line":4}},{"line":494,"address":[],"length":0,"stats":{"Line":4}},{"line":496,"address":[],"length":0,"stats":{"Line":4}},{"line":497,"address":[],"length":0,"stats":{"Line":2}},{"line":501,"address":[],"length":0,"stats":{"Line":12}},{"line":502,"address":[],"length":0,"stats":{"Line":12}},{"line":503,"address":[],"length":0,"stats":{"Line":34}},{"line":504,"address":[],"length":0,"stats":{"Line":30}},{"line":507,"address":[],"length":0,"stats":{"Line":10}},{"line":508,"address":[],"length":0,"stats":{"Line":10}},{"line":509,"address":[],"length":0,"stats":{"Line":28}},{"line":513,"address":[],"length":0,"stats":{"Line":0}},{"line":514,"address":[],"length":0,"stats":{"Line":0}},{"line":516,"address":[],"length":0,"stats":{"Line":0}},{"line":519,"address":[],"length":0,"stats":{"Line":0}},{"line":522,"address":[],"length":0,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":526,"address":[],"length":0,"stats":{"Line":0}},{"line":528,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":532,"address":[],"length":0,"stats":{"Line":0}},{"line":534,"address":[],"length":0,"stats":{"Line":0}},{"line":537,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":540,"address":[],"length":0,"stats":{"Line":0}},{"line":541,"address":[],"length":0,"stats":{"Line":0}},{"line":542,"address":[],"length":0,"stats":{"Line":0}},{"line":543,"address":[],"length":0,"stats":{"Line":0}},{"line":544,"address":[],"length":0,"stats":{"Line":0}},{"line":545,"address":[],"length":0,"stats":{"Line":0}},{"line":546,"address":[],"length":0,"stats":{"Line":0}},{"line":547,"address":[],"length":0,"stats":{"Line":0}},{"line":548,"address":[],"length":0,"stats":{"Line":0}},{"line":550,"address":[],"length":0,"stats":{"Line":0}},{"line":551,"address":[],"length":0,"stats":{"Line":0}},{"line":554,"address":[],"length":0,"stats":{"Line":0}},{"line":560,"address":[],"length":0,"stats":{"Line":0}},{"line":563,"address":[],"length":0,"stats":{"Line":0}},{"line":564,"address":[],"length":0,"stats":{"Line":0}},{"line":565,"address":[],"length":0,"stats":{"Line":0}},{"line":566,"address":[],"length":0,"stats":{"Line":0}},{"line":568,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":572,"address":[],"length":0,"stats":{"Line":0}},{"line":573,"address":[],"length":0,"stats":{"Line":0}},{"line":575,"address":[],"length":0,"stats":{"Line":0}},{"line":578,"address":[],"length":0,"stats":{"Line":0}},{"line":579,"address":[],"length":0,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":583,"address":[],"length":0,"stats":{"Line":0}},{"line":584,"address":[],"length":0,"stats":{"Line":0}},{"line":587,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":589,"address":[],"length":0,"stats":{"Line":0}},{"line":590,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":595,"address":[],"length":0,"stats":{"Line":0}},{"line":596,"address":[],"length":0,"stats":{"Line":0}},{"line":599,"address":[],"length":0,"stats":{"Line":0}},{"line":600,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":605,"address":[],"length":0,"stats":{"Line":0}},{"line":606,"address":[],"length":0,"stats":{"Line":0}},{"line":608,"address":[],"length":0,"stats":{"Line":0}},{"line":609,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":619,"address":[],"length":0,"stats":{"Line":0}},{"line":621,"address":[],"length":0,"stats":{"Line":0}},{"line":622,"address":[],"length":0,"stats":{"Line":0}},{"line":625,"address":[],"length":0,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":628,"address":[],"length":0,"stats":{"Line":0}},{"line":631,"address":[],"length":0,"stats":{"Line":0}},{"line":632,"address":[],"length":0,"stats":{"Line":0}},{"line":633,"address":[],"length":0,"stats":{"Line":0}},{"line":634,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":636,"address":[],"length":0,"stats":{"Line":0}},{"line":637,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":643,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":645,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":2}},{"line":653,"address":[],"length":0,"stats":{"Line":4}},{"line":654,"address":[],"length":0,"stats":{"Line":2}},{"line":657,"address":[],"length":0,"stats":{"Line":4}},{"line":659,"address":[],"length":0,"stats":{"Line":0}},{"line":662,"address":[],"length":0,"stats":{"Line":2}},{"line":682,"address":[],"length":0,"stats":{"Line":2}}],"covered":96,"coverable":356},{"path":["/","Users","ozan","Projects","command-vault","src","ui","mod.rs"],"content":"pub mod app;\npub mod add;\n\npub use app::App;\npub use add::AddCommandApp;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","utils","mod.rs"],"content":"pub mod time;\npub mod params;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","src","utils","params.rs"],"content":"use anyhow::Result;\nuse colored::*;\nuse crossterm::{\n    cursor::MoveTo,\n    event::{self, Event, KeyCode},\n    QueueableCommand,\n    style::Print,\n    terminal::{disable_raw_mode, enable_raw_mode, Clear, ClearType},\n};\nuse regex::Regex;\nuse std::{\n    collections::HashMap,\n    io::{stdout, Stdout, Write},\n};\n\nuse crate::db::models::Parameter;\n\npub fn parse_parameters(command: \u0026str) -\u003e Vec\u003cParameter\u003e {\n    let re = Regex::new(r\"@([a-zA-Z_][a-zA-Z0-9_]*)(?::([^@\\s][^@]*))?\").unwrap();\n    let mut parameters = Vec::new();\n    \n    for cap in re.captures_iter(command) {\n        let name = cap[1].to_string();\n        let description = cap.get(2).map(|m| {\n            let desc = m.as_str().trim_end();\n            if let Some(space_pos) = desc.find(char::is_whitespace) {\n                \u0026desc[..space_pos]\n            } else {\n                desc\n            }.to_string()\n        });\n        parameters.push(Parameter::with_description(name, description));\n    }\n    \n    parameters\n}\n\npub fn substitute_parameters(command: \u0026str, parameters: \u0026[Parameter], test_input: Option\u003c\u0026str\u003e) -\u003e Result\u003cString\u003e {\n    let is_test = test_input.is_some() || std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    if is_test {\n        let mut final_command = command.to_string();\n        let test_values: Vec\u003c\u0026str\u003e = if let Some(input) = test_input {\n            if input.is_empty() {\n                parameters.iter()\n                    .map(|p| p.description.as_deref().unwrap_or(\"\"))\n                    .collect()\n            } else {\n                input.split('\\n').collect()\n            }\n        } else {\n            // When no test input is provided, use descriptions\n            parameters.iter()\n                .map(|p| p.description.as_deref().unwrap_or(\"\"))\n                .collect()\n        };\n\n        for (i, param) in parameters.iter().enumerate() {\n            let value = if i \u003c test_values.len() {\n                test_values[i]\n            } else {\n                param.description.as_deref().unwrap_or(\"\")\n            };\n\n            let needs_quotes = value.is_empty() || \n                             value.contains(' ') || \n                             value.contains('*') || \n                             value.contains(';') ||\n                             value.contains('|') ||\n                             value.contains('\u003e') ||\n                             value.contains('\u003c') ||\n                             command.contains('\u003e') ||\n                             command.contains('\u003c') ||\n                             command.contains('|') ||\n                             final_command.starts_with(\"grep\");\n\n            let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n            } else {\n                value.to_string()\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", param.name), \u0026quoted_value);\n            \n            // Remove the description part from the command\n            if let Some(desc) = \u0026param.description {\n                final_command = final_command.replace(\u0026format!(\":{}\", desc), \"\");\n            }\n        }\n        Ok(final_command)\n    } else {\n        prompt_parameters(command, parameters, test_input)\n    }\n}\n\npub fn prompt_parameters(command: \u0026str, parameters: \u0026[Parameter], test_input: Option\u003c\u0026str\u003e) -\u003e Result\u003cString\u003e {\n    let is_test = test_input.is_some() || std::env::var(\"COMMAND_VAULT_TEST\").is_ok();\n    let result = (|| -\u003e Result\u003cString\u003e {\n        let mut param_values: HashMap\u003cString, String\u003e = HashMap::new();\n        let mut final_command = String::new();\n\n        for param in parameters {\n            let value = if is_test {\n                if let Some(input) = test_input {\n                    input.to_string()\n                } else {\n                    param.description.clone().unwrap_or_default()\n                }\n            } else {\n                enable_raw_mode()?;\n                let mut stdout = stdout();\n                stdout.queue(Clear(ClearType::All))?;\n                \n                // Function to update the preview\n                let update_preview = |stdout: \u0026mut Stdout, current_value: \u0026str| -\u003e Result\u003c()\u003e {\n                    let mut preview_command = command.to_string();\n                    \n                    // Add all previous parameter values\n                    for (name, value) in \u0026param_values {\n                        let needs_quotes = value.is_empty() || \n                            value.contains(' ') || \n                            value.contains('*') || \n                            value.contains(';') ||\n                            value.contains('|') ||\n                            value.contains('\u003e') ||\n                            value.contains('\u003c') ||\n                            preview_command.starts_with(\"grep\");\n\n                        let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                            format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n                        } else {\n                            value.clone()\n                        };\n\n                        preview_command = preview_command.replace(\u0026format!(\"@{}\", name), \u0026quoted_value);\n                    }\n\n                    // Add current parameter value\n                    let needs_quotes = current_value.is_empty() || \n                        current_value.contains(' ') || \n                        current_value.contains('*') || \n                        current_value.contains(';') ||\n                        current_value.contains('|') ||\n                        current_value.contains('\u003e') ||\n                        current_value.contains('\u003c') ||\n                        preview_command.starts_with(\"grep\");\n\n                    let quoted_value = if needs_quotes \u0026\u0026 !current_value.starts_with('\\'') \u0026\u0026 !current_value.starts_with('\"') {\n                        format!(\"'{}'\", current_value.replace('\\'', \"'\\\\''\"))\n                    } else {\n                        current_value.to_string()\n                    };\n\n                    preview_command = preview_command.replace(\u0026format!(\"@{}\", param.name), \u0026quoted_value);\n\n                    stdout.queue(MoveTo(0, 0))?\n                          .queue(Print(\"─\".repeat(45).dimmed()))?;\n                    stdout.queue(MoveTo(0, 1))?\n                          .queue(Clear(ClearType::CurrentLine))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Command to execute\".blue().bold(), \n                              preview_command.green()\n                          )))?;\n                    stdout.queue(MoveTo(0, 2))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Working directory\".cyan().bold(), \n                              std::env::current_dir()?.to_string_lossy().white()\n                          )))?;\n                    Ok(())\n                };\n\n                // Initial display\n                update_preview(\u0026mut stdout, \"\")?;\n\n                stdout.queue(MoveTo(0, 4))?\n                      .queue(Print(\"─\".repeat(45).dimmed()))?;\n                stdout.queue(MoveTo(0, 5))?\n                      .queue(Print(format!(\"{}: {}\", \n                          \"Parameter\".blue().bold(), \n                          param.name.green()\n                      )))?;\n                if let Some(desc) = \u0026param.description {\n                    stdout.queue(MoveTo(0, 6))?\n                          .queue(Print(format!(\"{}: {}\", \n                              \"Description\".cyan().bold(), \n                              desc.white()\n                          )))?;\n                }\n                stdout.queue(MoveTo(0, 7))?\n                      .queue(Print(format!(\"{}: \", \"Enter value\".yellow().bold())))?;\n                stdout.flush()?;\n\n                let mut value = String::new();\n                let mut cursor_pos = 0;\n\n                loop {\n                    if let Event::Key(key) = event::read()? {\n                        match key.code {\n                            KeyCode::Enter =\u003e break,\n                            KeyCode::Char('c') if key.modifiers.contains(event::KeyModifiers::CONTROL) =\u003e {\n                                // Handle Ctrl+C\n                                disable_raw_mode()?;\n                                stdout.queue(Clear(ClearType::All))?;\n                                stdout.queue(MoveTo(0, 0))?;\n                                stdout.flush()?;\n                                return Err(anyhow::anyhow!(\"Operation cancelled by user\"));\n                            }\n                            KeyCode::Char(c) =\u003e {\n                                value.insert(cursor_pos, c);\n                                cursor_pos += 1;\n                            }\n                            KeyCode::Backspace if cursor_pos \u003e 0 =\u003e {\n                                value.remove(cursor_pos - 1);\n                                cursor_pos -= 1;\n                            }\n                            KeyCode::Left if cursor_pos \u003e 0 =\u003e {\n                                cursor_pos -= 1;\n                            }\n                            KeyCode::Right if cursor_pos \u003c value.len() =\u003e {\n                                cursor_pos += 1;\n                            }\n                            _ =\u003e {}\n                        }\n\n                        // Update command preview\n                        update_preview(\u0026mut stdout, \u0026value)?;\n\n                        // Redraw the value line\n                        stdout.queue(MoveTo(0, 7))?\n                              .queue(Clear(ClearType::CurrentLine))?\n                              .queue(Print(format!(\"{}: {}\", \n                                  \"Enter value\".yellow().bold(), \n                                  value\n                              )))?;\n                        stdout.queue(MoveTo((cursor_pos + 13) as u16, 7))?;\n                        stdout.flush()?;\n                    }\n                }\n\n                disable_raw_mode()?;\n                value\n            };\n\n            param_values.insert(param.name.clone(), value);\n        }\n\n        // Build final command\n        final_command = command.to_string();\n        for (name, value) in \u0026param_values {\n            let needs_quotes = value.is_empty() || \n                             value.contains(' ') || \n                             value.contains('*') || \n                             value.contains(';') ||\n                             value.contains('|') ||\n                             value.contains('\u003e') ||\n                             value.contains('\u003c') ||\n                             command.contains('\u003e') ||\n                             command.contains('\u003c') ||\n                             command.contains('|') ||\n                             final_command.starts_with(\"grep\");\n\n            let quoted_value = if needs_quotes \u0026\u0026 !value.starts_with('\\'') \u0026\u0026 !value.starts_with('\"') {\n                format!(\"'{}'\", value.replace('\\'', \"'\\\\''\"))\n            } else {\n                value.clone()\n            };\n\n            final_command = final_command.replace(\u0026format!(\"@{}\", name), \u0026quoted_value);\n            \n            // Remove the description part from the command\n            if let Some(desc) = \u0026parameters.iter().find(|p| p.name == *name).unwrap().description {\n                final_command = final_command.replace(\u0026format!(\":{}\", desc), \"\");\n            }\n        }\n\n        if !is_test {\n            let mut stdout = stdout();\n            stdout.queue(Clear(ClearType::All))?;\n            stdout.queue(MoveTo(0, 0))?;\n            stdout.flush()?;\n        }\n\n        Ok(final_command)\n    })();\n\n    if !is_test {\n        disable_raw_mode()?;\n    }\n\n    result\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":40}},{"line":19,"address":[],"length":0,"stats":{"Line":40}},{"line":20,"address":[],"length":0,"stats":{"Line":40}},{"line":22,"address":[],"length":0,"stats":{"Line":116}},{"line":23,"address":[],"length":0,"stats":{"Line":38}},{"line":24,"address":[],"length":0,"stats":{"Line":62}},{"line":25,"address":[],"length":0,"stats":{"Line":24}},{"line":26,"address":[],"length":0,"stats":{"Line":28}},{"line":29,"address":[],"length":0,"stats":{"Line":20}},{"line":30,"address":[],"length":0,"stats":{"Line":24}},{"line":32,"address":[],"length":0,"stats":{"Line":38}},{"line":35,"address":[],"length":0,"stats":{"Line":40}},{"line":38,"address":[],"length":0,"stats":{"Line":42}},{"line":39,"address":[],"length":0,"stats":{"Line":92}},{"line":40,"address":[],"length":0,"stats":{"Line":42}},{"line":41,"address":[],"length":0,"stats":{"Line":42}},{"line":42,"address":[],"length":0,"stats":{"Line":118}},{"line":44,"address":[],"length":0,"stats":{"Line":6}},{"line":45,"address":[],"length":0,"stats":{"Line":18}},{"line":48,"address":[],"length":0,"stats":{"Line":28}},{"line":52,"address":[],"length":0,"stats":{"Line":8}},{"line":53,"address":[],"length":0,"stats":{"Line":18}},{"line":57,"address":[],"length":0,"stats":{"Line":38}},{"line":58,"address":[],"length":0,"stats":{"Line":76}},{"line":59,"address":[],"length":0,"stats":{"Line":38}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":76}},{"line":65,"address":[],"length":0,"stats":{"Line":34}},{"line":66,"address":[],"length":0,"stats":{"Line":10}},{"line":67,"address":[],"length":0,"stats":{"Line":10}},{"line":68,"address":[],"length":0,"stats":{"Line":10}},{"line":69,"address":[],"length":0,"stats":{"Line":10}},{"line":70,"address":[],"length":0,"stats":{"Line":10}},{"line":71,"address":[],"length":0,"stats":{"Line":10}},{"line":72,"address":[],"length":0,"stats":{"Line":10}},{"line":73,"address":[],"length":0,"stats":{"Line":10}},{"line":74,"address":[],"length":0,"stats":{"Line":10}},{"line":76,"address":[],"length":0,"stats":{"Line":96}},{"line":77,"address":[],"length":0,"stats":{"Line":28}},{"line":79,"address":[],"length":0,"stats":{"Line":10}},{"line":85,"address":[],"length":0,"stats":{"Line":8}},{"line":89,"address":[],"length":0,"stats":{"Line":42}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}}],"covered":41,"coverable":167},{"path":["/","Users","ozan","Projects","command-vault","src","utils","time.rs"],"content":"use chrono::{DateTime, TimeZone, Utc, NaiveDate};\n\npub fn parse_datetime(s: \u0026str) -\u003e Option\u003cDateTime\u003cUtc\u003e\u003e {\n    // Try RFC3339 format first\n    if let Ok(dt) = DateTime::parse_from_rfc3339(s) {\n        return Some(dt.with_timezone(\u0026Utc));\n    }\n\n    // Try common date formats\n    let date_formats = [\n        \"%Y-%m-%d\",\n        \"%Y/%m/%d\",\n        \"%d-%m-%Y\",\n        \"%d/%m/%Y\",\n    ];\n\n    let datetime_formats = [\n        \"%Y-%m-%d %H:%M\",\n        \"%Y-%m-%d %H:%M:%S\",\n        \"%Y-%m-%d %H:%M:%S UTC\",\n        \"%d/%m/%Y %H:%M\",\n        \"%d/%m/%Y %H:%M:%S\",\n    ];\n\n    // Try date-only formats first\n    for format in date_formats {\n        if let Ok(naive_date) = NaiveDate::parse_from_str(s, format) {\n            let naive_datetime = naive_date.and_hms_opt(0, 0, 0).unwrap();\n            return Some(Utc.from_utc_datetime(\u0026naive_datetime));\n        }\n    }\n\n    // Then try datetime formats\n    for format in datetime_formats {\n        if let Ok(naive) = chrono::NaiveDateTime::parse_from_str(s, format) {\n            return Some(Utc.from_utc_datetime(\u0026naive));\n        }\n    }\n\n    None\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":51}},{"line":5,"address":[],"length":0,"stats":{"Line":57}},{"line":10,"address":[],"length":0,"stats":{"Line":45}},{"line":11,"address":[],"length":0,"stats":{"Line":45}},{"line":12,"address":[],"length":0,"stats":{"Line":45}},{"line":13,"address":[],"length":0,"stats":{"Line":45}},{"line":14,"address":[],"length":0,"stats":{"Line":45}},{"line":17,"address":[],"length":0,"stats":{"Line":45}},{"line":18,"address":[],"length":0,"stats":{"Line":45}},{"line":19,"address":[],"length":0,"stats":{"Line":45}},{"line":20,"address":[],"length":0,"stats":{"Line":45}},{"line":21,"address":[],"length":0,"stats":{"Line":45}},{"line":22,"address":[],"length":0,"stats":{"Line":45}},{"line":26,"address":[],"length":0,"stats":{"Line":357}},{"line":27,"address":[],"length":0,"stats":{"Line":12}},{"line":28,"address":[],"length":0,"stats":{"Line":12}},{"line":29,"address":[],"length":0,"stats":{"Line":12}},{"line":34,"address":[],"length":0,"stats":{"Line":298}},{"line":35,"address":[],"length":0,"stats":{"Line":13}},{"line":36,"address":[],"length":0,"stats":{"Line":13}},{"line":40,"address":[],"length":0,"stats":{"Line":20}}],"covered":21,"coverable":21},{"path":["/","Users","ozan","Projects","command-vault","src","version.rs"],"content":"/// The current version of the application.\n/// This should match the version in Cargo.toml\npub const VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\n/// The name of the application\npub const APP_NAME: \u0026str = env!(\"CARGO_PKG_NAME\");\n\n/// The authors of the application\npub const APP_AUTHORS: \u0026str = env!(\"CARGO_PKG_AUTHORS\");\n\n/// The description of the application\npub const APP_DESCRIPTION: \u0026str = env!(\"CARGO_PKG_DESCRIPTION\");\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","args_test.rs"],"content":"use command_vault::cli::args::{Cli, Commands, TagCommands};\nuse clap::Parser;\n\n#[test]\nfn test_parse_args_add() {\n    let args = vec![\"cv\", \"add\", \"--\", \"ls\", \"-l\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command, vec![\"ls\", \"-l\"]);\n            assert!(tags.is_empty());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_add_with_tags() {\n    let args = vec![\"cv\", \"add\", \"-t\", \"file\", \"-t\", \"list\", \"--\", \"ls\", \"-l\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command, vec![\"ls\", \"-l\"]);\n            assert_eq!(tags, vec![\"file\", \"list\"]);\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_ls() {\n    let args = vec![\"cv\", \"ls\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 50);\n            assert!(!asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_ls_with_limit() {\n    let args = vec![\"cv\", \"ls\", \"--limit\", \"5\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 5);\n            assert!(!asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_exec() {\n    let args = vec![\"cv\", \"exec\", \"1\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(debug, false); // Default value should be false\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n\n    // Test with debug flag\n    let args = vec![\"cv\", \"exec\", \"1\", \"--debug\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(debug, true);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_search() {\n    let args = vec![\"cv\", \"search\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git\");\n            assert_eq!(limit, 10);\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_add() {\n    let args = vec![\"cv\", \"tag\", \"add\", \"1\", \"--\", \"git\", \"vcs\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Add { command_id, tags } =\u003e {\n                    assert_eq!(command_id, 1);\n                    assert_eq!(tags, vec![\"git\", \"vcs\"]);\n                }\n                _ =\u003e panic!(\"Expected Tag Add command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_remove() {\n    let args = vec![\"cv\", \"tag\", \"remove\", \"1\", \"--\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Remove { command_id, tag } =\u003e {\n                    assert_eq!(command_id, 1);\n                    assert_eq!(tag, \"git\");\n                }\n                _ =\u003e panic!(\"Expected Tag Remove command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_list() {\n    let args = vec![\"cv\", \"tag\", \"list\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::List =\u003e (),\n                _ =\u003e panic!(\"Expected Tag List command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n\n#[test]\nfn test_parse_args_tag_search() {\n    let args = vec![\"cv\", \"tag\", \"search\", \"--\", \"git\"];\n    let cli = Cli::parse_from(args);\n    match cli.command {\n        Commands::Tag { action } =\u003e {\n            match action {\n                TagCommands::Search { tag, limit } =\u003e {\n                    assert_eq!(tag, \"git\");\n                    assert_eq!(limit, 10);\n                }\n                _ =\u003e panic!(\"Expected Tag Search command\"),\n            }\n        }\n        _ =\u003e panic!(\"Expected Tag command\"),\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","cli_test.rs"],"content":"use anyhow::Result;\nuse command_vault::cli::args::{Cli, Commands, TagCommands};\nuse clap::Parser;\n\n#[test]\nfn test_add_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test basic command without tags\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"git\",\n        \"commit\",\n        \"-m\",\n        \"test\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"git commit -m test\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test with tags\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--tags\",\n        \"git\",\n        \"--tags\",\n        \"vcs\",\n        \"--\",\n        \"git\",\n        \"commit\",\n        \"-m\",\n        \"test\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"git commit -m test\");\n            assert_eq!(tags, vec![\"git\", \"vcs\"]);\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test with multiple words in command (no dashes)\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"echo\",\n        \"hello world\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"echo hello world\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command without any command (missing --)\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n    ]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"the following required arguments were not provided\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_search_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n        \"git commit\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git commit\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_ls_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"ls\",\n        \"--limit\",\n        \"20\",\n        \"--asc\",\n    ])?;\n\n    match args.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 20);\n            assert!(asc);\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_ls_command_default_behavior() -\u003e Result\u003c()\u003e {\n    // Test ls with default values\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"ls\",\n    ])?;\n\n    match args.command {\n        Commands::Ls { limit, asc } =\u003e {\n            assert_eq!(limit, 50); // Default limit is 50\n            assert!(!asc); // Default is descending order\n        }\n        _ =\u003e panic!(\"Expected Ls command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_tag_commands_parsing() -\u003e Result\u003c()\u003e {\n    // Test tag add\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"add\",\n        \"1\",\n        \"important\",\n        \"urgent\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Add { command_id, tags } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tags, vec![\"important\", \"urgent\"]);\n        }\n        _ =\u003e panic!(\"Expected Tag Add command\"),\n    }\n\n    // Test tag remove\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"remove\",\n        \"1\",\n        \"urgent\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Remove { command_id, tag } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tag, \"urgent\");\n        }\n        _ =\u003e panic!(\"Expected Tag Remove command\"),\n    }\n\n    // Test tag list\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"list\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::List } =\u003e (),\n        _ =\u003e panic!(\"Expected Tag List command\"),\n    }\n\n    // Test tag search\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_exec_command_parsing() -\u003e Result\u003c()\u003e {\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"exec\",\n        \"42\",\n    ])?;\n\n    match args.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 42);\n            assert_eq!(debug, false);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_parse_exec_command() {\n    let args = vec![\"command-vault\", \"exec\", \"123\"];\n    let cli = Cli::try_parse_from(args).unwrap();\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 123);\n            assert_eq!(debug, false);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n\n    // Test with debug flag\n    let args = vec![\"command-vault\", \"exec\", \"123\", \"--debug\"];\n    let cli = Cli::try_parse_from(args).unwrap();\n    match cli.command {\n        Commands::Exec { command_id, debug } =\u003e {\n            assert_eq!(command_id, 123);\n            assert_eq!(debug, true);\n        }\n        _ =\u003e panic!(\"Expected Exec command\"),\n    }\n}\n\n#[test]\nfn test_invalid_command_id() {\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"exec\",\n        \"not_a_number\",\n    ]);\n    assert!(result.is_err());\n    let err = result.unwrap_err().to_string();\n    assert!(err.contains(\"invalid value 'not_a_number'\"));\n}\n\n#[test]\nfn test_missing_required_args() {\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n    ]);\n    assert!(result.is_err());\n    let err = result.unwrap_err().to_string();\n    assert!(err.contains(\"\u003cQUERY\u003e\"));\n}\n\n#[test]\nfn test_search_command_default_limit() -\u003e Result\u003c()\u003e {\n    // Test search with default limit\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"search\",\n        \"git commit\",\n    ])?;\n\n    match args.command {\n        Commands::Search { query, limit } =\u003e {\n            assert_eq!(query, \"git commit\");\n            assert_eq!(limit, 10); // Default limit is 10\n        }\n        _ =\u003e panic!(\"Expected Search command\"),\n    }\n    Ok(())\n}\n\n#[test]\nfn test_delete_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test basic delete\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"delete\",\n        \"42\",\n    ])?;\n\n    match args.command {\n        Commands::Delete { command_id } =\u003e {\n            assert_eq!(command_id, 42);\n        }\n        _ =\u003e panic!(\"Expected Delete command\"),\n    }\n\n    // Test missing command ID\n    let result = Cli::try_parse_from([\n        \"command-vault\",\n        \"delete\",\n    ]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"required\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_shell_init_command_parsing() -\u003e Result\u003c()\u003e {\n    // Test default shell initialization\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"shell-init\",\n    ])?;\n\n    match args.command {\n        Commands::ShellInit { shell } =\u003e {\n            assert!(shell.is_none());\n        }\n        _ =\u003e panic!(\"Expected ShellInit command\"),\n    }\n\n    // Test explicit shell override\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"shell-init\",\n        \"--shell\",\n        \"fish\",\n    ])?;\n\n    match args.command {\n        Commands::ShellInit { shell } =\u003e {\n            assert_eq!(shell, Some(\"fish\".to_string()));\n        }\n        _ =\u003e panic!(\"Expected ShellInit command\"),\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_commands_all() -\u003e Result\u003c()\u003e {\n    // Test tag remove\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"remove\",\n        \"1\",\n        \"git\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Remove { command_id, tag } } =\u003e {\n            assert_eq!(command_id, 1);\n            assert_eq!(tag, \"git\");\n        }\n        _ =\u003e panic!(\"Expected Tag Remove command\"),\n    }\n\n    // Test tag list\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"list\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::List } =\u003e (),\n        _ =\u003e panic!(\"Expected Tag List command\"),\n    }\n\n    // Test tag search\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n        \"--limit\",\n        \"5\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 5);\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n\n    // Test tag search with default limit\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"tag\",\n        \"search\",\n        \"git\",\n    ])?;\n\n    match args.command {\n        Commands::Tag { action: TagCommands::Search { tag, limit } } =\u003e {\n            assert_eq!(tag, \"git\");\n            assert_eq!(limit, 10); // Default limit is 10\n        }\n        _ =\u003e panic!(\"Expected Tag Search command\"),\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_with_parameters() -\u003e Result\u003c()\u003e {\n    // Test add command with basic parameter\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command with parameter description\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename:Name of file to create\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename:Name of file to create\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    // Test add command with parameter default value\n    let args = Cli::try_parse_from([\n        \"command-vault\",\n        \"add\",\n        \"--\",\n        \"touch\",\n        \"@filename:Name of file to create=test.txt\",\n    ])?;\n\n    match args.command {\n        Commands::Add { command, tags } =\u003e {\n            assert_eq!(command.join(\" \"), \"touch @filename:Name of file to create=test.txt\");\n            assert_eq!(tags, Vec::\u003cString\u003e::new());\n        }\n        _ =\u003e panic!(\"Expected Add command\"),\n    }\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","commands_test.rs"],"content":"use anyhow::Result;\nuse chrono::{TimeZone, Utc};\nuse command_vault::{\n    cli::{args::{Commands, TagCommands}, commands::handle_command},\n    db::{Command, models::Parameter},\n};\nuse tempfile::tempdir;\nuse std::env;\n\nmod test_utils;\nuse test_utils::create_test_db;\n\n// Set up test environment\n#[ctor::ctor]\nfn setup() {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n}\n\n#[test]\nfn test_ls_empty() -\u003e Result\u003c()\u003e {\n    let (db, _db_dir) = create_test_db()?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_list() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    Ok(())\n}\n\n#[test]\nfn test_ls_with_limit() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    for i in 0..5 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    let commands = db.list_commands(3, false)?;\n    assert_eq!(commands.len(), 3);\n    Ok(())\n}\n\n#[test]\nfn test_ls_ordering() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let timestamps = vec![\n        Utc.with_ymd_and_hms(2022, 1, 1, 0, 0, 0).unwrap(),\n        Utc.with_ymd_and_hms(2022, 1, 2, 0, 0, 0).unwrap(),\n        Utc.with_ymd_and_hms(2022, 1, 3, 0, 0, 0).unwrap(),\n    ];\n    \n    for (i, timestamp) in timestamps.iter().enumerate() {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: *timestamp,\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 3);\n    assert_eq!(commands[0].command, \"command 2\");\n    assert_eq!(commands[1].command, \"command 1\");\n    assert_eq!(commands[2].command, \"command 0\");\n    Ok(())\n}\n\n#[test]\nfn test_delete_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    db.delete_command(id)?;\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_search_commands() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    db.add_command(\u0026command)?;\n    let commands = db.search_commands(\"test\", 10)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    Ok(())\n}\n\n#[test]\nfn test_add_command_with_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    std::fs::create_dir_all(temp_dir.path())?;\n\n    // Change to the test directory\n    let original_dir = env::current_dir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    env::set_current_dir(\u0026test_dir)?;\n    \n    let command = vec![\"test\".to_string(), \"command\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"test command\");\n    assert_eq!(commands[0].tags, vec![\"tag1\", \"tag2\"]);\n    \n    // Restore the original directory\n    env::set_current_dir(original_dir)?;\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_output() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test command that would produce output\n    let command = vec![\"echo\".to_string(), \"\\\"Hello, World!\\\"\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"echo \\\"Hello, World!\\\"\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_stderr() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test command that would produce stderr\n    let command = vec![\"ls\".to_string(), \"nonexistent_directory\".to_string()];\n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"ls nonexistent_directory\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_git_log_format_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    std::fs::create_dir_all(temp_dir.path())?;\n\n    // Change to the test directory\n    let original_dir = env::current_dir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    env::set_current_dir(\u0026test_dir)?;\n    \n    // Add the git log command with format string\n    let format_str = \"%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)\u003c%an\u003e%Creset\";\n    let command = vec![\n        \"git\".to_string(),\n        \"log\".to_string(),\n        \"--graph\".to_string(),\n        format!(\"--pretty=format:{}\", format_str),\n        \"--abbrev-commit\".to_string(),\n    ];\n    \n    let add_command = Commands::Add { \n        command: command.clone(), \n        tags: vec![] \n    };\n    \n    handle_command(add_command, \u0026mut db, false)?;\n    \n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(\n        commands[0].command, \n        format!(\"git log --graph \\\"--pretty=format:{}\\\" --abbrev-commit\", format_str)\n    );\n    \n    // Restore the original directory\n    env::set_current_dir(original_dir)?;\n    \n    Ok(())\n}\n\n#[test]\nfn test_parameter_parsing() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test basic parameter\n    let command = Command {\n        id: None,\n        command: \"echo @message\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"User_name\".to_string())\n        )],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 1);\n    assert_eq!(saved.parameters[0].name, \"message\");\n    assert_eq!(saved.parameters[0].description, Some(\"User_name\".to_string()));\n    \n    // Test parameter with description\n    let command = Command {\n        id: None,\n        command: \"echo @message:User_name\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"User_name\".to_string())\n        )],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 1);\n    assert_eq!(saved.parameters[0].name, \"message\");\n    assert_eq!(saved.parameters[0].description, Some(\"User_name\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_exec_command_with_parameters() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a command with parameters\n    let command = Command {\n        id: None,\n        command: \"echo Hello @name:Person's Name\".to_string(),\n        timestamp: Utc::now(),\n        directory: std::env::current_dir()?.to_string_lossy().to_string(),\n        tags: vec![],\n        parameters: vec![\n            Parameter::with_description(\"name\".to_string(), Some(\"Person's Name\".to_string()))\n        ],\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Execute the command without providing parameter values\n    // It should use the default value\n    let exec_command = Commands::Exec { \n        command_id,\n        debug: true  // Enable debug mode for better testing\n    };\n    \n    // Don't assert the result - the command execution may fail in test environments\n    // but we're primarily testing that our code can handle parameter substitution\n    handle_command(exec_command, \u0026mut db, false);\n    \n    // Instead, verify that the command was retrieved correctly\n    let retrieved_cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(retrieved_cmd.parameters.len(), 1);\n    assert_eq!(retrieved_cmd.parameters[0].name, \"name\");\n    \n    Ok(())\n}\n\n#[test]\nfn test_exec_command_not_found() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to execute a nonexistent command\n    let exec_command = Commands::Exec { \n        command_id: 999, // Nonexistent ID\n        debug: false\n    };\n    \n    let result = handle_command(exec_command, \u0026mut db, false);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n    \n    Ok(())\n}\n\n#[test]\nfn test_parameter_validation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Test invalid parameter name (starts with number)\n    let command = Command {\n        id: None,\n        command: \"echo @1name\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 0); // Invalid parameter should be ignored\n    \n    // Test invalid parameter name (special characters)\n    let command = Command {\n        id: None,\n        command: \"echo @name!\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026command)?;\n    let saved = db.get_command(id)?.unwrap();\n    assert_eq!(saved.parameters.len(), 0); // Invalid parameter should be ignored\n    \n    Ok(())\n}\n\n#[test]\nfn test_command_with_spaces_in_parameters() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"echo @message\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"test\".to_string()],\n        parameters: vec![Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"A test message\".to_string())\n        )],\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].command, \"echo @message\");\n    assert_eq!(commands[0].parameters[0].name, \"message\");\n    assert_eq!(commands[0].parameters[0].description, Some(\"A test message\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_command_with_multiple_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].tags.len(), 3);\n    assert!(commands[0].tags.contains(\u0026\"tag1\".to_string()));\n    assert!(commands[0].tags.contains(\u0026\"tag2\".to_string()));\n    assert!(commands[0].tags.contains(\u0026\"tag3\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_command_with_special_chars() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let command = Command {\n        id: None,\n        command: \"grep -r \\\"@pattern\\\" @directory\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"search\".to_string()],\n        parameters: vec![\n            Parameter::with_description(\n                \"pattern\".to_string(),\n                Some(\"Search pattern\".to_string())\n            ),\n            Parameter::with_description(\n                \"directory\".to_string(),\n                Some(\"Directory to search in\".to_string())\n            ),\n        ],\n    };\n    \n    db.add_command(\u0026command)?;\n    let commands = db.list_commands(1, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].parameters.len(), 2);\n    assert_eq!(commands[0].parameters[0].name, \"pattern\");\n    assert_eq!(commands[0].parameters[0].description, Some(\"Search pattern\".to_string()));\n    assert_eq!(commands[0].parameters[1].name, \"directory\");\n    assert_eq!(commands[0].parameters[1].description, Some(\"Directory to search in\".to_string()));\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_debug() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    let temp_dir = tempdir()?;\n    let test_dir = temp_dir.path().canonicalize()?;\n    std::env::set_current_dir(\u0026test_dir)?;\n    \n    // First add a simple command that works in any shell\n    let add_command = Commands::Add {\n        command: vec![\"echo\".to_string(), \"test\".to_string()],\n        tags: vec![],\n    };\n    handle_command(add_command, \u0026mut db, true)?;\n\n    // Then get the id of the added command\n    let commands = db.list_commands(1, false)?;\n    let id = commands[0].id.unwrap();\n\n    // Execute the command in debug mode\n    let exec_command = Commands::Exec { command_id: id, debug: true };\n    handle_command(exec_command, \u0026mut db, true)?;\n\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a test command\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    \n    // Verify command exists\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    \n    // Delete the command\n    handle_command(Commands::Delete { command_id: id }, \u0026mut db, false)?;\n    \n    // Verify command was deleted\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete_nonexistent() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to delete a command that doesn't exist\n    let result = handle_command(Commands::Delete { command_id: 999 }, \u0026mut db, false);\n    \n    // Verify we get an error\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"Command with ID 999 not found\"));\n    Ok(())\n}\n\n#[test]\nfn test_handle_command_delete_with_tags() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add a test command with tags\n    let command = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"test\".to_string(), \"example\".to_string()],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026command)?;\n    \n    // Verify command exists with tags\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 1);\n    assert_eq!(commands[0].tags.len(), 2);\n    \n    // Delete the command\n    handle_command(Commands::Delete { command_id: id }, \u0026mut db, false)?;\n    \n    // Verify command and its tags were deleted\n    let commands = db.list_commands(10, false)?;\n    assert_eq!(commands.len(), 0);\n    \n    // Verify tags were removed\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 0);\n    Ok(())\n}\n\n// Add new tests for tag command functionality\n#[test]\nfn test_tag_add_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // First add a command\n    let command = Command {\n        id: None,\n        command: \"test command for tags\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: Vec::new(),\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Add tags to the command\n    let add_tags = vec![\"test-tag\".to_string(), \"important\".to_string()];\n    let tag_command = Commands::Tag { \n        action: TagCommands::Add { \n            command_id, \n            tags: add_tags.clone()\n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tags were added\n    let cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(cmd.tags.len(), 2);\n    assert!(cmd.tags.contains(\u0026\"test-tag\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"important\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_remove_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // First add a command with tags\n    let command = Command {\n        id: None,\n        command: \"test command for tag removal\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n    let command_id = db.add_command(\u0026command)?;\n    \n    // Remove a tag\n    let tag_command = Commands::Tag { \n        action: TagCommands::Remove { \n            command_id, \n            tag: \"tag2\".to_string() \n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tag was removed\n    let cmd = db.get_command(command_id)?.unwrap();\n    assert_eq!(cmd.tags.len(), 2);\n    assert!(cmd.tags.contains(\u0026\"tag1\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"tag3\".to_string()));\n    assert!(!cmd.tags.contains(\u0026\"tag2\".to_string()));\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_list_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add commands with tags\n    for i in 0..3 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![\"common-tag\".to_string(), format!(\"tag-{}\", i)],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    // List tags\n    let tag_command = Commands::Tag { \n        action: TagCommands::List \n    };\n    \n    // This should not error\n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify tags directly\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 4); // common-tag + 3 individual tags\n    \n    // Check if common-tag is used 3 times\n    let common_tag = tags.iter().find(|(t, _)| t == \"common-tag\").unwrap();\n    assert_eq!(common_tag.1, 3);\n    \n    Ok(())\n}\n\n#[test]\nfn test_tag_search_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Add commands with different tags\n    for i in 0..5 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: if i % 2 == 0 { \n                vec![\"even\".to_string()]\n            } else {\n                vec![\"odd\".to_string()]\n            },\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n    \n    // Set up environment for testing\n    std::env::set_var(\"COMMAND_VAULT_NO_TUI\", \"1\");\n    \n    // Search by tag\n    let tag_command = Commands::Tag { \n        action: TagCommands::Search { \n            tag: \"even\".to_string(),\n            limit: 10\n        } \n    };\n    \n    handle_command(tag_command, \u0026mut db, false)?;\n    \n    // Verify directly with the DB\n    let results = db.search_by_tag(\"even\", 10)?;\n    assert_eq!(results.len(), 3); // commands 0, 2, 4\n    \n    // Clean up environment\n    std::env::remove_var(\"COMMAND_VAULT_NO_TUI\");\n    \n    Ok(())\n}\n\n// Add tests for edge cases and error conditions\n#[test]\nfn test_tag_add_nonexistent_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to add tags to a command that doesn't exist\n    let tag_command = Commands::Tag { \n        action: TagCommands::Add { \n            command_id: 999, // Nonexistent ID\n            tags: vec![\"test-tag\".to_string()]\n        } \n    };\n    \n    // This should not panic, but might produce an error\n    let result = handle_command(tag_command, \u0026mut db, false);\n    assert!(result.is_ok()); // The function handles the error internally\n    \n    Ok(())\n}\n\n#[test]\nfn test_empty_command_validation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Try to add an empty command\n    let add_command = Commands::Add {\n        command: vec![\"\".to_string()], \n        tags: vec![]\n    };\n    \n    let result = handle_command(add_command, \u0026mut db, false);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"empty command\"));\n    \n    Ok(())\n}\n\n// Test for shell initialization command\n#[test]\nfn test_shell_init_command_generation() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    let shell_command = Commands::ShellInit { \n        shell: Some(\"bash\".to_string()) \n    };\n    \n    // This should return the path to the shell script\n    let result = handle_command(shell_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    // Test with missing shell parameter\n    let shell_command = Commands::ShellInit { \n        shell: None \n    };\n    \n    // This should try to auto-detect the shell\n    let result = handle_command(shell_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    Ok(())\n}\n\n// Test error handling for invalid shell\n#[test]\nfn test_shell_init_invalid_shell() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    let shell_command = Commands::ShellInit { \n        shell: Some(\"invalid_shell_name\".to_string()) \n    };\n    \n    // This should return an error for an invalid shell name\n    let result = handle_command(shell_command, \u0026mut db, false);\n    \n    // The result could be Ok or Err depending on how the function handles invalid shells\n    // Check the behavior based on the implementation\n    if result.is_err() {\n        assert!(result.unwrap_err().to_string().contains(\"invalid\"));\n    }\n    \n    Ok(())\n}\n\n// Test for search with empty results\n#[test]\nfn test_search_no_results() -\u003e Result\u003c()\u003e {\n    let (mut db, _db_dir) = create_test_db()?;\n    \n    // Search for something that shouldn't exist\n    let search_command = Commands::Search { \n        query: \"nonexistent_command_XYZABC\".to_string(),\n        limit: 10\n    };\n    \n    // Set up environment for testing\n    std::env::set_var(\"COMMAND_VAULT_NO_TUI\", \"1\");\n    \n    // This should handle the case of no results\n    let result = handle_command(search_command, \u0026mut db, false);\n    assert!(result.is_ok());\n    \n    // Clean up environment\n    std::env::remove_var(\"COMMAND_VAULT_NO_TUI\");\n    \n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","db_test.rs"],"content":"use anyhow::Result;\nuse chrono::Utc;\nuse command_vault::db::{\n    models::{Command, Parameter},\n    Database,\n};\nuse std::fs;\nuse tempfile::tempdir;\n\nfn create_test_command(command: \u0026str, tags: Vec\u003cString\u003e, parameters: Vec\u003cParameter\u003e) -\u003e Command {\n    Command {\n        id: None,\n        command: command.to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test/dir\".to_string(),\n        tags,\n        parameters,\n    }\n}\n\n#[test]\nfn test_command_crud() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test adding a command\n    let cmd = create_test_command(\n        \"echo test\",\n        vec![\"test\".to_string()],\n        vec![],\n    );\n    let id = db.add_command(\u0026cmd)?;\n    assert!(id \u003e 0);\n\n    // Test retrieving the command\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, \"echo test\");\n    assert_eq!(retrieved.tags, vec![\"test\"]);\n    assert!(retrieved.parameters.is_empty());\n\n    // Test updating the command\n    let mut updated_cmd = retrieved.clone();\n    updated_cmd.command = \"echo updated\".to_string();\n    db.update_command(\u0026updated_cmd)?;\n\n    let retrieved_updated = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved_updated.command, \"echo updated\");\n\n    // Test deleting the command\n    db.delete_command(id)?;\n    assert!(db.get_command(id)?.is_none());\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add command with initial tags\n    let cmd = create_test_command(\n        \"git status\",\n        vec![\"git\".to_string()],\n        vec![],\n    );\n    let id = db.add_command(\u0026cmd)?;\n\n    // Add more tags\n    db.add_tags_to_command(id, \u0026vec![\"vcs\".to_string(), \"status\".to_string()])?;\n    let cmd = db.get_command(id)?.unwrap();\n    assert!(cmd.tags.contains(\u0026\"git\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"vcs\".to_string()));\n    assert!(cmd.tags.contains(\u0026\"status\".to_string()));\n\n    // Remove a tag\n    db.remove_tag_from_command(id, \"status\")?;\n    let cmd = db.get_command(id)?.unwrap();\n    assert!(!cmd.tags.contains(\u0026\"status\".to_string()));\n\n    // Test tag search\n    let results = db.search_by_tag(\"git\", 10)?;\n    assert_eq!(results.len(), 1);\n    assert_eq!(results[0].command, \"git status\");\n\n    // Test listing tags\n    let tags = db.list_tags()?;\n    assert!(tags.iter().any(|(name, _)| name == \"git\"));\n    assert!(tags.iter().any(|(name, _)| name == \"vcs\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_command_with_parameters() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Create command with parameters\n    let params = vec![\n        Parameter::new(\"branch\".to_string()),\n        Parameter::with_description(\n            \"message\".to_string(),\n            Some(\"Commit message\".to_string()),\n        ),\n    ];\n    let cmd = create_test_command(\n        \"git commit -m @message \u0026\u0026 git push origin @branch\",\n        vec![\"git\".to_string()],\n        params.clone(),\n    );\n\n    // Add and retrieve\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n\n    assert_eq!(retrieved.parameters.len(), 2);\n    assert_eq!(retrieved.parameters[0].name, \"branch\");\n    assert_eq!(retrieved.parameters[1].name, \"message\");\n    assert_eq!(retrieved.parameters[1].description, Some(\"Commit message\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_command_search() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add multiple commands\n    let commands = vec![\n        (\"git status\", vec![\"git\".to_string()]),\n        (\"git push\", vec![\"git\".to_string()]),\n        (\"ls -la\", vec![\"system\".to_string()]),\n        (\"echo test\", vec![\"test\".to_string()]),\n    ];\n\n    for (cmd, tags) in commands {\n        let command = create_test_command(cmd, tags, vec![]);\n        db.add_command(\u0026command)?;\n    }\n\n    // Test exact match\n    let results = db.search_commands(\"git status\", 10)?;\n    assert_eq!(results.len(), 1);\n    assert_eq!(results[0].command, \"git status\");\n\n    // Test partial match\n    let results = db.search_commands(\"git\", 10)?;\n    assert_eq!(results.len(), 2);\n\n    // Test with limit\n    let results = db.search_commands(\"git\", 1)?;\n    assert_eq!(results.len(), 1);\n\n    // Test case sensitivity\n    let results = db.search_commands(\"GIT\", 10)?;\n    assert!(!results.is_empty());\n\n    // Test tag search\n    let results = db.search_by_tag(\"git\", 10)?;\n    assert_eq!(results.len(), 2);\n\n    Ok(())\n}\n\n#[test]\nfn test_edge_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test empty command\n    let cmd = create_test_command(\"\", vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, \"\");\n\n    // Test very long command\n    let long_cmd = \"x\".repeat(1000);\n    let cmd = create_test_command(\u0026long_cmd, vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, long_cmd);\n\n    // Test special characters in command\n    let special_cmd = \"echo 'test' \u0026\u0026 ls -la | grep \\\"something\\\" \u003e output.txt\";\n    let cmd = create_test_command(special_cmd, vec![], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    let retrieved = db.get_command(id)?.unwrap();\n    assert_eq!(retrieved.command, special_cmd);\n\n    // Test non-existent command\n    assert!(db.get_command(9999)?.is_none());\n\n    // Test deleting non-existent command\n    assert!(db.delete_command(9999).is_err());\n\n    // Test adding tags to non-existent command\n    assert!(db.add_tags_to_command(9999, \u0026vec![\"test\".to_string()]).is_err());\n\n    // Test removing non-existent tag\n    let cmd = create_test_command(\"test\", vec![\"tag1\".to_string()], vec![]);\n    let id = db.add_command(\u0026cmd)?;\n    assert!(db.remove_tag_from_command(id, \"nonexistent\").is_ok());\n\n    Ok(())\n}\n\n#[test]\nfn test_database_init() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let db = Database::new(db_path.to_str().unwrap())?;\n\n    // Verify tables exist by attempting to use them\n    let conn = rusqlite::Connection::open(db_path)?;\n    \n    // Check commands table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM commands\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Check tags table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM tags\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Check command_tags table\n    let count: i64 = conn.query_row(\n        \"SELECT COUNT(*) FROM command_tags\",\n        [],\n        |row| row.get(0),\n    )?;\n    assert_eq!(count, 0);\n\n    // Verify indexes exist\n    let indexes: Vec\u003cString\u003e = conn\n        .prepare(\"SELECT name FROM sqlite_master WHERE type='index'\")?\n        .query_map([], |row| row.get(0))?\n        .collect::\u003cstd::result::Result\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n    assert!(indexes.contains(\u0026\"idx_commands_command\".to_string()));\n    assert!(indexes.contains(\u0026\"idx_tags_name\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_list_commands_no_limit() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add more than the default limit of commands\n    for i in 0..100 {\n        let command = Command {\n            id: None,\n            command: format!(\"command {}\", i),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![],\n            parameters: Vec::new(),\n        };\n        db.add_command(\u0026command)?;\n    }\n\n    // Test listing with no limit (0)\n    let commands = db.list_commands(0, false)?;\n    assert_eq!(commands.len(), 100);\n\n    // Test listing with no limit and ascending order\n    let commands = db.list_commands(0, true)?;\n    assert_eq!(commands.len(), 100);\n    \n    // Verify order in ascending mode\n    for i in 1..commands.len() {\n        assert!(commands[i].timestamp \u003e= commands[i-1].timestamp);\n    }\n\n    // Verify order in descending mode (default)\n    let commands = db.list_commands(0, false)?;\n    for i in 1..commands.len() {\n        assert!(commands[i].timestamp \u003c= commands[i-1].timestamp);\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_tag_cleanup_after_deletion() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add two commands with overlapping tags\n    let cmd1 = Command {\n        id: None,\n        command: \"command 1\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()],\n        parameters: Vec::new(),\n    };\n    let cmd2 = Command {\n        id: None,\n        command: \"command 2\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag2\".to_string(), \"tag3\".to_string()],\n        parameters: Vec::new(),\n    };\n\n    let id1 = db.add_command(\u0026cmd1)?;\n    let id2 = db.add_command(\u0026cmd2)?;\n\n    // Verify initial tag state\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 3);\n    assert!(tags.iter().any(|(name, count)| name == \"tag1\" \u0026\u0026 *count == 1));\n    assert!(tags.iter().any(|(name, count)| name == \"tag2\" \u0026\u0026 *count == 2));\n    assert!(tags.iter().any(|(name, count)| name == \"tag3\" \u0026\u0026 *count == 1));\n\n    // Delete first command\n    db.delete_command(id1)?;\n\n    // Verify tag1 is removed, tag2 count decreased, tag3 unchanged\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 2);\n    assert!(!tags.iter().any(|(name, _)| name == \"tag1\")); // tag1 should be removed\n    assert!(tags.iter().any(|(name, count)| name == \"tag2\" \u0026\u0026 *count == 1));\n    assert!(tags.iter().any(|(name, count)| name == \"tag3\" \u0026\u0026 *count == 1));\n\n    // Delete second command\n    db.delete_command(id2)?;\n\n    // Verify all tags are removed\n    let tags = db.list_tags()?;\n    assert_eq!(tags.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_rollback() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add a command with tags\n    let cmd = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string(), \"tag2\".to_string()],\n        parameters: Vec::new(),\n    };\n    let id = db.add_command(\u0026cmd)?;\n\n    // Verify initial state\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to update with invalid command (id = None)\n    let mut invalid_cmd = command.clone();\n    invalid_cmd.id = None;\n    let result = db.update_command(\u0026invalid_cmd);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"without id\"));\n\n    // Verify state wasn't changed\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to delete non-existent command\n    let result = db.delete_command(9999);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n\n    // Verify original command still exists\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.command, \"test command\");\n    assert_eq!(command.tags.len(), 2);\n\n    // Try to add tags to non-existent command\n    let result = db.add_tags_to_command(9999, \u0026vec![\"tag3\".to_string()]);\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"not found\"));\n\n    // Verify original command's tags weren't changed\n    let command = db.get_command(id)?.unwrap();\n    assert_eq!(command.tags.len(), 2);\n    assert!(command.tags.contains(\u0026\"tag1\".to_string()));\n    assert!(command.tags.contains(\u0026\"tag2\".to_string()));\n    assert!(!command.tags.contains(\u0026\"tag3\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_parameter_handling() -\u003e Result\u003c()\u003e {\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Test command with valid parameters\n    let mut cmd = Command {\n        id: None,\n        command: \"test command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![],\n        parameters: vec![\n            Parameter::new(\"param1\".to_string()),\n            Parameter::with_description(\"param2\".to_string(), Some(\"description\".to_string())),\n        ],\n    };\n    let id = db.add_command(\u0026cmd)?;\n\n    // Verify parameters were stored correctly\n    let stored = db.get_command(id)?.unwrap();\n    assert_eq!(stored.parameters.len(), 2);\n    assert_eq!(stored.parameters[0].name, \"param1\");\n    assert_eq!(stored.parameters[1].name, \"param2\");\n    assert_eq!(stored.parameters[1].description, Some(\"description\".to_string()));\n\n    // Test updating parameters\n    cmd.id = Some(id);\n    cmd.parameters = vec![Parameter::new(\"new_param\".to_string())];\n    db.update_command(\u0026cmd)?;\n\n    // Verify parameters were updated\n    let updated = db.get_command(id)?.unwrap();\n    assert_eq!(updated.parameters.len(), 1);\n    assert_eq!(updated.parameters[0].name, \"new_param\");\n\n    Ok(())\n}\n\n#[test]\nfn test_concurrent_access() -\u003e Result\u003c()\u003e {\n    use std::thread;\n    use std::sync::Arc;\n    use std::sync::Mutex;\n\n    let temp_dir = tempdir()?;\n    let db_path = temp_dir.path().join(\"test.db\");\n    \n    // Create initial database and enable WAL mode\n    let conn = rusqlite::Connection::open(db_path.to_str().unwrap())?;\n    conn.pragma_update(None, \"journal_mode\", \"WAL\")?;\n    conn.pragma_update(None, \"busy_timeout\", 5000)?;\n    drop(conn);\n\n    let mut db = Database::new(db_path.to_str().unwrap())?;\n\n    // Add initial command\n    let cmd = Command {\n        id: None,\n        command: \"initial command\".to_string(),\n        timestamp: Utc::now(),\n        directory: \"/test\".to_string(),\n        tags: vec![\"tag1\".to_string()],\n        parameters: vec![],\n    };\n    let id = db.add_command(\u0026cmd)?;\n    let db_path = Arc::new(db_path.to_str().unwrap().to_string());\n\n    // Create multiple threads that try to modify the same command\n    let mut handles = vec![];\n    let counter = Arc::new(Mutex::new(0));\n\n    for i in 0..5 {\n        let db_path = Arc::clone(\u0026db_path);\n        let counter = Arc::clone(\u0026counter);\n        \n        let handle = thread::spawn(move || -\u003e Result\u003c()\u003e {\n            let mut db = Database::new(\u0026db_path)?;\n            \n            // Try to update the command with retries\n            let mut retries = 3;\n            while retries \u003e 0 {\n                if let Ok(_) = db.update_command(\u0026Command {\n                    id: Some(id),\n                    command: format!(\"updated by thread {}\", i),\n                    timestamp: Utc::now(),\n                    directory: \"/test\".to_string(),\n                    tags: vec![],\n                    parameters: vec![],\n                }) {\n                    break;\n                }\n                retries -= 1;\n                thread::sleep(std::time::Duration::from_millis(100));\n            }\n\n            // Try to add a new tag with retries\n            let mut retries = 3;\n            while retries \u003e 0 {\n                if let Ok(_) = db.add_tags_to_command(id, \u0026vec![format!(\"tag{}\", i)]) {\n                    break;\n                }\n                retries -= 1;\n                thread::sleep(std::time::Duration::from_millis(100));\n            }\n\n            *counter.lock().unwrap() += 1;\n            Ok(())\n        });\n\n        handles.push(handle);\n    }\n\n    // Wait for all threads to complete\n    for handle in handles {\n        handle.join().unwrap()?;\n    }\n\n    // Verify final state\n    let final_cmd = db.get_command(id)?.unwrap();\n    assert!(final_cmd.command.starts_with(\"updated by thread\"));\n    assert_eq!(*counter.lock().unwrap(), 5);\n    \n    // Verify all tags were added (initial tag + 5 new tags)\n    let tags = db.list_tags()?;\n    assert!(tags.len() \u003e= 5, \"Expected at least 5 tags, got {}\", tags.len());\n    \n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","exec_test.rs"],"content":"use command_vault::exec::execute_command;\nuse command_vault::db::models::{Command, Parameter};\nuse std::env;\nuse std::fs;\nuse std::path::PathBuf;\nuse tempfile::TempDir;\nuse chrono::Utc;\nuse std::thread;\nuse std::time::Duration;\nuse std::io::Cursor;\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_test_command(command: \u0026str) -\u003e Command {\n        Command {\n            id: None,\n            command: command.to_string(),\n            directory: String::new(),\n            timestamp: Utc::now(),\n            tags: vec![],\n            parameters: vec![],\n        }\n    }\n\n    fn setup_test_env() {\n        env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"test_value\");\n        env::set_var(\"SHELL\", \"/bin/sh\");\n    }\n\n    fn cleanup_test_env() {\n        env::remove_var(\"COMMAND_VAULT_TEST\");\n        env::remove_var(\"COMMAND_VAULT_TEST_INPUT\");\n        env::remove_var(\"SHELL\");\n    }\n\n    fn ensure_directory_exists(path: \u0026PathBuf) -\u003e std::io::Result\u003c()\u003e {\n        if !path.exists() {\n            fs::create_dir_all(path)?;\n        }\n        // Small delay to ensure filesystem operations complete\n        thread::sleep(Duration::from_millis(100));\n        Ok(())\n    }\n\n    fn get_safe_temp_dir() -\u003e std::io::Result\u003c(TempDir, PathBuf)\u003e {\n        let temp_dir = TempDir::new()?;\n        let temp_path = temp_dir.path().to_path_buf();\n        ensure_directory_exists(\u0026temp_path)?;\n        \n        // Verify the directory exists and is accessible\n        if !temp_path.exists() || !temp_path.is_dir() {\n            return Err(std::io::Error::new(\n                std::io::ErrorKind::Other,\n                \"Failed to create temporary directory\"\n            ));\n        }\n        \n        Ok((temp_dir, temp_path))\n    }\n\n    fn setup_test_dir(temp_path: \u0026PathBuf) -\u003e std::io::Result\u003c()\u003e {\n        ensure_directory_exists(temp_path)?;\n        \n        // Create a test file\n        let test_file = temp_path.join(\"test.txt\");\n        fs::write(\u0026test_file, \"test content\")?;\n        \n        // Small delay to ensure file is written\n        thread::sleep(Duration::from_millis(100));\n        \n        // Verify the file was created\n        if !test_file.exists() {\n            return Err(std::io::Error::new(\n                std::io::ErrorKind::Other,\n                \"Failed to create test file\"\n            ));\n        }\n        \n        Ok(())\n    }\n\n    #[test]\n    fn test_basic_command_execution() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo 'hello world'\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_working_directory() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        setup_test_dir(\u0026temp_path)?;\n        \n        let mut command = create_test_command(\"cat test.txt\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_parameters() -\u003e std::io::Result\u003c()\u003e {\n        // Create and verify temp directory\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Ensure the directory exists and is accessible\n        ensure_directory_exists(\u0026temp_path)?;\n        \n        // Set up test environment with a known test value\n        setup_test_env();\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"test_message\");\n        \n        // Create a simple command that just echoes the parameter\n        let mut command = create_test_command(\"echo @message\");\n        command.directory = dir_path;\n        command.parameters = vec![\n            Parameter {\n                name: \"message\".to_string(),\n                description: Some(\"Test message\".to_string()),\n            },\n        ];\n        \n        // Execute the command and verify it succeeds\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        \n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_quoted_parameters() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo '@message'\");\n        command.directory = dir_path;\n        command.parameters = vec![\n            Parameter::with_description(\n                \"message\".to_string(),\n                Some(\"Test 'quoted' message\".to_string())\n            ),\n        ];\n\n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_multiple_env_vars() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo \\\"$TEST_VAR1 $TEST_VAR2\\\"\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        env::set_var(\"TEST_VAR1\", \"value1\");\n        env::set_var(\"TEST_VAR2\", \"value2\");\n        \n        let result = execute_command(\u0026command);\n        \n        env::remove_var(\"TEST_VAR1\");\n        env::remove_var(\"TEST_VAR2\");\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_directory_traversal() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Create a test directory structure\n        let test_dir = temp_path.join(\"test_dir\");\n        ensure_directory_exists(\u0026test_dir)?;\n        \n        // Create a test file in the test directory\n        let test_file = test_dir.join(\"test.txt\");\n        fs::write(\u0026test_file, \"test content\")?;\n        \n        // Small delay to ensure file is written\n        thread::sleep(Duration::from_millis(100));\n        \n        // Attempt to traverse outside the test directory\n        let mut command = create_test_command(\"cat ../test.txt\");\n        command.directory = test_dir.canonicalize()?.to_string_lossy().to_string();\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_err(), \"Directory traversal should be prevented\");\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_with_special_shell_chars() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        // Create a test file first\n        setup_test_dir(\u0026temp_path)?;\n        \n        let mut command = create_test_command(\"echo test \u003e output.txt \u0026\u0026 cat output.txt\");\n        command.directory = dir_path;\n        \n        setup_test_env();\n        let result = execute_command(\u0026command);\n        cleanup_test_env();\n        \n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_parameter_handling() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo @p\");\n        command.directory = dir_path.clone();\n        command.parameters = vec![\n            Parameter {\n                name: \"p\".to_string(),\n                description: Some(\"Test parameter\".to_string()),\n            },\n        ];\n        \n        // Set up test environment\n        setup_test_env();\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", \"some-value\");\n        \n        // Execute command\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        Ok(())\n    }\n\n    #[test]\n    fn test_command_output_format() -\u003e std::io::Result\u003c()\u003e {\n        let (temp_dir, temp_path) = get_safe_temp_dir()?;\n        let dir_path = temp_path.canonicalize()?.to_string_lossy().to_string();\n        \n        let mut command = create_test_command(\"echo @p \u003e output.txt\");\n        command.directory = dir_path.clone();\n        command.parameters = vec![\n            Parameter {\n                name: \"p\".to_string(),\n                description: Some(\"Test parameter\".to_string()),\n            },\n        ];\n        \n        // Set up test environment\n        setup_test_env();\n        let test_value = \"test_value\";\n        env::set_var(\"COMMAND_VAULT_TEST_INPUT\", test_value);\n        \n        // Execute command\n        let result = execute_command(\u0026command);\n        assert!(result.is_ok(), \"Command failed: {:?}\", result.err());\n        \n        // Verify the command executed correctly by checking the output file\n        let output_path = PathBuf::from(\u0026dir_path).join(\"output.txt\");\n        let output_content = fs::read_to_string(output_path)?;\n        assert_eq!(output_content.trim(), test_value);\n        \n        // Clean up\n        cleanup_test_env();\n        drop(temp_dir);\n        Ok(())\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","params_test.rs"],"content":"use command_vault::{\n    db::models::Parameter,\n    utils::params::{parse_parameters, substitute_parameters},\n};\n\n#[test]\nfn test_parse_parameters_basic() {\n    let command = \"echo @name\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, None);\n}\n\n#[test]\nfn test_parse_parameters_with_description() {\n    let command = \"echo @name:new-name\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"new-name\".to_string()));\n}\n\n#[test]\nfn test_parse_multiple_parameters() {\n    let command = \"echo @name:new-name @age:30 @city\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 3);\n    \n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"new-name\".to_string()));\n    \n    assert_eq!(params[1].name, \"age\");\n    assert_eq!(params[1].description, Some(\"30\".to_string()));\n    \n    assert_eq!(params[2].name, \"city\");\n    assert_eq!(params[2].description, None);\n}\n\n#[test]\nfn test_parse_parameters_with_underscores() {\n    let command = \"echo @user_name:new-user\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"user_name\");\n    assert_eq!(params[0].description, Some(\"new-user\".to_string()));\n}\n\n\n\n#[test]\nfn test_parse_parameters_empty_command() {\n    let command = \"echo\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 0);\n}\n\n#[test]\nfn test_parse_parameters_invalid_names() {\n    let command = \"echo @123 @!invalid @valid_name\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"valid_name\");\n}\n\n#[test]\nfn test_substitute_parameters_with_special_chars() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"grep @pattern /path/to/dir\";\n    let parameters = vec![Parameter {\n        name: \"pattern\".to_string(),\n        description: None,\n    }];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"test-pattern\"))?;\n    assert_eq!(result, \"grep 'test-pattern' /path/to/dir\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_value() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo ''\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_spaces() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![\n        Parameter::with_description(\"message\".to_string(), Some(\"A test message\".to_string())),\n    ];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello world\"))?;\n    assert_eq!(result, \"echo 'hello world'\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parse_parameters_from_params_rs() {\n    let command = \"docker run -p @port:8080 -v @volume @image\";\n    let params = parse_parameters(command);\n    \n    assert_eq!(params.len(), 3);\n    \n    assert_eq!(params[0].name, \"port\");\n    assert_eq!(params[0].description, Some(\"8080\".to_string()));\n    \n    assert_eq!(params[1].name, \"volume\");\n    assert_eq!(params[1].description, None);\n    \n    assert_eq!(params[2].name, \"image\");\n    assert_eq!(params[2].description, None);\n}\n\n#[test]\nfn test_substitute_parameters_basic() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter::with_description(\"message\".to_string(), None)];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello\"))?;\n    assert_eq!(result, \"echo hello\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_defaults() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message:default value\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: Some(\"default value\".to_string()),\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo 'default value'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_multiple() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"git commit -m @message --author @author\";\n    let parameters = vec![\n        Parameter {\n            name: \"message\".to_string(),\n            description: None,\n        },\n        Parameter {\n            name: \"author\".to_string(),\n            description: None,\n        },\n    ];\n    \n    let result = substitute_parameters(command, \u0026parameters, Some(\"test commit\\nJohn Doe\"))?;\n    assert_eq!(result, \"git commit -m 'test commit' --author 'John Doe'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello * world\"))?;\n    assert_eq!(result, \"echo 'hello * world'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_command() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"\";\n    let parameters = vec![];\n    \n    let result = substitute_parameters(command, \u0026parameters, None)?;\n    assert_eq!(result, \"\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_no_parameters() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo hello\";\n    let parameters = vec![];\n    \n    let result = substitute_parameters(command, \u0026parameters, None)?;\n    assert_eq!(result, \"echo hello\");\n    \n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_git_commands() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"git commit -m @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test commit\"))?;\n    assert_eq!(result, \"git commit -m 'test commit'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_grep() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"grep @pattern\";\n    let parameters = vec![Parameter {\n        name: \"pattern\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"hello * world\"))?;\n    assert_eq!(result, \"grep 'hello * world'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_multiple_occurrences() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    let command = \"echo @message \u0026\u0026 echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test\")).unwrap();\n    assert_eq!(result, \"echo test \u0026\u0026 echo test\");\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_descriptions() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    let command = \"echo @message:A test message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: Some(\"A test message\".to_string()),\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"test\")).unwrap();\n    assert_eq!(result, \"echo test\");\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_empty_value_removed_duplicate() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"\"))?;\n    assert_eq!(result, \"echo ''\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parse_parameters_with_adjacent_parameters() {\n    let command = \"echo @first@second\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 2);\n    assert_eq!(params[0].name, \"first\");\n    assert_eq!(params[1].name, \"second\");\n}\n\n#[test]\nfn test_parse_parameters_with_special_chars_in_description() {\n    let command = \"echo @name:special!\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"special!\".to_string()));\n}\n\n#[test]\nfn test_substitute_parameters_with_semicolon() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"echo hello; ls\"))?;\n    assert_eq!(result, \"echo 'echo hello; ls'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_pipe() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"ls | grep test\"))?;\n    assert_eq!(result, \"echo 'ls | grep test'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_redirection() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @cmd\";\n    let parameters = vec![Parameter {\n        name: \"cmd\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"echo test \u003e file.txt\"))?;\n    assert_eq!(result, \"echo 'echo test \u003e file.txt'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_existing_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"'already quoted'\"))?;\n    assert_eq!(result, \"echo 'already quoted'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_substitute_parameters_with_escaped_quotes() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    std::env::set_var(\"COMMAND_VAULT_TEST\", \"1\");\n    \n    let command = \"echo @message\";\n    let parameters = vec![Parameter {\n        name: \"message\".to_string(),\n        description: None,\n    }];\n\n    let result = substitute_parameters(command, \u0026parameters, Some(\"It's a test\"))?;\n    assert_eq!(result, \"echo 'It'\\\\''s a test'\");\n\n    std::env::remove_var(\"COMMAND_VAULT_TEST\");\n    Ok(())\n}\n\n#[test]\nfn test_parameter_new() {\n    let param = Parameter::new(\"test\".to_string());\n    assert_eq!(param.name, \"test\");\n    assert_eq!(param.description, None);\n}\n\n#[test]\nfn test_parameter_with_description() {\n    let param = Parameter::with_description(\"test\".to_string(), Some(\"A test parameter\".to_string()));\n    assert_eq!(param.name, \"test\");\n    assert_eq!(param.description, Some(\"A test parameter\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_trailing_whitespace() {\n    let command = \"echo @name:test\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"test\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_multiple_colons() {\n    let command = \"echo @name:test:value\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"name\");\n    assert_eq!(params[0].description, Some(\"test:value\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_numbers_in_description() {\n    let command = \"echo @port:8080 @host:localhost:8080\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 2);\n    assert_eq!(params[0].name, \"port\");\n    assert_eq!(params[0].description, Some(\"8080\".to_string()));\n    assert_eq!(params[1].name, \"host\");\n    assert_eq!(params[1].description, Some(\"localhost:8080\".to_string()));\n}\n\n#[test]\nfn test_parse_parameters_with_dash_in_description() {\n    let command = \"git checkout @branch:feature-123\";\n    let params = parse_parameters(command);\n    assert_eq!(params.len(), 1);\n    assert_eq!(params[0].name, \"branch\");\n    assert_eq!(params[0].description, Some(\"feature-123\".to_string()));\n}","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","shell_test.rs"],"content":"use std::env;\nuse std::path::PathBuf;\nuse anyhow::Result;\nuse serial_test::serial;\nuse command_vault::shell::hooks::{\n    detect_current_shell, get_shell_integration_dir, get_shell_integration_script,\n    get_zsh_integration_path, get_bash_integration_path, get_fish_integration_path, init_shell\n};\n\n#[test]\n#[serial]\nfn test_detect_current_shell() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test default case (no environment variables)\n    assert_eq!(\n        detect_current_shell(),\n        \"bash\",\n        \"Should default to bash when no shell is set\"\n    );\n    \n    // Test with FISH_VERSION (highest priority)\n    env::remove_var(\"SHELL\"); // Ensure SHELL is not set\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"Should detect Fish via FISH_VERSION\"\n    );\n    \n    // Test with SHELL environment variable\n    env::remove_var(\"FISH_VERSION\");\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    assert_eq!(\n        detect_current_shell(),\n        \"zsh\",\n        \"Should detect Zsh via SHELL\"\n    );\n    \n    // Test with SHELL environment variable (bash)\n    env::set_var(\"SHELL\", \"/bin/bash\");\n    assert_eq!(\n        detect_current_shell(),\n        \"bash\",\n        \"Should detect Bash via SHELL\"\n    );\n    \n    // Test that FISH_VERSION takes precedence over SHELL\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"FISH_VERSION should take precedence over SHELL\"\n    );\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    } else {\n        env::remove_var(\"SHELL\");\n    }\n    if let Some(fish_version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", fish_version);\n    } else {\n        env::remove_var(\"FISH_VERSION\");\n    }\n}\n\n#[test]\nfn test_get_shell_integration_dir() {\n    let dir = get_shell_integration_dir();\n    assert!(dir.is_dir(), \"Shell integration directory should exist\");\n    assert!(dir.ends_with(\"shell\"), \"Directory should end with 'shell'\");\n    \n    // Check if shell scripts exist\n    let zsh_script = dir.join(\"zsh-integration.zsh\");\n    let bash_script = dir.join(\"bash-integration.sh\");\n    let fish_script = dir.join(\"fish-integration.fish\");\n    \n    assert!(zsh_script.exists(), \"ZSH integration script should exist\");\n    assert!(bash_script.exists(), \"Bash integration script should exist\");\n    assert!(fish_script.exists(), \"Fish integration script should exist\");\n}\n\n#[test]\nfn test_get_shell_specific_paths() {\n    let zsh_path = get_zsh_integration_path();\n    let bash_path = get_bash_integration_path();\n    let fish_path = get_fish_integration_path();\n    \n    assert!(zsh_path.ends_with(\"zsh-integration.zsh\"), \"ZSH path should end with correct filename\");\n    assert!(bash_path.ends_with(\"bash-integration.sh\"), \"Bash path should end with correct filename\");\n    assert!(fish_path.ends_with(\"fish-integration.fish\"), \"Fish path should end with correct filename\");\n    assert!(zsh_path.exists(), \"ZSH integration script should exist\");\n    assert!(bash_path.exists(), \"Bash integration script should exist\");\n    assert!(fish_path.exists(), \"Fish integration script should exist\");\n}\n\n#[test]\nfn test_get_shell_integration_script() -\u003e Result\u003c()\u003e {\n    // Test valid shells\n    let zsh_script = get_shell_integration_script(\"zsh\")?;\n    let bash_script = get_shell_integration_script(\"bash\")?;\n    let fish_script = get_shell_integration_script(\"fish\")?;\n    \n    assert!(zsh_script.ends_with(\"zsh-integration.zsh\"));\n    assert!(bash_script.ends_with(\"bash-integration.sh\"));\n    assert!(fish_script.ends_with(\"fish-integration.fish\"));\n    \n    // Test case insensitivity\n    let upper_zsh = get_shell_integration_script(\"ZSH\")?;\n    assert_eq!(upper_zsh, zsh_script);\n    \n    // Test error cases\n    let unknown_result = get_shell_integration_script(\"unknown\");\n    assert!(unknown_result.is_err());\n    assert!(unknown_result.unwrap_err().to_string().contains(\"Unsupported shell\"));\n    \n    Ok(())\n}\n\n#[test]\n#[serial]\nfn test_init_shell() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test default shell (bash)\n    env::set_var(\"SHELL\", \"/bin/bash\");\n    let path = init_shell(None).unwrap();\n    assert!(path.ends_with(\"bash-integration.sh\"), \"Path should end with bash-integration.sh\");\n    \n    // Test with shell override\n    let path = init_shell(Some(\"fish\".to_string())).unwrap();\n    assert!(path.ends_with(\"fish-integration.fish\"), \"Path should end with fish-integration.fish\");\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\n#[serial]\nfn test_detect_current_shell_fish_env() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test FISH_VERSION detection\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"Should detect Fish via FISH_VERSION\"\n    );\n    \n    // Test FISH_VERSION takes precedence over SHELL\n    env::set_var(\"SHELL\", \"/bin/zsh\");\n    env::set_var(\"FISH_VERSION\", \"3.1.2\");\n    assert_eq!(\n        detect_current_shell(),\n        \"fish\",\n        \"FISH_VERSION should take precedence over SHELL\"\n    );\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\n#[serial]\nfn test_init_shell_explicit_fish() -\u003e Result\u003c()\u003e {\n    // Test with explicit fish shell override\n    let path = init_shell(Some(\"fish\".to_string()))?;\n    assert!(path.ends_with(\"fish-integration.fish\"));\n    Ok(())\n}\n\n#[test]\n#[serial]\nfn test_detect_current_shell_fish_variants() {\n    // Save original environment\n    let original_shell = env::var(\"SHELL\").ok();\n    let original_fish_version = env::var(\"FISH_VERSION\").ok();\n    \n    // Clean environment for testing\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Test various fish shell paths\n    let fish_paths = vec![\n        \"/usr/local/bin/fish\",\n        \"/opt/homebrew/bin/fish\",\n        \"fish\",\n        \"/usr/bin/fish\",\n        \"/bin/fish\",\n    ];\n    \n    for path in fish_paths {\n        env::remove_var(\"FISH_VERSION\"); // Ensure FISH_VERSION doesn't interfere\n        env::remove_var(\"SHELL\"); // Clean SHELL before setting\n        env::set_var(\"SHELL\", path);\n        assert_eq!(\n            detect_current_shell(),\n            \"fish\",\n            \"Failed to detect fish shell at path: {}\",\n            path\n        );\n    }\n    \n    // Clean up test environment\n    env::remove_var(\"FISH_VERSION\");\n    env::remove_var(\"SHELL\");\n    \n    // Restore original environment\n    if let Some(shell) = original_shell {\n        env::set_var(\"SHELL\", shell);\n    }\n    if let Some(version) = original_fish_version {\n        env::set_var(\"FISH_VERSION\", version);\n    }\n}\n\n#[test]\nfn test_shell_integration_paths() -\u003e Result\u003c()\u003e {\n    // Test shell integration directory\n    let integration_dir = get_shell_integration_dir();\n    assert!(integration_dir.ends_with(\"shell\"));\n\n    // Test zsh integration path\n    let zsh_path = get_zsh_integration_path();\n    assert!(zsh_path.ends_with(\"zsh-integration.zsh\"));\n\n    // Test bash integration path\n    let bash_path = get_bash_integration_path();\n    assert!(bash_path.ends_with(\"bash-integration.sh\"));\n\n    // Test fish integration path\n    let fish_path = get_fish_integration_path();\n    assert!(fish_path.ends_with(\"fish-integration.fish\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_init_shell_invalid_shell() -\u003e Result\u003c()\u003e {\n    // Test with an invalid shell\n    let result = init_shell(Some(\"invalid_shell\".to_string()));\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"Unsupported shell\"));\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","test_utils.rs"],"content":"use anyhow::Result;\nuse chrono::{Datelike, Timelike};\nuse command_vault::db::Database;\nuse command_vault::utils::time::parse_datetime;\nuse tempfile::TempDir;\n\npub fn create_test_db() -\u003e Result\u003c(Database, TempDir)\u003e {\n    let dir = tempfile::tempdir()?;\n    let db = Database::new(dir.path().join(\"test.db\").to_str().unwrap())?;\n    Ok((db, dir))\n}\n\n// Time parsing tests\n#[test]\nfn test_parse_datetime_rfc3339() {\n    let input = \"2024-03-14T15:30:00Z\";\n    let result = parse_datetime(input).unwrap();\n    assert_eq!(result.year(), 2024);\n    assert_eq!(result.month(), 3);\n    assert_eq!(result.day(), 14);\n    assert_eq!(result.hour(), 15);\n    assert_eq!(result.minute(), 30);\n    assert_eq!(result.second(), 0);\n}\n\n#[test]\nfn test_parse_datetime_common_formats() {\n    let test_cases = vec![\n        // Date-only formats\n        (\"2024-03-14\", 2024, 3, 14, 0, 0, 0),\n        (\"2024/03/14\", 2024, 3, 14, 0, 0, 0),\n        (\"14-03-2024\", 2024, 3, 14, 0, 0, 0),\n        (\"14/03/2024\", 2024, 3, 14, 0, 0, 0),\n        \n        // Date-time formats\n        (\"2024-03-14 15:30\", 2024, 3, 14, 15, 30, 0),\n        (\"2024-03-14 15:30:45\", 2024, 3, 14, 15, 30, 45),\n        (\"14/03/2024 15:30\", 2024, 3, 14, 15, 30, 0),\n        (\"14/03/2024 15:30:45\", 2024, 3, 14, 15, 30, 45),\n    ];\n\n    for (input, year, month, day, hour, minute, second) in test_cases {\n        let result = parse_datetime(input).unwrap_or_else(|| panic!(\"Failed to parse date: {}\", input));\n        assert_eq!(result.year(), year, \"Year mismatch for {}\", input);\n        assert_eq!(result.month(), month, \"Month mismatch for {}\", input);\n        assert_eq!(result.day(), day, \"Day mismatch for {}\", input);\n        assert_eq!(result.hour(), hour, \"Hour mismatch for {}\", input);\n        assert_eq!(result.minute(), minute, \"Minute mismatch for {}\", input);\n        assert_eq!(result.second(), second, \"Second mismatch for {}\", input);\n    }\n}\n\n#[test]\nfn test_parse_datetime_invalid() {\n    let test_cases = vec![\n        \"invalid\",\n        \"2024\",\n        \"2024-13-01\",  // Invalid month\n        \"2024-01-32\",  // Invalid day\n        \"03/14/24\",    // Two-digit year not supported\n        \"\",\n    ];\n\n    for input in test_cases {\n        assert!(parse_datetime(input).is_none(), \"Expected None for input: {}\", input);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","time_test.rs"],"content":"use command_vault::utils::time::parse_datetime;\nuse chrono::{DateTime, Utc};\n\n#[test]\nfn test_parse_datetime_valid() {\n    let input = \"2024-01-01T12:00:00Z\";\n    let result = parse_datetime(input);\n    assert!(result.is_some());\n    let dt: DateTime\u003cUtc\u003e = result.unwrap();\n    assert_eq!(dt.to_rfc3339(), \"2024-01-01T12:00:00+00:00\");\n}\n\n#[test]\nfn test_parse_datetime_invalid() {\n    let input = \"invalid date\";\n    let result = parse_datetime(input);\n    assert!(result.is_none());\n}\n\n#[test]\nfn test_parse_datetime_empty() {\n    let input = \"\";\n    let result = parse_datetime(input);\n    assert!(result.is_none());\n}\n\n#[test]\nfn test_parse_datetime_different_formats() {\n    let inputs = vec![\n        \"2024-01-01T12:00:00+00:00\",\n        \"2024-01-01T12:00:00-05:00\",\n        \"2024-01-01 12:00:00 UTC\",\n    ];\n\n    for input in inputs {\n        let result = parse_datetime(input);\n        assert!(result.is_some(), \"Failed to parse: {}\", input);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ozan","Projects","command-vault","tests","ui_test.rs"],"content":"use anyhow::Result;\nuse chrono::{TimeZone, Utc};\nuse command_vault::{\n    db::{Command, Database},\n    ui::{app::App, AddCommandApp},\n};\nuse crate::test_utils::create_test_db;\nuse command_vault::ui::add::InputMode;\nuse ratatui::style::Color;\nuse crossterm::terminal::{disable_raw_mode, enable_raw_mode, is_raw_mode_enabled};\nuse ratatui::{Terminal, backend::CrosstermBackend};\nuse std::io::stdout;\n\nmod test_utils;\n\nfn create_test_commands() -\u003e Vec\u003cCommand\u003e {\n    vec![\n        Command {\n            id: Some(1),\n            command: \"ls -la\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 0).unwrap(),\n            directory: \"/home/user\".to_string(),\n            tags: vec![\"file\".to_string(), \"list\".to_string()],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(2),\n            command: \"git status\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 1).unwrap(),\n            directory: \"/home/user/project\".to_string(),\n            tags: vec![\"git\".to_string()],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(3),\n            command: \"docker ps\".to_string(),\n            timestamp: Utc.with_ymd_and_hms(2024, 1, 1, 0, 0, 2).unwrap(),\n            directory: \"/home/user\".to_string(),\n            tags: vec![\"docker\".to_string()],\n            parameters: vec![],\n        },\n    ]\n}\n\n#[test]\nfn test_app_new() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = vec![\n        Command {\n            id: Some(1),\n            command: \"test command\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/test\".to_string(),\n            tags: vec![\"test\".to_string(), \"example\".to_string()],\n            parameters: vec![],\n        }\n    ];\n    \n    let app = App::new(commands.clone(), \u0026mut db, false);\n    \n    assert_eq!(app.commands, commands);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.show_help, false);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands, vec![0]);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.debug_mode, false);\n    \n    Ok(())\n}\n\n#[test]\nfn test_app_filter() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = vec![\n        Command {\n            id: Some(1),\n            command: \"ls -l\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/\".to_string(),\n            tags: vec![],\n            parameters: vec![],\n        },\n        Command {\n            id: Some(2),\n            command: \"pwd\".to_string(),\n            timestamp: Utc::now(),\n            directory: \"/\".to_string(),\n            tags: vec![],\n            parameters: vec![],\n        },\n    ];\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n    app.filter_text = \"ls\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.filtered_commands[0], 0);\n    Ok(())\n}\n\n#[test]\nfn test_app_filtering() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test filtering by command\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test filtering by tag\n    app.filter_text = \"file\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Test filtering by directory\n    app.filter_text = \"project\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test no matches\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_new() {\n    let app = AddCommandApp::new();\n    assert!(app.command.is_empty());\n    assert!(app.tags.is_empty());\n    assert!(app.current_tag.is_empty());\n    assert_eq!(app.command_cursor, 0);\n}\n\n#[test]\nfn test_add_command_app_command_input() {\n    let mut app = AddCommandApp::new();\n    app.set_command(\"ls -la\".to_string());\n    assert_eq!(app.command, \"ls -la\");\n}\n\n#[test]\nfn test_add_command_app_tag_input() {\n    let mut app = AddCommandApp::new();\n    \n    // Test single tag\n    app.set_tags(vec![\"git\".to_string()]);\n    assert_eq!(app.tags, vec![\"git\"]);\n    \n    // Test multiple tags\n    app.set_tags(vec![\"git\".to_string(), \"docker\".to_string()]);\n    assert_eq!(app.tags, vec![\"git\", \"docker\"]);\n}\n\n#[test]\nfn test_app_message() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.message, None);\n\n    // Set a success message\n    app.message = Some((\"Command copied to clipboard!\".to_string(), Color::Green));\n    assert_eq!(app.message, Some((\"Command copied to clipboard!\".to_string(), Color::Green)));\n\n    // Set an error message\n    app.message = Some((\"Failed to delete command\".to_string(), Color::Red));\n    assert_eq!(app.message, Some((\"Failed to delete command\".to_string(), Color::Red)));\n\n    // Clear message\n    app.message = None;\n    assert_eq!(app.message, None);\n\n    // Set an info message\n    app.message = Some((\"Type to filter commands...\".to_string(), Color::Blue));\n    assert_eq!(app.message, Some((\"Type to filter commands...\".to_string(), Color::Blue)));\n\n    // Set a warning message\n    app.message = Some((\"Delete operation cancelled\".to_string(), Color::Yellow));\n    assert_eq!(app.message, Some((\"Delete operation cancelled\".to_string(), Color::Yellow)));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selection() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n\n    // Test selecting a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test selecting another command\n    app.selected = Some(1);\n    assert_eq!(app.selected, Some(1));\n\n    // Test selecting last command\n    app.selected = Some(app.commands.len() - 1);\n    assert_eq!(app.selected, Some(2));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_confirm_delete() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test setting confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Test canceling delete\n    app.confirm_delete = None;\n    assert_eq!(app.confirm_delete, None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_debug_mode() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    \n    // Test debug mode enabled\n    let mut app = App::new(commands.clone(), \u0026mut db, true);\n    assert_eq!(app.debug_mode, true);\n    \n    // Test debug mode disabled\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n    assert_eq!(app.debug_mode, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_help_toggle() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.show_help, false);\n\n    // Test toggling help on\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Test toggling help off\n    app.show_help = false;\n    assert_eq!(app.show_help, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_cursor_movement() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial cursor position\n    assert_eq!(app.command_cursor, 0);\n    \n    // Test setting cursor position\n    app.set_command(\"ls -la\".to_string());\n    app.command_cursor = 3;\n    assert_eq!(app.command_cursor, 3);\n}\n\n#[test]\nfn test_app_filter_clear() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Apply filter\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Clear filter\n    app.filter_text.clear();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    Ok(())\n}\n\n#[test]\nfn test_add_command_app_tag_operations() {\n    let mut app = AddCommandApp::new();\n    \n    // Test adding a tag\n    app.current_tag = \"git\".to_string();\n    app.tags.push(app.current_tag.clone());\n    assert_eq!(app.tags, vec![\"git\"]);\n    \n    // Test clearing current tag\n    app.current_tag.clear();\n    assert!(app.current_tag.is_empty());\n    \n    // Test adding multiple tags\n    app.tags.push(\"docker\".to_string());\n    app.tags.push(\"test\".to_string());\n    assert_eq!(app.tags, vec![\"git\", \"docker\", \"test\"]);\n}\n\n#[test]\nfn test_add_command_app_input_modes() {\n    use command_vault::ui::add::InputMode;\n    let mut app = AddCommandApp::new();\n    \n    // Test initial mode\n    assert!(matches!(app.input_mode, InputMode::Command));\n    \n    // Test switching to Tag mode\n    app.input_mode = InputMode::Tag;\n    assert!(matches!(app.input_mode, InputMode::Tag));\n    \n    // Test switching to Confirm mode\n    app.input_mode = InputMode::Confirm;\n    assert!(matches!(app.input_mode, InputMode::Confirm));\n    \n    // Test switching to Help mode\n    app.input_mode = InputMode::Help;\n    assert!(matches!(app.input_mode, InputMode::Help));\n    \n    // Test storing previous mode\n    app.previous_mode = InputMode::Command;\n    assert!(matches!(app.previous_mode, InputMode::Command));\n}\n\n#[test]\nfn test_add_command_app_tag_suggestions() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial state\n    assert!(app.suggested_tags.is_empty());\n    \n    // Test adding suggested tags\n    app.suggested_tags = vec![\"git\".to_string(), \"docker\".to_string()];\n    assert_eq!(app.suggested_tags, vec![\"git\", \"docker\"]);\n    \n    // Test clearing suggestions\n    app.suggested_tags.clear();\n    assert!(app.suggested_tags.is_empty());\n}\n\n#[test]\nfn test_add_command_app_multiline() {\n    let mut app = AddCommandApp::new();\n    \n    // Test initial state\n    assert_eq!(app.command_line, 0);\n    \n    // Test setting command with multiple lines\n    app.set_command(\"line1\\nline2\\nline3\".to_string());\n    assert_eq!(app.command, \"line1\\nline2\\nline3\");\n    \n    // Test cursor movement across lines\n    app.command_cursor = 6;  // After \"line1\\n\"\n    assert_eq!(app.command_cursor, 6);\n}\n\n#[test]\nfn test_add_command_app_key_events() {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n\n    let mut app = AddCommandApp::new();\n\n    // Test command input\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('l'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('s'), KeyModifiers::empty()));\n    assert_eq!(app.command, \"ls\");\n    assert_eq!(app.command_cursor, 2);\n\n    // Test backspace\n    app.handle_key_event(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty()));\n    assert_eq!(app.command, \"l\");\n    assert_eq!(app.command_cursor, 1);\n\n    // Test cursor movement\n    app.handle_key_event(KeyEvent::new(KeyCode::Left, KeyModifiers::empty()));\n    assert_eq!(app.command_cursor, 0);\n    app.handle_key_event(KeyEvent::new(KeyCode::Right, KeyModifiers::empty()));\n    assert_eq!(app.command_cursor, 1);\n\n    // Test multiline command\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::SHIFT));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('a'), KeyModifiers::empty()));\n    assert_eq!(app.command, \"l\\na\");\n    assert_eq!(app.command_line, 1);\n\n    // Test switching to tag mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Tag);\n\n    // Test tag input\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('t'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('a'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('g'), KeyModifiers::empty()));\n    assert_eq!(app.current_tag, \"tag\");\n\n    // Test adding tag\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::empty()));\n    assert_eq!(app.tags, vec![\"tag\"]);\n    assert_eq!(app.current_tag, \"\");\n\n    // Test help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Help);\n    assert_eq!(app.previous_mode, InputMode::Tag);\n\n    // Test exiting help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert_eq!(app.input_mode, InputMode::Tag);\n}\n\n#[test]\nfn test_add_command_app_help_mode() {\n    use command_vault::ui::add::InputMode;\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut app = AddCommandApp::new();\n    \n    // Test entering help mode\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Help));\n    assert!(matches!(app.previous_mode, InputMode::Command));\n    \n    // Test exiting help mode with ?\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Command));\n    \n    // Test exiting help mode with Esc\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('?'), KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Help));\n    app.handle_key_event(KeyEvent::new(KeyCode::Esc, KeyModifiers::empty()));\n    assert!(matches!(app.input_mode, InputMode::Command));\n}\n\n#[test]\nfn test_add_command_app_multiline_command() {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut app = AddCommandApp::new();\n    \n    // Test entering multiline command\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('l'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('s'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Enter, KeyModifiers::SHIFT));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('p'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('w'), KeyModifiers::empty()));\n    app.handle_key_event(KeyEvent::new(KeyCode::Char('d'), KeyModifiers::empty()));\n    \n    assert_eq!(app.command, \"ls\\npwd\");\n    assert_eq!(app.command_line, 1);\n    assert_eq!(app.command_cursor, 6);\n}\n\n#[test]\nfn test_app_command_copy() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n    assert_eq!(app.filtered_commands[0], 0);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Verify the command to be copied\n    if let Some(selected) = app.selected {\n        if let Some(\u0026idx) = app.filtered_commands.get(selected) {\n            if let Some(cmd) = app.commands.get(idx) {\n                assert_eq!(cmd.command, \"ls -la\");\n            }\n        }\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_app_navigation() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test moving down\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving down again\n    app.selected = Some(1);\n    assert_eq!(app.selected, Some(1));\n\n    // Test moving up\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving up at the top (should stay at 0)\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Test moving down at the bottom (should stay at last index)\n    app.selected = Some(2);\n    assert_eq!(app.selected, Some(2));\n\n    // Test selection with filtered commands\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_delete_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.confirm_delete, None);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Initiate delete\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Cancel delete\n    app.confirm_delete = None;\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.commands.len(), 3);\n\n    // Initiate delete again\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n\n    // Confirm delete\n    if let Some(selected) = app.selected {\n        if let Some(confirm_idx) = app.confirm_delete {\n            if confirm_idx == selected {\n                if let Some(\u0026filtered_idx) = app.filtered_commands.get(selected) {\n                    if let Some(command_id) = app.commands[filtered_idx].id {\n                        match app.db.delete_command(command_id) {\n                            Ok(_) =\u003e {\n                                app.commands.remove(filtered_idx);\n                                app.update_filtered_commands();\n                                // Update selection after deletion\n                                if app.filtered_commands.is_empty() {\n                                    app.selected = None;\n                                } else {\n                                    app.selected = Some(selected.min(app.filtered_commands.len() - 1));\n                                }\n                            }\n                            Err(e) =\u003e panic!(\"Failed to delete command: {}\", e),\n                        }\n                        app.confirm_delete = None;\n                    }\n                }\n            }\n        }\n    }\n\n    // Verify deletion\n    assert_eq!(app.commands.len(), 2);\n    assert_eq!(app.filtered_commands.len(), 2);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.selected, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_edit_command() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Get the original command\n    let original_command = app.commands[0].clone();\n    assert_eq!(original_command.command, \"ls -la\");\n\n    // Update the command\n    let updated_command = Command {\n        id: original_command.id,\n        command: \"ls -lah\".to_string(),\n        timestamp: original_command.timestamp,\n        directory: original_command.directory.clone(),\n        tags: vec![\"test\".to_string(), \"updated\".to_string()],\n        parameters: vec![],\n    };\n\n    // Update in database\n    app.db.update_command(\u0026updated_command)?;\n\n    // Update in app's command list\n    app.commands[0] = updated_command.clone();\n\n    // Verify the update\n    assert_eq!(app.commands[0].command, \"ls -lah\");\n    assert_eq!(app.commands[0].tags, vec![\"test\".to_string(), \"updated\".to_string()]);\n    assert_eq!(app.commands[0].id, original_command.id);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_help_mode() -\u003e Result\u003c()\u003e {\n    let (mut db, _dir) = create_test_db()?;\n    let mut commands = create_test_commands();\n    \n    // Add commands to the database first\n    for cmd in \u0026mut commands {\n        cmd.id = Some(db.add_command(cmd)?);\n    }\n    \n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Initial state\n    assert_eq!(app.show_help, false);\n\n    // Toggle help mode on\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Toggle help mode off\n    app.show_help = false;\n    assert_eq!(app.show_help, false);\n\n    // Verify that help mode doesn't affect other app state\n    assert_eq!(app.commands.len(), 3);\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.debug_mode, false);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_message_handling() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = vec![];\n    let mut app = App::new(commands, \u0026mut db, false);\n    \n    // Test setting a message\n    app.set_message(\"Test message\".to_string(), Color::Green);\n    assert_eq!(app.message, Some((\"Test message\".to_string(), Color::Green)));\n    \n    // Test setting a success message\n    app.set_success_message(\"Success message\".to_string());\n    assert_eq!(app.message, Some((\"Success message\".to_string(), Color::Green)));\n    \n    // Test setting an error message\n    app.set_error_message(\"Error message\".to_string());\n    assert_eq!(app.message, Some((\"Error message\".to_string(), Color::Red)));\n    \n    // Test clearing the message\n    app.clear_message();\n    assert_eq!(app.message, None);\n    \n    Ok(())\n}\n\n#[test]\nfn test_app_selection_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.get_selection(), None);\n\n    // Test setting valid selection\n    app.set_selection(Some(1));\n    assert_eq!(app.get_selection(), Some(1));\n\n    // Test setting selection to None\n    app.set_selection(None);\n    assert_eq!(app.get_selection(), None);\n\n    // Test setting selection to last index\n    app.set_selection(Some(app.commands.len() - 1));\n    assert_eq!(app.get_selection(), Some(app.commands.len() - 1));\n\n    // Test that selection is maintained after filtering\n    app.set_selection(Some(1));\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.get_selection(), Some(0)); // Selection should adjust to filtered index\n\n    Ok(())\n}\n\n#[test]\nfn test_app_navigation_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.selected, None);\n\n    // Test select_next from None\n    app.select_next();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_next from first item\n    app.select_next();\n    assert_eq!(app.selected, Some(1));\n\n    // Test select_next from last item (should stay at last)\n    app.selected = Some(app.filtered_commands.len() - 1);\n    app.select_next();\n    assert_eq!(app.selected, Some(app.filtered_commands.len() - 1));\n\n    // Test select_previous from middle\n    app.selected = Some(1);\n    app.select_previous();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_previous from first item (should stay at first)\n    app.select_previous();\n    assert_eq!(app.selected, Some(0));\n\n    // Test select_previous from None (should go to last)\n    app.selected = None;\n    app.select_previous();\n    assert_eq!(app.selected, Some(app.filtered_commands.len() - 1));\n\n    // Test with filtered list\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filtered_commands.len(), 1);\n\n    // Test navigation with filtered list\n    app.selected = None;\n    app.select_next();\n    assert_eq!(app.selected, Some(0));\n    app.select_next();\n    assert_eq!(app.selected, Some(0)); // Should stay at 0 since there's only one item\n\n    Ok(())\n}\n\n#[test]\nfn test_app_filter_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test set_filter\n    app.set_filter(\"git\".to_string());\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test clear_filter\n    app.clear_filter();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test append_to_filter\n    app.append_to_filter('d');\n    app.append_to_filter('o');\n    app.append_to_filter('c');\n    assert_eq!(app.filter_text, \"doc\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"docker ps\");\n\n    // Test backspace_filter\n    app.backspace_filter();\n    assert_eq!(app.filter_text, \"do\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"docker ps\");\n\n    // Test backspace_filter until empty\n    app.backspace_filter();\n    app.backspace_filter();\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test case insensitive filtering\n    app.set_filter(\"GIT\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test filtering by tag\n    app.set_filter(\"file\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"ls -la\");\n\n    // Test filtering by directory\n    app.set_filter(\"project\".to_string());\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test no matches\n    app.set_filter(\"nonexistent\".to_string());\n    assert_eq!(app.filtered_commands.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selected_command_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    // Test with valid selection\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command().unwrap().command, \"ls -la\");\n    assert_eq!(app.get_selected_index(), Some(0));\n\n    // Test with filtered list\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command().unwrap().command, \"git status\");\n    assert_eq!(app.get_selected_index(), Some(1)); // Index in original commands list\n\n    // Test with invalid selection\n    app.selected = Some(5); // Out of bounds\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    // Test with empty filtered list\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(0);\n    assert_eq!(app.get_selected_command(), None);\n    assert_eq!(app.get_selected_index(), None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_selection_update_methods() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test update_selection_after_filter\n\n    // Test with no selection\n    assert_eq!(app.selected, None);\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, None);\n\n    // Test with selection and empty filtered list\n    app.selected = Some(0);\n    app.filter_text = \"nonexistent\".to_string();\n    app.update_filtered_commands();\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, None);\n\n    // Test with selection and filtered list smaller than selection\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    app.selected = Some(2); // Out of bounds for filtered list\n    app.update_selection_after_filter();\n    assert_eq!(app.selected, Some(0)); // Should adjust to last item in filtered list\n\n    // Test update_selection_after_delete\n\n    // Reset to initial state\n    app.filter_text.clear();\n    app.update_filtered_commands();\n    \n    // Test with no selection\n    app.selected = None;\n    app.update_selection_after_delete(0);\n    assert_eq!(app.selected, None);\n\n    // Test with selection and empty filtered list\n    app.selected = Some(0);\n    app.filtered_commands.clear();\n    app.update_selection_after_delete(0);\n    assert_eq!(app.selected, None);\n\n    // Test with selection after deleting item\n    app.filtered_commands = vec![0, 1, 2];\n    app.selected = Some(2);\n    app.filtered_commands.remove(1); // Remove middle item\n    app.update_selection_after_delete(1);\n    assert_eq!(app.selected, Some(1)); // Should adjust to new length\n\n    // Test with selection at end after deleting last item\n    app.selected = Some(1);\n    app.filtered_commands.pop(); // Remove last item\n    app.update_selection_after_delete(1);\n    assert_eq!(app.selected, Some(0)); // Should adjust to new last item\n\n    Ok(())\n}\n\n#[test]\nfn test_app_key_events() -\u003e Result\u003c()\u003e {\n    use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test help toggle with '?'\n    assert_eq!(app.show_help, false);\n    app.show_help = !app.show_help; // Simulate '?' key press\n    assert_eq!(app.show_help, true);\n    app.show_help = !app.show_help; // Simulate '?' key press again\n    assert_eq!(app.show_help, false);\n\n    // Test filter operations\n    assert_eq!(app.filter_text, \"\");\n    app.append_to_filter('g'); // Simulate typing 'g'\n    app.append_to_filter('i'); // Simulate typing 'i'\n    app.append_to_filter('t'); // Simulate typing 't'\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test backspace in filter\n    app.backspace_filter(); // Simulate backspace\n    assert_eq!(app.filter_text, \"gi\");\n    \n    // Test clear filter with Esc\n    app.clear_filter(); // Simulate Esc\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test navigation\n    assert_eq!(app.selected, None);\n    app.select_next(); // Simulate down arrow or 'j'\n    assert_eq!(app.selected, Some(0));\n    app.select_next(); // Move down again\n    assert_eq!(app.selected, Some(1));\n    app.select_previous(); // Simulate up arrow or 'k'\n    assert_eq!(app.selected, Some(0));\n\n    // Test delete confirmation\n    app.confirm_delete = Some(0); // Simulate 'd' key\n    assert_eq!(app.confirm_delete, Some(0));\n    app.confirm_delete = None; // Simulate Esc\n    assert_eq!(app.confirm_delete, None);\n\n    // Test message handling\n    assert_eq!(app.message, None);\n    app.set_success_message(\"Test success\".to_string());\n    assert_eq!(app.message, Some((\"Test success\".to_string(), Color::Green)));\n    app.clear_message();\n    assert_eq!(app.message, None);\n\n    Ok(())\n}\n\n#[test]\nfn test_app_clipboard_operations() -\u003e Result\u003c()\u003e {\n    use command_vault::ui::app::copy_to_clipboard;\n    \n    // Skip this test in CI environment\n    if std::env::var(\"CI\").is_ok() {\n        return Ok(());\n    }\n\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Select a command\n    app.selected = Some(0);\n    assert_eq!(app.selected, Some(0));\n\n    // Get the command that will be copied\n    let command_to_copy = app.get_selected_command().unwrap().command.clone();\n    assert_eq!(command_to_copy, \"ls -la\");\n\n    // Try to copy command to clipboard, but don't fail the test if clipboard is unavailable\n    if let Err(_) = copy_to_clipboard(\u0026command_to_copy) {\n        eprintln!(\"Warning: Clipboard operations not available in this environment\");\n        return Ok(());\n    }\n\n    // Verify message is set after copy\n    assert_eq!(app.message, None);\n    app.set_success_message(\"Command copied to clipboard!\".to_string());\n    assert_eq!(app.message, Some((\"Command copied to clipboard!\".to_string(), Color::Green)));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_terminal_setup() -\u003e Result\u003c()\u003e {\n    // Skip this test in CI environment\n    if std::env::var(\"CI\").is_ok() {\n        return Ok(());\n    }\n\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test terminal setup\n    match enable_raw_mode() {\n        Ok(_) =\u003e {\n            let stdout = stdout();\n            let backend = CrosstermBackend::new(stdout);\n            if let Ok(terminal) = Terminal::new(backend) {\n                // Test terminal restoration\n                if let Ok(_) = disable_raw_mode() {\n                    assert!(!is_raw_mode_enabled().unwrap_or(true));\n                }\n            }\n        }\n        Err(_) =\u003e {\n            eprintln!(\"Warning: Terminal operations not available in this environment\");\n        }\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_app_ui_state() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test initial state\n    assert_eq!(app.show_help, false);\n    assert_eq!(app.message, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n    assert_eq!(app.selected, None);\n    assert_eq!(app.confirm_delete, None);\n\n    // Test help state\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n\n    // Test filter state\n    app.show_help = false;\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    assert_eq!(app.commands[app.filtered_commands[0]].command, \"git status\");\n\n    // Test message state\n    app.set_success_message(\"Test message\".to_string());\n    assert_eq!(app.message, Some((\"Test message\".to_string(), Color::Green)));\n\n    // Test delete confirmation state\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.selected, Some(0));\n    assert_eq!(app.confirm_delete, Some(0));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_handle_quit() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test quit with filter text\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test quit with confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.confirm_delete, None);\n\n    // Test quit with help screen\n    app.show_help = true;\n    assert_eq!(app.show_help, true);\n    \n    let result = app.handle_quit()?;\n    assert_eq!(result, None);\n    assert_eq!(app.show_help, false);\n\n    // Test normal quit\n    let result = app.handle_quit()?;\n    assert_eq!(result, Some(()));\n\n    Ok(())\n}\n\n#[test]\nfn test_app_handle_escape() -\u003e Result\u003c()\u003e {\n    let mut db = Database::new(\":memory:\")?;\n    db.init()?;\n    \n    let commands = create_test_commands();\n    let mut app = App::new(commands.clone(), \u0026mut db, false);\n\n    // Test escape with filter text\n    app.filter_text = \"git\".to_string();\n    app.update_filtered_commands();\n    assert_eq!(app.filter_text, \"git\");\n    assert_eq!(app.filtered_commands.len(), 1);\n    \n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.filter_text, \"\");\n    assert_eq!(app.filtered_commands.len(), 3);\n\n    // Test escape with confirm delete\n    app.selected = Some(0);\n    app.confirm_delete = Some(0);\n    assert_eq!(app.confirm_delete, Some(0));\n    \n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.confirm_delete, None);\n    assert_eq!(app.message, Some((\"Delete operation cancelled\".to_string(), Color::Yellow)));\n\n    // Test escape with no active state\n    app.clear_message();\n    let result = app.handle_escape()?;\n    assert_eq!(result, None);\n    assert_eq!(app.message, None);\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>